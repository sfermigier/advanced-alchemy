<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <title>sqlalchemy.sql.schema - Docs</title>
    <link rel="index" title="Index" href="../../../genindex.html" /><link rel="search" title="Search" href="../../../search.html" />
  <script>
    const isDarkTheme = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
    const sessionTheme = sessionStorage['_theme']
    if (sessionTheme) {
      document.documentElement.classList.add(sessionTheme)
    } else if (isDarkTheme) {
      document.documentElement.classList.add('dark')
    }
  </script><link rel="shortcut icon" href="../../../_static/logo.png"/><link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=aecf457f" />
    <link rel="stylesheet" type="text/css" href="../../../_static/shibuya.css?v=28c32440" />
    <link rel="stylesheet" type="text/css" href="../../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../../_static/design-style.1e8bd061cd6da7fc9cf755528e8ffc24.min.css?v=0a3b3ea7" />
    <link media="print" rel="stylesheet" type="text/css" href="../../../_static/print.css?v=ee381b95" />
    <link rel="stylesheet" type="text/css" href="../../../_static/css/custom.css?v=bf5addad" />
    <style>
:root {
  --sy-f-sys:-apple-system, BlinkMacSystemFont, Segoe UI, Oxygen, Ubuntu, Droid Sans, Helvetica Neue;--sy-f-cjk:PingFang SC, Hiragino Sans GB, Droid Sans Fallback, Microsoft YaHei;--sy-f-heading:var(--sy-f-sys), var(--sy-f-cjk), sans-serif;--sy-f-text:var(--sy-f-sys), var(--sy-f-cjk), sans-serif;--sy-f-mono:Menlo, Monaco, Consolas, "Courier New", monospace;--sy-c-divider:rgba(var(--sy-rc-text), 0.1);--sy-c-divider-weak:rgba(var(--sy-rc-text), 0.05);--sy-c-border:rgba(var(--sy-rc-text), 0.14);--sy-s-banner-height:0rem;--sy-s-navbar-height:56px;--sy-s-offset-top:calc(var(--sy-s-navbar-height) + var(--sy-s-banner-height));--sy-c-link:rgb(var(--sy-rc-theme));--sy-c-link-weak:rgba(var(--sy-rc-theme), 0.86);
  --sy-rc-theme:245, 0, 87;--sy-rc-bg:255, 255, 255;--sy-rc-invert:245, 0, 87;--sy-rc-text:245, 0, 87;--sy-c-bg:#fff;--sy-c-bg-weak:0, 0, 0;--sy-c-text:#000000;--sy-c-text-weak:#f50057;--sy-c-heading:#f50057;--sy-c-bold:#f50057;--sy-c-foot-text:#000000;--sy-c-foot-bg:#fafafa;--sy-c-foot-divider:#f50057;
}
@media (prefers-color-scheme: light) {
  :root {
    --sy-rc-theme:245, 0, 87;--sy-rc-bg:255, 255, 255;--sy-rc-invert:245, 0, 87;--sy-rc-text:245, 0, 87;--sy-c-bg:#fff;--sy-c-bg-weak:0, 0, 0;--sy-c-text:#000000;--sy-c-text-weak:#f50057;--sy-c-heading:#f50057;--sy-c-bold:#f50057;--sy-c-foot-text:#000000;--sy-c-foot-bg:#fafafa;--sy-c-foot-divider:#f50057;
  }
}
@media (prefers-color-scheme: dark) {
  :root {
    --sy-rc-theme:245, 0, 87;--sy-rc-bg:0, 0, 0;--sy-rc-invert:245, 0, 87;--sy-rc-text:245, 0, 87;--sy-c-bg:#f50057;--sy-c-bg-weak:#000000;--sy-c-text:#ebdddd;--sy-c-text-weak:#f50057;--sy-c-heading:#f50057;--sy-c-bold:#f50057;--sy-c-foot-text:#ebdddd;--sy-c-foot-bg:#000000;--sy-c-foot-divider:#f50057;
  }
}
html.light {
  --sy-rc-theme:245, 0, 87;--sy-rc-bg:255, 255, 255;--sy-rc-invert:245, 0, 87;--sy-rc-text:245, 0, 87;--sy-c-bg:#fff;--sy-c-bg-weak:0, 0, 0;--sy-c-text:#000000;--sy-c-text-weak:#f50057;--sy-c-heading:#f50057;--sy-c-bold:#f50057;--sy-c-foot-text:#000000;--sy-c-foot-bg:#fafafa;--sy-c-foot-divider:#f50057;
}
html.dark {
  --sy-rc-theme:245, 0, 87;--sy-rc-bg:0, 0, 0;--sy-rc-invert:245, 0, 87;--sy-rc-text:245, 0, 87;--sy-c-bg:#f50057;--sy-c-bg-weak:#000000;--sy-c-text:#ebdddd;--sy-c-text-weak:#f50057;--sy-c-heading:#f50057;--sy-c-bold:#f50057;--sy-c-foot-text:#ebdddd;--sy-c-foot-bg:#000000;--sy-c-foot-divider:#f50057;
}
</style>
    <link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@500;600;700&display=swap" rel="stylesheet">
<style>
:root {
  --sy-f-heading: Inter, var(--sy-f-sys), var(--sy-f-cjk), sans-serif;
}
</style>
    <meta property="og:type" content="website"/><meta property="og:title" content="sqlalchemy.sql.schema"/>
<meta name="twitter:card" content="summary"/></head>
<body><div class="document"><div class="announcement">
    <div class="announcement-inner">
      <p>This documentation is currently under development.</p>
      <button class="announcement-close" aria-label="Close announcement">
        <i class="i-icon close"></i>
      </button>
    </div>
  </div><div class="sy-head">
  <div class="sy-head-blur"></div>
  <div class="sy-head-inner sy-container mx-auto">
    <a class="sy-head-brand mr-4" href="/">
      <img class="light-logo" src="../../../_static/logo.png" alt="advanced_alchemy" height="28" />
      <img class="dark-logo" src="../../../_static/logo.png" alt="advanced_alchemy" height="28" />
      <strong>advanced_alchemy</strong>
    </a>
    <div class="sy-head-links" id="NavLinks">
      <nav class="sy-head-nav">

<ul><li class="link">
          <a href="https://advanced-alchemy.jolt.rs"><span>Home</span><i class="i-icon external-link"></i></a>
        </li><li class="link">
          <a href="https://docs.advanced-alchemy.jolt.rs"><span>Docs</span><i class="i-icon external-link"></i></a>
        </li><li class="link">
          <a href="https://github.com/jolt-org/advanced-alchemy"><span>Code</span><i class="i-icon external-link"></i></a>
        </li></ul></nav>
      <div class="sy-head-extra flex items-center print:hidden"><form class="searchbox flex items-center" action="../../../search.html" method="get">
  <input type="text" name="q" placeholder="Search" />
  <kbd>/</kbd>
</form>
        
        
        <div class="sy-head-social flex items-center">
            <a class="flex items-center" href="https://github.com/jolt-org/advanced-alchemy" aria-label="GitHub">
              <i class="i-icon github"></i>
            </a>
        </div>
      </div>
    </div>
    <div class="sy-head-actions flex items-center shrink-0 print:hidden">
      <button class="js-theme theme-switch flex items-center" data-aria-light="Switch to dark mode" data-aria-dark="Switch to light mode">
        <i class="i-icon theme-icon"></i>
      </button>
      <button class="md:hidden flex items-center js-menu" aria-label="Menu" type="button" aria-controls="NavLinks" aria-expanded="false">
        <div class="hamburger">
          <span class="hamburger_1"></span>
          <span class="hamburger_2 -translate-x-2"></span>
          <span class="hamburger_3 -translate-x-1"></span>
        </div>
      </button>
    </div>
  </div>
</div>
<div class="sy-page sy-container flex mx-auto">
  <aside id="lside" class="sy-lside md:w-72 md:shrink-0 print:hidden">
    <div class="sy-lside-inner md:sticky">
      <div class="sy-scrollbar p-6">
        <div class="globaltoc" data-expand-depth="0"><p class="caption" role="heading"><span class="caption-text">Advanced Alchemy Documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../usage/index.html">Usage</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../usage/placeholder.html">Placeholder</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../reference/index.html">API Reference</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../reference/base.html">base</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../reference/exceptions.html">exceptions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../reference/filters.html">filters</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../reference/operations.html">operations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../reference/repository.html">repositories</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../reference/types.html">types</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../reference/alembic/index.html">alembic</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../reference/alembic/commands.html">commands</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../reference/alembic/templates/asyncio/index.html">asyncio</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../reference/alembic/templates/asyncio/alembic-ini.html">alembic.ini</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../reference/alembic/templates/asyncio/env.html">env</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../reference/alembic/templates/asyncio/script-py.html">script.py</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../reference/alembic/templates/sync/index.html">sync</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../reference/alembic/templates/sync/alembic-ini.html">alembic.ini</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../reference/alembic/templates/sync/env.html">env</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../reference/alembic/templates/sync/script-py.html">script.py</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../reference/config/index.html">config</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../reference/config/asyncio.html">asyncio</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../reference/config/common.html">common</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../reference/config/engine.html">engine</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../reference/config/sync.html">sync</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../reference/config/types.html">types</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../reference/extensions/index.html">extensions</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../reference/extensions/litestar/index.html">litestar</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../reference/extensions/litestar/alembic.html">alembic</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../reference/extensions/litestar/cli.html">cli</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../reference/extensions/litestar/dto.html">dto</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../reference/extensions/litestar/plugins/index.html">plugins</a><ul>
<li class="toctree-l5"><a class="reference internal" href="../../../reference/extensions/litestar/plugins/serialization.html">serialization</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../reference/extensions/litestar/plugins/init/plugin.html">plugin</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../reference/extensions/litestar/plugins/init/config/asyncio.html">asyncio</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../reference/extensions/litestar/plugins/init/config/common.html">common</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../reference/extensions/litestar/plugins/init/config/engine.html">engine</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../reference/extensions/litestar/plugins/init/config/sync.html">sync</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../reference/extensions/litestar/plugins/init/config/types.html">types</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../reference/extensions/sanic.html">sanic</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../reference/extensions/starlette.html">starlette</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Development</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../changelog.html">Changelog</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../contribution-guide.html">Contribution guide</a></li>
</ul>

        </div>
      </div>
      
    </div>
  </aside>
  <div class="lside-overlay js-menu" role="button" aria-label="Close left sidebar" aria-controls="lside" aria-expanded="false"></div>
  <aside id="rside" class="sy-rside pb-3 w-64 shrink-0 order-last">
    <button class="rside-close js-menu xl:hidden" aria-label="Close Table of Contents" type="button" aria-controls="rside" aria-expanded="false">
      <i class="i-icon close"></i>
    </button>
    <div class="sy-scrollbar sy-rside-inner px-6 xl:top-16 xl:sticky xl:pl-0 pt-6 pb-4"><a class="js-repo-stats repo-stats flex items-center" href="https://github.com/jolt-org/advanced-alchemy"
  data-type="github" data-user="jolt-org" data-repo="advanced-alchemy">
  <span class="w-8 flex items-center justify-around shrink-0 text-2xl">
    <i class="i-icon github"></i>
  </span>
  <span class="flex-grow px-2">
    <span>jolt-org/advanced-alchemy</span>
    <span class="flex text-sm repo-stats-count">
      <span class="flex items-center pr-3">
        <i class="i-icon star"></i>
        <strong class="js-repo-stars ml-1">0</strong>
      </span>
      <span class="flex items-center">
        <i class="i-icon git-fork"></i>
        <strong class="js-repo-forks ml-1">0</strong>
      </span>
    </span>
  </span>
</a><div id="ethical-ad-placement" data-ea-publisher="readthedocs"></div>
    </div>
  </aside>
  <div class="rside-overlay js-menu" role="button" aria-label="Close Table of Contents" aria-controls="rside" aria-expanded="false"></div>
  <main class="sy-main w-full max-sm:max-w-full print:pt-6">
    <div class="sy-breadcrumbs" role="navigation">
  <div class="sy-breadcrumbs-inner flex items-center">
    <div class="md:hidden mr-3">
      <button class="js-menu" aria-label="Menu" type="button" aria-controls="lside" aria-expanded="false">
        <i class="i-icon menu"></i>
      </button>
    </div>
    <ul class="flex-1">
      
      
      <li><a href="../../../index.html">advanced_alchemy</a><span>/</span></li>
      
      <li><a href="../../index.html">Module code</a><span>/</span></li>
      
      <li><strong>sqlalchemy.sql.schema</strong></li>
      
      
    </ul>
    <div class="xl:hidden ml-1">
      <button class="js-menu" aria-label="Show table of contents" type="button" aria-controls="rside"
        aria-expanded="false">
        <i class="i-icon outdent"></i>
      </button>
    </div>
  </div>
</div>
    <div class="flex flex-col break-words justify-between">
      <div class="min-w-0 max-w-6xl px-6 pb-6 pt-8 xl:px-12">
        <article class="yue" role="main">
          <h1>Source code for sqlalchemy.sql.schema</h1><div class="highlight"><pre>
<span></span><span id="1-1"><span class="c1"># sql/schema.py</span>
</span><span id="1-2"><span class="c1"># Copyright (C) 2005-2023 the SQLAlchemy authors and contributors</span>
</span><span id="1-3"><span class="c1"># &lt;see AUTHORS file&gt;</span>
</span><span id="1-4"><span class="c1">#</span>
</span><span id="1-5"><span class="c1"># This module is part of SQLAlchemy and is released under</span>
</span><span id="1-6"><span class="c1"># the MIT License: https://www.opensource.org/licenses/mit-license.php</span>
</span><span id="1-7">
</span><span id="1-8"><span class="sd">&quot;&quot;&quot;The schema module provides the building blocks for database metadata.</span>
</span><span id="1-9">
</span><span id="1-10"><span class="sd">Each element within this module describes a database entity which can be</span>
</span><span id="1-11"><span class="sd">created and dropped, or is otherwise part of such an entity.  Examples include</span>
</span><span id="1-12"><span class="sd">tables, columns, sequences, and indexes.</span>
</span><span id="1-13">
</span><span id="1-14"><span class="sd">All entities are subclasses of :class:`~sqlalchemy.schema.SchemaItem`, and as</span>
</span><span id="1-15"><span class="sd">defined in this module they are intended to be agnostic of any vendor-specific</span>
</span><span id="1-16"><span class="sd">constructs.</span>
</span><span id="1-17">
</span><span id="1-18"><span class="sd">A collection of entities are grouped into a unit called</span>
</span><span id="1-19"><span class="sd">:class:`~sqlalchemy.schema.MetaData`. MetaData serves as a logical grouping of</span>
</span><span id="1-20"><span class="sd">schema elements, and can also be associated with an actual database connection</span>
</span><span id="1-21"><span class="sd">such that operations involving the contained elements can contact the database</span>
</span><span id="1-22"><span class="sd">as needed.</span>
</span><span id="1-23">
</span><span id="1-24"><span class="sd">Two of the elements here also build upon their &quot;syntactic&quot; counterparts, which</span>
</span><span id="1-25"><span class="sd">are defined in :class:`~sqlalchemy.sql.expression.`, specifically</span>
</span><span id="1-26"><span class="sd">:class:`~sqlalchemy.schema.Table` and :class:`~sqlalchemy.schema.Column`.</span>
</span><span id="1-27"><span class="sd">Since these objects are part of the SQL expression language, they are usable</span>
</span><span id="1-28"><span class="sd">as components in SQL expressions.</span>
</span><span id="1-29">
</span><span id="1-30"><span class="sd">&quot;&quot;&quot;</span>
</span><span id="1-31"><span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">annotations</span>
</span><span id="1-32">
</span><span id="1-33"><span class="kn">from</span> <span class="nn">abc</span> <span class="kn">import</span> <span class="n">ABC</span>
</span><span id="1-34"><span class="kn">import</span> <span class="nn">collections</span>
</span><span id="1-35"><span class="kn">from</span> <span class="nn">enum</span> <span class="kn">import</span> <span class="n">Enum</span>
</span><span id="1-36"><span class="kn">import</span> <span class="nn">operator</span>
</span><span id="1-37"><span class="kn">import</span> <span class="nn">typing</span>
</span><span id="1-38"><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Any</span>
</span><span id="1-39"><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Callable</span>
</span><span id="1-40"><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">cast</span>
</span><span id="1-41"><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Collection</span>
</span><span id="1-42"><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Dict</span>
</span><span id="1-43"><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Iterable</span>
</span><span id="1-44"><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Iterator</span>
</span><span id="1-45"><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">List</span>
</span><span id="1-46"><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Mapping</span>
</span><span id="1-47"><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">NoReturn</span>
</span><span id="1-48"><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Optional</span>
</span><span id="1-49"><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">overload</span>
</span><span id="1-50"><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Sequence</span> <span class="k">as</span> <span class="n">_typing_Sequence</span>
</span><span id="1-51"><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Set</span>
</span><span id="1-52"><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Tuple</span>
</span><span id="1-53"><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">TYPE_CHECKING</span>
</span><span id="1-54"><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">TypeVar</span>
</span><span id="1-55"><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Union</span>
</span><span id="1-56">
</span><span id="1-57"><span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">coercions</span>
</span><span id="1-58"><span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">ddl</span>
</span><span id="1-59"><span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">roles</span>
</span><span id="1-60"><span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">type_api</span>
</span><span id="1-61"><span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">visitors</span>
</span><span id="1-62"><span class="kn">from</span> <span class="nn">.base</span> <span class="kn">import</span> <span class="n">_DefaultDescriptionTuple</span>
</span><span id="1-63"><span class="kn">from</span> <span class="nn">.base</span> <span class="kn">import</span> <span class="n">_NoneName</span>
</span><span id="1-64"><span class="kn">from</span> <span class="nn">.base</span> <span class="kn">import</span> <span class="n">_SentinelColumnCharacterization</span>
</span><span id="1-65"><span class="kn">from</span> <span class="nn">.base</span> <span class="kn">import</span> <span class="n">_SentinelDefaultCharacterization</span>
</span><span id="1-66"><span class="kn">from</span> <span class="nn">.base</span> <span class="kn">import</span> <span class="n">DedupeColumnCollection</span>
</span><span id="1-67"><span class="kn">from</span> <span class="nn">.base</span> <span class="kn">import</span> <span class="n">DialectKWArgs</span>
</span><span id="1-68"><span class="kn">from</span> <span class="nn">.base</span> <span class="kn">import</span> <span class="n">Executable</span>
</span><span id="1-69"><span class="kn">from</span> <span class="nn">.base</span> <span class="kn">import</span> <span class="n">SchemaEventTarget</span> <span class="k">as</span> <span class="n">SchemaEventTarget</span>
</span><span id="1-70"><span class="kn">from</span> <span class="nn">.coercions</span> <span class="kn">import</span> <span class="n">_document_text_coercion</span>
</span><span id="1-71"><span class="kn">from</span> <span class="nn">.elements</span> <span class="kn">import</span> <span class="n">ClauseElement</span>
</span><span id="1-72"><span class="kn">from</span> <span class="nn">.elements</span> <span class="kn">import</span> <span class="n">ColumnClause</span>
</span><span id="1-73"><span class="kn">from</span> <span class="nn">.elements</span> <span class="kn">import</span> <span class="n">ColumnElement</span>
</span><span id="1-74"><span class="kn">from</span> <span class="nn">.elements</span> <span class="kn">import</span> <span class="n">quoted_name</span>
</span><span id="1-75"><span class="kn">from</span> <span class="nn">.elements</span> <span class="kn">import</span> <span class="n">TextClause</span>
</span><span id="1-76"><span class="kn">from</span> <span class="nn">.selectable</span> <span class="kn">import</span> <span class="n">TableClause</span>
</span><span id="1-77"><span class="kn">from</span> <span class="nn">.type_api</span> <span class="kn">import</span> <span class="n">to_instance</span>
</span><span id="1-78"><span class="kn">from</span> <span class="nn">.visitors</span> <span class="kn">import</span> <span class="n">ExternallyTraversible</span>
</span><span id="1-79"><span class="kn">from</span> <span class="nn">.visitors</span> <span class="kn">import</span> <span class="n">InternalTraversal</span>
</span><span id="1-80"><span class="kn">from</span> <span class="nn">..</span> <span class="kn">import</span> <span class="n">event</span>
</span><span id="1-81"><span class="kn">from</span> <span class="nn">..</span> <span class="kn">import</span> <span class="n">exc</span>
</span><span id="1-82"><span class="kn">from</span> <span class="nn">..</span> <span class="kn">import</span> <span class="n">inspection</span>
</span><span id="1-83"><span class="kn">from</span> <span class="nn">..</span> <span class="kn">import</span> <span class="n">util</span>
</span><span id="1-84"><span class="kn">from</span> <span class="nn">..util</span> <span class="kn">import</span> <span class="n">HasMemoized</span>
</span><span id="1-85"><span class="kn">from</span> <span class="nn">..util.typing</span> <span class="kn">import</span> <span class="n">Final</span>
</span><span id="1-86"><span class="kn">from</span> <span class="nn">..util.typing</span> <span class="kn">import</span> <span class="n">Literal</span>
</span><span id="1-87"><span class="kn">from</span> <span class="nn">..util.typing</span> <span class="kn">import</span> <span class="n">Protocol</span>
</span><span id="1-88"><span class="kn">from</span> <span class="nn">..util.typing</span> <span class="kn">import</span> <span class="n">Self</span>
</span><span id="1-89"><span class="kn">from</span> <span class="nn">..util.typing</span> <span class="kn">import</span> <span class="n">TypedDict</span>
</span><span id="1-90"><span class="kn">from</span> <span class="nn">..util.typing</span> <span class="kn">import</span> <span class="n">TypeGuard</span>
</span><span id="1-91">
</span><span id="1-92"><span class="k">if</span> <span class="n">typing</span><span class="o">.</span><span class="n">TYPE_CHECKING</span><span class="p">:</span>
</span><span id="1-93">    <span class="kn">from</span> <span class="nn">._typing</span> <span class="kn">import</span> <span class="n">_AutoIncrementType</span>
</span><span id="1-94">    <span class="kn">from</span> <span class="nn">._typing</span> <span class="kn">import</span> <span class="n">_DDLColumnArgument</span>
</span><span id="1-95">    <span class="kn">from</span> <span class="nn">._typing</span> <span class="kn">import</span> <span class="n">_InfoType</span>
</span><span id="1-96">    <span class="kn">from</span> <span class="nn">._typing</span> <span class="kn">import</span> <span class="n">_TextCoercedExpressionArgument</span>
</span><span id="1-97">    <span class="kn">from</span> <span class="nn">._typing</span> <span class="kn">import</span> <span class="n">_TypeEngineArgument</span>
</span><span id="1-98">    <span class="kn">from</span> <span class="nn">.base</span> <span class="kn">import</span> <span class="n">ReadOnlyColumnCollection</span>
</span><span id="1-99">    <span class="kn">from</span> <span class="nn">.compiler</span> <span class="kn">import</span> <span class="n">DDLCompiler</span>
</span><span id="1-100">    <span class="kn">from</span> <span class="nn">.elements</span> <span class="kn">import</span> <span class="n">BindParameter</span>
</span><span id="1-101">    <span class="kn">from</span> <span class="nn">.functions</span> <span class="kn">import</span> <span class="n">Function</span>
</span><span id="1-102">    <span class="kn">from</span> <span class="nn">.type_api</span> <span class="kn">import</span> <span class="n">TypeEngine</span>
</span><span id="1-103">    <span class="kn">from</span> <span class="nn">.visitors</span> <span class="kn">import</span> <span class="n">_TraverseInternalsType</span>
</span><span id="1-104">    <span class="kn">from</span> <span class="nn">.visitors</span> <span class="kn">import</span> <span class="n">anon_map</span>
</span><span id="1-105">    <span class="kn">from</span> <span class="nn">..engine</span> <span class="kn">import</span> <span class="n">Connection</span>
</span><span id="1-106">    <span class="kn">from</span> <span class="nn">..engine</span> <span class="kn">import</span> <span class="n">Engine</span>
</span><span id="1-107">    <span class="kn">from</span> <span class="nn">..engine.interfaces</span> <span class="kn">import</span> <span class="n">_CoreMultiExecuteParams</span>
</span><span id="1-108">    <span class="kn">from</span> <span class="nn">..engine.interfaces</span> <span class="kn">import</span> <span class="n">CoreExecuteOptionsParameter</span>
</span><span id="1-109">    <span class="kn">from</span> <span class="nn">..engine.interfaces</span> <span class="kn">import</span> <span class="n">ExecutionContext</span>
</span><span id="1-110">    <span class="kn">from</span> <span class="nn">..engine.mock</span> <span class="kn">import</span> <span class="n">MockConnection</span>
</span><span id="1-111">    <span class="kn">from</span> <span class="nn">..engine.reflection</span> <span class="kn">import</span> <span class="n">_ReflectionInfo</span>
</span><span id="1-112">    <span class="kn">from</span> <span class="nn">..sql.selectable</span> <span class="kn">import</span> <span class="n">FromClause</span>
</span><span id="1-113">
</span><span id="1-114"><span class="n">_T</span> <span class="o">=</span> <span class="n">TypeVar</span><span class="p">(</span><span class="s2">&quot;_T&quot;</span><span class="p">,</span> <span class="n">bound</span><span class="o">=</span><span class="s2">&quot;Any&quot;</span><span class="p">)</span>
</span><span id="1-115"><span class="n">_SI</span> <span class="o">=</span> <span class="n">TypeVar</span><span class="p">(</span><span class="s2">&quot;_SI&quot;</span><span class="p">,</span> <span class="n">bound</span><span class="o">=</span><span class="s2">&quot;SchemaItem&quot;</span><span class="p">)</span>
</span><span id="1-116"><span class="n">_TAB</span> <span class="o">=</span> <span class="n">TypeVar</span><span class="p">(</span><span class="s2">&quot;_TAB&quot;</span><span class="p">,</span> <span class="n">bound</span><span class="o">=</span><span class="s2">&quot;Table&quot;</span><span class="p">)</span>
</span><span id="1-117">
</span><span id="1-118">
</span><span id="1-119"><span class="n">_CreateDropBind</span> <span class="o">=</span> <span class="n">Union</span><span class="p">[</span><span class="s2">&quot;Engine&quot;</span><span class="p">,</span> <span class="s2">&quot;Connection&quot;</span><span class="p">,</span> <span class="s2">&quot;MockConnection&quot;</span><span class="p">]</span>
</span><span id="1-120">
</span><span id="1-121"><span class="n">_ConstraintNameArgument</span> <span class="o">=</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">_NoneName</span><span class="p">]]</span>
</span><span id="1-122">
</span><span id="1-123"><span class="n">_ServerDefaultArgument</span> <span class="o">=</span> <span class="n">Union</span><span class="p">[</span>
</span><span id="1-124">    <span class="s2">&quot;FetchedValue&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="n">TextClause</span><span class="p">,</span> <span class="n">ColumnElement</span><span class="p">[</span><span class="n">Any</span><span class="p">]</span>
</span><span id="1-125"><span class="p">]</span>
</span><span id="1-126">
</span><span id="1-127">
</span><span id="1-128"><span class="k">class</span> <span class="nc">SchemaConst</span><span class="p">(</span><span class="n">Enum</span><span class="p">):</span>
</span><span id="1-129">    <span class="n">RETAIN_SCHEMA</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="1-130"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Symbol indicating that a :class:`_schema.Table`, :class:`.Sequence`</span>
</span><span id="1-131"><span class="sd">    or in some cases a :class:`_schema.ForeignKey` object, in situations</span>
</span><span id="1-132"><span class="sd">    where the object is being copied for a :meth:`.Table.to_metadata`</span>
</span><span id="1-133"><span class="sd">    operation, should retain the schema name that it already has.</span>
</span><span id="1-134">
</span><span id="1-135"><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="1-136">
</span><span id="1-137">    <span class="n">BLANK_SCHEMA</span> <span class="o">=</span> <span class="mi">2</span>
</span><span id="1-138"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Symbol indicating that a :class:`_schema.Table` or :class:`.Sequence`</span>
</span><span id="1-139"><span class="sd">    should have &#39;None&#39; for its schema, even if the parent</span>
</span><span id="1-140"><span class="sd">    :class:`_schema.MetaData` has specified a schema.</span>
</span><span id="1-141">
</span><span id="1-142"><span class="sd">    .. seealso::</span>
</span><span id="1-143">
</span><span id="1-144"><span class="sd">        :paramref:`_schema.MetaData.schema`</span>
</span><span id="1-145">
</span><span id="1-146"><span class="sd">        :paramref:`_schema.Table.schema`</span>
</span><span id="1-147">
</span><span id="1-148"><span class="sd">        :paramref:`.Sequence.schema`</span>
</span><span id="1-149">
</span><span id="1-150"><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="1-151">
</span><span id="1-152">    <span class="n">NULL_UNSPECIFIED</span> <span class="o">=</span> <span class="mi">3</span>
</span><span id="1-153"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Symbol indicating the &quot;nullable&quot; keyword was not passed to a Column.</span>
</span><span id="1-154">
</span><span id="1-155"><span class="sd">    This is used to distinguish between the use case of passing</span>
</span><span id="1-156"><span class="sd">    ``nullable=None`` to a :class:`.Column`, which has special meaning</span>
</span><span id="1-157"><span class="sd">    on some backends such as SQL Server.</span>
</span><span id="1-158">
</span><span id="1-159"><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="1-160">
</span><span id="1-161">
</span><span id="1-162"><span class="n">RETAIN_SCHEMA</span><span class="p">:</span> <span class="n">Final</span><span class="p">[</span>
</span><span id="1-163">    <span class="n">Literal</span><span class="p">[</span><span class="n">SchemaConst</span><span class="o">.</span><span class="n">RETAIN_SCHEMA</span><span class="p">]</span>
</span><span id="1-164"><span class="p">]</span> <span class="o">=</span> <span class="n">SchemaConst</span><span class="o">.</span><span class="n">RETAIN_SCHEMA</span>
</span><span id="1-165"><span class="n">BLANK_SCHEMA</span><span class="p">:</span> <span class="n">Final</span><span class="p">[</span>
</span><span id="1-166">    <span class="n">Literal</span><span class="p">[</span><span class="n">SchemaConst</span><span class="o">.</span><span class="n">BLANK_SCHEMA</span><span class="p">]</span>
</span><span id="1-167"><span class="p">]</span> <span class="o">=</span> <span class="n">SchemaConst</span><span class="o">.</span><span class="n">BLANK_SCHEMA</span>
</span><span id="1-168"><span class="n">NULL_UNSPECIFIED</span><span class="p">:</span> <span class="n">Final</span><span class="p">[</span>
</span><span id="1-169">    <span class="n">Literal</span><span class="p">[</span><span class="n">SchemaConst</span><span class="o">.</span><span class="n">NULL_UNSPECIFIED</span><span class="p">]</span>
</span><span id="1-170"><span class="p">]</span> <span class="o">=</span> <span class="n">SchemaConst</span><span class="o">.</span><span class="n">NULL_UNSPECIFIED</span>
</span><span id="1-171">
</span><span id="1-172">
</span><span id="1-173"><span class="k">def</span> <span class="nf">_get_table_key</span><span class="p">(</span><span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">schema</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="1-174">    <span class="k">if</span> <span class="n">schema</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-175">        <span class="k">return</span> <span class="n">name</span>
</span><span id="1-176">    <span class="k">else</span><span class="p">:</span>
</span><span id="1-177">        <span class="k">return</span> <span class="n">schema</span> <span class="o">+</span> <span class="s2">&quot;.&quot;</span> <span class="o">+</span> <span class="n">name</span>
</span><span id="1-178">
</span><span id="1-179">
</span><span id="1-180"><span class="c1"># this should really be in sql/util.py but we&#39;d have to</span>
</span><span id="1-181"><span class="c1"># break an import cycle</span>
</span><span id="1-182"><span class="k">def</span> <span class="nf">_copy_expression</span><span class="p">(</span>
</span><span id="1-183">    <span class="n">expression</span><span class="p">:</span> <span class="n">ColumnElement</span><span class="p">[</span><span class="n">Any</span><span class="p">],</span>
</span><span id="1-184">    <span class="n">source_table</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Table</span><span class="p">],</span>
</span><span id="1-185">    <span class="n">target_table</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Table</span><span class="p">],</span>
</span><span id="1-186"><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ColumnElement</span><span class="p">[</span><span class="n">Any</span><span class="p">]:</span>
</span><span id="1-187">    <span class="k">if</span> <span class="n">source_table</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">target_table</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-188">        <span class="k">return</span> <span class="n">expression</span>
</span><span id="1-189">
</span><span id="1-190">    <span class="n">fixed_source_table</span> <span class="o">=</span> <span class="n">source_table</span>
</span><span id="1-191">    <span class="n">fixed_target_table</span> <span class="o">=</span> <span class="n">target_table</span>
</span><span id="1-192">
</span><span id="1-193">    <span class="k">def</span> <span class="nf">replace</span><span class="p">(</span>
</span><span id="1-194">        <span class="n">element</span><span class="p">:</span> <span class="n">ExternallyTraversible</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">:</span> <span class="n">Any</span>
</span><span id="1-195">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ExternallyTraversible</span><span class="p">]:</span>
</span><span id="1-196">        <span class="k">if</span> <span class="p">(</span>
</span><span id="1-197">            <span class="nb">isinstance</span><span class="p">(</span><span class="n">element</span><span class="p">,</span> <span class="n">Column</span><span class="p">)</span>
</span><span id="1-198">            <span class="ow">and</span> <span class="n">element</span><span class="o">.</span><span class="n">table</span> <span class="ow">is</span> <span class="n">fixed_source_table</span>
</span><span id="1-199">            <span class="ow">and</span> <span class="n">element</span><span class="o">.</span><span class="n">key</span> <span class="ow">in</span> <span class="n">fixed_source_table</span><span class="o">.</span><span class="n">c</span>
</span><span id="1-200">        <span class="p">):</span>
</span><span id="1-201">            <span class="k">return</span> <span class="n">fixed_target_table</span><span class="o">.</span><span class="n">c</span><span class="p">[</span><span class="n">element</span><span class="o">.</span><span class="n">key</span><span class="p">]</span>
</span><span id="1-202">        <span class="k">else</span><span class="p">:</span>
</span><span id="1-203">            <span class="k">return</span> <span class="kc">None</span>
</span><span id="1-204">
</span><span id="1-205">    <span class="k">return</span> <span class="n">cast</span><span class="p">(</span>
</span><span id="1-206">        <span class="n">ColumnElement</span><span class="p">[</span><span class="n">Any</span><span class="p">],</span>
</span><span id="1-207">        <span class="n">visitors</span><span class="o">.</span><span class="n">replacement_traverse</span><span class="p">(</span><span class="n">expression</span><span class="p">,</span> <span class="p">{},</span> <span class="n">replace</span><span class="p">),</span>
</span><span id="1-208">    <span class="p">)</span>
</span><span id="1-209">
</span><span id="1-210">
</span><span id="1-211"><span class="nd">@inspection</span><span class="o">.</span><span class="n">_self_inspects</span>
</span><span id="1-212"><span class="k">class</span> <span class="nc">SchemaItem</span><span class="p">(</span><span class="n">SchemaEventTarget</span><span class="p">,</span> <span class="n">visitors</span><span class="o">.</span><span class="n">Visitable</span><span class="p">):</span>
</span><span id="1-213"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Base class for items that define a database schema.&quot;&quot;&quot;</span>
</span><span id="1-214">
</span><span id="1-215">    <span class="n">__visit_name__</span> <span class="o">=</span> <span class="s2">&quot;schema_item&quot;</span>
</span><span id="1-216">
</span><span id="1-217">    <span class="n">create_drop_stringify_dialect</span> <span class="o">=</span> <span class="s2">&quot;default&quot;</span>
</span><span id="1-218">
</span><span id="1-219">    <span class="k">def</span> <span class="nf">_init_items</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">SchemaItem</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-220"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize the list of child items for this SchemaItem.&quot;&quot;&quot;</span>
</span><span id="1-221">        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">args</span><span class="p">:</span>
</span><span id="1-222">            <span class="k">if</span> <span class="n">item</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-223">                <span class="k">try</span><span class="p">:</span>
</span><span id="1-224">                    <span class="n">spwd</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">_set_parent_with_dispatch</span>
</span><span id="1-225">                <span class="k">except</span> <span class="ne">AttributeError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
</span><span id="1-226">                    <span class="k">raise</span> <span class="n">exc</span><span class="o">.</span><span class="n">ArgumentError</span><span class="p">(</span>
</span><span id="1-227">                        <span class="s2">&quot;&#39;SchemaItem&#39; object, such as a &#39;Column&#39; or a &quot;</span>
</span><span id="1-228">                        <span class="s2">&quot;&#39;Constraint&#39; expected, got </span><span class="si">%r</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">item</span>
</span><span id="1-229">                    <span class="p">)</span> <span class="kn">from</span> <span class="nn">err</span>
</span><span id="1-230">                <span class="k">else</span><span class="p">:</span>
</span><span id="1-231">                    <span class="n">spwd</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>
</span><span id="1-232">
</span><span id="1-233">    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="1-234">        <span class="k">return</span> <span class="n">util</span><span class="o">.</span><span class="n">generic_repr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">omit_kwarg</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;info&quot;</span><span class="p">])</span>
</span><span id="1-235">
</span><span id="1-236">    <span class="nd">@util</span><span class="o">.</span><span class="n">memoized_property</span>
</span><span id="1-237">    <span class="k">def</span> <span class="nf">info</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_InfoType</span><span class="p">:</span>
</span><span id="1-238"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Info dictionary associated with the object, allowing user-defined</span>
</span><span id="1-239"><span class="sd">        data to be associated with this :class:`.SchemaItem`.</span>
</span><span id="1-240">
</span><span id="1-241"><span class="sd">        The dictionary is automatically generated when first accessed.</span>
</span><span id="1-242"><span class="sd">        It can also be specified in the constructor of some objects,</span>
</span><span id="1-243"><span class="sd">        such as :class:`_schema.Table` and :class:`_schema.Column`.</span>
</span><span id="1-244">
</span><span id="1-245"><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="1-246">        <span class="k">return</span> <span class="p">{}</span>
</span><span id="1-247">
</span><span id="1-248">    <span class="k">def</span> <span class="nf">_schema_item_copy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">schema_item</span><span class="p">:</span> <span class="n">_SI</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_SI</span><span class="p">:</span>
</span><span id="1-249">        <span class="k">if</span> <span class="s2">&quot;info&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">:</span>
</span><span id="1-250">            <span class="n">schema_item</span><span class="o">.</span><span class="n">info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="1-251">        <span class="n">schema_item</span><span class="o">.</span><span class="n">dispatch</span><span class="o">.</span><span class="n">_update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dispatch</span><span class="p">)</span>
</span><span id="1-252">        <span class="k">return</span> <span class="n">schema_item</span>
</span><span id="1-253">
</span><span id="1-254">    <span class="n">_use_schema_map</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="1-255">
</span><span id="1-256">
</span><span id="1-257"><span class="k">class</span> <span class="nc">HasConditionalDDL</span><span class="p">:</span>
</span><span id="1-258"><span class="w">    </span><span class="sd">&quot;&quot;&quot;define a class that includes the :meth:`.HasConditionalDDL.ddl_if`</span>
</span><span id="1-259"><span class="sd">    method, allowing for conditional rendering of DDL.</span>
</span><span id="1-260">
</span><span id="1-261"><span class="sd">    Currently applies to constraints and indexes.</span>
</span><span id="1-262">
</span><span id="1-263"><span class="sd">    .. versionadded:: 2.0</span>
</span><span id="1-264">
</span><span id="1-265">
</span><span id="1-266"><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="1-267">
</span><span id="1-268">    <span class="n">_ddl_if</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ddl</span><span class="o">.</span><span class="n">DDLIf</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="1-269">
</span><span id="1-270">    <span class="k">def</span> <span class="nf">ddl_if</span><span class="p">(</span>
</span><span id="1-271">        <span class="bp">self</span><span class="p">,</span>
</span><span id="1-272">        <span class="n">dialect</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="1-273">        <span class="n">callable_</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ddl</span><span class="o">.</span><span class="n">DDLIfCallable</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="1-274">        <span class="n">state</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="1-275">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Self</span><span class="p">:</span>
</span><span id="1-276"><span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;apply a conditional DDL rule to this schema item.</span>
</span><span id="1-277">
</span><span id="1-278"><span class="sd">        These rules work in a similar manner to the</span>
</span><span id="1-279"><span class="sd">        :meth:`.ExecutableDDLElement.execute_if` callable, with the added</span>
</span><span id="1-280"><span class="sd">        feature that the criteria may be checked within the DDL compilation</span>
</span><span id="1-281"><span class="sd">        phase for a construct such as :class:`.CreateTable`.</span>
</span><span id="1-282"><span class="sd">        :meth:`.HasConditionalDDL.ddl_if` currently applies towards the</span>
</span><span id="1-283"><span class="sd">        :class:`.Index` construct as well as all :class:`.Constraint`</span>
</span><span id="1-284"><span class="sd">        constructs.</span>
</span><span id="1-285">
</span><span id="1-286"><span class="sd">        :param dialect: string name of a dialect, or a tuple of string names</span>
</span><span id="1-287"><span class="sd">         to indicate multiple dialect types.</span>
</span><span id="1-288">
</span><span id="1-289"><span class="sd">        :param callable\_: a callable that is constructed using the same form</span>
</span><span id="1-290"><span class="sd">         as that described in</span>
</span><span id="1-291"><span class="sd">         :paramref:`.ExecutableDDLElement.execute_if.callable_`.</span>
</span><span id="1-292">
</span><span id="1-293"><span class="sd">        :param state: any arbitrary object that will be passed to the</span>
</span><span id="1-294"><span class="sd">         callable, if present.</span>
</span><span id="1-295">
</span><span id="1-296"><span class="sd">        .. versionadded:: 2.0</span>
</span><span id="1-297">
</span><span id="1-298"><span class="sd">        .. seealso::</span>
</span><span id="1-299">
</span><span id="1-300"><span class="sd">            :ref:`schema_ddl_ddl_if` - background and usage examples</span>
</span><span id="1-301">
</span><span id="1-302">
</span><span id="1-303"><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="1-304">        <span class="bp">self</span><span class="o">.</span><span class="n">_ddl_if</span> <span class="o">=</span> <span class="n">ddl</span><span class="o">.</span><span class="n">DDLIf</span><span class="p">(</span><span class="n">dialect</span><span class="p">,</span> <span class="n">callable_</span><span class="p">,</span> <span class="n">state</span><span class="p">)</span>
</span><span id="1-305">        <span class="k">return</span> <span class="bp">self</span>
</span><span id="1-306">
</span><span id="1-307">
</span><span id="1-308"><span class="k">class</span> <span class="nc">HasSchemaAttr</span><span class="p">(</span><span class="n">SchemaItem</span><span class="p">):</span>
</span><span id="1-309"><span class="w">    </span><span class="sd">&quot;&quot;&quot;schema item that includes a top-level schema name&quot;&quot;&quot;</span>
</span><span id="1-310">
</span><span id="1-311">    <span class="n">schema</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
</span><span id="1-312">
</span><span id="1-313">
</span><span id="1-314"><span class="k">class</span> <span class="nc">Table</span><span class="p">(</span>
</span><span id="1-315">    <span class="n">DialectKWArgs</span><span class="p">,</span> <span class="n">HasSchemaAttr</span><span class="p">,</span> <span class="n">TableClause</span><span class="p">,</span> <span class="n">inspection</span><span class="o">.</span><span class="n">Inspectable</span><span class="p">[</span><span class="s2">&quot;Table&quot;</span><span class="p">]</span>
</span><span id="1-316"><span class="p">):</span>
</span><span id="1-317"><span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Represent a table in a database.</span>
</span><span id="1-318">
</span><span id="1-319"><span class="sd">    e.g.::</span>
</span><span id="1-320">
</span><span id="1-321"><span class="sd">        mytable = Table(</span>
</span><span id="1-322"><span class="sd">            &quot;mytable&quot;, metadata,</span>
</span><span id="1-323"><span class="sd">            Column(&#39;mytable_id&#39;, Integer, primary_key=True),</span>
</span><span id="1-324"><span class="sd">            Column(&#39;value&#39;, String(50))</span>
</span><span id="1-325"><span class="sd">        )</span>
</span><span id="1-326">
</span><span id="1-327"><span class="sd">    The :class:`_schema.Table`</span>
</span><span id="1-328"><span class="sd">    object constructs a unique instance of itself based</span>
</span><span id="1-329"><span class="sd">    on its name and optional schema name within the given</span>
</span><span id="1-330"><span class="sd">    :class:`_schema.MetaData` object. Calling the :class:`_schema.Table`</span>
</span><span id="1-331"><span class="sd">    constructor with the same name and same :class:`_schema.MetaData` argument</span>
</span><span id="1-332"><span class="sd">    a second time will return the *same* :class:`_schema.Table`</span>
</span><span id="1-333"><span class="sd">    object - in this way</span>
</span><span id="1-334"><span class="sd">    the :class:`_schema.Table` constructor acts as a registry function.</span>
</span><span id="1-335">
</span><span id="1-336"><span class="sd">    .. seealso::</span>
</span><span id="1-337">
</span><span id="1-338"><span class="sd">        :ref:`metadata_describing` - Introduction to database metadata</span>
</span><span id="1-339">
</span><span id="1-340"><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="1-341">
</span><span id="1-342">    <span class="n">__visit_name__</span> <span class="o">=</span> <span class="s2">&quot;table&quot;</span>
</span><span id="1-343">
</span><span id="1-344">    <span class="k">if</span> <span class="n">TYPE_CHECKING</span><span class="p">:</span>
</span><span id="1-345">
</span><span id="1-346">        <span class="nd">@util</span><span class="o">.</span><span class="n">ro_non_memoized_property</span>
</span><span id="1-347">        <span class="k">def</span> <span class="nf">primary_key</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">PrimaryKeyConstraint</span><span class="p">:</span>
</span><span id="1-348">            <span class="o">...</span>
</span><span id="1-349">
</span><span id="1-350">        <span class="nd">@util</span><span class="o">.</span><span class="n">ro_non_memoized_property</span>
</span><span id="1-351">        <span class="k">def</span> <span class="nf">foreign_keys</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Set</span><span class="p">[</span><span class="n">ForeignKey</span><span class="p">]:</span>
</span><span id="1-352">            <span class="o">...</span>
</span><span id="1-353">
</span><span id="1-354">    <span class="n">_columns</span><span class="p">:</span> <span class="n">DedupeColumnCollection</span><span class="p">[</span><span class="n">Column</span><span class="p">[</span><span class="n">Any</span><span class="p">]]</span>
</span><span id="1-355">
</span><span id="1-356">    <span class="n">_sentinel_column</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Column</span><span class="p">[</span><span class="n">Any</span><span class="p">]]</span>
</span><span id="1-357">
</span><span id="1-358">    <span class="n">constraints</span><span class="p">:</span> <span class="n">Set</span><span class="p">[</span><span class="n">Constraint</span><span class="p">]</span>
</span><span id="1-359"><span class="w">    </span><span class="sd">&quot;&quot;&quot;A collection of all :class:`_schema.Constraint` objects associated with</span>
</span><span id="1-360"><span class="sd">      this :class:`_schema.Table`.</span>
</span><span id="1-361">
</span><span id="1-362"><span class="sd">      Includes :class:`_schema.PrimaryKeyConstraint`,</span>
</span><span id="1-363"><span class="sd">      :class:`_schema.ForeignKeyConstraint`, :class:`_schema.UniqueConstraint`,</span>
</span><span id="1-364"><span class="sd">      :class:`_schema.CheckConstraint`.  A separate collection</span>
</span><span id="1-365"><span class="sd">      :attr:`_schema.Table.foreign_key_constraints` refers to the collection</span>
</span><span id="1-366"><span class="sd">      of all :class:`_schema.ForeignKeyConstraint` objects, and the</span>
</span><span id="1-367"><span class="sd">      :attr:`_schema.Table.primary_key` attribute refers to the single</span>
</span><span id="1-368"><span class="sd">      :class:`_schema.PrimaryKeyConstraint` associated with the</span>
</span><span id="1-369"><span class="sd">      :class:`_schema.Table`.</span>
</span><span id="1-370">
</span><span id="1-371"><span class="sd">      .. seealso::</span>
</span><span id="1-372">
</span><span id="1-373"><span class="sd">            :attr:`_schema.Table.constraints`</span>
</span><span id="1-374">
</span><span id="1-375"><span class="sd">            :attr:`_schema.Table.primary_key`</span>
</span><span id="1-376">
</span><span id="1-377"><span class="sd">            :attr:`_schema.Table.foreign_key_constraints`</span>
</span><span id="1-378">
</span><span id="1-379"><span class="sd">            :attr:`_schema.Table.indexes`</span>
</span><span id="1-380">
</span><span id="1-381"><span class="sd">            :class:`_reflection.Inspector`</span>
</span><span id="1-382">
</span><span id="1-383">
</span><span id="1-384"><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="1-385">
</span><span id="1-386">    <span class="n">indexes</span><span class="p">:</span> <span class="n">Set</span><span class="p">[</span><span class="n">Index</span><span class="p">]</span>
</span><span id="1-387"><span class="w">    </span><span class="sd">&quot;&quot;&quot;A collection of all :class:`_schema.Index` objects associated with this</span>
</span><span id="1-388"><span class="sd">      :class:`_schema.Table`.</span>
</span><span id="1-389">
</span><span id="1-390"><span class="sd">      .. seealso::</span>
</span><span id="1-391">
</span><span id="1-392"><span class="sd">            :meth:`_reflection.Inspector.get_indexes`</span>
</span><span id="1-393">
</span><span id="1-394"><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="1-395">
</span><span id="1-396">    <span class="n">_traverse_internals</span><span class="p">:</span> <span class="n">_TraverseInternalsType</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="1-397">        <span class="n">TableClause</span><span class="o">.</span><span class="n">_traverse_internals</span>
</span><span id="1-398">        <span class="o">+</span> <span class="p">[(</span><span class="s2">&quot;schema&quot;</span><span class="p">,</span> <span class="n">InternalTraversal</span><span class="o">.</span><span class="n">dp_string</span><span class="p">)]</span>
</span><span id="1-399">    <span class="p">)</span>
</span><span id="1-400">
</span><span id="1-401">    <span class="k">if</span> <span class="n">TYPE_CHECKING</span><span class="p">:</span>
</span><span id="1-402">
</span><span id="1-403">        <span class="nd">@util</span><span class="o">.</span><span class="n">ro_non_memoized_property</span>
</span><span id="1-404">        <span class="k">def</span> <span class="nf">columns</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ReadOnlyColumnCollection</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Column</span><span class="p">[</span><span class="n">Any</span><span class="p">]]:</span>
</span><span id="1-405">            <span class="o">...</span>
</span><span id="1-406">
</span><span id="1-407">        <span class="nd">@util</span><span class="o">.</span><span class="n">ro_non_memoized_property</span>
</span><span id="1-408">        <span class="k">def</span> <span class="nf">exported_columns</span><span class="p">(</span>
</span><span id="1-409">            <span class="bp">self</span><span class="p">,</span>
</span><span id="1-410">        <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ReadOnlyColumnCollection</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Column</span><span class="p">[</span><span class="n">Any</span><span class="p">]]:</span>
</span><span id="1-411">            <span class="o">...</span>
</span><span id="1-412">
</span><span id="1-413">        <span class="nd">@util</span><span class="o">.</span><span class="n">ro_non_memoized_property</span>
</span><span id="1-414">        <span class="k">def</span> <span class="nf">c</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ReadOnlyColumnCollection</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Column</span><span class="p">[</span><span class="n">Any</span><span class="p">]]:</span>
</span><span id="1-415">            <span class="o">...</span>
</span><span id="1-416">
</span><span id="1-417">    <span class="k">def</span> <span class="nf">_gen_cache_key</span><span class="p">(</span>
</span><span id="1-418">        <span class="bp">self</span><span class="p">,</span> <span class="n">anon_map</span><span class="p">:</span> <span class="n">anon_map</span><span class="p">,</span> <span class="n">bindparams</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">BindParameter</span><span class="p">[</span><span class="n">Any</span><span class="p">]]</span>
</span><span id="1-419">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="o">...</span><span class="p">]:</span>
</span><span id="1-420">        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_annotations</span><span class="p">:</span>
</span><span id="1-421">            <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="p">,)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_annotations_cache_key</span>
</span><span id="1-422">        <span class="k">else</span><span class="p">:</span>
</span><span id="1-423">            <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="p">,)</span>
</span><span id="1-424">
</span><span id="1-425">    <span class="k">if</span> <span class="ow">not</span> <span class="n">typing</span><span class="o">.</span><span class="n">TYPE_CHECKING</span><span class="p">:</span>
</span><span id="1-426">        <span class="c1"># typing tools seem to be inconsistent in how they handle</span>
</span><span id="1-427">        <span class="c1"># __new__, so suggest this pattern for classes that use</span>
</span><span id="1-428">        <span class="c1"># __new__.  apply typing to the __init__ method normally</span>
</span><span id="1-429">        <span class="nd">@util</span><span class="o">.</span><span class="n">deprecated_params</span><span class="p">(</span>
</span><span id="1-430">            <span class="n">mustexist</span><span class="o">=</span><span class="p">(</span>
</span><span id="1-431">                <span class="s2">&quot;1.4&quot;</span><span class="p">,</span>
</span><span id="1-432">                <span class="s2">&quot;Deprecated alias of :paramref:`_schema.Table.must_exist`&quot;</span><span class="p">,</span>
</span><span id="1-433">            <span class="p">),</span>
</span><span id="1-434">        <span class="p">)</span>
</span><span id="1-435">        <span class="k">def</span> <span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
</span><span id="1-436">            <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_new</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>
</span><span id="1-437">
</span><span id="1-438">    <span class="nd">@classmethod</span>
</span><span id="1-439">    <span class="k">def</span> <span class="nf">_new</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
</span><span id="1-440">        <span class="k">if</span> <span class="ow">not</span> <span class="n">args</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">kw</span><span class="p">:</span>
</span><span id="1-441">            <span class="c1"># python3k pickle seems to call this</span>
</span><span id="1-442">            <span class="k">return</span> <span class="nb">object</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span>
</span><span id="1-443">
</span><span id="1-444">        <span class="k">try</span><span class="p">:</span>
</span><span id="1-445">            <span class="n">name</span><span class="p">,</span> <span class="n">metadata</span><span class="p">,</span> <span class="n">args</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">args</span><span class="p">[</span><span class="mi">2</span><span class="p">:]</span>
</span><span id="1-446">        <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
</span><span id="1-447">            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
</span><span id="1-448">                <span class="s2">&quot;Table() takes at least two positional-only &quot;</span>
</span><span id="1-449">                <span class="s2">&quot;arguments &#39;name&#39; and &#39;metadata&#39;&quot;</span>
</span><span id="1-450">            <span class="p">)</span>
</span><span id="1-451">
</span><span id="1-452">        <span class="n">schema</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;schema&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="1-453">        <span class="k">if</span> <span class="n">schema</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-454">            <span class="n">schema</span> <span class="o">=</span> <span class="n">metadata</span><span class="o">.</span><span class="n">schema</span>
</span><span id="1-455">        <span class="k">elif</span> <span class="n">schema</span> <span class="ow">is</span> <span class="n">BLANK_SCHEMA</span><span class="p">:</span>
</span><span id="1-456">            <span class="n">schema</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="1-457">        <span class="n">keep_existing</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;keep_existing&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
</span><span id="1-458">        <span class="n">extend_existing</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;extend_existing&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
</span><span id="1-459">
</span><span id="1-460">        <span class="k">if</span> <span class="n">keep_existing</span> <span class="ow">and</span> <span class="n">extend_existing</span><span class="p">:</span>
</span><span id="1-461">            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;keep_existing and extend_existing are mutually exclusive.&quot;</span>
</span><span id="1-462">            <span class="k">raise</span> <span class="n">exc</span><span class="o">.</span><span class="n">ArgumentError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="1-463">
</span><span id="1-464">        <span class="n">must_exist</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;must_exist&quot;</span><span class="p">,</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;mustexist&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">))</span>
</span><span id="1-465">        <span class="n">key</span> <span class="o">=</span> <span class="n">_get_table_key</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">schema</span><span class="p">)</span>
</span><span id="1-466">        <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">metadata</span><span class="o">.</span><span class="n">tables</span><span class="p">:</span>
</span><span id="1-467">            <span class="k">if</span> <span class="ow">not</span> <span class="n">keep_existing</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">extend_existing</span> <span class="ow">and</span> <span class="nb">bool</span><span class="p">(</span><span class="n">args</span><span class="p">):</span>
</span><span id="1-468">                <span class="k">raise</span> <span class="n">exc</span><span class="o">.</span><span class="n">InvalidRequestError</span><span class="p">(</span>
</span><span id="1-469">                    <span class="s2">&quot;Table &#39;</span><span class="si">%s</span><span class="s2">&#39; is already defined for this MetaData &quot;</span>
</span><span id="1-470">                    <span class="s2">&quot;instance.  Specify &#39;extend_existing=True&#39; &quot;</span>
</span><span id="1-471">                    <span class="s2">&quot;to redefine &quot;</span>
</span><span id="1-472">                    <span class="s2">&quot;options and columns on an &quot;</span>
</span><span id="1-473">                    <span class="s2">&quot;existing Table object.&quot;</span> <span class="o">%</span> <span class="n">key</span>
</span><span id="1-474">                <span class="p">)</span>
</span><span id="1-475">            <span class="n">table</span> <span class="o">=</span> <span class="n">metadata</span><span class="o">.</span><span class="n">tables</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
</span><span id="1-476">            <span class="k">if</span> <span class="n">extend_existing</span><span class="p">:</span>
</span><span id="1-477">                <span class="n">table</span><span class="o">.</span><span class="n">_init_existing</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>
</span><span id="1-478">            <span class="k">return</span> <span class="n">table</span>
</span><span id="1-479">        <span class="k">else</span><span class="p">:</span>
</span><span id="1-480">            <span class="k">if</span> <span class="n">must_exist</span><span class="p">:</span>
</span><span id="1-481">                <span class="k">raise</span> <span class="n">exc</span><span class="o">.</span><span class="n">InvalidRequestError</span><span class="p">(</span><span class="s2">&quot;Table &#39;</span><span class="si">%s</span><span class="s2">&#39; not defined&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">key</span><span class="p">))</span>
</span><span id="1-482">            <span class="n">table</span> <span class="o">=</span> <span class="nb">object</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span>
</span><span id="1-483">            <span class="n">table</span><span class="o">.</span><span class="n">dispatch</span><span class="o">.</span><span class="n">before_parent_attach</span><span class="p">(</span><span class="n">table</span><span class="p">,</span> <span class="n">metadata</span><span class="p">)</span>
</span><span id="1-484">            <span class="n">metadata</span><span class="o">.</span><span class="n">_add_table</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">schema</span><span class="p">,</span> <span class="n">table</span><span class="p">)</span>
</span><span id="1-485">            <span class="k">try</span><span class="p">:</span>
</span><span id="1-486">                <span class="n">table</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">metadata</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">_no_init</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>
</span><span id="1-487">                <span class="n">table</span><span class="o">.</span><span class="n">dispatch</span><span class="o">.</span><span class="n">after_parent_attach</span><span class="p">(</span><span class="n">table</span><span class="p">,</span> <span class="n">metadata</span><span class="p">)</span>
</span><span id="1-488">                <span class="k">return</span> <span class="n">table</span>
</span><span id="1-489">            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
</span><span id="1-490">                <span class="k">with</span> <span class="n">util</span><span class="o">.</span><span class="n">safe_reraise</span><span class="p">():</span>
</span><span id="1-491">                    <span class="n">metadata</span><span class="o">.</span><span class="n">_remove_table</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">schema</span><span class="p">)</span>
</span><span id="1-492">
</span><span id="1-493">    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
</span><span id="1-494">        <span class="bp">self</span><span class="p">,</span>
</span><span id="1-495">        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="1-496">        <span class="n">metadata</span><span class="p">:</span> <span class="n">MetaData</span><span class="p">,</span>
</span><span id="1-497">        <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">SchemaItem</span><span class="p">,</span>
</span><span id="1-498">        <span class="n">schema</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Literal</span><span class="p">[</span><span class="n">SchemaConst</span><span class="o">.</span><span class="n">BLANK_SCHEMA</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="1-499">        <span class="n">quote</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="1-500">        <span class="n">quote_schema</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="1-501">        <span class="n">autoload_with</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">Engine</span><span class="p">,</span> <span class="n">Connection</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="1-502">        <span class="n">autoload_replace</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="1-503">        <span class="n">keep_existing</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="1-504">        <span class="n">extend_existing</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="1-505">        <span class="n">resolve_fks</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="1-506">        <span class="n">include_columns</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Collection</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="1-507">        <span class="n">implicit_returning</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="1-508">        <span class="n">comment</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="1-509">        <span class="n">info</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="1-510">        <span class="n">listeners</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span>
</span><span id="1-511">            <span class="n">_typing_Sequence</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]]</span>
</span><span id="1-512">        <span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="1-513">        <span class="n">prefixes</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">_typing_Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="1-514">        <span class="c1"># used internally in the metadata.reflect() process</span>
</span><span id="1-515">        <span class="n">_extend_on</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Set</span><span class="p">[</span><span class="n">Table</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="1-516">        <span class="c1"># used by __new__ to bypass __init__</span>
</span><span id="1-517">        <span class="n">_no_init</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="1-518">        <span class="c1"># dialect-specific keyword args</span>
</span><span id="1-519">        <span class="o">**</span><span class="n">kw</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
</span><span id="1-520">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-521"><span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Constructor for :class:`_schema.Table`.</span>
</span><span id="1-522">
</span><span id="1-523">
</span><span id="1-524"><span class="sd">        :param name: The name of this table as represented in the database.</span>
</span><span id="1-525">
</span><span id="1-526"><span class="sd">            The table name, along with the value of the ``schema`` parameter,</span>
</span><span id="1-527"><span class="sd">            forms a key which uniquely identifies this :class:`_schema.Table`</span>
</span><span id="1-528"><span class="sd">            within</span>
</span><span id="1-529"><span class="sd">            the owning :class:`_schema.MetaData` collection.</span>
</span><span id="1-530"><span class="sd">            Additional calls to :class:`_schema.Table` with the same name,</span>
</span><span id="1-531"><span class="sd">            metadata,</span>
</span><span id="1-532"><span class="sd">            and schema name will return the same :class:`_schema.Table` object.</span>
</span><span id="1-533">
</span><span id="1-534"><span class="sd">            Names which contain no upper case characters</span>
</span><span id="1-535"><span class="sd">            will be treated as case insensitive names, and will not be quoted</span>
</span><span id="1-536"><span class="sd">            unless they are a reserved word or contain special characters.</span>
</span><span id="1-537"><span class="sd">            A name with any number of upper case characters is considered</span>
</span><span id="1-538"><span class="sd">            to be case sensitive, and will be sent as quoted.</span>
</span><span id="1-539">
</span><span id="1-540"><span class="sd">            To enable unconditional quoting for the table name, specify the flag</span>
</span><span id="1-541"><span class="sd">            ``quote=True`` to the constructor, or use the :class:`.quoted_name`</span>
</span><span id="1-542"><span class="sd">            construct to specify the name.</span>
</span><span id="1-543">
</span><span id="1-544"><span class="sd">        :param metadata: a :class:`_schema.MetaData`</span>
</span><span id="1-545"><span class="sd">            object which will contain this</span>
</span><span id="1-546"><span class="sd">            table.  The metadata is used as a point of association of this table</span>
</span><span id="1-547"><span class="sd">            with other tables which are referenced via foreign key.  It also</span>
</span><span id="1-548"><span class="sd">            may be used to associate this table with a particular</span>
</span><span id="1-549"><span class="sd">            :class:`.Connection` or :class:`.Engine`.</span>
</span><span id="1-550">
</span><span id="1-551"><span class="sd">        :param \*args: Additional positional arguments are used primarily</span>
</span><span id="1-552"><span class="sd">            to add the list of :class:`_schema.Column`</span>
</span><span id="1-553"><span class="sd">            objects contained within this</span>
</span><span id="1-554"><span class="sd">            table. Similar to the style of a CREATE TABLE statement, other</span>
</span><span id="1-555"><span class="sd">            :class:`.SchemaItem` constructs may be added here, including</span>
</span><span id="1-556"><span class="sd">            :class:`.PrimaryKeyConstraint`, and</span>
</span><span id="1-557"><span class="sd">            :class:`_schema.ForeignKeyConstraint`.</span>
</span><span id="1-558">
</span><span id="1-559"><span class="sd">        :param autoload_replace: Defaults to ``True``; when using</span>
</span><span id="1-560"><span class="sd">            :paramref:`_schema.Table.autoload_with`</span>
</span><span id="1-561"><span class="sd">            in conjunction with :paramref:`_schema.Table.extend_existing`,</span>
</span><span id="1-562"><span class="sd">            indicates</span>
</span><span id="1-563"><span class="sd">            that :class:`_schema.Column` objects present in the already-existing</span>
</span><span id="1-564"><span class="sd">            :class:`_schema.Table`</span>
</span><span id="1-565"><span class="sd">            object should be replaced with columns of the same</span>
</span><span id="1-566"><span class="sd">            name retrieved from the autoload process.   When ``False``, columns</span>
</span><span id="1-567"><span class="sd">            already present under existing names will be omitted from the</span>
</span><span id="1-568"><span class="sd">            reflection process.</span>
</span><span id="1-569">
</span><span id="1-570"><span class="sd">            Note that this setting does not impact :class:`_schema.Column` objects</span>
</span><span id="1-571"><span class="sd">            specified programmatically within the call to :class:`_schema.Table`</span>
</span><span id="1-572"><span class="sd">            that</span>
</span><span id="1-573"><span class="sd">            also is autoloading; those :class:`_schema.Column` objects will always</span>
</span><span id="1-574"><span class="sd">            replace existing columns of the same name when</span>
</span><span id="1-575"><span class="sd">            :paramref:`_schema.Table.extend_existing` is ``True``.</span>
</span><span id="1-576">
</span><span id="1-577"><span class="sd">            .. seealso::</span>
</span><span id="1-578">
</span><span id="1-579"><span class="sd">                :paramref:`_schema.Table.autoload_with`</span>
</span><span id="1-580">
</span><span id="1-581"><span class="sd">                :paramref:`_schema.Table.extend_existing`</span>
</span><span id="1-582">
</span><span id="1-583"><span class="sd">        :param autoload_with: An :class:`_engine.Engine` or</span>
</span><span id="1-584"><span class="sd">            :class:`_engine.Connection` object,</span>
</span><span id="1-585"><span class="sd">            or a :class:`_reflection.Inspector` object as returned by</span>
</span><span id="1-586"><span class="sd">            :func:`_sa.inspect`</span>
</span><span id="1-587"><span class="sd">            against one, with which this :class:`_schema.Table`</span>
</span><span id="1-588"><span class="sd">            object will be reflected.</span>
</span><span id="1-589"><span class="sd">            When set to a non-None value, the autoload process will take place</span>
</span><span id="1-590"><span class="sd">            for this table against the given engine or connection.</span>
</span><span id="1-591">
</span><span id="1-592"><span class="sd">            .. seealso::</span>
</span><span id="1-593">
</span><span id="1-594"><span class="sd">                :ref:`metadata_reflection_toplevel`</span>
</span><span id="1-595">
</span><span id="1-596"><span class="sd">                :meth:`_events.DDLEvents.column_reflect`</span>
</span><span id="1-597">
</span><span id="1-598"><span class="sd">                :ref:`metadata_reflection_dbagnostic_types`</span>
</span><span id="1-599">
</span><span id="1-600"><span class="sd">        :param extend_existing: When ``True``, indicates that if this</span>
</span><span id="1-601"><span class="sd">            :class:`_schema.Table` is already present in the given</span>
</span><span id="1-602"><span class="sd">            :class:`_schema.MetaData`,</span>
</span><span id="1-603"><span class="sd">            apply further arguments within the constructor to the existing</span>
</span><span id="1-604"><span class="sd">            :class:`_schema.Table`.</span>
</span><span id="1-605">
</span><span id="1-606"><span class="sd">            If :paramref:`_schema.Table.extend_existing` or</span>
</span><span id="1-607"><span class="sd">            :paramref:`_schema.Table.keep_existing` are not set,</span>
</span><span id="1-608"><span class="sd">            and the given name</span>
</span><span id="1-609"><span class="sd">            of the new :class:`_schema.Table` refers to a :class:`_schema.Table`</span>
</span><span id="1-610"><span class="sd">            that is</span>
</span><span id="1-611"><span class="sd">            already present in the target :class:`_schema.MetaData` collection,</span>
</span><span id="1-612"><span class="sd">            and</span>
</span><span id="1-613"><span class="sd">            this :class:`_schema.Table`</span>
</span><span id="1-614"><span class="sd">            specifies additional columns or other constructs</span>
</span><span id="1-615"><span class="sd">            or flags that modify the table&#39;s state, an</span>
</span><span id="1-616"><span class="sd">            error is raised.  The purpose of these two mutually-exclusive flags</span>
</span><span id="1-617"><span class="sd">            is to specify what action should be taken when a</span>
</span><span id="1-618"><span class="sd">            :class:`_schema.Table`</span>
</span><span id="1-619"><span class="sd">            is specified that matches an existing :class:`_schema.Table`,</span>
</span><span id="1-620"><span class="sd">            yet specifies</span>
</span><span id="1-621"><span class="sd">            additional constructs.</span>
</span><span id="1-622">
</span><span id="1-623"><span class="sd">            :paramref:`_schema.Table.extend_existing`</span>
</span><span id="1-624"><span class="sd">            will also work in conjunction</span>
</span><span id="1-625"><span class="sd">            with :paramref:`_schema.Table.autoload_with` to run a new reflection</span>
</span><span id="1-626"><span class="sd">            operation against the database, even if a :class:`_schema.Table`</span>
</span><span id="1-627"><span class="sd">            of the same name is already present in the target</span>
</span><span id="1-628"><span class="sd">            :class:`_schema.MetaData`; newly reflected :class:`_schema.Column`</span>
</span><span id="1-629"><span class="sd">            objects</span>
</span><span id="1-630"><span class="sd">            and other options will be added into the state of the</span>
</span><span id="1-631"><span class="sd">            :class:`_schema.Table`, potentially overwriting existing columns</span>
</span><span id="1-632"><span class="sd">            and options of the same name.</span>
</span><span id="1-633">
</span><span id="1-634"><span class="sd">            As is always the case with :paramref:`_schema.Table.autoload_with`,</span>
</span><span id="1-635"><span class="sd">            :class:`_schema.Column` objects can be specified in the same</span>
</span><span id="1-636"><span class="sd">            :class:`_schema.Table`</span>
</span><span id="1-637"><span class="sd">            constructor, which will take precedence.  Below, the existing</span>
</span><span id="1-638"><span class="sd">            table ``mytable`` will be augmented with :class:`_schema.Column`</span>
</span><span id="1-639"><span class="sd">            objects</span>
</span><span id="1-640"><span class="sd">            both reflected from the database, as well as the given</span>
</span><span id="1-641"><span class="sd">            :class:`_schema.Column`</span>
</span><span id="1-642"><span class="sd">            named &quot;y&quot;::</span>
</span><span id="1-643">
</span><span id="1-644"><span class="sd">                Table(&quot;mytable&quot;, metadata,</span>
</span><span id="1-645"><span class="sd">                            Column(&#39;y&#39;, Integer),</span>
</span><span id="1-646"><span class="sd">                            extend_existing=True,</span>
</span><span id="1-647"><span class="sd">                            autoload_with=engine</span>
</span><span id="1-648"><span class="sd">                        )</span>
</span><span id="1-649">
</span><span id="1-650"><span class="sd">            .. seealso::</span>
</span><span id="1-651">
</span><span id="1-652"><span class="sd">                :paramref:`_schema.Table.autoload_with`</span>
</span><span id="1-653">
</span><span id="1-654"><span class="sd">                :paramref:`_schema.Table.autoload_replace`</span>
</span><span id="1-655">
</span><span id="1-656"><span class="sd">                :paramref:`_schema.Table.keep_existing`</span>
</span><span id="1-657">
</span><span id="1-658">
</span><span id="1-659"><span class="sd">        :param implicit_returning: True by default - indicates that</span>
</span><span id="1-660"><span class="sd">            RETURNING can be used, typically by the ORM, in order to fetch</span>
</span><span id="1-661"><span class="sd">            server-generated values such as primary key values and</span>
</span><span id="1-662"><span class="sd">            server side defaults, on those backends which support RETURNING.</span>
</span><span id="1-663">
</span><span id="1-664"><span class="sd">            In modern SQLAlchemy there is generally no reason to alter this</span>
</span><span id="1-665"><span class="sd">            setting, except for some backend specific cases</span>
</span><span id="1-666"><span class="sd">            (see :ref:`mssql_triggers` in the SQL Server dialect documentation</span>
</span><span id="1-667"><span class="sd">            for one such example).</span>
</span><span id="1-668">
</span><span id="1-669"><span class="sd">        :param include_columns: A list of strings indicating a subset of</span>
</span><span id="1-670"><span class="sd">            columns to be loaded via the ``autoload`` operation; table columns who</span>
</span><span id="1-671"><span class="sd">            aren&#39;t present in this list will not be represented on the resulting</span>
</span><span id="1-672"><span class="sd">            ``Table`` object. Defaults to ``None`` which indicates all columns</span>
</span><span id="1-673"><span class="sd">            should be reflected.</span>
</span><span id="1-674">
</span><span id="1-675"><span class="sd">        :param resolve_fks: Whether or not to reflect :class:`_schema.Table`</span>
</span><span id="1-676"><span class="sd">            objects</span>
</span><span id="1-677"><span class="sd">            related to this one via :class:`_schema.ForeignKey` objects, when</span>
</span><span id="1-678"><span class="sd">            :paramref:`_schema.Table.autoload_with` is</span>
</span><span id="1-679"><span class="sd">            specified.   Defaults to True.  Set to False to disable reflection of</span>
</span><span id="1-680"><span class="sd">            related tables as :class:`_schema.ForeignKey`</span>
</span><span id="1-681"><span class="sd">            objects are encountered; may be</span>
</span><span id="1-682"><span class="sd">            used either to save on SQL calls or to avoid issues with related tables</span>
</span><span id="1-683"><span class="sd">            that can&#39;t be accessed. Note that if a related table is already present</span>
</span><span id="1-684"><span class="sd">            in the :class:`_schema.MetaData` collection, or becomes present later,</span>
</span><span id="1-685"><span class="sd">            a</span>
</span><span id="1-686"><span class="sd">            :class:`_schema.ForeignKey` object associated with this</span>
</span><span id="1-687"><span class="sd">            :class:`_schema.Table` will</span>
</span><span id="1-688"><span class="sd">            resolve to that table normally.</span>
</span><span id="1-689">
</span><span id="1-690"><span class="sd">            .. versionadded:: 1.3</span>
</span><span id="1-691">
</span><span id="1-692"><span class="sd">            .. seealso::</span>
</span><span id="1-693">
</span><span id="1-694"><span class="sd">                :paramref:`.MetaData.reflect.resolve_fks`</span>
</span><span id="1-695">
</span><span id="1-696">
</span><span id="1-697"><span class="sd">        :param info: Optional data dictionary which will be populated into the</span>
</span><span id="1-698"><span class="sd">            :attr:`.SchemaItem.info` attribute of this object.</span>
</span><span id="1-699">
</span><span id="1-700"><span class="sd">        :param keep_existing: When ``True``, indicates that if this Table</span>
</span><span id="1-701"><span class="sd">            is already present in the given :class:`_schema.MetaData`, ignore</span>
</span><span id="1-702"><span class="sd">            further arguments within the constructor to the existing</span>
</span><span id="1-703"><span class="sd">            :class:`_schema.Table`, and return the :class:`_schema.Table`</span>
</span><span id="1-704"><span class="sd">            object as</span>
</span><span id="1-705"><span class="sd">            originally created. This is to allow a function that wishes</span>
</span><span id="1-706"><span class="sd">            to define a new :class:`_schema.Table` on first call, but on</span>
</span><span id="1-707"><span class="sd">            subsequent calls will return the same :class:`_schema.Table`,</span>
</span><span id="1-708"><span class="sd">            without any of the declarations (particularly constraints)</span>
</span><span id="1-709"><span class="sd">            being applied a second time.</span>
</span><span id="1-710">
</span><span id="1-711"><span class="sd">            If :paramref:`_schema.Table.extend_existing` or</span>
</span><span id="1-712"><span class="sd">            :paramref:`_schema.Table.keep_existing` are not set,</span>
</span><span id="1-713"><span class="sd">            and the given name</span>
</span><span id="1-714"><span class="sd">            of the new :class:`_schema.Table` refers to a :class:`_schema.Table`</span>
</span><span id="1-715"><span class="sd">            that is</span>
</span><span id="1-716"><span class="sd">            already present in the target :class:`_schema.MetaData` collection,</span>
</span><span id="1-717"><span class="sd">            and</span>
</span><span id="1-718"><span class="sd">            this :class:`_schema.Table`</span>
</span><span id="1-719"><span class="sd">            specifies additional columns or other constructs</span>
</span><span id="1-720"><span class="sd">            or flags that modify the table&#39;s state, an</span>
</span><span id="1-721"><span class="sd">            error is raised.  The purpose of these two mutually-exclusive flags</span>
</span><span id="1-722"><span class="sd">            is to specify what action should be taken when a</span>
</span><span id="1-723"><span class="sd">            :class:`_schema.Table`</span>
</span><span id="1-724"><span class="sd">            is specified that matches an existing :class:`_schema.Table`,</span>
</span><span id="1-725"><span class="sd">            yet specifies</span>
</span><span id="1-726"><span class="sd">            additional constructs.</span>
</span><span id="1-727">
</span><span id="1-728"><span class="sd">            .. seealso::</span>
</span><span id="1-729">
</span><span id="1-730"><span class="sd">                :paramref:`_schema.Table.extend_existing`</span>
</span><span id="1-731">
</span><span id="1-732"><span class="sd">        :param listeners: A list of tuples of the form ``(&lt;eventname&gt;, &lt;fn&gt;)``</span>
</span><span id="1-733"><span class="sd">            which will be passed to :func:`.event.listen` upon construction.</span>
</span><span id="1-734"><span class="sd">            This alternate hook to :func:`.event.listen` allows the establishment</span>
</span><span id="1-735"><span class="sd">            of a listener function specific to this :class:`_schema.Table` before</span>
</span><span id="1-736"><span class="sd">            the &quot;autoload&quot; process begins.  Historically this has been intended</span>
</span><span id="1-737"><span class="sd">            for use with the :meth:`.DDLEvents.column_reflect` event, however</span>
</span><span id="1-738"><span class="sd">            note that this event hook may now be associated with the</span>
</span><span id="1-739"><span class="sd">            :class:`_schema.MetaData` object directly::</span>
</span><span id="1-740">
</span><span id="1-741"><span class="sd">                def listen_for_reflect(table, column_info):</span>
</span><span id="1-742"><span class="sd">                    &quot;handle the column reflection event&quot;</span>
</span><span id="1-743"><span class="sd">                    # ...</span>
</span><span id="1-744">
</span><span id="1-745"><span class="sd">                t = Table(</span>
</span><span id="1-746"><span class="sd">                    &#39;sometable&#39;,</span>
</span><span id="1-747"><span class="sd">                    autoload_with=engine,</span>
</span><span id="1-748"><span class="sd">                    listeners=[</span>
</span><span id="1-749"><span class="sd">                        (&#39;column_reflect&#39;, listen_for_reflect)</span>
</span><span id="1-750"><span class="sd">                    ])</span>
</span><span id="1-751">
</span><span id="1-752"><span class="sd">            .. seealso::</span>
</span><span id="1-753">
</span><span id="1-754"><span class="sd">                :meth:`_events.DDLEvents.column_reflect`</span>
</span><span id="1-755">
</span><span id="1-756"><span class="sd">        :param must_exist: When ``True``, indicates that this Table must already</span>
</span><span id="1-757"><span class="sd">            be present in the given :class:`_schema.MetaData` collection, else</span>
</span><span id="1-758"><span class="sd">            an exception is raised.</span>
</span><span id="1-759">
</span><span id="1-760"><span class="sd">        :param prefixes:</span>
</span><span id="1-761"><span class="sd">            A list of strings to insert after CREATE in the CREATE TABLE</span>
</span><span id="1-762"><span class="sd">            statement.  They will be separated by spaces.</span>
</span><span id="1-763">
</span><span id="1-764"><span class="sd">        :param quote: Force quoting of this table&#39;s name on or off, corresponding</span>
</span><span id="1-765"><span class="sd">            to ``True`` or ``False``.  When left at its default of ``None``,</span>
</span><span id="1-766"><span class="sd">            the column identifier will be quoted according to whether the name is</span>
</span><span id="1-767"><span class="sd">            case sensitive (identifiers with at least one upper case character are</span>
</span><span id="1-768"><span class="sd">            treated as case sensitive), or if it&#39;s a reserved word.  This flag</span>
</span><span id="1-769"><span class="sd">            is only needed to force quoting of a reserved word which is not known</span>
</span><span id="1-770"><span class="sd">            by the SQLAlchemy dialect.</span>
</span><span id="1-771">
</span><span id="1-772"><span class="sd">            .. note:: setting this flag to ``False`` will not provide</span>
</span><span id="1-773"><span class="sd">              case-insensitive behavior for table reflection; table reflection</span>
</span><span id="1-774"><span class="sd">              will always search for a mixed-case name in a case sensitive</span>
</span><span id="1-775"><span class="sd">              fashion.  Case insensitive names are specified in SQLAlchemy only</span>
</span><span id="1-776"><span class="sd">              by stating the name with all lower case characters.</span>
</span><span id="1-777">
</span><span id="1-778"><span class="sd">        :param quote_schema: same as &#39;quote&#39; but applies to the schema identifier.</span>
</span><span id="1-779">
</span><span id="1-780"><span class="sd">        :param schema: The schema name for this table, which is required if</span>
</span><span id="1-781"><span class="sd">            the table resides in a schema other than the default selected schema</span>
</span><span id="1-782"><span class="sd">            for the engine&#39;s database connection.  Defaults to ``None``.</span>
</span><span id="1-783">
</span><span id="1-784"><span class="sd">            If the owning :class:`_schema.MetaData` of this :class:`_schema.Table`</span>
</span><span id="1-785"><span class="sd">            specifies its</span>
</span><span id="1-786"><span class="sd">            own :paramref:`_schema.MetaData.schema` parameter,</span>
</span><span id="1-787"><span class="sd">            then that schema name will</span>
</span><span id="1-788"><span class="sd">            be applied to this :class:`_schema.Table`</span>
</span><span id="1-789"><span class="sd">            if the schema parameter here is set</span>
</span><span id="1-790"><span class="sd">            to ``None``.  To set a blank schema name on a :class:`_schema.Table`</span>
</span><span id="1-791"><span class="sd">            that</span>
</span><span id="1-792"><span class="sd">            would otherwise use the schema set on the owning</span>
</span><span id="1-793"><span class="sd">            :class:`_schema.MetaData`,</span>
</span><span id="1-794"><span class="sd">            specify the special symbol :attr:`.BLANK_SCHEMA`.</span>
</span><span id="1-795">
</span><span id="1-796"><span class="sd">            The quoting rules for the schema name are the same as those for the</span>
</span><span id="1-797"><span class="sd">            ``name`` parameter, in that quoting is applied for reserved words or</span>
</span><span id="1-798"><span class="sd">            case-sensitive names; to enable unconditional quoting for the schema</span>
</span><span id="1-799"><span class="sd">            name, specify the flag ``quote_schema=True`` to the constructor, or use</span>
</span><span id="1-800"><span class="sd">            the :class:`.quoted_name` construct to specify the name.</span>
</span><span id="1-801">
</span><span id="1-802"><span class="sd">        :param comment: Optional string that will render an SQL comment on table</span>
</span><span id="1-803"><span class="sd">            creation.</span>
</span><span id="1-804">
</span><span id="1-805"><span class="sd">            .. versionadded:: 1.2 Added the :paramref:`_schema.Table.comment`</span>
</span><span id="1-806"><span class="sd">                parameter</span>
</span><span id="1-807"><span class="sd">                to :class:`_schema.Table`.</span>
</span><span id="1-808">
</span><span id="1-809"><span class="sd">        :param \**kw: Additional keyword arguments not mentioned above are</span>
</span><span id="1-810"><span class="sd">            dialect specific, and passed in the form ``&lt;dialectname&gt;_&lt;argname&gt;``.</span>
</span><span id="1-811"><span class="sd">            See the documentation regarding an individual dialect at</span>
</span><span id="1-812"><span class="sd">            :ref:`dialect_toplevel` for detail on documented arguments.</span>
</span><span id="1-813">
</span><span id="1-814"><span class="sd">        &quot;&quot;&quot;</span>  <span class="c1"># noqa: E501</span>
</span><span id="1-815">        <span class="k">if</span> <span class="n">_no_init</span><span class="p">:</span>
</span><span id="1-816">            <span class="c1"># don&#39;t run __init__ from __new__ by default;</span>
</span><span id="1-817">            <span class="c1"># __new__ has a specific place that __init__ is called</span>
</span><span id="1-818">            <span class="k">return</span>
</span><span id="1-819">
</span><span id="1-820">        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">quoted_name</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">quote</span><span class="p">))</span>
</span><span id="1-821">        <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span> <span class="o">=</span> <span class="n">metadata</span>
</span><span id="1-822">
</span><span id="1-823">        <span class="k">if</span> <span class="n">schema</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-824">            <span class="bp">self</span><span class="o">.</span><span class="n">schema</span> <span class="o">=</span> <span class="n">metadata</span><span class="o">.</span><span class="n">schema</span>
</span><span id="1-825">        <span class="k">elif</span> <span class="n">schema</span> <span class="ow">is</span> <span class="n">BLANK_SCHEMA</span><span class="p">:</span>
</span><span id="1-826">            <span class="bp">self</span><span class="o">.</span><span class="n">schema</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="1-827">        <span class="k">else</span><span class="p">:</span>
</span><span id="1-828">            <span class="n">quote_schema</span> <span class="o">=</span> <span class="n">quote_schema</span>
</span><span id="1-829">            <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">schema</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span>
</span><span id="1-830">            <span class="bp">self</span><span class="o">.</span><span class="n">schema</span> <span class="o">=</span> <span class="n">quoted_name</span><span class="p">(</span><span class="n">schema</span><span class="p">,</span> <span class="n">quote_schema</span><span class="p">)</span>
</span><span id="1-831">
</span><span id="1-832">        <span class="bp">self</span><span class="o">.</span><span class="n">_sentinel_column</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="1-833">
</span><span id="1-834">        <span class="bp">self</span><span class="o">.</span><span class="n">indexes</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
</span><span id="1-835">        <span class="bp">self</span><span class="o">.</span><span class="n">constraints</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
</span><span id="1-836">        <span class="n">PrimaryKeyConstraint</span><span class="p">(</span>
</span><span id="1-837">            <span class="n">_implicit_generated</span><span class="o">=</span><span class="kc">True</span>
</span><span id="1-838">        <span class="p">)</span><span class="o">.</span><span class="n">_set_parent_with_dispatch</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span><span id="1-839">        <span class="bp">self</span><span class="o">.</span><span class="n">foreign_keys</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>  <span class="c1"># type: ignore</span>
</span><span id="1-840">        <span class="bp">self</span><span class="o">.</span><span class="n">_extra_dependencies</span><span class="p">:</span> <span class="n">Set</span><span class="p">[</span><span class="n">Table</span><span class="p">]</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
</span><span id="1-841">        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">schema</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-842">            <span class="bp">self</span><span class="o">.</span><span class="n">fullname</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">.</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">schema</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</span><span id="1-843">        <span class="k">else</span><span class="p">:</span>
</span><span id="1-844">            <span class="bp">self</span><span class="o">.</span><span class="n">fullname</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>
</span><span id="1-845">
</span><span id="1-846">        <span class="bp">self</span><span class="o">.</span><span class="n">implicit_returning</span> <span class="o">=</span> <span class="n">implicit_returning</span>
</span><span id="1-847">        <span class="n">_reflect_info</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;_reflect_info&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="1-848">
</span><span id="1-849">        <span class="bp">self</span><span class="o">.</span><span class="n">comment</span> <span class="o">=</span> <span class="n">comment</span>
</span><span id="1-850">
</span><span id="1-851">        <span class="k">if</span> <span class="n">info</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-852">            <span class="bp">self</span><span class="o">.</span><span class="n">info</span> <span class="o">=</span> <span class="n">info</span>
</span><span id="1-853">
</span><span id="1-854">        <span class="k">if</span> <span class="n">listeners</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-855">            <span class="k">for</span> <span class="n">evt</span><span class="p">,</span> <span class="n">fn</span> <span class="ow">in</span> <span class="n">listeners</span><span class="p">:</span>
</span><span id="1-856">                <span class="n">event</span><span class="o">.</span><span class="n">listen</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">evt</span><span class="p">,</span> <span class="n">fn</span><span class="p">)</span>
</span><span id="1-857">
</span><span id="1-858">        <span class="bp">self</span><span class="o">.</span><span class="n">_prefixes</span> <span class="o">=</span> <span class="n">prefixes</span> <span class="k">if</span> <span class="n">prefixes</span> <span class="k">else</span> <span class="p">[]</span>
</span><span id="1-859">
</span><span id="1-860">        <span class="bp">self</span><span class="o">.</span><span class="n">_extra_kwargs</span><span class="p">(</span><span class="o">**</span><span class="n">kw</span><span class="p">)</span>
</span><span id="1-861">
</span><span id="1-862">        <span class="c1"># load column definitions from the database if &#39;autoload&#39; is defined</span>
</span><span id="1-863">        <span class="c1"># we do it after the table is in the singleton dictionary to support</span>
</span><span id="1-864">        <span class="c1"># circular foreign keys</span>
</span><span id="1-865">        <span class="k">if</span> <span class="n">autoload_with</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-866">            <span class="bp">self</span><span class="o">.</span><span class="n">_autoload</span><span class="p">(</span>
</span><span id="1-867">                <span class="n">metadata</span><span class="p">,</span>
</span><span id="1-868">                <span class="n">autoload_with</span><span class="p">,</span>
</span><span id="1-869">                <span class="n">include_columns</span><span class="p">,</span>
</span><span id="1-870">                <span class="n">_extend_on</span><span class="o">=</span><span class="n">_extend_on</span><span class="p">,</span>
</span><span id="1-871">                <span class="n">_reflect_info</span><span class="o">=</span><span class="n">_reflect_info</span><span class="p">,</span>
</span><span id="1-872">                <span class="n">resolve_fks</span><span class="o">=</span><span class="n">resolve_fks</span><span class="p">,</span>
</span><span id="1-873">            <span class="p">)</span>
</span><span id="1-874">
</span><span id="1-875">        <span class="c1"># initialize all the column, etc. objects.  done after reflection to</span>
</span><span id="1-876">        <span class="c1"># allow user-overrides</span>
</span><span id="1-877">
</span><span id="1-878">        <span class="bp">self</span><span class="o">.</span><span class="n">_init_items</span><span class="p">(</span>
</span><span id="1-879">            <span class="o">*</span><span class="n">args</span><span class="p">,</span>
</span><span id="1-880">            <span class="n">allow_replacements</span><span class="o">=</span><span class="n">extend_existing</span>
</span><span id="1-881">            <span class="ow">or</span> <span class="n">keep_existing</span>
</span><span id="1-882">            <span class="ow">or</span> <span class="n">autoload_with</span><span class="p">,</span>
</span><span id="1-883">            <span class="n">all_names</span><span class="o">=</span><span class="p">{},</span>
</span><span id="1-884">        <span class="p">)</span>
</span><span id="1-885">
</span><span id="1-886">    <span class="k">def</span> <span class="nf">_autoload</span><span class="p">(</span>
</span><span id="1-887">        <span class="bp">self</span><span class="p">,</span>
</span><span id="1-888">        <span class="n">metadata</span><span class="p">:</span> <span class="n">MetaData</span><span class="p">,</span>
</span><span id="1-889">        <span class="n">autoload_with</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Engine</span><span class="p">,</span> <span class="n">Connection</span><span class="p">],</span>
</span><span id="1-890">        <span class="n">include_columns</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Collection</span><span class="p">[</span><span class="nb">str</span><span class="p">]],</span>
</span><span id="1-891">        <span class="n">exclude_columns</span><span class="p">:</span> <span class="n">Collection</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">(),</span>
</span><span id="1-892">        <span class="n">resolve_fks</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="1-893">        <span class="n">_extend_on</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Set</span><span class="p">[</span><span class="n">Table</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="1-894">        <span class="n">_reflect_info</span><span class="p">:</span> <span class="n">_ReflectionInfo</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="1-895">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-896">        <span class="n">insp</span> <span class="o">=</span> <span class="n">inspection</span><span class="o">.</span><span class="n">inspect</span><span class="p">(</span><span class="n">autoload_with</span><span class="p">)</span>
</span><span id="1-897">        <span class="k">with</span> <span class="n">insp</span><span class="o">.</span><span class="n">_inspection_context</span><span class="p">()</span> <span class="k">as</span> <span class="n">conn_insp</span><span class="p">:</span>
</span><span id="1-898">            <span class="n">conn_insp</span><span class="o">.</span><span class="n">reflect_table</span><span class="p">(</span>
</span><span id="1-899">                <span class="bp">self</span><span class="p">,</span>
</span><span id="1-900">                <span class="n">include_columns</span><span class="p">,</span>
</span><span id="1-901">                <span class="n">exclude_columns</span><span class="p">,</span>
</span><span id="1-902">                <span class="n">resolve_fks</span><span class="p">,</span>
</span><span id="1-903">                <span class="n">_extend_on</span><span class="o">=</span><span class="n">_extend_on</span><span class="p">,</span>
</span><span id="1-904">                <span class="n">_reflect_info</span><span class="o">=</span><span class="n">_reflect_info</span><span class="p">,</span>
</span><span id="1-905">            <span class="p">)</span>
</span><span id="1-906">
</span><span id="1-907">    <span class="nd">@property</span>
</span><span id="1-908">    <span class="k">def</span> <span class="nf">_sorted_constraints</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Constraint</span><span class="p">]:</span>
</span><span id="1-909"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the set of constraints as a list, sorted by creation</span>
</span><span id="1-910"><span class="sd">        order.</span>
</span><span id="1-911">
</span><span id="1-912"><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="1-913">
</span><span id="1-914">        <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">constraints</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">c</span><span class="p">:</span> <span class="n">c</span><span class="o">.</span><span class="n">_creation_order</span><span class="p">)</span>
</span><span id="1-915">
</span><span id="1-916">    <span class="nd">@property</span>
</span><span id="1-917">    <span class="k">def</span> <span class="nf">foreign_key_constraints</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Set</span><span class="p">[</span><span class="n">ForeignKeyConstraint</span><span class="p">]:</span>
</span><span id="1-918"><span class="w">        </span><span class="sd">&quot;&quot;&quot;:class:`_schema.ForeignKeyConstraint` objects referred to by this</span>
</span><span id="1-919"><span class="sd">        :class:`_schema.Table`.</span>
</span><span id="1-920">
</span><span id="1-921"><span class="sd">        This list is produced from the collection of</span>
</span><span id="1-922"><span class="sd">        :class:`_schema.ForeignKey`</span>
</span><span id="1-923"><span class="sd">        objects currently associated.</span>
</span><span id="1-924">
</span><span id="1-925">
</span><span id="1-926"><span class="sd">        .. seealso::</span>
</span><span id="1-927">
</span><span id="1-928"><span class="sd">            :attr:`_schema.Table.constraints`</span>
</span><span id="1-929">
</span><span id="1-930"><span class="sd">            :attr:`_schema.Table.foreign_keys`</span>
</span><span id="1-931">
</span><span id="1-932"><span class="sd">            :attr:`_schema.Table.indexes`</span>
</span><span id="1-933">
</span><span id="1-934"><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="1-935">        <span class="k">return</span> <span class="p">{</span>
</span><span id="1-936">            <span class="n">fkc</span><span class="o">.</span><span class="n">constraint</span>
</span><span id="1-937">            <span class="k">for</span> <span class="n">fkc</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">foreign_keys</span>
</span><span id="1-938">            <span class="k">if</span> <span class="n">fkc</span><span class="o">.</span><span class="n">constraint</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span id="1-939">        <span class="p">}</span>
</span><span id="1-940">
</span><span id="1-941">    <span class="k">def</span> <span class="nf">_init_existing</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-942">        <span class="n">autoload_with</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;autoload_with&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="1-943">        <span class="n">autoload</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;autoload&quot;</span><span class="p">,</span> <span class="n">autoload_with</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="1-944">        <span class="n">autoload_replace</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;autoload_replace&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
</span><span id="1-945">        <span class="n">schema</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;schema&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="1-946">        <span class="n">_extend_on</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;_extend_on&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="1-947">        <span class="n">_reflect_info</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;_reflect_info&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="1-948">
</span><span id="1-949">        <span class="c1"># these arguments are only used with _init()</span>
</span><span id="1-950">        <span class="n">extend_existing</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;extend_existing&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
</span><span id="1-951">        <span class="n">keep_existing</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;keep_existing&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
</span><span id="1-952">
</span><span id="1-953">        <span class="k">assert</span> <span class="n">extend_existing</span>
</span><span id="1-954">        <span class="k">assert</span> <span class="ow">not</span> <span class="n">keep_existing</span>
</span><span id="1-955">
</span><span id="1-956">        <span class="k">if</span> <span class="n">schema</span> <span class="ow">and</span> <span class="n">schema</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">schema</span><span class="p">:</span>
</span><span id="1-957">            <span class="k">raise</span> <span class="n">exc</span><span class="o">.</span><span class="n">ArgumentError</span><span class="p">(</span>
</span><span id="1-958">                <span class="s2">&quot;Can&#39;t change schema of existing table from &#39;</span><span class="si">%s</span><span class="s2">&#39; to &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span><span class="p">,</span>
</span><span id="1-959">                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">schema</span><span class="p">,</span> <span class="n">schema</span><span class="p">),</span>
</span><span id="1-960">            <span class="p">)</span>
</span><span id="1-961">
</span><span id="1-962">        <span class="n">include_columns</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;include_columns&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="1-963">        <span class="k">if</span> <span class="n">include_columns</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-964">            <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span><span class="p">:</span>
</span><span id="1-965">                <span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">include_columns</span><span class="p">:</span>
</span><span id="1-966">                    <span class="bp">self</span><span class="o">.</span><span class="n">_columns</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
</span><span id="1-967">
</span><span id="1-968">        <span class="n">resolve_fks</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;resolve_fks&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
</span><span id="1-969">
</span><span id="1-970">        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;quote&quot;</span><span class="p">,</span> <span class="s2">&quot;quote_schema&quot;</span><span class="p">):</span>
</span><span id="1-971">            <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
</span><span id="1-972">                <span class="k">raise</span> <span class="n">exc</span><span class="o">.</span><span class="n">ArgumentError</span><span class="p">(</span>
</span><span id="1-973">                    <span class="s2">&quot;Can&#39;t redefine &#39;quote&#39; or &#39;quote_schema&#39; arguments&quot;</span>
</span><span id="1-974">                <span class="p">)</span>
</span><span id="1-975">
</span><span id="1-976">        <span class="c1"># update `self` with these kwargs, if provided</span>
</span><span id="1-977">        <span class="bp">self</span><span class="o">.</span><span class="n">comment</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;comment&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">comment</span><span class="p">)</span>
</span><span id="1-978">        <span class="bp">self</span><span class="o">.</span><span class="n">implicit_returning</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span>
</span><span id="1-979">            <span class="s2">&quot;implicit_returning&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">implicit_returning</span>
</span><span id="1-980">        <span class="p">)</span>
</span><span id="1-981">        <span class="bp">self</span><span class="o">.</span><span class="n">info</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;info&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="p">)</span>
</span><span id="1-982">
</span><span id="1-983">        <span class="n">exclude_columns</span><span class="p">:</span> <span class="n">_typing_Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
</span><span id="1-984">
</span><span id="1-985">        <span class="k">if</span> <span class="n">autoload</span><span class="p">:</span>
</span><span id="1-986">            <span class="k">if</span> <span class="ow">not</span> <span class="n">autoload_replace</span><span class="p">:</span>
</span><span id="1-987">                <span class="c1"># don&#39;t replace columns already present.</span>
</span><span id="1-988">                <span class="c1"># we&#39;d like to do this for constraints also however we don&#39;t</span>
</span><span id="1-989">                <span class="c1"># have simple de-duping for unnamed constraints.</span>
</span><span id="1-990">                <span class="n">exclude_columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span><span class="p">]</span>
</span><span id="1-991">            <span class="k">else</span><span class="p">:</span>
</span><span id="1-992">                <span class="n">exclude_columns</span> <span class="o">=</span> <span class="p">()</span>
</span><span id="1-993">            <span class="bp">self</span><span class="o">.</span><span class="n">_autoload</span><span class="p">(</span>
</span><span id="1-994">                <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">,</span>
</span><span id="1-995">                <span class="n">autoload_with</span><span class="p">,</span>
</span><span id="1-996">                <span class="n">include_columns</span><span class="p">,</span>
</span><span id="1-997">                <span class="n">exclude_columns</span><span class="p">,</span>
</span><span id="1-998">                <span class="n">resolve_fks</span><span class="p">,</span>
</span><span id="1-999">                <span class="n">_extend_on</span><span class="o">=</span><span class="n">_extend_on</span><span class="p">,</span>
</span><span id="1-1000">                <span class="n">_reflect_info</span><span class="o">=</span><span class="n">_reflect_info</span><span class="p">,</span>
</span><span id="1-1001">            <span class="p">)</span>
</span><span id="1-1002">
</span><span id="1-1003">        <span class="n">all_names</span> <span class="o">=</span> <span class="p">{</span><span class="n">c</span><span class="o">.</span><span class="n">name</span><span class="p">:</span> <span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span><span class="p">}</span>
</span><span id="1-1004">        <span class="bp">self</span><span class="o">.</span><span class="n">_extra_kwargs</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="1-1005">        <span class="bp">self</span><span class="o">.</span><span class="n">_init_items</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">allow_replacements</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">all_names</span><span class="o">=</span><span class="n">all_names</span><span class="p">)</span>
</span><span id="1-1006">
</span><span id="1-1007">    <span class="k">def</span> <span class="nf">_extra_kwargs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-1008">        <span class="bp">self</span><span class="o">.</span><span class="n">_validate_dialect_kwargs</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="1-1009">
</span><span id="1-1010">    <span class="k">def</span> <span class="nf">_init_collections</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-1011">        <span class="k">pass</span>
</span><span id="1-1012">
</span><span id="1-1013">    <span class="k">def</span> <span class="nf">_reset_exported</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-1014">        <span class="k">pass</span>
</span><span id="1-1015">
</span><span id="1-1016">    <span class="nd">@util</span><span class="o">.</span><span class="n">ro_non_memoized_property</span>
</span><span id="1-1017">    <span class="k">def</span> <span class="nf">_autoincrement_column</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Column</span><span class="p">[</span><span class="nb">int</span><span class="p">]]:</span>
</span><span id="1-1018">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">primary_key</span><span class="o">.</span><span class="n">_autoincrement_column</span>
</span><span id="1-1019">
</span><span id="1-1020">    <span class="nd">@util</span><span class="o">.</span><span class="n">ro_memoized_property</span>
</span><span id="1-1021">    <span class="k">def</span> <span class="nf">_sentinel_column_characteristics</span><span class="p">(</span>
</span><span id="1-1022">        <span class="bp">self</span><span class="p">,</span>
</span><span id="1-1023">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_SentinelColumnCharacterization</span><span class="p">:</span>
</span><span id="1-1024"><span class="w">        </span><span class="sd">&quot;&quot;&quot;determine a candidate column (or columns, in case of a client</span>
</span><span id="1-1025"><span class="sd">        generated composite primary key) which can be used as an</span>
</span><span id="1-1026"><span class="sd">        &quot;insert sentinel&quot; for an INSERT statement.</span>
</span><span id="1-1027">
</span><span id="1-1028"><span class="sd">        The returned structure, :class:`_SentinelColumnCharacterization`,</span>
</span><span id="1-1029"><span class="sd">        includes all the details needed by :class:`.Dialect` and</span>
</span><span id="1-1030"><span class="sd">        :class:`.SQLCompiler` to determine if these column(s) can be used</span>
</span><span id="1-1031"><span class="sd">        as an INSERT..RETURNING sentinel for a particular database</span>
</span><span id="1-1032"><span class="sd">        dialect.</span>
</span><span id="1-1033">
</span><span id="1-1034"><span class="sd">        .. versionadded:: 2.0.10</span>
</span><span id="1-1035">
</span><span id="1-1036"><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="1-1037">
</span><span id="1-1038">        <span class="n">sentinel_is_explicit</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="1-1039">        <span class="n">sentinel_is_autoinc</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="1-1040">        <span class="n">the_sentinel</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">_typing_Sequence</span><span class="p">[</span><span class="n">Column</span><span class="p">[</span><span class="n">Any</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="1-1041">
</span><span id="1-1042">        <span class="c1"># see if a column was explicitly marked &quot;insert_sentinel=True&quot;.</span>
</span><span id="1-1043">        <span class="n">explicit_sentinel_col</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sentinel_column</span>
</span><span id="1-1044">
</span><span id="1-1045">        <span class="k">if</span> <span class="n">explicit_sentinel_col</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-1046">            <span class="n">the_sentinel</span> <span class="o">=</span> <span class="p">(</span><span class="n">explicit_sentinel_col</span><span class="p">,)</span>
</span><span id="1-1047">            <span class="n">sentinel_is_explicit</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="1-1048">
</span><span id="1-1049">        <span class="n">autoinc_col</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_autoincrement_column</span>
</span><span id="1-1050">        <span class="k">if</span> <span class="n">sentinel_is_explicit</span> <span class="ow">and</span> <span class="n">explicit_sentinel_col</span> <span class="ow">is</span> <span class="n">autoinc_col</span><span class="p">:</span>
</span><span id="1-1051">            <span class="k">assert</span> <span class="n">autoinc_col</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span id="1-1052">            <span class="n">sentinel_is_autoinc</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="1-1053">        <span class="k">elif</span> <span class="n">explicit_sentinel_col</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">autoinc_col</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-1054">            <span class="n">the_sentinel</span> <span class="o">=</span> <span class="p">(</span><span class="n">autoinc_col</span><span class="p">,)</span>
</span><span id="1-1055">            <span class="n">sentinel_is_autoinc</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="1-1056">
</span><span id="1-1057">        <span class="n">default_characterization</span> <span class="o">=</span> <span class="n">_SentinelDefaultCharacterization</span><span class="o">.</span><span class="n">UNKNOWN</span>
</span><span id="1-1058">
</span><span id="1-1059">        <span class="k">if</span> <span class="n">the_sentinel</span><span class="p">:</span>
</span><span id="1-1060">            <span class="n">the_sentinel_zero</span> <span class="o">=</span> <span class="n">the_sentinel</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="1-1061">            <span class="k">if</span> <span class="n">the_sentinel_zero</span><span class="o">.</span><span class="n">identity</span><span class="p">:</span>
</span><span id="1-1062">                <span class="k">if</span> <span class="n">the_sentinel_zero</span><span class="o">.</span><span class="n">identity</span><span class="o">.</span><span class="n">_increment_is_negative</span><span class="p">:</span>
</span><span id="1-1063">                    <span class="k">if</span> <span class="n">sentinel_is_explicit</span><span class="p">:</span>
</span><span id="1-1064">                        <span class="k">raise</span> <span class="n">exc</span><span class="o">.</span><span class="n">InvalidRequestError</span><span class="p">(</span>
</span><span id="1-1065">                            <span class="s2">&quot;Can&#39;t use IDENTITY default with negative &quot;</span>
</span><span id="1-1066">                            <span class="s2">&quot;increment as an explicit sentinel column&quot;</span>
</span><span id="1-1067">                        <span class="p">)</span>
</span><span id="1-1068">                    <span class="k">else</span><span class="p">:</span>
</span><span id="1-1069">                        <span class="k">if</span> <span class="n">sentinel_is_autoinc</span><span class="p">:</span>
</span><span id="1-1070">                            <span class="n">autoinc_col</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="1-1071">                            <span class="n">sentinel_is_autoinc</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="1-1072">                        <span class="n">the_sentinel</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="1-1073">                <span class="k">else</span><span class="p">:</span>
</span><span id="1-1074">                    <span class="n">default_characterization</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="1-1075">                        <span class="n">_SentinelDefaultCharacterization</span><span class="o">.</span><span class="n">IDENTITY</span>
</span><span id="1-1076">                    <span class="p">)</span>
</span><span id="1-1077">            <span class="k">elif</span> <span class="p">(</span>
</span><span id="1-1078">                <span class="n">the_sentinel_zero</span><span class="o">.</span><span class="n">default</span> <span class="ow">is</span> <span class="kc">None</span>
</span><span id="1-1079">                <span class="ow">and</span> <span class="n">the_sentinel_zero</span><span class="o">.</span><span class="n">server_default</span> <span class="ow">is</span> <span class="kc">None</span>
</span><span id="1-1080">            <span class="p">):</span>
</span><span id="1-1081">                <span class="k">if</span> <span class="n">the_sentinel_zero</span><span class="o">.</span><span class="n">nullable</span><span class="p">:</span>
</span><span id="1-1082">                    <span class="k">raise</span> <span class="n">exc</span><span class="o">.</span><span class="n">InvalidRequestError</span><span class="p">(</span>
</span><span id="1-1083">                        <span class="sa">f</span><span class="s2">&quot;Column </span><span class="si">{</span><span class="n">the_sentinel_zero</span><span class="si">}</span><span class="s2"> has been marked as a &quot;</span>
</span><span id="1-1084">                        <span class="s2">&quot;sentinel &quot;</span>
</span><span id="1-1085">                        <span class="s2">&quot;column with no default generation function; it &quot;</span>
</span><span id="1-1086">                        <span class="s2">&quot;at least needs to be marked nullable=False assuming &quot;</span>
</span><span id="1-1087">                        <span class="s2">&quot;user-populated sentinel values will be used.&quot;</span>
</span><span id="1-1088">                    <span class="p">)</span>
</span><span id="1-1089">                <span class="n">default_characterization</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="1-1090">                    <span class="n">_SentinelDefaultCharacterization</span><span class="o">.</span><span class="n">NONE</span>
</span><span id="1-1091">                <span class="p">)</span>
</span><span id="1-1092">            <span class="k">elif</span> <span class="n">the_sentinel_zero</span><span class="o">.</span><span class="n">default</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-1093">                <span class="k">if</span> <span class="n">the_sentinel_zero</span><span class="o">.</span><span class="n">default</span><span class="o">.</span><span class="n">is_sentinel</span><span class="p">:</span>
</span><span id="1-1094">                    <span class="n">default_characterization</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="1-1095">                        <span class="n">_SentinelDefaultCharacterization</span><span class="o">.</span><span class="n">SENTINEL_DEFAULT</span>
</span><span id="1-1096">                    <span class="p">)</span>
</span><span id="1-1097">                <span class="k">elif</span> <span class="n">default_is_sequence</span><span class="p">(</span><span class="n">the_sentinel_zero</span><span class="o">.</span><span class="n">default</span><span class="p">):</span>
</span><span id="1-1098">                    <span class="k">if</span> <span class="n">the_sentinel_zero</span><span class="o">.</span><span class="n">default</span><span class="o">.</span><span class="n">_increment_is_negative</span><span class="p">:</span>
</span><span id="1-1099">                        <span class="k">if</span> <span class="n">sentinel_is_explicit</span><span class="p">:</span>
</span><span id="1-1100">                            <span class="k">raise</span> <span class="n">exc</span><span class="o">.</span><span class="n">InvalidRequestError</span><span class="p">(</span>
</span><span id="1-1101">                                <span class="s2">&quot;Can&#39;t use SEQUENCE default with negative &quot;</span>
</span><span id="1-1102">                                <span class="s2">&quot;increment as an explicit sentinel column&quot;</span>
</span><span id="1-1103">                            <span class="p">)</span>
</span><span id="1-1104">                        <span class="k">else</span><span class="p">:</span>
</span><span id="1-1105">                            <span class="k">if</span> <span class="n">sentinel_is_autoinc</span><span class="p">:</span>
</span><span id="1-1106">                                <span class="n">autoinc_col</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="1-1107">                                <span class="n">sentinel_is_autoinc</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="1-1108">                            <span class="n">the_sentinel</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="1-1109">
</span><span id="1-1110">                    <span class="n">default_characterization</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="1-1111">                        <span class="n">_SentinelDefaultCharacterization</span><span class="o">.</span><span class="n">SEQUENCE</span>
</span><span id="1-1112">                    <span class="p">)</span>
</span><span id="1-1113">                <span class="k">elif</span> <span class="n">the_sentinel_zero</span><span class="o">.</span><span class="n">default</span><span class="o">.</span><span class="n">is_callable</span><span class="p">:</span>
</span><span id="1-1114">                    <span class="n">default_characterization</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="1-1115">                        <span class="n">_SentinelDefaultCharacterization</span><span class="o">.</span><span class="n">CLIENTSIDE</span>
</span><span id="1-1116">                    <span class="p">)</span>
</span><span id="1-1117">            <span class="k">elif</span> <span class="n">the_sentinel_zero</span><span class="o">.</span><span class="n">server_default</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-1118">                <span class="k">if</span> <span class="n">sentinel_is_explicit</span><span class="p">:</span>
</span><span id="1-1119">                    <span class="k">raise</span> <span class="n">exc</span><span class="o">.</span><span class="n">InvalidRequestError</span><span class="p">(</span>
</span><span id="1-1120">                        <span class="sa">f</span><span class="s2">&quot;Column </span><span class="si">{</span><span class="n">the_sentinel</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2"> can&#39;t be a sentinel column &quot;</span>
</span><span id="1-1121">                        <span class="s2">&quot;because it uses an explicit server side default &quot;</span>
</span><span id="1-1122">                        <span class="s2">&quot;that&#39;s not the Identity() default.&quot;</span>
</span><span id="1-1123">                    <span class="p">)</span>
</span><span id="1-1124">
</span><span id="1-1125">                <span class="n">default_characterization</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="1-1126">                    <span class="n">_SentinelDefaultCharacterization</span><span class="o">.</span><span class="n">SERVERSIDE</span>
</span><span id="1-1127">                <span class="p">)</span>
</span><span id="1-1128">
</span><span id="1-1129">        <span class="k">if</span> <span class="n">the_sentinel</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">primary_key</span><span class="p">:</span>
</span><span id="1-1130">            <span class="k">assert</span> <span class="n">autoinc_col</span> <span class="ow">is</span> <span class="kc">None</span>
</span><span id="1-1131">
</span><span id="1-1132">            <span class="c1"># determine for non-autoincrement pk if all elements are</span>
</span><span id="1-1133">            <span class="c1"># client side</span>
</span><span id="1-1134">            <span class="k">for</span> <span class="n">_pkc</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">primary_key</span><span class="p">:</span>
</span><span id="1-1135">                <span class="k">if</span> <span class="n">_pkc</span><span class="o">.</span><span class="n">server_default</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">or</span> <span class="p">(</span>
</span><span id="1-1136">                    <span class="n">_pkc</span><span class="o">.</span><span class="n">default</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">_pkc</span><span class="o">.</span><span class="n">default</span><span class="o">.</span><span class="n">is_callable</span>
</span><span id="1-1137">                <span class="p">):</span>
</span><span id="1-1138">                    <span class="k">break</span>
</span><span id="1-1139">            <span class="k">else</span><span class="p">:</span>
</span><span id="1-1140">                <span class="n">the_sentinel</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">primary_key</span><span class="p">)</span>
</span><span id="1-1141">                <span class="n">default_characterization</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="1-1142">                    <span class="n">_SentinelDefaultCharacterization</span><span class="o">.</span><span class="n">CLIENTSIDE</span>
</span><span id="1-1143">                <span class="p">)</span>
</span><span id="1-1144">
</span><span id="1-1145">        <span class="k">return</span> <span class="n">_SentinelColumnCharacterization</span><span class="p">(</span>
</span><span id="1-1146">            <span class="n">the_sentinel</span><span class="p">,</span>
</span><span id="1-1147">            <span class="n">sentinel_is_explicit</span><span class="p">,</span>
</span><span id="1-1148">            <span class="n">sentinel_is_autoinc</span><span class="p">,</span>
</span><span id="1-1149">            <span class="n">default_characterization</span><span class="p">,</span>
</span><span id="1-1150">        <span class="p">)</span>
</span><span id="1-1151">
</span><span id="1-1152">    <span class="nd">@property</span>
</span><span id="1-1153">    <span class="k">def</span> <span class="nf">autoincrement_column</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Column</span><span class="p">[</span><span class="nb">int</span><span class="p">]]:</span>
</span><span id="1-1154"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns the :class:`.Column` object which currently represents</span>
</span><span id="1-1155"><span class="sd">        the &quot;auto increment&quot; column, if any, else returns None.</span>
</span><span id="1-1156">
</span><span id="1-1157"><span class="sd">        This is based on the rules for :class:`.Column` as defined by the</span>
</span><span id="1-1158"><span class="sd">        :paramref:`.Column.autoincrement` parameter, which generally means the</span>
</span><span id="1-1159"><span class="sd">        column within a single integer column primary key constraint that is</span>
</span><span id="1-1160"><span class="sd">        not constrained by a foreign key.   If the table does not have such</span>
</span><span id="1-1161"><span class="sd">        a primary key constraint, then there&#39;s no &quot;autoincrement&quot; column.</span>
</span><span id="1-1162"><span class="sd">        A :class:`.Table` may have only one column defined as the</span>
</span><span id="1-1163"><span class="sd">        &quot;autoincrement&quot; column.</span>
</span><span id="1-1164">
</span><span id="1-1165"><span class="sd">        .. versionadded:: 2.0.4</span>
</span><span id="1-1166">
</span><span id="1-1167"><span class="sd">        .. seealso::</span>
</span><span id="1-1168">
</span><span id="1-1169"><span class="sd">            :paramref:`.Column.autoincrement`</span>
</span><span id="1-1170">
</span><span id="1-1171"><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="1-1172">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_autoincrement_column</span>
</span><span id="1-1173">
</span><span id="1-1174">    <span class="nd">@property</span>
</span><span id="1-1175">    <span class="k">def</span> <span class="nf">key</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="1-1176"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the &#39;key&#39; for this :class:`_schema.Table`.</span>
</span><span id="1-1177">
</span><span id="1-1178"><span class="sd">        This value is used as the dictionary key within the</span>
</span><span id="1-1179"><span class="sd">        :attr:`_schema.MetaData.tables` collection.   It is typically the same</span>
</span><span id="1-1180"><span class="sd">        as that of :attr:`_schema.Table.name` for a table with no</span>
</span><span id="1-1181"><span class="sd">        :attr:`_schema.Table.schema`</span>
</span><span id="1-1182"><span class="sd">        set; otherwise it is typically of the form</span>
</span><span id="1-1183"><span class="sd">        ``schemaname.tablename``.</span>
</span><span id="1-1184">
</span><span id="1-1185"><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="1-1186">        <span class="k">return</span> <span class="n">_get_table_key</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">schema</span><span class="p">)</span>
</span><span id="1-1187">
</span><span id="1-1188">    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="1-1189">        <span class="k">return</span> <span class="s2">&quot;Table(</span><span class="si">%s</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="1-1190">            <span class="p">[</span><span class="nb">repr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)]</span>
</span><span id="1-1191">            <span class="o">+</span> <span class="p">[</span><span class="nb">repr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">)]</span>
</span><span id="1-1192">            <span class="o">+</span> <span class="p">[</span><span class="nb">repr</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">columns</span><span class="p">]</span>
</span><span id="1-1193">            <span class="o">+</span> <span class="p">[</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">=</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="nb">repr</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">)))</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;schema&quot;</span><span class="p">]]</span>
</span><span id="1-1194">        <span class="p">)</span>
</span><span id="1-1195">
</span><span id="1-1196">    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="1-1197">        <span class="k">return</span> <span class="n">_get_table_key</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">description</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">schema</span><span class="p">)</span>
</span><span id="1-1198">
</span><span id="1-1199">    <span class="k">def</span> <span class="nf">add_is_dependent_on</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">table</span><span class="p">:</span> <span class="n">Table</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-1200"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Add a &#39;dependency&#39; for this Table.</span>
</span><span id="1-1201">
</span><span id="1-1202"><span class="sd">        This is another Table object which must be created</span>
</span><span id="1-1203"><span class="sd">        first before this one can, or dropped after this one.</span>
</span><span id="1-1204">
</span><span id="1-1205"><span class="sd">        Usually, dependencies between tables are determined via</span>
</span><span id="1-1206"><span class="sd">        ForeignKey objects.   However, for other situations that</span>
</span><span id="1-1207"><span class="sd">        create dependencies outside of foreign keys (rules, inheriting),</span>
</span><span id="1-1208"><span class="sd">        this method can manually establish such a link.</span>
</span><span id="1-1209">
</span><span id="1-1210"><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="1-1211">        <span class="bp">self</span><span class="o">.</span><span class="n">_extra_dependencies</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">table</span><span class="p">)</span>
</span><span id="1-1212">
</span><span id="1-1213">    <span class="k">def</span> <span class="nf">append_column</span><span class="p">(</span>
</span><span id="1-1214">        <span class="bp">self</span><span class="p">,</span> <span class="n">column</span><span class="p">:</span> <span class="n">ColumnClause</span><span class="p">[</span><span class="n">Any</span><span class="p">],</span> <span class="n">replace_existing</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="1-1215">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-1216"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Append a :class:`_schema.Column` to this :class:`_schema.Table`.</span>
</span><span id="1-1217">
</span><span id="1-1218"><span class="sd">        The &quot;key&quot; of the newly added :class:`_schema.Column`, i.e. the</span>
</span><span id="1-1219"><span class="sd">        value of its ``.key`` attribute, will then be available</span>
</span><span id="1-1220"><span class="sd">        in the ``.c`` collection of this :class:`_schema.Table`, and the</span>
</span><span id="1-1221"><span class="sd">        column definition will be included in any CREATE TABLE, SELECT,</span>
</span><span id="1-1222"><span class="sd">        UPDATE, etc. statements generated from this :class:`_schema.Table`</span>
</span><span id="1-1223"><span class="sd">        construct.</span>
</span><span id="1-1224">
</span><span id="1-1225"><span class="sd">        Note that this does **not** change the definition of the table</span>
</span><span id="1-1226"><span class="sd">        as it exists within any underlying database, assuming that</span>
</span><span id="1-1227"><span class="sd">        table has already been created in the database.   Relational</span>
</span><span id="1-1228"><span class="sd">        databases support the addition of columns to existing tables</span>
</span><span id="1-1229"><span class="sd">        using the SQL ALTER command, which would need to be</span>
</span><span id="1-1230"><span class="sd">        emitted for an already-existing table that doesn&#39;t contain</span>
</span><span id="1-1231"><span class="sd">        the newly added column.</span>
</span><span id="1-1232">
</span><span id="1-1233"><span class="sd">        :param replace_existing: When ``True``, allows replacing existing</span>
</span><span id="1-1234"><span class="sd">            columns. When ``False``, the default, an warning will be raised</span>
</span><span id="1-1235"><span class="sd">            if a column with the same ``.key`` already exists. A future</span>
</span><span id="1-1236"><span class="sd">            version of sqlalchemy will instead rise a warning.</span>
</span><span id="1-1237">
</span><span id="1-1238"><span class="sd">            .. versionadded:: 1.4.0</span>
</span><span id="1-1239"><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="1-1240">
</span><span id="1-1241">        <span class="k">try</span><span class="p">:</span>
</span><span id="1-1242">            <span class="n">column</span><span class="o">.</span><span class="n">_set_parent_with_dispatch</span><span class="p">(</span>
</span><span id="1-1243">                <span class="bp">self</span><span class="p">,</span>
</span><span id="1-1244">                <span class="n">allow_replacements</span><span class="o">=</span><span class="n">replace_existing</span><span class="p">,</span>
</span><span id="1-1245">                <span class="n">all_names</span><span class="o">=</span><span class="p">{</span><span class="n">c</span><span class="o">.</span><span class="n">name</span><span class="p">:</span> <span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span><span class="p">},</span>
</span><span id="1-1246">            <span class="p">)</span>
</span><span id="1-1247">        <span class="k">except</span> <span class="n">exc</span><span class="o">.</span><span class="n">DuplicateColumnError</span> <span class="k">as</span> <span class="n">de</span><span class="p">:</span>
</span><span id="1-1248">            <span class="k">raise</span> <span class="n">exc</span><span class="o">.</span><span class="n">DuplicateColumnError</span><span class="p">(</span>
</span><span id="1-1249">                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">de</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2"> Specify replace_existing=True to &quot;</span>
</span><span id="1-1250">                <span class="s2">&quot;Table.append_column() to replace an &quot;</span>
</span><span id="1-1251">                <span class="s2">&quot;existing column.&quot;</span>
</span><span id="1-1252">            <span class="p">)</span> <span class="kn">from</span> <span class="nn">de</span>
</span><span id="1-1253">
</span><span id="1-1254">    <span class="k">def</span> <span class="nf">append_constraint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">constraint</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Index</span><span class="p">,</span> <span class="n">Constraint</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-1255"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Append a :class:`_schema.Constraint` to this</span>
</span><span id="1-1256"><span class="sd">        :class:`_schema.Table`.</span>
</span><span id="1-1257">
</span><span id="1-1258"><span class="sd">        This has the effect of the constraint being included in any</span>
</span><span id="1-1259"><span class="sd">        future CREATE TABLE statement, assuming specific DDL creation</span>
</span><span id="1-1260"><span class="sd">        events have not been associated with the given</span>
</span><span id="1-1261"><span class="sd">        :class:`_schema.Constraint` object.</span>
</span><span id="1-1262">
</span><span id="1-1263"><span class="sd">        Note that this does **not** produce the constraint within the</span>
</span><span id="1-1264"><span class="sd">        relational database automatically, for a table that already exists</span>
</span><span id="1-1265"><span class="sd">        in the database.   To add a constraint to an</span>
</span><span id="1-1266"><span class="sd">        existing relational database table, the SQL ALTER command must</span>
</span><span id="1-1267"><span class="sd">        be used.  SQLAlchemy also provides the</span>
</span><span id="1-1268"><span class="sd">        :class:`.AddConstraint` construct which can produce this SQL when</span>
</span><span id="1-1269"><span class="sd">        invoked as an executable clause.</span>
</span><span id="1-1270">
</span><span id="1-1271"><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="1-1272">
</span><span id="1-1273">        <span class="n">constraint</span><span class="o">.</span><span class="n">_set_parent_with_dispatch</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span><span id="1-1274">
</span><span id="1-1275">    <span class="k">def</span> <span class="nf">_set_parent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">:</span> <span class="n">SchemaEventTarget</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-1276">        <span class="n">metadata</span> <span class="o">=</span> <span class="n">parent</span>
</span><span id="1-1277">        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">metadata</span><span class="p">,</span> <span class="n">MetaData</span><span class="p">)</span>
</span><span id="1-1278">        <span class="n">metadata</span><span class="o">.</span><span class="n">_add_table</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">schema</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
</span><span id="1-1279">        <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span> <span class="o">=</span> <span class="n">metadata</span>
</span><span id="1-1280">
</span><span id="1-1281">    <span class="k">def</span> <span class="nf">create</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bind</span><span class="p">:</span> <span class="n">_CreateDropBind</span><span class="p">,</span> <span class="n">checkfirst</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-1282"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Issue a ``CREATE`` statement for this</span>
</span><span id="1-1283"><span class="sd">        :class:`_schema.Table`, using the given</span>
</span><span id="1-1284"><span class="sd">        :class:`.Connection` or :class:`.Engine`</span>
</span><span id="1-1285"><span class="sd">        for connectivity.</span>
</span><span id="1-1286">
</span><span id="1-1287"><span class="sd">        .. seealso::</span>
</span><span id="1-1288">
</span><span id="1-1289"><span class="sd">            :meth:`_schema.MetaData.create_all`.</span>
</span><span id="1-1290">
</span><span id="1-1291"><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="1-1292">
</span><span id="1-1293">        <span class="n">bind</span><span class="o">.</span><span class="n">_run_ddl_visitor</span><span class="p">(</span><span class="n">ddl</span><span class="o">.</span><span class="n">SchemaGenerator</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="n">checkfirst</span><span class="o">=</span><span class="n">checkfirst</span><span class="p">)</span>
</span><span id="1-1294">
</span><span id="1-1295">    <span class="k">def</span> <span class="nf">drop</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bind</span><span class="p">:</span> <span class="n">_CreateDropBind</span><span class="p">,</span> <span class="n">checkfirst</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-1296"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Issue a ``DROP`` statement for this</span>
</span><span id="1-1297"><span class="sd">        :class:`_schema.Table`, using the given</span>
</span><span id="1-1298"><span class="sd">        :class:`.Connection` or :class:`.Engine` for connectivity.</span>
</span><span id="1-1299">
</span><span id="1-1300"><span class="sd">        .. seealso::</span>
</span><span id="1-1301">
</span><span id="1-1302"><span class="sd">            :meth:`_schema.MetaData.drop_all`.</span>
</span><span id="1-1303">
</span><span id="1-1304"><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="1-1305">        <span class="n">bind</span><span class="o">.</span><span class="n">_run_ddl_visitor</span><span class="p">(</span><span class="n">ddl</span><span class="o">.</span><span class="n">SchemaDropper</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="n">checkfirst</span><span class="o">=</span><span class="n">checkfirst</span><span class="p">)</span>
</span><span id="1-1306">
</span><span id="1-1307">    <span class="nd">@util</span><span class="o">.</span><span class="n">deprecated</span><span class="p">(</span>
</span><span id="1-1308">        <span class="s2">&quot;1.4&quot;</span><span class="p">,</span>
</span><span id="1-1309">        <span class="s2">&quot;:meth:`_schema.Table.tometadata` is renamed to &quot;</span>
</span><span id="1-1310">        <span class="s2">&quot;:meth:`_schema.Table.to_metadata`&quot;</span><span class="p">,</span>
</span><span id="1-1311">    <span class="p">)</span>
</span><span id="1-1312">    <span class="k">def</span> <span class="nf">tometadata</span><span class="p">(</span>
</span><span id="1-1313">        <span class="bp">self</span><span class="p">,</span>
</span><span id="1-1314">        <span class="n">metadata</span><span class="p">:</span> <span class="n">MetaData</span><span class="p">,</span>
</span><span id="1-1315">        <span class="n">schema</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Literal</span><span class="p">[</span><span class="n">SchemaConst</span><span class="o">.</span><span class="n">RETAIN_SCHEMA</span><span class="p">]]</span> <span class="o">=</span> <span class="n">RETAIN_SCHEMA</span><span class="p">,</span>
</span><span id="1-1316">        <span class="n">referred_schema_fn</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span>
</span><span id="1-1317">            <span class="n">Callable</span><span class="p">[</span>
</span><span id="1-1318">                <span class="p">[</span><span class="n">Table</span><span class="p">,</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">ForeignKeyConstraint</span><span class="p">,</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]],</span>
</span><span id="1-1319">                <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
</span><span id="1-1320">            <span class="p">]</span>
</span><span id="1-1321">        <span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="1-1322">        <span class="n">name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="1-1323">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Table</span><span class="p">:</span>
</span><span id="1-1324"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Return a copy of this :class:`_schema.Table`</span>
</span><span id="1-1325"><span class="sd">        associated with a different</span>
</span><span id="1-1326"><span class="sd">        :class:`_schema.MetaData`.</span>
</span><span id="1-1327">
</span><span id="1-1328"><span class="sd">        See :meth:`_schema.Table.to_metadata` for a full description.</span>
</span><span id="1-1329">
</span><span id="1-1330"><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="1-1331">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_metadata</span><span class="p">(</span>
</span><span id="1-1332">            <span class="n">metadata</span><span class="p">,</span>
</span><span id="1-1333">            <span class="n">schema</span><span class="o">=</span><span class="n">schema</span><span class="p">,</span>
</span><span id="1-1334">            <span class="n">referred_schema_fn</span><span class="o">=</span><span class="n">referred_schema_fn</span><span class="p">,</span>
</span><span id="1-1335">            <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
</span><span id="1-1336">        <span class="p">)</span>
</span><span id="1-1337">
</span><span id="1-1338">    <span class="k">def</span> <span class="nf">to_metadata</span><span class="p">(</span>
</span><span id="1-1339">        <span class="bp">self</span><span class="p">,</span>
</span><span id="1-1340">        <span class="n">metadata</span><span class="p">:</span> <span class="n">MetaData</span><span class="p">,</span>
</span><span id="1-1341">        <span class="n">schema</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Literal</span><span class="p">[</span><span class="n">SchemaConst</span><span class="o">.</span><span class="n">RETAIN_SCHEMA</span><span class="p">]]</span> <span class="o">=</span> <span class="n">RETAIN_SCHEMA</span><span class="p">,</span>
</span><span id="1-1342">        <span class="n">referred_schema_fn</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span>
</span><span id="1-1343">            <span class="n">Callable</span><span class="p">[</span>
</span><span id="1-1344">                <span class="p">[</span><span class="n">Table</span><span class="p">,</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">ForeignKeyConstraint</span><span class="p">,</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]],</span>
</span><span id="1-1345">                <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
</span><span id="1-1346">            <span class="p">]</span>
</span><span id="1-1347">        <span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="1-1348">        <span class="n">name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="1-1349">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Table</span><span class="p">:</span>
</span><span id="1-1350"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Return a copy of this :class:`_schema.Table` associated with a</span>
</span><span id="1-1351"><span class="sd">        different :class:`_schema.MetaData`.</span>
</span><span id="1-1352">
</span><span id="1-1353"><span class="sd">        E.g.::</span>
</span><span id="1-1354">
</span><span id="1-1355"><span class="sd">            m1 = MetaData()</span>
</span><span id="1-1356">
</span><span id="1-1357"><span class="sd">            user = Table(&#39;user&#39;, m1, Column(&#39;id&#39;, Integer, primary_key=True))</span>
</span><span id="1-1358">
</span><span id="1-1359"><span class="sd">            m2 = MetaData()</span>
</span><span id="1-1360"><span class="sd">            user_copy = user.to_metadata(m2)</span>
</span><span id="1-1361">
</span><span id="1-1362"><span class="sd">        .. versionchanged:: 1.4  The :meth:`_schema.Table.to_metadata` function</span>
</span><span id="1-1363"><span class="sd">           was renamed from :meth:`_schema.Table.tometadata`.</span>
</span><span id="1-1364">
</span><span id="1-1365">
</span><span id="1-1366"><span class="sd">        :param metadata: Target :class:`_schema.MetaData` object,</span>
</span><span id="1-1367"><span class="sd">         into which the</span>
</span><span id="1-1368"><span class="sd">         new :class:`_schema.Table` object will be created.</span>
</span><span id="1-1369">
</span><span id="1-1370"><span class="sd">        :param schema: optional string name indicating the target schema.</span>
</span><span id="1-1371"><span class="sd">         Defaults to the special symbol :attr:`.RETAIN_SCHEMA` which indicates</span>
</span><span id="1-1372"><span class="sd">         that no change to the schema name should be made in the new</span>
</span><span id="1-1373"><span class="sd">         :class:`_schema.Table`.  If set to a string name, the new</span>
</span><span id="1-1374"><span class="sd">         :class:`_schema.Table`</span>
</span><span id="1-1375"><span class="sd">         will have this new name as the ``.schema``.  If set to ``None``, the</span>
</span><span id="1-1376"><span class="sd">         schema will be set to that of the schema set on the target</span>
</span><span id="1-1377"><span class="sd">         :class:`_schema.MetaData`, which is typically ``None`` as well,</span>
</span><span id="1-1378"><span class="sd">         unless</span>
</span><span id="1-1379"><span class="sd">         set explicitly::</span>
</span><span id="1-1380">
</span><span id="1-1381"><span class="sd">            m2 = MetaData(schema=&#39;newschema&#39;)</span>
</span><span id="1-1382">
</span><span id="1-1383"><span class="sd">            # user_copy_one will have &quot;newschema&quot; as the schema name</span>
</span><span id="1-1384"><span class="sd">            user_copy_one = user.to_metadata(m2, schema=None)</span>
</span><span id="1-1385">
</span><span id="1-1386"><span class="sd">            m3 = MetaData()  # schema defaults to None</span>
</span><span id="1-1387">
</span><span id="1-1388"><span class="sd">            # user_copy_two will have None as the schema name</span>
</span><span id="1-1389"><span class="sd">            user_copy_two = user.to_metadata(m3, schema=None)</span>
</span><span id="1-1390">
</span><span id="1-1391"><span class="sd">        :param referred_schema_fn: optional callable which can be supplied</span>
</span><span id="1-1392"><span class="sd">         in order to provide for the schema name that should be assigned</span>
</span><span id="1-1393"><span class="sd">         to the referenced table of a :class:`_schema.ForeignKeyConstraint`.</span>
</span><span id="1-1394"><span class="sd">         The callable accepts this parent :class:`_schema.Table`, the</span>
</span><span id="1-1395"><span class="sd">         target schema that we are changing to, the</span>
</span><span id="1-1396"><span class="sd">         :class:`_schema.ForeignKeyConstraint` object, and the existing</span>
</span><span id="1-1397"><span class="sd">         &quot;target schema&quot; of that constraint.  The function should return the</span>
</span><span id="1-1398"><span class="sd">         string schema name that should be applied.    To reset the schema</span>
</span><span id="1-1399"><span class="sd">         to &quot;none&quot;, return the symbol :data:`.BLANK_SCHEMA`.  To effect no</span>
</span><span id="1-1400"><span class="sd">         change, return ``None`` or :data:`.RETAIN_SCHEMA`.</span>
</span><span id="1-1401">
</span><span id="1-1402"><span class="sd">         .. versionchanged:: 1.4.33  The ``referred_schema_fn`` function</span>
</span><span id="1-1403"><span class="sd">            may return the :data:`.BLANK_SCHEMA` or :data:`.RETAIN_SCHEMA`</span>
</span><span id="1-1404"><span class="sd">            symbols.</span>
</span><span id="1-1405">
</span><span id="1-1406"><span class="sd">         E.g.::</span>
</span><span id="1-1407">
</span><span id="1-1408"><span class="sd">                def referred_schema_fn(table, to_schema,</span>
</span><span id="1-1409"><span class="sd">                                                constraint, referred_schema):</span>
</span><span id="1-1410"><span class="sd">                    if referred_schema == &#39;base_tables&#39;:</span>
</span><span id="1-1411"><span class="sd">                        return referred_schema</span>
</span><span id="1-1412"><span class="sd">                    else:</span>
</span><span id="1-1413"><span class="sd">                        return to_schema</span>
</span><span id="1-1414">
</span><span id="1-1415"><span class="sd">                new_table = table.to_metadata(m2, schema=&quot;alt_schema&quot;,</span>
</span><span id="1-1416"><span class="sd">                                        referred_schema_fn=referred_schema_fn)</span>
</span><span id="1-1417">
</span><span id="1-1418"><span class="sd">        :param name: optional string name indicating the target table name.</span>
</span><span id="1-1419"><span class="sd">         If not specified or None, the table name is retained.  This allows</span>
</span><span id="1-1420"><span class="sd">         a :class:`_schema.Table` to be copied to the same</span>
</span><span id="1-1421"><span class="sd">         :class:`_schema.MetaData` target</span>
</span><span id="1-1422"><span class="sd">         with a new name.</span>
</span><span id="1-1423">
</span><span id="1-1424"><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="1-1425">        <span class="k">if</span> <span class="n">name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-1426">            <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>
</span><span id="1-1427">
</span><span id="1-1428">        <span class="n">actual_schema</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
</span><span id="1-1429">
</span><span id="1-1430">        <span class="k">if</span> <span class="n">schema</span> <span class="ow">is</span> <span class="n">RETAIN_SCHEMA</span><span class="p">:</span>
</span><span id="1-1431">            <span class="n">actual_schema</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">schema</span>
</span><span id="1-1432">        <span class="k">elif</span> <span class="n">schema</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-1433">            <span class="n">actual_schema</span> <span class="o">=</span> <span class="n">metadata</span><span class="o">.</span><span class="n">schema</span>
</span><span id="1-1434">        <span class="k">else</span><span class="p">:</span>
</span><span id="1-1435">            <span class="n">actual_schema</span> <span class="o">=</span> <span class="n">schema</span>
</span><span id="1-1436">        <span class="n">key</span> <span class="o">=</span> <span class="n">_get_table_key</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">actual_schema</span><span class="p">)</span>
</span><span id="1-1437">        <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">metadata</span><span class="o">.</span><span class="n">tables</span><span class="p">:</span>
</span><span id="1-1438">            <span class="n">util</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
</span><span id="1-1439">                <span class="s2">&quot;Table &#39;</span><span class="si">%s</span><span class="s2">&#39; already exists within the given &quot;</span>
</span><span id="1-1440">                <span class="s2">&quot;MetaData - not copying.&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">description</span>
</span><span id="1-1441">            <span class="p">)</span>
</span><span id="1-1442">            <span class="k">return</span> <span class="n">metadata</span><span class="o">.</span><span class="n">tables</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
</span><span id="1-1443">
</span><span id="1-1444">        <span class="n">args</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="1-1445">        <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
</span><span id="1-1446">            <span class="n">args</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">col</span><span class="o">.</span><span class="n">_copy</span><span class="p">(</span><span class="n">schema</span><span class="o">=</span><span class="n">actual_schema</span><span class="p">))</span>
</span><span id="1-1447">        <span class="n">table</span> <span class="o">=</span> <span class="n">Table</span><span class="p">(</span>
</span><span id="1-1448">            <span class="n">name</span><span class="p">,</span>
</span><span id="1-1449">            <span class="n">metadata</span><span class="p">,</span>
</span><span id="1-1450">            <span class="n">schema</span><span class="o">=</span><span class="n">actual_schema</span><span class="p">,</span>
</span><span id="1-1451">            <span class="n">comment</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">comment</span><span class="p">,</span>
</span><span id="1-1452">            <span class="o">*</span><span class="n">args</span><span class="p">,</span>
</span><span id="1-1453">            <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">,</span>
</span><span id="1-1454">        <span class="p">)</span>
</span><span id="1-1455">        <span class="k">for</span> <span class="n">const</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">constraints</span><span class="p">:</span>
</span><span id="1-1456">            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">const</span><span class="p">,</span> <span class="n">ForeignKeyConstraint</span><span class="p">):</span>
</span><span id="1-1457">                <span class="n">referred_schema</span> <span class="o">=</span> <span class="n">const</span><span class="o">.</span><span class="n">_referred_schema</span>
</span><span id="1-1458">                <span class="k">if</span> <span class="n">referred_schema_fn</span><span class="p">:</span>
</span><span id="1-1459">                    <span class="n">fk_constraint_schema</span> <span class="o">=</span> <span class="n">referred_schema_fn</span><span class="p">(</span>
</span><span id="1-1460">                        <span class="bp">self</span><span class="p">,</span> <span class="n">actual_schema</span><span class="p">,</span> <span class="n">const</span><span class="p">,</span> <span class="n">referred_schema</span>
</span><span id="1-1461">                    <span class="p">)</span>
</span><span id="1-1462">                <span class="k">else</span><span class="p">:</span>
</span><span id="1-1463">                    <span class="n">fk_constraint_schema</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="1-1464">                        <span class="n">actual_schema</span>
</span><span id="1-1465">                        <span class="k">if</span> <span class="n">referred_schema</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">schema</span>
</span><span id="1-1466">                        <span class="k">else</span> <span class="kc">None</span>
</span><span id="1-1467">                    <span class="p">)</span>
</span><span id="1-1468">                <span class="n">table</span><span class="o">.</span><span class="n">append_constraint</span><span class="p">(</span>
</span><span id="1-1469">                    <span class="n">const</span><span class="o">.</span><span class="n">_copy</span><span class="p">(</span>
</span><span id="1-1470">                        <span class="n">schema</span><span class="o">=</span><span class="n">fk_constraint_schema</span><span class="p">,</span> <span class="n">target_table</span><span class="o">=</span><span class="n">table</span>
</span><span id="1-1471">                    <span class="p">)</span>
</span><span id="1-1472">                <span class="p">)</span>
</span><span id="1-1473">            <span class="k">elif</span> <span class="ow">not</span> <span class="n">const</span><span class="o">.</span><span class="n">_type_bound</span><span class="p">:</span>
</span><span id="1-1474">                <span class="c1"># skip unique constraints that would be generated</span>
</span><span id="1-1475">                <span class="c1"># by the &#39;unique&#39; flag on Column</span>
</span><span id="1-1476">                <span class="k">if</span> <span class="n">const</span><span class="o">.</span><span class="n">_column_flag</span><span class="p">:</span>
</span><span id="1-1477">                    <span class="k">continue</span>
</span><span id="1-1478">
</span><span id="1-1479">                <span class="n">table</span><span class="o">.</span><span class="n">append_constraint</span><span class="p">(</span>
</span><span id="1-1480">                    <span class="n">const</span><span class="o">.</span><span class="n">_copy</span><span class="p">(</span><span class="n">schema</span><span class="o">=</span><span class="n">actual_schema</span><span class="p">,</span> <span class="n">target_table</span><span class="o">=</span><span class="n">table</span><span class="p">)</span>
</span><span id="1-1481">                <span class="p">)</span>
</span><span id="1-1482">        <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">indexes</span><span class="p">:</span>
</span><span id="1-1483">            <span class="c1"># skip indexes that would be generated</span>
</span><span id="1-1484">            <span class="c1"># by the &#39;index&#39; flag on Column</span>
</span><span id="1-1485">            <span class="k">if</span> <span class="n">index</span><span class="o">.</span><span class="n">_column_flag</span><span class="p">:</span>
</span><span id="1-1486">                <span class="k">continue</span>
</span><span id="1-1487">            <span class="n">Index</span><span class="p">(</span>
</span><span id="1-1488">                <span class="n">index</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
</span><span id="1-1489">                <span class="n">unique</span><span class="o">=</span><span class="n">index</span><span class="o">.</span><span class="n">unique</span><span class="p">,</span>
</span><span id="1-1490">                <span class="o">*</span><span class="p">[</span>
</span><span id="1-1491">                    <span class="n">_copy_expression</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="n">table</span><span class="p">)</span>
</span><span id="1-1492">                    <span class="k">for</span> <span class="n">expr</span> <span class="ow">in</span> <span class="n">index</span><span class="o">.</span><span class="n">_table_bound_expressions</span>
</span><span id="1-1493">                <span class="p">],</span>
</span><span id="1-1494">                <span class="n">_table</span><span class="o">=</span><span class="n">table</span><span class="p">,</span>
</span><span id="1-1495">                <span class="o">**</span><span class="n">index</span><span class="o">.</span><span class="n">kwargs</span><span class="p">,</span>
</span><span id="1-1496">            <span class="p">)</span>
</span><span id="1-1497">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_schema_item_copy</span><span class="p">(</span><span class="n">table</span><span class="p">)</span>
</span><span id="1-1498">
</span><span id="1-1499">
</span><span id="1-1500"><span class="k">class</span> <span class="nc">Column</span><span class="p">(</span><span class="n">DialectKWArgs</span><span class="p">,</span> <span class="n">SchemaItem</span><span class="p">,</span> <span class="n">ColumnClause</span><span class="p">[</span><span class="n">_T</span><span class="p">]):</span>
</span><span id="1-1501"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Represents a column in a database table.&quot;&quot;&quot;</span>
</span><span id="1-1502">
</span><span id="1-1503">    <span class="n">__visit_name__</span> <span class="o">=</span> <span class="s2">&quot;column&quot;</span>
</span><span id="1-1504">
</span><span id="1-1505">    <span class="n">inherit_cache</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="1-1506">    <span class="n">key</span><span class="p">:</span> <span class="nb">str</span>
</span><span id="1-1507">
</span><span id="1-1508">    <span class="n">server_default</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">FetchedValue</span><span class="p">]</span>
</span><span id="1-1509">
</span><span id="1-1510">    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
</span><span id="1-1511">        <span class="bp">self</span><span class="p">,</span>
</span><span id="1-1512">        <span class="n">__name_pos</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span>
</span><span id="1-1513">            <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">_TypeEngineArgument</span><span class="p">[</span><span class="n">_T</span><span class="p">],</span> <span class="n">SchemaEventTarget</span><span class="p">]</span>
</span><span id="1-1514">        <span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="1-1515">        <span class="n">__type_pos</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span>
</span><span id="1-1516">            <span class="n">Union</span><span class="p">[</span><span class="n">_TypeEngineArgument</span><span class="p">[</span><span class="n">_T</span><span class="p">],</span> <span class="n">SchemaEventTarget</span><span class="p">]</span>
</span><span id="1-1517">        <span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="1-1518">        <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">SchemaEventTarget</span><span class="p">,</span>
</span><span id="1-1519">        <span class="n">name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="1-1520">        <span class="n">type_</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">_TypeEngineArgument</span><span class="p">[</span><span class="n">_T</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="1-1521">        <span class="n">autoincrement</span><span class="p">:</span> <span class="n">_AutoIncrementType</span> <span class="o">=</span> <span class="s2">&quot;auto&quot;</span><span class="p">,</span>
</span><span id="1-1522">        <span class="n">default</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="1-1523">        <span class="n">doc</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="1-1524">        <span class="n">key</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="1-1525">        <span class="n">index</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="1-1526">        <span class="n">unique</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="1-1527">        <span class="n">info</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">_InfoType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="1-1528">        <span class="n">nullable</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span>
</span><span id="1-1529">            <span class="n">Union</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="n">Literal</span><span class="p">[</span><span class="n">SchemaConst</span><span class="o">.</span><span class="n">NULL_UNSPECIFIED</span><span class="p">]]</span>
</span><span id="1-1530">        <span class="p">]</span> <span class="o">=</span> <span class="n">SchemaConst</span><span class="o">.</span><span class="n">NULL_UNSPECIFIED</span><span class="p">,</span>
</span><span id="1-1531">        <span class="n">onupdate</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="1-1532">        <span class="n">primary_key</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="1-1533">        <span class="n">server_default</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">_ServerDefaultArgument</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="1-1534">        <span class="n">server_onupdate</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">FetchedValue</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="1-1535">        <span class="n">quote</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="1-1536">        <span class="n">system</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="1-1537">        <span class="n">comment</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="1-1538">        <span class="n">insert_sentinel</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="1-1539">        <span class="n">_omit_from_statements</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="1-1540">        <span class="n">_proxies</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="1-1541">        <span class="o">**</span><span class="n">dialect_kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
</span><span id="1-1542">    <span class="p">):</span>
</span><span id="1-1543"><span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="1-1544"><span class="sd">        Construct a new ``Column`` object.</span>
</span><span id="1-1545">
</span><span id="1-1546"><span class="sd">        :param name: The name of this column as represented in the database.</span>
</span><span id="1-1547"><span class="sd">          This argument may be the first positional argument, or specified</span>
</span><span id="1-1548"><span class="sd">          via keyword.</span>
</span><span id="1-1549">
</span><span id="1-1550"><span class="sd">          Names which contain no upper case characters</span>
</span><span id="1-1551"><span class="sd">          will be treated as case insensitive names, and will not be quoted</span>
</span><span id="1-1552"><span class="sd">          unless they are a reserved word.  Names with any number of upper</span>
</span><span id="1-1553"><span class="sd">          case characters will be quoted and sent exactly.  Note that this</span>
</span><span id="1-1554"><span class="sd">          behavior applies even for databases which standardize upper</span>
</span><span id="1-1555"><span class="sd">          case names as case insensitive such as Oracle.</span>
</span><span id="1-1556">
</span><span id="1-1557"><span class="sd">          The name field may be omitted at construction time and applied</span>
</span><span id="1-1558"><span class="sd">          later, at any time before the Column is associated with a</span>
</span><span id="1-1559"><span class="sd">          :class:`_schema.Table`.  This is to support convenient</span>
</span><span id="1-1560"><span class="sd">          usage within the :mod:`~sqlalchemy.ext.declarative` extension.</span>
</span><span id="1-1561">
</span><span id="1-1562"><span class="sd">        :param type\_: The column&#39;s type, indicated using an instance which</span>
</span><span id="1-1563"><span class="sd">          subclasses :class:`~sqlalchemy.types.TypeEngine`.  If no arguments</span>
</span><span id="1-1564"><span class="sd">          are required for the type, the class of the type can be sent</span>
</span><span id="1-1565"><span class="sd">          as well, e.g.::</span>
</span><span id="1-1566">
</span><span id="1-1567"><span class="sd">            # use a type with arguments</span>
</span><span id="1-1568"><span class="sd">            Column(&#39;data&#39;, String(50))</span>
</span><span id="1-1569">
</span><span id="1-1570"><span class="sd">            # use no arguments</span>
</span><span id="1-1571"><span class="sd">            Column(&#39;level&#39;, Integer)</span>
</span><span id="1-1572">
</span><span id="1-1573"><span class="sd">          The ``type`` argument may be the second positional argument</span>
</span><span id="1-1574"><span class="sd">          or specified by keyword.</span>
</span><span id="1-1575">
</span><span id="1-1576"><span class="sd">          If the ``type`` is ``None`` or is omitted, it will first default to</span>
</span><span id="1-1577"><span class="sd">          the special type :class:`.NullType`.  If and when this</span>
</span><span id="1-1578"><span class="sd">          :class:`_schema.Column` is made to refer to another column using</span>
</span><span id="1-1579"><span class="sd">          :class:`_schema.ForeignKey` and/or</span>
</span><span id="1-1580"><span class="sd">          :class:`_schema.ForeignKeyConstraint`, the type</span>
</span><span id="1-1581"><span class="sd">          of the remote-referenced column will be copied to this column as</span>
</span><span id="1-1582"><span class="sd">          well, at the moment that the foreign key is resolved against that</span>
</span><span id="1-1583"><span class="sd">          remote :class:`_schema.Column` object.</span>
</span><span id="1-1584">
</span><span id="1-1585"><span class="sd">        :param \*args: Additional positional arguments include various</span>
</span><span id="1-1586"><span class="sd">          :class:`.SchemaItem` derived constructs which will be applied</span>
</span><span id="1-1587"><span class="sd">          as options to the column.  These include instances of</span>
</span><span id="1-1588"><span class="sd">          :class:`.Constraint`, :class:`_schema.ForeignKey`,</span>
</span><span id="1-1589"><span class="sd">          :class:`.ColumnDefault`, :class:`.Sequence`, :class:`.Computed`</span>
</span><span id="1-1590"><span class="sd">          :class:`.Identity`.  In some cases an</span>
</span><span id="1-1591"><span class="sd">          equivalent keyword argument is available such as ``server_default``,</span>
</span><span id="1-1592"><span class="sd">          ``default`` and ``unique``.</span>
</span><span id="1-1593">
</span><span id="1-1594"><span class="sd">        :param autoincrement: Set up &quot;auto increment&quot; semantics for an</span>
</span><span id="1-1595"><span class="sd">          **integer primary key column with no foreign key dependencies**</span>
</span><span id="1-1596"><span class="sd">          (see later in this docstring for a more specific definition).</span>
</span><span id="1-1597"><span class="sd">          This may influence the :term:`DDL` that will be emitted for</span>
</span><span id="1-1598"><span class="sd">          this column during a table create, as well as how the column</span>
</span><span id="1-1599"><span class="sd">          will be considered when INSERT statements are compiled and</span>
</span><span id="1-1600"><span class="sd">          executed.</span>
</span><span id="1-1601">
</span><span id="1-1602"><span class="sd">          The default value is the string ``&quot;auto&quot;``,</span>
</span><span id="1-1603"><span class="sd">          which indicates that a single-column (i.e. non-composite) primary key</span>
</span><span id="1-1604"><span class="sd">          that is of an INTEGER type with no other client-side or server-side</span>
</span><span id="1-1605"><span class="sd">          default constructs indicated should receive auto increment semantics</span>
</span><span id="1-1606"><span class="sd">          automatically. Other values include ``True`` (force this column to</span>
</span><span id="1-1607"><span class="sd">          have auto-increment semantics for a :term:`composite primary key` as</span>
</span><span id="1-1608"><span class="sd">          well), ``False`` (this column should never have auto-increment</span>
</span><span id="1-1609"><span class="sd">          semantics), and the string ``&quot;ignore_fk&quot;`` (special-case for foreign</span>
</span><span id="1-1610"><span class="sd">          key columns, see below).</span>
</span><span id="1-1611">
</span><span id="1-1612"><span class="sd">          The term &quot;auto increment semantics&quot; refers both to the kind of DDL</span>
</span><span id="1-1613"><span class="sd">          that will be emitted for the column within a CREATE TABLE statement,</span>
</span><span id="1-1614"><span class="sd">          when methods such as :meth:`.MetaData.create_all` and</span>
</span><span id="1-1615"><span class="sd">          :meth:`.Table.create` are invoked, as well as how the column will be</span>
</span><span id="1-1616"><span class="sd">          considered when an INSERT statement is compiled and emitted to the</span>
</span><span id="1-1617"><span class="sd">          database:</span>
</span><span id="1-1618">
</span><span id="1-1619"><span class="sd">          * **DDL rendering** (i.e. :meth:`.MetaData.create_all`,</span>
</span><span id="1-1620"><span class="sd">            :meth:`.Table.create`): When used on a :class:`.Column` that has</span>
</span><span id="1-1621"><span class="sd">            no other</span>
</span><span id="1-1622"><span class="sd">            default-generating construct associated with it (such as a</span>
</span><span id="1-1623"><span class="sd">            :class:`.Sequence` or :class:`.Identity` construct), the parameter</span>
</span><span id="1-1624"><span class="sd">            will imply that database-specific keywords such as PostgreSQL</span>
</span><span id="1-1625"><span class="sd">            ``SERIAL``, MySQL ``AUTO_INCREMENT``, or ``IDENTITY`` on SQL Server</span>
</span><span id="1-1626"><span class="sd">            should also be rendered.  Not every database backend has an</span>
</span><span id="1-1627"><span class="sd">            &quot;implied&quot; default generator available; for example the Oracle</span>
</span><span id="1-1628"><span class="sd">            backend always needs an explicit construct such as</span>
</span><span id="1-1629"><span class="sd">            :class:`.Identity` to be included with a :class:`.Column` in order</span>
</span><span id="1-1630"><span class="sd">            for the DDL rendered to include auto-generating constructs to also</span>
</span><span id="1-1631"><span class="sd">            be produced in the database.</span>
</span><span id="1-1632">
</span><span id="1-1633"><span class="sd">          * **INSERT semantics** (i.e. when a :func:`_sql.insert` construct is</span>
</span><span id="1-1634"><span class="sd">            compiled into a SQL string and is then executed on a database using</span>
</span><span id="1-1635"><span class="sd">            :meth:`_engine.Connection.execute` or equivalent): A single-row</span>
</span><span id="1-1636"><span class="sd">            INSERT statement will be known to produce a new integer primary key</span>
</span><span id="1-1637"><span class="sd">            value automatically for this column, which will be accessible</span>
</span><span id="1-1638"><span class="sd">            after the statement is invoked via the</span>
</span><span id="1-1639"><span class="sd">            :attr:`.CursorResult.inserted_primary_key` attribute upon the</span>
</span><span id="1-1640"><span class="sd">            :class:`_result.Result` object.   This also applies towards use of the</span>
</span><span id="1-1641"><span class="sd">            ORM when ORM-mapped objects are persisted to the database,</span>
</span><span id="1-1642"><span class="sd">            indicating that a new integer primary key will be available to</span>
</span><span id="1-1643"><span class="sd">            become part of the :term:`identity key` for that object.  This</span>
</span><span id="1-1644"><span class="sd">            behavior takes place regardless of what DDL constructs are</span>
</span><span id="1-1645"><span class="sd">            associated with the :class:`_schema.Column` and is independent</span>
</span><span id="1-1646"><span class="sd">            of the &quot;DDL Rendering&quot; behavior discussed in the previous note</span>
</span><span id="1-1647"><span class="sd">            above.</span>
</span><span id="1-1648">
</span><span id="1-1649"><span class="sd">          The parameter may be set to ``True`` to indicate that a column which</span>
</span><span id="1-1650"><span class="sd">          is part of a composite (i.e. multi-column) primary key should</span>
</span><span id="1-1651"><span class="sd">          have autoincrement semantics, though note that only one column</span>
</span><span id="1-1652"><span class="sd">          within a primary key may have this setting.    It can also</span>
</span><span id="1-1653"><span class="sd">          be set to ``True`` to indicate autoincrement semantics on a</span>
</span><span id="1-1654"><span class="sd">          column that has a client-side or server-side default configured,</span>
</span><span id="1-1655"><span class="sd">          however note that not all dialects can accommodate all styles</span>
</span><span id="1-1656"><span class="sd">          of default as an &quot;autoincrement&quot;.  It can also be</span>
</span><span id="1-1657"><span class="sd">          set to ``False`` on a single-column primary key that has a</span>
</span><span id="1-1658"><span class="sd">          datatype of INTEGER in order to disable auto increment semantics</span>
</span><span id="1-1659"><span class="sd">          for that column.</span>
</span><span id="1-1660">
</span><span id="1-1661"><span class="sd">          The setting *only* has an effect for columns which are:</span>
</span><span id="1-1662">
</span><span id="1-1663"><span class="sd">          * Integer derived (i.e. INT, SMALLINT, BIGINT).</span>
</span><span id="1-1664">
</span><span id="1-1665"><span class="sd">          * Part of the primary key</span>
</span><span id="1-1666">
</span><span id="1-1667"><span class="sd">          * Not referring to another column via :class:`_schema.ForeignKey`,</span>
</span><span id="1-1668"><span class="sd">            unless</span>
</span><span id="1-1669"><span class="sd">            the value is specified as ``&#39;ignore_fk&#39;``::</span>
</span><span id="1-1670">
</span><span id="1-1671"><span class="sd">                # turn on autoincrement for this column despite</span>
</span><span id="1-1672"><span class="sd">                # the ForeignKey()</span>
</span><span id="1-1673"><span class="sd">                Column(&#39;id&#39;, ForeignKey(&#39;other.id&#39;),</span>
</span><span id="1-1674"><span class="sd">                            primary_key=True, autoincrement=&#39;ignore_fk&#39;)</span>
</span><span id="1-1675">
</span><span id="1-1676"><span class="sd">          It is typically not desirable to have &quot;autoincrement&quot; enabled on a</span>
</span><span id="1-1677"><span class="sd">          column that refers to another via foreign key, as such a column is</span>
</span><span id="1-1678"><span class="sd">          required to refer to a value that originates from elsewhere.</span>
</span><span id="1-1679">
</span><span id="1-1680"><span class="sd">          The setting has these effects on columns that meet the</span>
</span><span id="1-1681"><span class="sd">          above criteria:</span>
</span><span id="1-1682">
</span><span id="1-1683"><span class="sd">          * DDL issued for the column, if the column does not already include</span>
</span><span id="1-1684"><span class="sd">            a default generating construct supported by the backend such as</span>
</span><span id="1-1685"><span class="sd">            :class:`.Identity`, will include database-specific</span>
</span><span id="1-1686"><span class="sd">            keywords intended to signify this column as an</span>
</span><span id="1-1687"><span class="sd">            &quot;autoincrement&quot; column for specific backends.   Behavior for</span>
</span><span id="1-1688"><span class="sd">            primary SQLAlchemy dialects includes:</span>
</span><span id="1-1689">
</span><span id="1-1690"><span class="sd">            * AUTO INCREMENT on MySQL and MariaDB</span>
</span><span id="1-1691"><span class="sd">            * SERIAL on PostgreSQL</span>
</span><span id="1-1692"><span class="sd">            * IDENTITY on MS-SQL - this occurs even without the</span>
</span><span id="1-1693"><span class="sd">              :class:`.Identity` construct as the</span>
</span><span id="1-1694"><span class="sd">              :paramref:`.Column.autoincrement` parameter pre-dates this</span>
</span><span id="1-1695"><span class="sd">              construct.</span>
</span><span id="1-1696"><span class="sd">            * SQLite - SQLite integer primary key columns are implicitly</span>
</span><span id="1-1697"><span class="sd">              &quot;auto incrementing&quot; and no additional keywords are rendered;</span>
</span><span id="1-1698"><span class="sd">              to render the special SQLite keyword ``AUTOINCREMENT``</span>
</span><span id="1-1699"><span class="sd">              is not included as this is unnecessary and not recommended</span>
</span><span id="1-1700"><span class="sd">              by the database vendor.  See the section</span>
</span><span id="1-1701"><span class="sd">              :ref:`sqlite_autoincrement` for more background.</span>
</span><span id="1-1702"><span class="sd">            * Oracle - The Oracle dialect has no default &quot;autoincrement&quot;</span>
</span><span id="1-1703"><span class="sd">              feature available at this time, instead the :class:`.Identity`</span>
</span><span id="1-1704"><span class="sd">              construct is recommended to achieve this (the :class:`.Sequence`</span>
</span><span id="1-1705"><span class="sd">              construct may also be used).</span>
</span><span id="1-1706"><span class="sd">            * Third-party dialects - consult those dialects&#39; documentation</span>
</span><span id="1-1707"><span class="sd">              for details on their specific behaviors.</span>
</span><span id="1-1708">
</span><span id="1-1709"><span class="sd">          * When a single-row :func:`_sql.insert` construct is compiled and</span>
</span><span id="1-1710"><span class="sd">            executed, which does not set the :meth:`_sql.Insert.inline`</span>
</span><span id="1-1711"><span class="sd">            modifier, newly generated primary key values for this column</span>
</span><span id="1-1712"><span class="sd">            will be automatically retrieved upon statement execution</span>
</span><span id="1-1713"><span class="sd">            using a method specific to the database driver in use:</span>
</span><span id="1-1714">
</span><span id="1-1715"><span class="sd">            * MySQL, SQLite - calling upon ``cursor.lastrowid()``</span>
</span><span id="1-1716"><span class="sd">              (see</span>
</span><span id="1-1717"><span class="sd">              `https://www.python.org/dev/peps/pep-0249/#lastrowid</span>
</span><span id="1-1718"><span class="sd">              &lt;https://www.python.org/dev/peps/pep-0249/#lastrowid&gt;`_)</span>
</span><span id="1-1719"><span class="sd">            * PostgreSQL, SQL Server, Oracle - use RETURNING or an equivalent</span>
</span><span id="1-1720"><span class="sd">              construct when rendering an INSERT statement, and then retrieving</span>
</span><span id="1-1721"><span class="sd">              the newly generated primary key values after execution</span>
</span><span id="1-1722"><span class="sd">            * PostgreSQL, Oracle for :class:`_schema.Table` objects that</span>
</span><span id="1-1723"><span class="sd">              set :paramref:`_schema.Table.implicit_returning` to False -</span>
</span><span id="1-1724"><span class="sd">              for a :class:`.Sequence` only, the :class:`.Sequence` is invoked</span>
</span><span id="1-1725"><span class="sd">              explicitly before the INSERT statement takes place so that the</span>
</span><span id="1-1726"><span class="sd">              newly generated primary key value is available to the client</span>
</span><span id="1-1727"><span class="sd">            * SQL Server for :class:`_schema.Table` objects that</span>
</span><span id="1-1728"><span class="sd">              set :paramref:`_schema.Table.implicit_returning` to False -</span>
</span><span id="1-1729"><span class="sd">              the ``SELECT scope_identity()`` construct is used after the</span>
</span><span id="1-1730"><span class="sd">              INSERT statement is invoked to retrieve the newly generated</span>
</span><span id="1-1731"><span class="sd">              primary key value.</span>
</span><span id="1-1732"><span class="sd">            * Third-party dialects - consult those dialects&#39; documentation</span>
</span><span id="1-1733"><span class="sd">              for details on their specific behaviors.</span>
</span><span id="1-1734">
</span><span id="1-1735"><span class="sd">          * For multiple-row :func:`_sql.insert` constructs invoked with</span>
</span><span id="1-1736"><span class="sd">            a list of parameters (i.e. &quot;executemany&quot; semantics), primary-key</span>
</span><span id="1-1737"><span class="sd">            retrieving behaviors are generally disabled, however there may</span>
</span><span id="1-1738"><span class="sd">            be special APIs that may be used to retrieve lists of new</span>
</span><span id="1-1739"><span class="sd">            primary key values for an &quot;executemany&quot;, such as the psycopg2</span>
</span><span id="1-1740"><span class="sd">            &quot;fast insertmany&quot; feature.  Such features are very new and</span>
</span><span id="1-1741"><span class="sd">            may not yet be well covered in documentation.</span>
</span><span id="1-1742">
</span><span id="1-1743"><span class="sd">        :param default: A scalar, Python callable, or</span>
</span><span id="1-1744"><span class="sd">            :class:`_expression.ColumnElement` expression representing the</span>
</span><span id="1-1745"><span class="sd">            *default value* for this column, which will be invoked upon insert</span>
</span><span id="1-1746"><span class="sd">            if this column is otherwise not specified in the VALUES clause of</span>
</span><span id="1-1747"><span class="sd">            the insert. This is a shortcut to using :class:`.ColumnDefault` as</span>
</span><span id="1-1748"><span class="sd">            a positional argument; see that class for full detail on the</span>
</span><span id="1-1749"><span class="sd">            structure of the argument.</span>
</span><span id="1-1750">
</span><span id="1-1751"><span class="sd">            Contrast this argument to</span>
</span><span id="1-1752"><span class="sd">            :paramref:`_schema.Column.server_default`</span>
</span><span id="1-1753"><span class="sd">            which creates a default generator on the database side.</span>
</span><span id="1-1754">
</span><span id="1-1755"><span class="sd">            .. seealso::</span>
</span><span id="1-1756">
</span><span id="1-1757"><span class="sd">                :ref:`metadata_defaults_toplevel`</span>
</span><span id="1-1758">
</span><span id="1-1759"><span class="sd">        :param doc: optional String that can be used by the ORM or similar</span>
</span><span id="1-1760"><span class="sd">            to document attributes on the Python side.   This attribute does</span>
</span><span id="1-1761"><span class="sd">            **not** render SQL comments; use the</span>
</span><span id="1-1762"><span class="sd">            :paramref:`_schema.Column.comment`</span>
</span><span id="1-1763"><span class="sd">            parameter for this purpose.</span>
</span><span id="1-1764">
</span><span id="1-1765"><span class="sd">        :param key: An optional string identifier which will identify this</span>
</span><span id="1-1766"><span class="sd">            ``Column`` object on the :class:`_schema.Table`.</span>
</span><span id="1-1767"><span class="sd">            When a key is provided,</span>
</span><span id="1-1768"><span class="sd">            this is the only identifier referencing the ``Column`` within the</span>
</span><span id="1-1769"><span class="sd">            application, including ORM attribute mapping; the ``name`` field</span>
</span><span id="1-1770"><span class="sd">            is used only when rendering SQL.</span>
</span><span id="1-1771">
</span><span id="1-1772"><span class="sd">        :param index: When ``True``, indicates that a :class:`_schema.Index`</span>
</span><span id="1-1773"><span class="sd">            construct will be automatically generated for this</span>
</span><span id="1-1774"><span class="sd">            :class:`_schema.Column`, which will result in a &quot;CREATE INDEX&quot;</span>
</span><span id="1-1775"><span class="sd">            statement being emitted for the :class:`_schema.Table` when the DDL</span>
</span><span id="1-1776"><span class="sd">            create operation is invoked.</span>
</span><span id="1-1777">
</span><span id="1-1778"><span class="sd">            Using this flag is equivalent to making use of the</span>
</span><span id="1-1779"><span class="sd">            :class:`_schema.Index` construct explicitly at the level of the</span>
</span><span id="1-1780"><span class="sd">            :class:`_schema.Table` construct itself::</span>
</span><span id="1-1781">
</span><span id="1-1782"><span class="sd">                Table(</span>
</span><span id="1-1783"><span class="sd">                    &quot;some_table&quot;,</span>
</span><span id="1-1784"><span class="sd">                    metadata,</span>
</span><span id="1-1785"><span class="sd">                    Column(&quot;x&quot;, Integer),</span>
</span><span id="1-1786"><span class="sd">                    Index(&quot;ix_some_table_x&quot;, &quot;x&quot;)</span>
</span><span id="1-1787"><span class="sd">                )</span>
</span><span id="1-1788">
</span><span id="1-1789"><span class="sd">            To add the :paramref:`_schema.Index.unique` flag to the</span>
</span><span id="1-1790"><span class="sd">            :class:`_schema.Index`, set both the</span>
</span><span id="1-1791"><span class="sd">            :paramref:`_schema.Column.unique` and</span>
</span><span id="1-1792"><span class="sd">            :paramref:`_schema.Column.index` flags to True simultaneously,</span>
</span><span id="1-1793"><span class="sd">            which will have the effect of rendering the &quot;CREATE UNIQUE INDEX&quot;</span>
</span><span id="1-1794"><span class="sd">            DDL instruction instead of &quot;CREATE INDEX&quot;.</span>
</span><span id="1-1795">
</span><span id="1-1796"><span class="sd">            The name of the index is generated using the</span>
</span><span id="1-1797"><span class="sd">            :ref:`default naming convention &lt;constraint_default_naming_convention&gt;`</span>
</span><span id="1-1798"><span class="sd">            which for the :class:`_schema.Index` construct is of the form</span>
</span><span id="1-1799"><span class="sd">            ``ix_&lt;tablename&gt;_&lt;columnname&gt;``.</span>
</span><span id="1-1800">
</span><span id="1-1801"><span class="sd">            As this flag is intended only as a convenience for the common case</span>
</span><span id="1-1802"><span class="sd">            of adding a single-column, default configured index to a table</span>
</span><span id="1-1803"><span class="sd">            definition, explicit use of the :class:`_schema.Index` construct</span>
</span><span id="1-1804"><span class="sd">            should be preferred for most use cases, including composite indexes</span>
</span><span id="1-1805"><span class="sd">            that encompass more than one column, indexes with SQL expressions</span>
</span><span id="1-1806"><span class="sd">            or ordering, backend-specific index configuration options, and</span>
</span><span id="1-1807"><span class="sd">            indexes that use a specific name.</span>
</span><span id="1-1808">
</span><span id="1-1809"><span class="sd">            .. note:: the :attr:`_schema.Column.index` attribute on</span>
</span><span id="1-1810"><span class="sd">               :class:`_schema.Column`</span>
</span><span id="1-1811"><span class="sd">               **does not indicate** if this column is indexed or not, only</span>
</span><span id="1-1812"><span class="sd">               if this flag was explicitly set here.  To view indexes on</span>
</span><span id="1-1813"><span class="sd">               a column, view the :attr:`_schema.Table.indexes` collection</span>
</span><span id="1-1814"><span class="sd">               or use :meth:`_reflection.Inspector.get_indexes`.</span>
</span><span id="1-1815">
</span><span id="1-1816"><span class="sd">            .. seealso::</span>
</span><span id="1-1817">
</span><span id="1-1818"><span class="sd">                :ref:`schema_indexes`</span>
</span><span id="1-1819">
</span><span id="1-1820"><span class="sd">                :ref:`constraint_naming_conventions`</span>
</span><span id="1-1821">
</span><span id="1-1822"><span class="sd">                :paramref:`_schema.Column.unique`</span>
</span><span id="1-1823">
</span><span id="1-1824"><span class="sd">        :param info: Optional data dictionary which will be populated into the</span>
</span><span id="1-1825"><span class="sd">            :attr:`.SchemaItem.info` attribute of this object.</span>
</span><span id="1-1826">
</span><span id="1-1827"><span class="sd">        :param nullable: When set to ``False``, will cause the &quot;NOT NULL&quot;</span>
</span><span id="1-1828"><span class="sd">            phrase to be added when generating DDL for the column.   When</span>
</span><span id="1-1829"><span class="sd">            ``True``, will normally generate nothing (in SQL this defaults to</span>
</span><span id="1-1830"><span class="sd">            &quot;NULL&quot;), except in some very specific backend-specific edge cases</span>
</span><span id="1-1831"><span class="sd">            where &quot;NULL&quot; may render explicitly.</span>
</span><span id="1-1832"><span class="sd">            Defaults to ``True`` unless :paramref:`_schema.Column.primary_key`</span>
</span><span id="1-1833"><span class="sd">            is also ``True`` or the column specifies a :class:`_sql.Identity`,</span>
</span><span id="1-1834"><span class="sd">            in which case it defaults to ``False``.</span>
</span><span id="1-1835"><span class="sd">            This parameter is only used when issuing CREATE TABLE statements.</span>
</span><span id="1-1836">
</span><span id="1-1837"><span class="sd">            .. note::</span>
</span><span id="1-1838">
</span><span id="1-1839"><span class="sd">                When the column specifies a :class:`_sql.Identity` this</span>
</span><span id="1-1840"><span class="sd">                parameter is in general ignored by the DDL compiler. The</span>
</span><span id="1-1841"><span class="sd">                PostgreSQL database allows nullable identity column by</span>
</span><span id="1-1842"><span class="sd">                setting this parameter to ``True`` explicitly.</span>
</span><span id="1-1843">
</span><span id="1-1844"><span class="sd">        :param onupdate: A scalar, Python callable, or</span>
</span><span id="1-1845"><span class="sd">            :class:`~sqlalchemy.sql.expression.ClauseElement` representing a</span>
</span><span id="1-1846"><span class="sd">            default value to be applied to the column within UPDATE</span>
</span><span id="1-1847"><span class="sd">            statements, which will be invoked upon update if this column is not</span>
</span><span id="1-1848"><span class="sd">            present in the SET clause of the update. This is a shortcut to</span>
</span><span id="1-1849"><span class="sd">            using :class:`.ColumnDefault` as a positional argument with</span>
</span><span id="1-1850"><span class="sd">            ``for_update=True``.</span>
</span><span id="1-1851">
</span><span id="1-1852"><span class="sd">            .. seealso::</span>
</span><span id="1-1853">
</span><span id="1-1854"><span class="sd">                :ref:`metadata_defaults` - complete discussion of onupdate</span>
</span><span id="1-1855">
</span><span id="1-1856"><span class="sd">        :param primary_key: If ``True``, marks this column as a primary key</span>
</span><span id="1-1857"><span class="sd">            column. Multiple columns can have this flag set to specify</span>
</span><span id="1-1858"><span class="sd">            composite primary keys. As an alternative, the primary key of a</span>
</span><span id="1-1859"><span class="sd">            :class:`_schema.Table` can be specified via an explicit</span>
</span><span id="1-1860"><span class="sd">            :class:`.PrimaryKeyConstraint` object.</span>
</span><span id="1-1861">
</span><span id="1-1862"><span class="sd">        :param server_default: A :class:`.FetchedValue` instance, str, Unicode</span>
</span><span id="1-1863"><span class="sd">            or :func:`~sqlalchemy.sql.expression.text` construct representing</span>
</span><span id="1-1864"><span class="sd">            the DDL DEFAULT value for the column.</span>
</span><span id="1-1865">
</span><span id="1-1866"><span class="sd">            String types will be emitted as-is, surrounded by single quotes::</span>
</span><span id="1-1867">
</span><span id="1-1868"><span class="sd">                Column(&#39;x&#39;, Text, server_default=&quot;val&quot;)</span>
</span><span id="1-1869">
</span><span id="1-1870"><span class="sd">                x TEXT DEFAULT &#39;val&#39;</span>
</span><span id="1-1871">
</span><span id="1-1872"><span class="sd">            A :func:`~sqlalchemy.sql.expression.text` expression will be</span>
</span><span id="1-1873"><span class="sd">            rendered as-is, without quotes::</span>
</span><span id="1-1874">
</span><span id="1-1875"><span class="sd">                Column(&#39;y&#39;, DateTime, server_default=text(&#39;NOW()&#39;))</span>
</span><span id="1-1876">
</span><span id="1-1877"><span class="sd">                y DATETIME DEFAULT NOW()</span>
</span><span id="1-1878">
</span><span id="1-1879"><span class="sd">            Strings and text() will be converted into a</span>
</span><span id="1-1880"><span class="sd">            :class:`.DefaultClause` object upon initialization.</span>
</span><span id="1-1881">
</span><span id="1-1882"><span class="sd">            This parameter can also accept complex combinations of contextually</span>
</span><span id="1-1883"><span class="sd">            valid SQLAlchemy expressions or constructs::</span>
</span><span id="1-1884">
</span><span id="1-1885"><span class="sd">                from sqlalchemy import create_engine</span>
</span><span id="1-1886"><span class="sd">                from sqlalchemy import Table, Column, MetaData, ARRAY, Text</span>
</span><span id="1-1887"><span class="sd">                from sqlalchemy.dialects.postgresql import array</span>
</span><span id="1-1888">
</span><span id="1-1889"><span class="sd">                engine = create_engine(</span>
</span><span id="1-1890"><span class="sd">                    &#39;postgresql+psycopg2://scott:tiger@localhost/mydatabase&#39;</span>
</span><span id="1-1891"><span class="sd">                )</span>
</span><span id="1-1892"><span class="sd">                metadata_obj = MetaData()</span>
</span><span id="1-1893"><span class="sd">                tbl = Table(</span>
</span><span id="1-1894"><span class="sd">                        &quot;foo&quot;,</span>
</span><span id="1-1895"><span class="sd">                        metadata_obj,</span>
</span><span id="1-1896"><span class="sd">                        Column(&quot;bar&quot;,</span>
</span><span id="1-1897"><span class="sd">                               ARRAY(Text),</span>
</span><span id="1-1898"><span class="sd">                               server_default=array([&quot;biz&quot;, &quot;bang&quot;, &quot;bash&quot;])</span>
</span><span id="1-1899"><span class="sd">                               )</span>
</span><span id="1-1900"><span class="sd">                )</span>
</span><span id="1-1901"><span class="sd">                metadata_obj.create_all(engine)</span>
</span><span id="1-1902">
</span><span id="1-1903"><span class="sd">            The above results in a table created with the following SQL::</span>
</span><span id="1-1904">
</span><span id="1-1905"><span class="sd">                CREATE TABLE foo (</span>
</span><span id="1-1906"><span class="sd">                    bar TEXT[] DEFAULT ARRAY[&#39;biz&#39;, &#39;bang&#39;, &#39;bash&#39;]</span>
</span><span id="1-1907"><span class="sd">                )</span>
</span><span id="1-1908">
</span><span id="1-1909"><span class="sd">            Use :class:`.FetchedValue` to indicate that an already-existing</span>
</span><span id="1-1910"><span class="sd">            column will generate a default value on the database side which</span>
</span><span id="1-1911"><span class="sd">            will be available to SQLAlchemy for post-fetch after inserts. This</span>
</span><span id="1-1912"><span class="sd">            construct does not specify any DDL and the implementation is left</span>
</span><span id="1-1913"><span class="sd">            to the database, such as via a trigger.</span>
</span><span id="1-1914">
</span><span id="1-1915"><span class="sd">            .. seealso::</span>
</span><span id="1-1916">
</span><span id="1-1917"><span class="sd">                :ref:`server_defaults` - complete discussion of server side</span>
</span><span id="1-1918"><span class="sd">                defaults</span>
</span><span id="1-1919">
</span><span id="1-1920"><span class="sd">        :param server_onupdate: A :class:`.FetchedValue` instance</span>
</span><span id="1-1921"><span class="sd">            representing a database-side default generation function,</span>
</span><span id="1-1922"><span class="sd">            such as a trigger. This</span>
</span><span id="1-1923"><span class="sd">            indicates to SQLAlchemy that a newly generated value will be</span>
</span><span id="1-1924"><span class="sd">            available after updates. This construct does not actually</span>
</span><span id="1-1925"><span class="sd">            implement any kind of generation function within the database,</span>
</span><span id="1-1926"><span class="sd">            which instead must be specified separately.</span>
</span><span id="1-1927">
</span><span id="1-1928">
</span><span id="1-1929"><span class="sd">            .. warning:: This directive **does not** currently produce MySQL&#39;s</span>
</span><span id="1-1930"><span class="sd">               &quot;ON UPDATE CURRENT_TIMESTAMP()&quot; clause.  See</span>
</span><span id="1-1931"><span class="sd">               :ref:`mysql_timestamp_onupdate` for background on how to</span>
</span><span id="1-1932"><span class="sd">               produce this clause.</span>
</span><span id="1-1933">
</span><span id="1-1934"><span class="sd">            .. seealso::</span>
</span><span id="1-1935">
</span><span id="1-1936"><span class="sd">                :ref:`triggered_columns`</span>
</span><span id="1-1937">
</span><span id="1-1938"><span class="sd">        :param quote: Force quoting of this column&#39;s name on or off,</span>
</span><span id="1-1939"><span class="sd">             corresponding to ``True`` or ``False``. When left at its default</span>
</span><span id="1-1940"><span class="sd">             of ``None``, the column identifier will be quoted according to</span>
</span><span id="1-1941"><span class="sd">             whether the name is case sensitive (identifiers with at least one</span>
</span><span id="1-1942"><span class="sd">             upper case character are treated as case sensitive), or if it&#39;s a</span>
</span><span id="1-1943"><span class="sd">             reserved word. This flag is only needed to force quoting of a</span>
</span><span id="1-1944"><span class="sd">             reserved word which is not known by the SQLAlchemy dialect.</span>
</span><span id="1-1945">
</span><span id="1-1946"><span class="sd">        :param unique: When ``True``, and the :paramref:`_schema.Column.index`</span>
</span><span id="1-1947"><span class="sd">            parameter is left at its default value of ``False``,</span>
</span><span id="1-1948"><span class="sd">            indicates that a :class:`_schema.UniqueConstraint`</span>
</span><span id="1-1949"><span class="sd">            construct will be automatically generated for this</span>
</span><span id="1-1950"><span class="sd">            :class:`_schema.Column`,</span>
</span><span id="1-1951"><span class="sd">            which will result in a &quot;UNIQUE CONSTRAINT&quot; clause referring</span>
</span><span id="1-1952"><span class="sd">            to this column being included</span>
</span><span id="1-1953"><span class="sd">            in the ``CREATE TABLE`` statement emitted, when the DDL create</span>
</span><span id="1-1954"><span class="sd">            operation for the :class:`_schema.Table` object is invoked.</span>
</span><span id="1-1955">
</span><span id="1-1956"><span class="sd">            When this flag is ``True`` while the</span>
</span><span id="1-1957"><span class="sd">            :paramref:`_schema.Column.index` parameter is simultaneously</span>
</span><span id="1-1958"><span class="sd">            set to ``True``, the effect instead is that a</span>
</span><span id="1-1959"><span class="sd">            :class:`_schema.Index` construct which includes the</span>
</span><span id="1-1960"><span class="sd">            :paramref:`_schema.Index.unique` parameter set to ``True``</span>
</span><span id="1-1961"><span class="sd">            is generated.  See the documentation for</span>
</span><span id="1-1962"><span class="sd">            :paramref:`_schema.Column.index` for additional detail.</span>
</span><span id="1-1963">
</span><span id="1-1964"><span class="sd">            Using this flag is equivalent to making use of the</span>
</span><span id="1-1965"><span class="sd">            :class:`_schema.UniqueConstraint` construct explicitly at the</span>
</span><span id="1-1966"><span class="sd">            level of the :class:`_schema.Table` construct itself::</span>
</span><span id="1-1967">
</span><span id="1-1968"><span class="sd">                Table(</span>
</span><span id="1-1969"><span class="sd">                    &quot;some_table&quot;,</span>
</span><span id="1-1970"><span class="sd">                    metadata,</span>
</span><span id="1-1971"><span class="sd">                    Column(&quot;x&quot;, Integer),</span>
</span><span id="1-1972"><span class="sd">                    UniqueConstraint(&quot;x&quot;)</span>
</span><span id="1-1973"><span class="sd">                )</span>
</span><span id="1-1974">
</span><span id="1-1975"><span class="sd">            The :paramref:`_schema.UniqueConstraint.name` parameter</span>
</span><span id="1-1976"><span class="sd">            of the unique constraint object is left at its default value</span>
</span><span id="1-1977"><span class="sd">            of ``None``; in the absence of a :ref:`naming convention &lt;constraint_naming_conventions&gt;`</span>
</span><span id="1-1978"><span class="sd">            for the enclosing :class:`_schema.MetaData`, the UNIQUE CONSTRAINT</span>
</span><span id="1-1979"><span class="sd">            construct will be emitted as unnamed, which typically invokes</span>
</span><span id="1-1980"><span class="sd">            a database-specific naming convention to take place.</span>
</span><span id="1-1981">
</span><span id="1-1982"><span class="sd">            As this flag is intended only as a convenience for the common case</span>
</span><span id="1-1983"><span class="sd">            of adding a single-column, default configured unique constraint to a table</span>
</span><span id="1-1984"><span class="sd">            definition, explicit use of the :class:`_schema.UniqueConstraint` construct</span>
</span><span id="1-1985"><span class="sd">            should be preferred for most use cases, including composite constraints</span>
</span><span id="1-1986"><span class="sd">            that encompass more than one column, backend-specific index configuration options, and</span>
</span><span id="1-1987"><span class="sd">            constraints that use a specific name.</span>
</span><span id="1-1988">
</span><span id="1-1989"><span class="sd">            .. note:: the :attr:`_schema.Column.unique` attribute on</span>
</span><span id="1-1990"><span class="sd">                :class:`_schema.Column`</span>
</span><span id="1-1991"><span class="sd">                **does not indicate** if this column has a unique constraint or</span>
</span><span id="1-1992"><span class="sd">                not, only if this flag was explicitly set here.  To view</span>
</span><span id="1-1993"><span class="sd">                indexes and unique constraints that may involve this column,</span>
</span><span id="1-1994"><span class="sd">                view the</span>
</span><span id="1-1995"><span class="sd">                :attr:`_schema.Table.indexes` and/or</span>
</span><span id="1-1996"><span class="sd">                :attr:`_schema.Table.constraints` collections or use</span>
</span><span id="1-1997"><span class="sd">                :meth:`_reflection.Inspector.get_indexes` and/or</span>
</span><span id="1-1998"><span class="sd">                :meth:`_reflection.Inspector.get_unique_constraints`</span>
</span><span id="1-1999">
</span><span id="1-2000"><span class="sd">            .. seealso::</span>
</span><span id="1-2001">
</span><span id="1-2002"><span class="sd">                :ref:`schema_unique_constraint`</span>
</span><span id="1-2003">
</span><span id="1-2004"><span class="sd">                :ref:`constraint_naming_conventions`</span>
</span><span id="1-2005">
</span><span id="1-2006"><span class="sd">                :paramref:`_schema.Column.index`</span>
</span><span id="1-2007">
</span><span id="1-2008"><span class="sd">        :param system: When ``True``, indicates this is a &quot;system&quot; column,</span>
</span><span id="1-2009"><span class="sd">             that is a column which is automatically made available by the</span>
</span><span id="1-2010"><span class="sd">             database, and should not be included in the columns list for a</span>
</span><span id="1-2011"><span class="sd">             ``CREATE TABLE`` statement.</span>
</span><span id="1-2012">
</span><span id="1-2013"><span class="sd">             For more elaborate scenarios where columns should be</span>
</span><span id="1-2014"><span class="sd">             conditionally rendered differently on different backends,</span>
</span><span id="1-2015"><span class="sd">             consider custom compilation rules for :class:`.CreateColumn`.</span>
</span><span id="1-2016">
</span><span id="1-2017"><span class="sd">        :param comment: Optional string that will render an SQL comment on</span>
</span><span id="1-2018"><span class="sd">             table creation.</span>
</span><span id="1-2019">
</span><span id="1-2020"><span class="sd">             .. versionadded:: 1.2 Added the</span>
</span><span id="1-2021"><span class="sd">                :paramref:`_schema.Column.comment`</span>
</span><span id="1-2022"><span class="sd">                parameter to :class:`_schema.Column`.</span>
</span><span id="1-2023">
</span><span id="1-2024"><span class="sd">        :param insert_sentinel: Marks this :class:`_schema.Column` as an</span>
</span><span id="1-2025"><span class="sd">         :term:`insert sentinel` used for optimizing the performance of the</span>
</span><span id="1-2026"><span class="sd">         :term:`insertmanyvalues` feature for tables that don&#39;t</span>
</span><span id="1-2027"><span class="sd">         otherwise have qualifying primary key configurations.</span>
</span><span id="1-2028">
</span><span id="1-2029"><span class="sd">         .. versionadded:: 2.0.10</span>
</span><span id="1-2030">
</span><span id="1-2031"><span class="sd">         .. seealso::</span>
</span><span id="1-2032">
</span><span id="1-2033"><span class="sd">            :func:`_schema.insert_sentinel` - all in one helper for declaring</span>
</span><span id="1-2034"><span class="sd">            sentinel columns</span>
</span><span id="1-2035">
</span><span id="1-2036"><span class="sd">            :ref:`engine_insertmanyvalues`</span>
</span><span id="1-2037">
</span><span id="1-2038"><span class="sd">            :ref:`engine_insertmanyvalues_sentinel_columns`</span>
</span><span id="1-2039">
</span><span id="1-2040">
</span><span id="1-2041"><span class="sd">        &quot;&quot;&quot;</span>  <span class="c1"># noqa: E501, RST201, RST202</span>
</span><span id="1-2042">
</span><span id="1-2043">        <span class="n">l_args</span> <span class="o">=</span> <span class="p">[</span><span class="n">__name_pos</span><span class="p">,</span> <span class="n">__type_pos</span><span class="p">]</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
</span><span id="1-2044">        <span class="k">del</span> <span class="n">args</span>
</span><span id="1-2045">
</span><span id="1-2046">        <span class="k">if</span> <span class="n">l_args</span><span class="p">:</span>
</span><span id="1-2047">            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">l_args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="1-2048">                <span class="k">if</span> <span class="n">name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-2049">                    <span class="k">raise</span> <span class="n">exc</span><span class="o">.</span><span class="n">ArgumentError</span><span class="p">(</span>
</span><span id="1-2050">                        <span class="s2">&quot;May not pass name positionally and as a keyword.&quot;</span>
</span><span id="1-2051">                    <span class="p">)</span>
</span><span id="1-2052">                <span class="n">name</span> <span class="o">=</span> <span class="n">l_args</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>  <span class="c1"># type: ignore</span>
</span><span id="1-2053">            <span class="k">elif</span> <span class="n">l_args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-2054">                <span class="n">l_args</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="1-2055">        <span class="k">if</span> <span class="n">l_args</span><span class="p">:</span>
</span><span id="1-2056">            <span class="n">coltype</span> <span class="o">=</span> <span class="n">l_args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="1-2057">
</span><span id="1-2058">            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">coltype</span><span class="p">,</span> <span class="s2">&quot;_sqla_type&quot;</span><span class="p">):</span>
</span><span id="1-2059">                <span class="k">if</span> <span class="n">type_</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-2060">                    <span class="k">raise</span> <span class="n">exc</span><span class="o">.</span><span class="n">ArgumentError</span><span class="p">(</span>
</span><span id="1-2061">                        <span class="s2">&quot;May not pass type_ positionally and as a keyword.&quot;</span>
</span><span id="1-2062">                    <span class="p">)</span>
</span><span id="1-2063">                <span class="n">type_</span> <span class="o">=</span> <span class="n">l_args</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>  <span class="c1"># type: ignore</span>
</span><span id="1-2064">            <span class="k">elif</span> <span class="n">l_args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-2065">                <span class="n">l_args</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="1-2066">
</span><span id="1-2067">        <span class="k">if</span> <span class="n">name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-2068">            <span class="n">name</span> <span class="o">=</span> <span class="n">quoted_name</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">quote</span><span class="p">)</span>
</span><span id="1-2069">        <span class="k">elif</span> <span class="n">quote</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-2070">            <span class="k">raise</span> <span class="n">exc</span><span class="o">.</span><span class="n">ArgumentError</span><span class="p">(</span>
</span><span id="1-2071">                <span class="s2">&quot;Explicit &#39;name&#39; is required when &quot;</span> <span class="s2">&quot;sending &#39;quote&#39; argument&quot;</span>
</span><span id="1-2072">            <span class="p">)</span>
</span><span id="1-2073">
</span><span id="1-2074">        <span class="c1"># name = None is expected to be an interim state</span>
</span><span id="1-2075">        <span class="c1"># note this use case is legacy now that ORM declarative has a</span>
</span><span id="1-2076">        <span class="c1"># dedicated &quot;column&quot; construct local to the ORM</span>
</span><span id="1-2077">        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">type_</span><span class="p">)</span>  <span class="c1"># type: ignore</span>
</span><span id="1-2078">
</span><span id="1-2079">        <span class="bp">self</span><span class="o">.</span><span class="n">key</span> <span class="o">=</span> <span class="n">key</span> <span class="k">if</span> <span class="n">key</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">name</span>  <span class="c1"># type: ignore</span>
</span><span id="1-2080">        <span class="bp">self</span><span class="o">.</span><span class="n">primary_key</span> <span class="o">=</span> <span class="n">primary_key</span>
</span><span id="1-2081">        <span class="bp">self</span><span class="o">.</span><span class="n">_insert_sentinel</span> <span class="o">=</span> <span class="n">insert_sentinel</span>
</span><span id="1-2082">        <span class="bp">self</span><span class="o">.</span><span class="n">_omit_from_statements</span> <span class="o">=</span> <span class="n">_omit_from_statements</span>
</span><span id="1-2083">        <span class="bp">self</span><span class="o">.</span><span class="n">_user_defined_nullable</span> <span class="o">=</span> <span class="n">udn</span> <span class="o">=</span> <span class="n">nullable</span>
</span><span id="1-2084">        <span class="k">if</span> <span class="n">udn</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">NULL_UNSPECIFIED</span><span class="p">:</span>
</span><span id="1-2085">            <span class="bp">self</span><span class="o">.</span><span class="n">nullable</span> <span class="o">=</span> <span class="n">udn</span>
</span><span id="1-2086">        <span class="k">else</span><span class="p">:</span>
</span><span id="1-2087">            <span class="bp">self</span><span class="o">.</span><span class="n">nullable</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">primary_key</span>
</span><span id="1-2088">
</span><span id="1-2089">        <span class="c1"># these default to None because .index and .unique is *not*</span>
</span><span id="1-2090">        <span class="c1"># an informational flag about Column - there can still be an</span>
</span><span id="1-2091">        <span class="c1"># Index or UniqueConstraint referring to this Column.</span>
</span><span id="1-2092">        <span class="bp">self</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">index</span>
</span><span id="1-2093">        <span class="bp">self</span><span class="o">.</span><span class="n">unique</span> <span class="o">=</span> <span class="n">unique</span>
</span><span id="1-2094">
</span><span id="1-2095">        <span class="bp">self</span><span class="o">.</span><span class="n">system</span> <span class="o">=</span> <span class="n">system</span>
</span><span id="1-2096">        <span class="bp">self</span><span class="o">.</span><span class="n">doc</span> <span class="o">=</span> <span class="n">doc</span>
</span><span id="1-2097">        <span class="bp">self</span><span class="o">.</span><span class="n">autoincrement</span><span class="p">:</span> <span class="n">_AutoIncrementType</span> <span class="o">=</span> <span class="n">autoincrement</span>
</span><span id="1-2098">        <span class="bp">self</span><span class="o">.</span><span class="n">constraints</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
</span><span id="1-2099">        <span class="bp">self</span><span class="o">.</span><span class="n">foreign_keys</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
</span><span id="1-2100">        <span class="bp">self</span><span class="o">.</span><span class="n">comment</span> <span class="o">=</span> <span class="n">comment</span>
</span><span id="1-2101">        <span class="bp">self</span><span class="o">.</span><span class="n">computed</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="1-2102">        <span class="bp">self</span><span class="o">.</span><span class="n">identity</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="1-2103">
</span><span id="1-2104">        <span class="c1"># check if this Column is proxying another column</span>
</span><span id="1-2105">
</span><span id="1-2106">        <span class="k">if</span> <span class="n">_proxies</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-2107">            <span class="bp">self</span><span class="o">.</span><span class="n">_proxies</span> <span class="o">=</span> <span class="n">_proxies</span>
</span><span id="1-2108">        <span class="k">else</span><span class="p">:</span>
</span><span id="1-2109">            <span class="c1"># otherwise, add DDL-related events</span>
</span><span id="1-2110">            <span class="bp">self</span><span class="o">.</span><span class="n">_set_type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="p">)</span>
</span><span id="1-2111">
</span><span id="1-2112">        <span class="k">if</span> <span class="n">default</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-2113">            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">default</span><span class="p">,</span> <span class="p">(</span><span class="n">ColumnDefault</span><span class="p">,</span> <span class="n">Sequence</span><span class="p">)):</span>
</span><span id="1-2114">                <span class="n">default</span> <span class="o">=</span> <span class="n">ColumnDefault</span><span class="p">(</span><span class="n">default</span><span class="p">)</span>
</span><span id="1-2115">
</span><span id="1-2116">            <span class="bp">self</span><span class="o">.</span><span class="n">default</span> <span class="o">=</span> <span class="n">default</span>
</span><span id="1-2117">            <span class="n">l_args</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">default</span><span class="p">)</span>
</span><span id="1-2118">        <span class="k">else</span><span class="p">:</span>
</span><span id="1-2119">            <span class="bp">self</span><span class="o">.</span><span class="n">default</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="1-2120">
</span><span id="1-2121">        <span class="k">if</span> <span class="n">onupdate</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-2122">            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">onupdate</span><span class="p">,</span> <span class="p">(</span><span class="n">ColumnDefault</span><span class="p">,</span> <span class="n">Sequence</span><span class="p">)):</span>
</span><span id="1-2123">                <span class="n">onupdate</span> <span class="o">=</span> <span class="n">ColumnDefault</span><span class="p">(</span><span class="n">onupdate</span><span class="p">,</span> <span class="n">for_update</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="1-2124">
</span><span id="1-2125">            <span class="bp">self</span><span class="o">.</span><span class="n">onupdate</span> <span class="o">=</span> <span class="n">onupdate</span>
</span><span id="1-2126">            <span class="n">l_args</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">onupdate</span><span class="p">)</span>
</span><span id="1-2127">        <span class="k">else</span><span class="p">:</span>
</span><span id="1-2128">            <span class="bp">self</span><span class="o">.</span><span class="n">onupdate</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="1-2129">
</span><span id="1-2130">        <span class="k">if</span> <span class="n">server_default</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-2131">            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">server_default</span><span class="p">,</span> <span class="n">FetchedValue</span><span class="p">):</span>
</span><span id="1-2132">                <span class="n">server_default</span> <span class="o">=</span> <span class="n">server_default</span><span class="o">.</span><span class="n">_as_for_update</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
</span><span id="1-2133">                <span class="n">l_args</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">server_default</span><span class="p">)</span>
</span><span id="1-2134">            <span class="k">else</span><span class="p">:</span>
</span><span id="1-2135">                <span class="n">server_default</span> <span class="o">=</span> <span class="n">DefaultClause</span><span class="p">(</span><span class="n">server_default</span><span class="p">)</span>
</span><span id="1-2136">                <span class="n">l_args</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">server_default</span><span class="p">)</span>
</span><span id="1-2137">        <span class="bp">self</span><span class="o">.</span><span class="n">server_default</span> <span class="o">=</span> <span class="n">server_default</span>
</span><span id="1-2138">
</span><span id="1-2139">        <span class="k">if</span> <span class="n">server_onupdate</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-2140">            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">server_onupdate</span><span class="p">,</span> <span class="n">FetchedValue</span><span class="p">):</span>
</span><span id="1-2141">                <span class="n">server_onupdate</span> <span class="o">=</span> <span class="n">server_onupdate</span><span class="o">.</span><span class="n">_as_for_update</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
</span><span id="1-2142">                <span class="n">l_args</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">server_onupdate</span><span class="p">)</span>
</span><span id="1-2143">            <span class="k">else</span><span class="p">:</span>
</span><span id="1-2144">                <span class="n">server_onupdate</span> <span class="o">=</span> <span class="n">DefaultClause</span><span class="p">(</span>
</span><span id="1-2145">                    <span class="n">server_onupdate</span><span class="p">,</span> <span class="n">for_update</span><span class="o">=</span><span class="kc">True</span>
</span><span id="1-2146">                <span class="p">)</span>
</span><span id="1-2147">                <span class="n">l_args</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">server_onupdate</span><span class="p">)</span>
</span><span id="1-2148">        <span class="bp">self</span><span class="o">.</span><span class="n">server_onupdate</span> <span class="o">=</span> <span class="n">server_onupdate</span>
</span><span id="1-2149">
</span><span id="1-2150">        <span class="bp">self</span><span class="o">.</span><span class="n">_init_items</span><span class="p">(</span><span class="o">*</span><span class="n">cast</span><span class="p">(</span><span class="n">_typing_Sequence</span><span class="p">[</span><span class="n">SchemaItem</span><span class="p">],</span> <span class="n">l_args</span><span class="p">))</span>
</span><span id="1-2151">
</span><span id="1-2152">        <span class="n">util</span><span class="o">.</span><span class="n">set_creation_order</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span><span id="1-2153">
</span><span id="1-2154">        <span class="k">if</span> <span class="n">info</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-2155">            <span class="bp">self</span><span class="o">.</span><span class="n">info</span> <span class="o">=</span> <span class="n">info</span>
</span><span id="1-2156">
</span><span id="1-2157">        <span class="bp">self</span><span class="o">.</span><span class="n">_extra_kwargs</span><span class="p">(</span><span class="o">**</span><span class="n">dialect_kwargs</span><span class="p">)</span>
</span><span id="1-2158">
</span><span id="1-2159">    <span class="n">table</span><span class="p">:</span> <span class="n">Table</span>
</span><span id="1-2160">
</span><span id="1-2161">    <span class="n">constraints</span><span class="p">:</span> <span class="n">Set</span><span class="p">[</span><span class="n">Constraint</span><span class="p">]</span>
</span><span id="1-2162">
</span><span id="1-2163">    <span class="n">foreign_keys</span><span class="p">:</span> <span class="n">Set</span><span class="p">[</span><span class="n">ForeignKey</span><span class="p">]</span>
</span><span id="1-2164"><span class="w">    </span><span class="sd">&quot;&quot;&quot;A collection of all :class:`_schema.ForeignKey` marker objects</span>
</span><span id="1-2165"><span class="sd">       associated with this :class:`_schema.Column`.</span>
</span><span id="1-2166">
</span><span id="1-2167"><span class="sd">       Each object is a member of a :class:`_schema.Table`-wide</span>
</span><span id="1-2168"><span class="sd">       :class:`_schema.ForeignKeyConstraint`.</span>
</span><span id="1-2169">
</span><span id="1-2170"><span class="sd">       .. seealso::</span>
</span><span id="1-2171">
</span><span id="1-2172"><span class="sd">           :attr:`_schema.Table.foreign_keys`</span>
</span><span id="1-2173">
</span><span id="1-2174"><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="1-2175">
</span><span id="1-2176">    <span class="n">index</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span>
</span><span id="1-2177"><span class="w">    </span><span class="sd">&quot;&quot;&quot;The value of the :paramref:`_schema.Column.index` parameter.</span>
</span><span id="1-2178">
</span><span id="1-2179"><span class="sd">       Does not indicate if this :class:`_schema.Column` is actually indexed</span>
</span><span id="1-2180"><span class="sd">       or not; use :attr:`_schema.Table.indexes`.</span>
</span><span id="1-2181">
</span><span id="1-2182"><span class="sd">       .. seealso::</span>
</span><span id="1-2183">
</span><span id="1-2184"><span class="sd">           :attr:`_schema.Table.indexes`</span>
</span><span id="1-2185"><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="1-2186">
</span><span id="1-2187">    <span class="n">unique</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span>
</span><span id="1-2188"><span class="w">    </span><span class="sd">&quot;&quot;&quot;The value of the :paramref:`_schema.Column.unique` parameter.</span>
</span><span id="1-2189">
</span><span id="1-2190"><span class="sd">       Does not indicate if this :class:`_schema.Column` is actually subject to</span>
</span><span id="1-2191"><span class="sd">       a unique constraint or not; use :attr:`_schema.Table.indexes` and</span>
</span><span id="1-2192"><span class="sd">       :attr:`_schema.Table.constraints`.</span>
</span><span id="1-2193">
</span><span id="1-2194"><span class="sd">       .. seealso::</span>
</span><span id="1-2195">
</span><span id="1-2196"><span class="sd">           :attr:`_schema.Table.indexes`</span>
</span><span id="1-2197">
</span><span id="1-2198"><span class="sd">           :attr:`_schema.Table.constraints`.</span>
</span><span id="1-2199">
</span><span id="1-2200"><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="1-2201">
</span><span id="1-2202">    <span class="n">computed</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Computed</span><span class="p">]</span>
</span><span id="1-2203">
</span><span id="1-2204">    <span class="n">identity</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Identity</span><span class="p">]</span>
</span><span id="1-2205">
</span><span id="1-2206">    <span class="k">def</span> <span class="nf">_set_type</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">type_</span><span class="p">:</span> <span class="n">TypeEngine</span><span class="p">[</span><span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-2207">        <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="n">type_</span>
</span><span id="1-2208">        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="p">,</span> <span class="n">SchemaEventTarget</span><span class="p">):</span>
</span><span id="1-2209">            <span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="o">.</span><span class="n">_set_parent_with_dispatch</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span><span id="1-2210">        <span class="k">for</span> <span class="n">impl</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="o">.</span><span class="n">_variant_mapping</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
</span><span id="1-2211">            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">impl</span><span class="p">,</span> <span class="n">SchemaEventTarget</span><span class="p">):</span>
</span><span id="1-2212">                <span class="n">impl</span><span class="o">.</span><span class="n">_set_parent_with_dispatch</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span><span id="1-2213">
</span><span id="1-2214">    <span class="nd">@HasMemoized</span><span class="o">.</span><span class="n">memoized_attribute</span>
</span><span id="1-2215">    <span class="k">def</span> <span class="nf">_default_description_tuple</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_DefaultDescriptionTuple</span><span class="p">:</span>
</span><span id="1-2216"><span class="w">        </span><span class="sd">&quot;&quot;&quot;used by default.py -&gt; _process_execute_defaults()&quot;&quot;&quot;</span>
</span><span id="1-2217">
</span><span id="1-2218">        <span class="k">return</span> <span class="n">_DefaultDescriptionTuple</span><span class="o">.</span><span class="n">_from_column_default</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">default</span><span class="p">)</span>
</span><span id="1-2219">
</span><span id="1-2220">    <span class="nd">@HasMemoized</span><span class="o">.</span><span class="n">memoized_attribute</span>
</span><span id="1-2221">    <span class="k">def</span> <span class="nf">_onupdate_description_tuple</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_DefaultDescriptionTuple</span><span class="p">:</span>
</span><span id="1-2222"><span class="w">        </span><span class="sd">&quot;&quot;&quot;used by default.py -&gt; _process_execute_defaults()&quot;&quot;&quot;</span>
</span><span id="1-2223">        <span class="k">return</span> <span class="n">_DefaultDescriptionTuple</span><span class="o">.</span><span class="n">_from_column_default</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">onupdate</span><span class="p">)</span>
</span><span id="1-2224">
</span><span id="1-2225">    <span class="nd">@util</span><span class="o">.</span><span class="n">memoized_property</span>
</span><span id="1-2226">    <span class="k">def</span> <span class="nf">_gen_static_annotations_cache_key</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>  <span class="c1"># type: ignore</span>
</span><span id="1-2227"><span class="w">        </span><span class="sd">&quot;&quot;&quot;special attribute used by cache key gen, if true, we will</span>
</span><span id="1-2228"><span class="sd">        use a static cache key for the annotations dictionary, else we</span>
</span><span id="1-2229"><span class="sd">        will generate a new cache key for annotations each time.</span>
</span><span id="1-2230">
</span><span id="1-2231"><span class="sd">        Added for #8790</span>
</span><span id="1-2232">
</span><span id="1-2233"><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="1-2234">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">table</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">_is_table</span>
</span><span id="1-2235">
</span><span id="1-2236">    <span class="k">def</span> <span class="nf">_extra_kwargs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-2237">        <span class="bp">self</span><span class="o">.</span><span class="n">_validate_dialect_kwargs</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="1-2238">
</span><span id="1-2239">    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="1-2240">        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-2241">            <span class="k">return</span> <span class="s2">&quot;(no name)&quot;</span>
</span><span id="1-2242">        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">table</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-2243">            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">named_with_column</span><span class="p">:</span>
</span><span id="1-2244">                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">description</span> <span class="o">+</span> <span class="s2">&quot;.&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">description</span>
</span><span id="1-2245">            <span class="k">else</span><span class="p">:</span>
</span><span id="1-2246">                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">description</span>
</span><span id="1-2247">        <span class="k">else</span><span class="p">:</span>
</span><span id="1-2248">            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">description</span>
</span><span id="1-2249">
</span><span id="1-2250">    <span class="k">def</span> <span class="nf">references</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">column</span><span class="p">:</span> <span class="n">Column</span><span class="p">[</span><span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="1-2251"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Return True if this Column references the given column via foreign</span>
</span><span id="1-2252"><span class="sd">        key.&quot;&quot;&quot;</span>
</span><span id="1-2253">
</span><span id="1-2254">        <span class="k">for</span> <span class="n">fk</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">foreign_keys</span><span class="p">:</span>
</span><span id="1-2255">            <span class="k">if</span> <span class="n">fk</span><span class="o">.</span><span class="n">column</span><span class="o">.</span><span class="n">proxy_set</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">column</span><span class="o">.</span><span class="n">proxy_set</span><span class="p">):</span>
</span><span id="1-2256">                <span class="k">return</span> <span class="kc">True</span>
</span><span id="1-2257">        <span class="k">else</span><span class="p">:</span>
</span><span id="1-2258">            <span class="k">return</span> <span class="kc">False</span>
</span><span id="1-2259">
</span><span id="1-2260">    <span class="k">def</span> <span class="nf">append_foreign_key</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fk</span><span class="p">:</span> <span class="n">ForeignKey</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-2261">        <span class="n">fk</span><span class="o">.</span><span class="n">_set_parent_with_dispatch</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span><span id="1-2262">
</span><span id="1-2263">    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="1-2264">        <span class="n">kwarg</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="1-2265">        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">key</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">:</span>
</span><span id="1-2266">            <span class="n">kwarg</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;key&quot;</span><span class="p">)</span>
</span><span id="1-2267">        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">primary_key</span><span class="p">:</span>
</span><span id="1-2268">            <span class="n">kwarg</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;primary_key&quot;</span><span class="p">)</span>
</span><span id="1-2269">        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">nullable</span><span class="p">:</span>
</span><span id="1-2270">            <span class="n">kwarg</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;nullable&quot;</span><span class="p">)</span>
</span><span id="1-2271">        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">onupdate</span><span class="p">:</span>
</span><span id="1-2272">            <span class="n">kwarg</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;onupdate&quot;</span><span class="p">)</span>
</span><span id="1-2273">        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">default</span><span class="p">:</span>
</span><span id="1-2274">            <span class="n">kwarg</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;default&quot;</span><span class="p">)</span>
</span><span id="1-2275">        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">server_default</span><span class="p">:</span>
</span><span id="1-2276">            <span class="n">kwarg</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;server_default&quot;</span><span class="p">)</span>
</span><span id="1-2277">        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">comment</span><span class="p">:</span>
</span><span id="1-2278">            <span class="n">kwarg</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;comment&quot;</span><span class="p">)</span>
</span><span id="1-2279">        <span class="k">return</span> <span class="s2">&quot;Column(</span><span class="si">%s</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="1-2280">            <span class="p">[</span><span class="nb">repr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)]</span>
</span><span id="1-2281">            <span class="o">+</span> <span class="p">[</span><span class="nb">repr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="p">)]</span>
</span><span id="1-2282">            <span class="o">+</span> <span class="p">[</span><span class="nb">repr</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">foreign_keys</span> <span class="k">if</span> <span class="n">x</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">]</span>
</span><span id="1-2283">            <span class="o">+</span> <span class="p">[</span><span class="nb">repr</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">constraints</span><span class="p">]</span>
</span><span id="1-2284">            <span class="o">+</span> <span class="p">[</span>
</span><span id="1-2285">                <span class="p">(</span>
</span><span id="1-2286">                    <span class="bp">self</span><span class="o">.</span><span class="n">table</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span id="1-2287">                    <span class="ow">and</span> <span class="s2">&quot;table=&lt;</span><span class="si">%s</span><span class="s2">&gt;&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">description</span>
</span><span id="1-2288">                    <span class="ow">or</span> <span class="s2">&quot;table=None&quot;</span>
</span><span id="1-2289">                <span class="p">)</span>
</span><span id="1-2290">            <span class="p">]</span>
</span><span id="1-2291">            <span class="o">+</span> <span class="p">[</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">=</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="nb">repr</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">)))</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">kwarg</span><span class="p">]</span>
</span><span id="1-2292">        <span class="p">)</span>
</span><span id="1-2293">
</span><span id="1-2294">    <span class="k">def</span> <span class="nf">_set_parent</span><span class="p">(</span>  <span class="c1"># type: ignore[override]</span>
</span><span id="1-2295">        <span class="bp">self</span><span class="p">,</span>
</span><span id="1-2296">        <span class="n">parent</span><span class="p">:</span> <span class="n">SchemaEventTarget</span><span class="p">,</span>
</span><span id="1-2297">        <span class="o">*</span><span class="p">,</span>
</span><span id="1-2298">        <span class="n">all_names</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Column</span><span class="p">[</span><span class="n">Any</span><span class="p">]],</span>
</span><span id="1-2299">        <span class="n">allow_replacements</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
</span><span id="1-2300">        <span class="o">**</span><span class="n">kw</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
</span><span id="1-2301">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-2302">        <span class="n">table</span> <span class="o">=</span> <span class="n">parent</span>
</span><span id="1-2303">        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">table</span><span class="p">,</span> <span class="n">Table</span><span class="p">)</span>
</span><span id="1-2304">        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">:</span>
</span><span id="1-2305">            <span class="k">raise</span> <span class="n">exc</span><span class="o">.</span><span class="n">ArgumentError</span><span class="p">(</span>
</span><span id="1-2306">                <span class="s2">&quot;Column must be constructed with a non-blank name or &quot;</span>
</span><span id="1-2307">                <span class="s2">&quot;assign a non-blank .name before adding to a Table.&quot;</span>
</span><span id="1-2308">            <span class="p">)</span>
</span><span id="1-2309">
</span><span id="1-2310">        <span class="bp">self</span><span class="o">.</span><span class="n">_reset_memoizations</span><span class="p">()</span>
</span><span id="1-2311">
</span><span id="1-2312">        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">key</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-2313">            <span class="bp">self</span><span class="o">.</span><span class="n">key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>
</span><span id="1-2314">
</span><span id="1-2315">        <span class="n">existing</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;table&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="1-2316">        <span class="k">if</span> <span class="n">existing</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">existing</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">table</span><span class="p">:</span>
</span><span id="1-2317">            <span class="k">raise</span> <span class="n">exc</span><span class="o">.</span><span class="n">ArgumentError</span><span class="p">(</span>
</span><span id="1-2318">                <span class="s2">&quot;Column object &#39;</span><span class="si">%s</span><span class="s2">&#39; already assigned to Table &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span>
</span><span id="1-2319">                <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">,</span> <span class="n">existing</span><span class="o">.</span><span class="n">description</span><span class="p">)</span>
</span><span id="1-2320">            <span class="p">)</span>
</span><span id="1-2321">
</span><span id="1-2322">        <span class="n">extra_remove</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="1-2323">        <span class="n">existing_col</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="1-2324">        <span class="n">conflicts_on</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="1-2325">
</span><span id="1-2326">        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">key</span> <span class="ow">in</span> <span class="n">table</span><span class="o">.</span><span class="n">_columns</span><span class="p">:</span>
</span><span id="1-2327">            <span class="n">existing_col</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">_columns</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">]</span>
</span><span id="1-2328">            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">key</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">:</span>
</span><span id="1-2329">                <span class="n">conflicts_on</span> <span class="o">=</span> <span class="s2">&quot;name&quot;</span>
</span><span id="1-2330">            <span class="k">else</span><span class="p">:</span>
</span><span id="1-2331">                <span class="n">conflicts_on</span> <span class="o">=</span> <span class="s2">&quot;key&quot;</span>
</span><span id="1-2332">        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="n">all_names</span><span class="p">:</span>
</span><span id="1-2333">            <span class="n">existing_col</span> <span class="o">=</span> <span class="n">all_names</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">]</span>
</span><span id="1-2334">            <span class="n">extra_remove</span> <span class="o">=</span> <span class="p">{</span><span class="n">existing_col</span><span class="p">}</span>
</span><span id="1-2335">            <span class="n">conflicts_on</span> <span class="o">=</span> <span class="s2">&quot;name&quot;</span>
</span><span id="1-2336">
</span><span id="1-2337">        <span class="k">if</span> <span class="n">existing_col</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-2338">            <span class="k">if</span> <span class="n">existing_col</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">self</span><span class="p">:</span>
</span><span id="1-2339">                <span class="k">if</span> <span class="ow">not</span> <span class="n">allow_replacements</span><span class="p">:</span>
</span><span id="1-2340">                    <span class="k">raise</span> <span class="n">exc</span><span class="o">.</span><span class="n">DuplicateColumnError</span><span class="p">(</span>
</span><span id="1-2341">                        <span class="sa">f</span><span class="s2">&quot;A column with </span><span class="si">{</span><span class="n">conflicts_on</span><span class="si">}</span><span class="s2"> &quot;</span>
</span><span id="1-2342">                        <span class="sa">f</span><span class="s2">&quot;&quot;&quot;&#39;</span><span class="si">{</span>
</span><span id="1-2343"><span class="w">                            </span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">conflicts_on</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s1">&#39;key&#39;</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">name</span>
</span><span id="1-2344"><span class="w">                        </span><span class="si">}</span><span class="s2">&#39; &quot;&quot;&quot;</span>
</span><span id="1-2345">                        <span class="sa">f</span><span class="s2">&quot;is already present in table &#39;</span><span class="si">{</span><span class="n">table</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39;.&quot;</span>
</span><span id="1-2346">                    <span class="p">)</span>
</span><span id="1-2347">                <span class="k">for</span> <span class="n">fk</span> <span class="ow">in</span> <span class="n">existing_col</span><span class="o">.</span><span class="n">foreign_keys</span><span class="p">:</span>
</span><span id="1-2348">                    <span class="n">table</span><span class="o">.</span><span class="n">foreign_keys</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">fk</span><span class="p">)</span>
</span><span id="1-2349">                    <span class="k">if</span> <span class="n">fk</span><span class="o">.</span><span class="n">constraint</span> <span class="ow">in</span> <span class="n">table</span><span class="o">.</span><span class="n">constraints</span><span class="p">:</span>
</span><span id="1-2350">                        <span class="c1"># this might have been removed</span>
</span><span id="1-2351">                        <span class="c1"># already, if it&#39;s a composite constraint</span>
</span><span id="1-2352">                        <span class="c1"># and more than one col being replaced</span>
</span><span id="1-2353">                        <span class="n">table</span><span class="o">.</span><span class="n">constraints</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">fk</span><span class="o">.</span><span class="n">constraint</span><span class="p">)</span>
</span><span id="1-2354">
</span><span id="1-2355">        <span class="k">if</span> <span class="n">extra_remove</span> <span class="ow">and</span> <span class="n">existing_col</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">key</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">:</span>
</span><span id="1-2356">            <span class="n">util</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
</span><span id="1-2357">                <span class="sa">f</span><span class="s1">&#39;Column with user-specified key &quot;</span><span class="si">{</span><span class="n">existing_col</span><span class="o">.</span><span class="n">key</span><span class="si">}</span><span class="s1">&quot; is &#39;</span>
</span><span id="1-2358">                <span class="s2">&quot;being replaced with &quot;</span>
</span><span id="1-2359">                <span class="sa">f</span><span class="s1">&#39;plain named column &quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1">&quot;, &#39;</span>
</span><span id="1-2360">                <span class="sa">f</span><span class="s1">&#39;key &quot;</span><span class="si">{</span><span class="n">existing_col</span><span class="o">.</span><span class="n">key</span><span class="si">}</span><span class="s1">&quot; is being removed.  If this is a &#39;</span>
</span><span id="1-2361">                <span class="s2">&quot;reflection operation, specify autoload_replace=False to &quot;</span>
</span><span id="1-2362">                <span class="s2">&quot;prevent this replacement.&quot;</span>
</span><span id="1-2363">            <span class="p">)</span>
</span><span id="1-2364">        <span class="n">table</span><span class="o">.</span><span class="n">_columns</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">extra_remove</span><span class="o">=</span><span class="n">extra_remove</span><span class="p">)</span>
</span><span id="1-2365">        <span class="n">all_names</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span>
</span><span id="1-2366">        <span class="bp">self</span><span class="o">.</span><span class="n">table</span> <span class="o">=</span> <span class="n">table</span>
</span><span id="1-2367">
</span><span id="1-2368">        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_insert_sentinel</span><span class="p">:</span>
</span><span id="1-2369">            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">_sentinel_column</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-2370">                <span class="k">raise</span> <span class="n">exc</span><span class="o">.</span><span class="n">ArgumentError</span><span class="p">(</span>
</span><span id="1-2371">                    <span class="s2">&quot;a Table may have only one explicit sentinel column&quot;</span>
</span><span id="1-2372">                <span class="p">)</span>
</span><span id="1-2373">            <span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">_sentinel_column</span> <span class="o">=</span> <span class="bp">self</span>
</span><span id="1-2374">
</span><span id="1-2375">        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">primary_key</span><span class="p">:</span>
</span><span id="1-2376">            <span class="n">table</span><span class="o">.</span><span class="n">primary_key</span><span class="o">.</span><span class="n">_replace</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span><span id="1-2377">        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">key</span> <span class="ow">in</span> <span class="n">table</span><span class="o">.</span><span class="n">primary_key</span><span class="p">:</span>
</span><span id="1-2378">            <span class="k">raise</span> <span class="n">exc</span><span class="o">.</span><span class="n">ArgumentError</span><span class="p">(</span>
</span><span id="1-2379">                <span class="s2">&quot;Trying to redefine primary-key column &#39;</span><span class="si">%s</span><span class="s2">&#39; as a &quot;</span>
</span><span id="1-2380">                <span class="s2">&quot;non-primary-key column on table &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span>
</span><span id="1-2381">                <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">,</span> <span class="n">table</span><span class="o">.</span><span class="n">fullname</span><span class="p">)</span>
</span><span id="1-2382">            <span class="p">)</span>
</span><span id="1-2383">
</span><span id="1-2384">        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">:</span>
</span><span id="1-2385">            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="1-2386">                <span class="k">raise</span> <span class="n">exc</span><span class="o">.</span><span class="n">ArgumentError</span><span class="p">(</span>
</span><span id="1-2387">                    <span class="s2">&quot;The &#39;index&#39; keyword argument on Column is boolean only. &quot;</span>
</span><span id="1-2388">                    <span class="s2">&quot;To create indexes with a specific name, create an &quot;</span>
</span><span id="1-2389">                    <span class="s2">&quot;explicit Index object external to the Table.&quot;</span>
</span><span id="1-2390">                <span class="p">)</span>
</span><span id="1-2391">            <span class="n">table</span><span class="o">.</span><span class="n">append_constraint</span><span class="p">(</span>
</span><span id="1-2392">                <span class="n">Index</span><span class="p">(</span>
</span><span id="1-2393">                    <span class="kc">None</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">,</span> <span class="n">unique</span><span class="o">=</span><span class="nb">bool</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">unique</span><span class="p">),</span> <span class="n">_column_flag</span><span class="o">=</span><span class="kc">True</span>
</span><span id="1-2394">                <span class="p">)</span>
</span><span id="1-2395">            <span class="p">)</span>
</span><span id="1-2396">
</span><span id="1-2397">        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">unique</span><span class="p">:</span>
</span><span id="1-2398">            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">unique</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="1-2399">                <span class="k">raise</span> <span class="n">exc</span><span class="o">.</span><span class="n">ArgumentError</span><span class="p">(</span>
</span><span id="1-2400">                    <span class="s2">&quot;The &#39;unique&#39; keyword argument on Column is boolean &quot;</span>
</span><span id="1-2401">                    <span class="s2">&quot;only. To create unique constraints or indexes with a &quot;</span>
</span><span id="1-2402">                    <span class="s2">&quot;specific name, append an explicit UniqueConstraint to &quot;</span>
</span><span id="1-2403">                    <span class="s2">&quot;the Table&#39;s list of elements, or create an explicit &quot;</span>
</span><span id="1-2404">                    <span class="s2">&quot;Index object external to the Table.&quot;</span>
</span><span id="1-2405">                <span class="p">)</span>
</span><span id="1-2406">            <span class="n">table</span><span class="o">.</span><span class="n">append_constraint</span><span class="p">(</span>
</span><span id="1-2407">                <span class="n">UniqueConstraint</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">,</span> <span class="n">_column_flag</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="1-2408">            <span class="p">)</span>
</span><span id="1-2409">
</span><span id="1-2410">        <span class="bp">self</span><span class="o">.</span><span class="n">_setup_on_memoized_fks</span><span class="p">(</span><span class="k">lambda</span> <span class="n">fk</span><span class="p">:</span> <span class="n">fk</span><span class="o">.</span><span class="n">_set_remote_table</span><span class="p">(</span><span class="n">table</span><span class="p">))</span>
</span><span id="1-2411">
</span><span id="1-2412">        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">identity</span> <span class="ow">and</span> <span class="p">(</span>
</span><span id="1-2413">            <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">default</span><span class="p">,</span> <span class="n">Sequence</span><span class="p">)</span>
</span><span id="1-2414">            <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">onupdate</span><span class="p">,</span> <span class="n">Sequence</span><span class="p">)</span>
</span><span id="1-2415">        <span class="p">):</span>
</span><span id="1-2416">            <span class="k">raise</span> <span class="n">exc</span><span class="o">.</span><span class="n">ArgumentError</span><span class="p">(</span>
</span><span id="1-2417">                <span class="s2">&quot;An column cannot specify both Identity and Sequence.&quot;</span>
</span><span id="1-2418">            <span class="p">)</span>
</span><span id="1-2419">
</span><span id="1-2420">    <span class="k">def</span> <span class="nf">_setup_on_memoized_fks</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fn</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-2421">        <span class="n">fk_keys</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="1-2422">            <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">key</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">),</span> <span class="kc">False</span><span class="p">),</span>
</span><span id="1-2423">            <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">key</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">),</span> <span class="kc">True</span><span class="p">),</span>
</span><span id="1-2424">        <span class="p">]</span>
</span><span id="1-2425">        <span class="k">for</span> <span class="n">fk_key</span><span class="p">,</span> <span class="n">link_to_name</span> <span class="ow">in</span> <span class="n">fk_keys</span><span class="p">:</span>
</span><span id="1-2426">            <span class="k">if</span> <span class="n">fk_key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">_fk_memos</span><span class="p">:</span>
</span><span id="1-2427">                <span class="k">for</span> <span class="n">fk</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">_fk_memos</span><span class="p">[</span><span class="n">fk_key</span><span class="p">]:</span>
</span><span id="1-2428">                    <span class="k">if</span> <span class="n">fk</span><span class="o">.</span><span class="n">link_to_name</span> <span class="ow">is</span> <span class="n">link_to_name</span><span class="p">:</span>
</span><span id="1-2429">                        <span class="n">fn</span><span class="p">(</span><span class="n">fk</span><span class="p">)</span>
</span><span id="1-2430">
</span><span id="1-2431">    <span class="k">def</span> <span class="nf">_on_table_attach</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fn</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-2432">        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">table</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-2433">            <span class="n">fn</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="p">)</span>
</span><span id="1-2434">        <span class="k">else</span><span class="p">:</span>
</span><span id="1-2435">            <span class="n">event</span><span class="o">.</span><span class="n">listen</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;after_parent_attach&quot;</span><span class="p">,</span> <span class="n">fn</span><span class="p">)</span>
</span><span id="1-2436">
</span><span id="1-2437">    <span class="nd">@util</span><span class="o">.</span><span class="n">deprecated</span><span class="p">(</span>
</span><span id="1-2438">        <span class="s2">&quot;1.4&quot;</span><span class="p">,</span>
</span><span id="1-2439">        <span class="s2">&quot;The :meth:`_schema.Column.copy` method is deprecated &quot;</span>
</span><span id="1-2440">        <span class="s2">&quot;and will be removed in a future release.&quot;</span><span class="p">,</span>
</span><span id="1-2441">    <span class="p">)</span>
</span><span id="1-2442">    <span class="k">def</span> <span class="nf">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Column</span><span class="p">[</span><span class="n">Any</span><span class="p">]:</span>
</span><span id="1-2443">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_copy</span><span class="p">(</span><span class="o">**</span><span class="n">kw</span><span class="p">)</span>
</span><span id="1-2444">
</span><span id="1-2445">    <span class="k">def</span> <span class="nf">_copy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Column</span><span class="p">[</span><span class="n">Any</span><span class="p">]:</span>
</span><span id="1-2446"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a copy of this ``Column``, uninitialized.</span>
</span><span id="1-2447">
</span><span id="1-2448"><span class="sd">        This is used in :meth:`_schema.Table.to_metadata` and by the ORM.</span>
</span><span id="1-2449">
</span><span id="1-2450"><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="1-2451">
</span><span id="1-2452">        <span class="c1"># Constraint objects plus non-constraint-bound ForeignKey objects</span>
</span><span id="1-2453">        <span class="n">args</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">SchemaItem</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="1-2454">            <span class="n">c</span><span class="o">.</span><span class="n">_copy</span><span class="p">(</span><span class="o">**</span><span class="n">kw</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">constraints</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">c</span><span class="o">.</span><span class="n">_type_bound</span>
</span><span id="1-2455">        <span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="n">c</span><span class="o">.</span><span class="n">_copy</span><span class="p">(</span><span class="o">**</span><span class="n">kw</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">foreign_keys</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">c</span><span class="o">.</span><span class="n">constraint</span><span class="p">]</span>
</span><span id="1-2456">
</span><span id="1-2457">        <span class="c1"># ticket #5276</span>
</span><span id="1-2458">        <span class="n">column_kwargs</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="1-2459">        <span class="k">for</span> <span class="n">dialect_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dialect_options</span><span class="p">:</span>
</span><span id="1-2460">            <span class="n">dialect_options</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dialect_options</span><span class="p">[</span><span class="n">dialect_name</span><span class="p">]</span><span class="o">.</span><span class="n">_non_defaults</span>
</span><span id="1-2461">            <span class="k">for</span> <span class="p">(</span>
</span><span id="1-2462">                <span class="n">dialect_option_key</span><span class="p">,</span>
</span><span id="1-2463">                <span class="n">dialect_option_value</span><span class="p">,</span>
</span><span id="1-2464">            <span class="p">)</span> <span class="ow">in</span> <span class="n">dialect_options</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="1-2465">                <span class="n">column_kwargs</span><span class="p">[</span>
</span><span id="1-2466">                    <span class="n">dialect_name</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="n">dialect_option_key</span>
</span><span id="1-2467">                <span class="p">]</span> <span class="o">=</span> <span class="n">dialect_option_value</span>
</span><span id="1-2468">
</span><span id="1-2469">        <span class="n">server_default</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">server_default</span>
</span><span id="1-2470">        <span class="n">server_onupdate</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">server_onupdate</span>
</span><span id="1-2471">        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">server_default</span><span class="p">,</span> <span class="p">(</span><span class="n">Computed</span><span class="p">,</span> <span class="n">Identity</span><span class="p">)):</span>
</span><span id="1-2472">            <span class="c1"># TODO: likely should be copied in all cases</span>
</span><span id="1-2473">            <span class="n">args</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">server_default</span><span class="o">.</span><span class="n">_copy</span><span class="p">(</span><span class="o">**</span><span class="n">kw</span><span class="p">))</span>
</span><span id="1-2474">            <span class="n">server_default</span> <span class="o">=</span> <span class="n">server_onupdate</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="1-2475">
</span><span id="1-2476">        <span class="n">type_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span>
</span><span id="1-2477">        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">type_</span><span class="p">,</span> <span class="n">SchemaEventTarget</span><span class="p">):</span>
</span><span id="1-2478">            <span class="n">type_</span> <span class="o">=</span> <span class="n">type_</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="o">**</span><span class="n">kw</span><span class="p">)</span>
</span><span id="1-2479">
</span><span id="1-2480">        <span class="c1"># TODO: DefaultGenerator is not copied here!  it&#39;s just used again</span>
</span><span id="1-2481">        <span class="c1"># with _set_parent() pointing to the old column.  see the new</span>
</span><span id="1-2482">        <span class="c1"># use of _copy() in the new _merge() method</span>
</span><span id="1-2483">
</span><span id="1-2484">        <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_constructor</span><span class="p">(</span>
</span><span id="1-2485">            <span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
</span><span id="1-2486">            <span class="n">type_</span><span class="o">=</span><span class="n">type_</span><span class="p">,</span>
</span><span id="1-2487">            <span class="n">key</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">,</span>
</span><span id="1-2488">            <span class="n">primary_key</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">primary_key</span><span class="p">,</span>
</span><span id="1-2489">            <span class="n">unique</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">unique</span><span class="p">,</span>
</span><span id="1-2490">            <span class="n">system</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">system</span><span class="p">,</span>
</span><span id="1-2491">            <span class="c1"># quote=self.quote,  # disabled 2013-08-27 (commit 031ef080)</span>
</span><span id="1-2492">            <span class="n">index</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">,</span>
</span><span id="1-2493">            <span class="n">autoincrement</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">autoincrement</span><span class="p">,</span>
</span><span id="1-2494">            <span class="n">default</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">default</span><span class="p">,</span>
</span><span id="1-2495">            <span class="n">server_default</span><span class="o">=</span><span class="n">server_default</span><span class="p">,</span>
</span><span id="1-2496">            <span class="n">onupdate</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">onupdate</span><span class="p">,</span>
</span><span id="1-2497">            <span class="n">server_onupdate</span><span class="o">=</span><span class="n">server_onupdate</span><span class="p">,</span>
</span><span id="1-2498">            <span class="n">doc</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">doc</span><span class="p">,</span>
</span><span id="1-2499">            <span class="n">comment</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">comment</span><span class="p">,</span>
</span><span id="1-2500">            <span class="n">_omit_from_statements</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_omit_from_statements</span><span class="p">,</span>
</span><span id="1-2501">            <span class="n">insert_sentinel</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_insert_sentinel</span><span class="p">,</span>
</span><span id="1-2502">            <span class="o">*</span><span class="n">args</span><span class="p">,</span>
</span><span id="1-2503">            <span class="o">**</span><span class="n">column_kwargs</span><span class="p">,</span>
</span><span id="1-2504">        <span class="p">)</span>
</span><span id="1-2505">
</span><span id="1-2506">        <span class="c1"># copy the state of &quot;nullable&quot; exactly, to accommodate for</span>
</span><span id="1-2507">        <span class="c1"># ORM flipping the .nullable flag directly</span>
</span><span id="1-2508">        <span class="n">c</span><span class="o">.</span><span class="n">nullable</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nullable</span>
</span><span id="1-2509">        <span class="n">c</span><span class="o">.</span><span class="n">_user_defined_nullable</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_user_defined_nullable</span>
</span><span id="1-2510">
</span><span id="1-2511">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_schema_item_copy</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
</span><span id="1-2512">
</span><span id="1-2513">    <span class="k">def</span> <span class="nf">_merge</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="n">Column</span><span class="p">[</span><span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-2514"><span class="w">        </span><span class="sd">&quot;&quot;&quot;merge the elements of another column into this one.</span>
</span><span id="1-2515">
</span><span id="1-2516"><span class="sd">        this is used by ORM pep-593 merge and will likely need a lot</span>
</span><span id="1-2517"><span class="sd">        of fixes.</span>
</span><span id="1-2518">
</span><span id="1-2519">
</span><span id="1-2520"><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="1-2521">
</span><span id="1-2522">        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">primary_key</span><span class="p">:</span>
</span><span id="1-2523">            <span class="n">other</span><span class="o">.</span><span class="n">primary_key</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="1-2524">
</span><span id="1-2525">        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">autoincrement</span> <span class="o">!=</span> <span class="s2">&quot;auto&quot;</span> <span class="ow">and</span> <span class="n">other</span><span class="o">.</span><span class="n">autoincrement</span> <span class="o">==</span> <span class="s2">&quot;auto&quot;</span><span class="p">:</span>
</span><span id="1-2526">            <span class="n">other</span><span class="o">.</span><span class="n">autoincrement</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">autoincrement</span>
</span><span id="1-2527">
</span><span id="1-2528">        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">system</span><span class="p">:</span>
</span><span id="1-2529">            <span class="n">other</span><span class="o">.</span><span class="n">system</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">system</span>
</span><span id="1-2530">
</span><span id="1-2531">        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="p">:</span>
</span><span id="1-2532">            <span class="n">other</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="p">)</span>
</span><span id="1-2533">
</span><span id="1-2534">        <span class="n">type_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span>
</span><span id="1-2535">        <span class="k">if</span> <span class="ow">not</span> <span class="n">type_</span><span class="o">.</span><span class="n">_isnull</span> <span class="ow">and</span> <span class="n">other</span><span class="o">.</span><span class="n">type</span><span class="o">.</span><span class="n">_isnull</span><span class="p">:</span>
</span><span id="1-2536">            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">type_</span><span class="p">,</span> <span class="n">SchemaEventTarget</span><span class="p">):</span>
</span><span id="1-2537">                <span class="n">type_</span> <span class="o">=</span> <span class="n">type_</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="1-2538">
</span><span id="1-2539">            <span class="n">other</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="n">type_</span>
</span><span id="1-2540">
</span><span id="1-2541">            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">type_</span><span class="p">,</span> <span class="n">SchemaEventTarget</span><span class="p">):</span>
</span><span id="1-2542">                <span class="n">type_</span><span class="o">.</span><span class="n">_set_parent_with_dispatch</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
</span><span id="1-2543">
</span><span id="1-2544">            <span class="k">for</span> <span class="n">impl</span> <span class="ow">in</span> <span class="n">type_</span><span class="o">.</span><span class="n">_variant_mapping</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
</span><span id="1-2545">                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">impl</span><span class="p">,</span> <span class="n">SchemaEventTarget</span><span class="p">):</span>
</span><span id="1-2546">                    <span class="n">impl</span><span class="o">.</span><span class="n">_set_parent_with_dispatch</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
</span><span id="1-2547">
</span><span id="1-2548">        <span class="k">if</span> <span class="p">(</span>
</span><span id="1-2549">            <span class="bp">self</span><span class="o">.</span><span class="n">_user_defined_nullable</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">NULL_UNSPECIFIED</span>
</span><span id="1-2550">            <span class="ow">and</span> <span class="n">other</span><span class="o">.</span><span class="n">_user_defined_nullable</span> <span class="ow">is</span> <span class="n">NULL_UNSPECIFIED</span>
</span><span id="1-2551">        <span class="p">):</span>
</span><span id="1-2552">            <span class="n">other</span><span class="o">.</span><span class="n">nullable</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nullable</span>
</span><span id="1-2553">            <span class="n">other</span><span class="o">.</span><span class="n">_user_defined_nullable</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_user_defined_nullable</span>
</span><span id="1-2554">
</span><span id="1-2555">        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">default</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">other</span><span class="o">.</span><span class="n">default</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-2556">            <span class="n">new_default</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">default</span><span class="o">.</span><span class="n">_copy</span><span class="p">()</span>
</span><span id="1-2557">            <span class="n">new_default</span><span class="o">.</span><span class="n">_set_parent</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
</span><span id="1-2558">
</span><span id="1-2559">        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">server_default</span> <span class="ow">and</span> <span class="n">other</span><span class="o">.</span><span class="n">server_default</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-2560">            <span class="n">new_server_default</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">server_default</span>
</span><span id="1-2561">            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">new_server_default</span><span class="p">,</span> <span class="n">FetchedValue</span><span class="p">):</span>
</span><span id="1-2562">                <span class="n">new_server_default</span> <span class="o">=</span> <span class="n">new_server_default</span><span class="o">.</span><span class="n">_copy</span><span class="p">()</span>
</span><span id="1-2563">                <span class="n">new_server_default</span><span class="o">.</span><span class="n">_set_parent</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
</span><span id="1-2564">            <span class="k">else</span><span class="p">:</span>
</span><span id="1-2565">                <span class="n">other</span><span class="o">.</span><span class="n">server_default</span> <span class="o">=</span> <span class="n">new_server_default</span>
</span><span id="1-2566">
</span><span id="1-2567">        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">server_onupdate</span> <span class="ow">and</span> <span class="n">other</span><span class="o">.</span><span class="n">server_onupdate</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-2568">            <span class="n">new_server_onupdate</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">server_onupdate</span>
</span><span id="1-2569">            <span class="n">new_server_onupdate</span> <span class="o">=</span> <span class="n">new_server_onupdate</span><span class="o">.</span><span class="n">_copy</span><span class="p">()</span>
</span><span id="1-2570">            <span class="n">new_server_onupdate</span><span class="o">.</span><span class="n">_set_parent</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
</span><span id="1-2571">
</span><span id="1-2572">        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">onupdate</span> <span class="ow">and</span> <span class="n">other</span><span class="o">.</span><span class="n">onupdate</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-2573">            <span class="n">new_onupdate</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">onupdate</span><span class="o">.</span><span class="n">_copy</span><span class="p">()</span>
</span><span id="1-2574">            <span class="n">new_onupdate</span><span class="o">.</span><span class="n">_set_parent</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
</span><span id="1-2575">
</span><span id="1-2576">        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">index</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">other</span><span class="o">.</span><span class="n">index</span><span class="p">:</span>
</span><span id="1-2577">            <span class="n">other</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="1-2578">
</span><span id="1-2579">        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">doc</span> <span class="ow">and</span> <span class="n">other</span><span class="o">.</span><span class="n">doc</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-2580">            <span class="n">other</span><span class="o">.</span><span class="n">doc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">doc</span>
</span><span id="1-2581">
</span><span id="1-2582">        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">comment</span> <span class="ow">and</span> <span class="n">other</span><span class="o">.</span><span class="n">comment</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-2583">            <span class="n">other</span><span class="o">.</span><span class="n">comment</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">comment</span>
</span><span id="1-2584">
</span><span id="1-2585">        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">unique</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">other</span><span class="o">.</span><span class="n">unique</span><span class="p">:</span>
</span><span id="1-2586">            <span class="n">other</span><span class="o">.</span><span class="n">unique</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="1-2587">
</span><span id="1-2588">        <span class="k">for</span> <span class="n">const</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">constraints</span><span class="p">:</span>
</span><span id="1-2589">            <span class="k">if</span> <span class="ow">not</span> <span class="n">const</span><span class="o">.</span><span class="n">_type_bound</span><span class="p">:</span>
</span><span id="1-2590">                <span class="n">new_const</span> <span class="o">=</span> <span class="n">const</span><span class="o">.</span><span class="n">_copy</span><span class="p">()</span>
</span><span id="1-2591">                <span class="n">new_const</span><span class="o">.</span><span class="n">_set_parent</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
</span><span id="1-2592">
</span><span id="1-2593">        <span class="k">for</span> <span class="n">fk</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">foreign_keys</span><span class="p">:</span>
</span><span id="1-2594">            <span class="k">if</span> <span class="ow">not</span> <span class="n">fk</span><span class="o">.</span><span class="n">constraint</span><span class="p">:</span>
</span><span id="1-2595">                <span class="n">new_fk</span> <span class="o">=</span> <span class="n">fk</span><span class="o">.</span><span class="n">_copy</span><span class="p">()</span>
</span><span id="1-2596">                <span class="n">new_fk</span><span class="o">.</span><span class="n">_set_parent</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
</span><span id="1-2597">
</span><span id="1-2598">    <span class="k">def</span> <span class="nf">_make_proxy</span><span class="p">(</span>
</span><span id="1-2599">        <span class="bp">self</span><span class="p">,</span>
</span><span id="1-2600">        <span class="n">selectable</span><span class="p">:</span> <span class="n">FromClause</span><span class="p">,</span>
</span><span id="1-2601">        <span class="n">name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="1-2602">        <span class="n">key</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="1-2603">        <span class="n">name_is_truncatable</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="1-2604">        <span class="n">compound_select_cols</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span>
</span><span id="1-2605">            <span class="n">_typing_Sequence</span><span class="p">[</span><span class="n">ColumnElement</span><span class="p">[</span><span class="n">Any</span><span class="p">]]</span>
</span><span id="1-2606">        <span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="1-2607">        <span class="o">**</span><span class="n">kw</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
</span><span id="1-2608">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">ColumnClause</span><span class="p">[</span><span class="n">_T</span><span class="p">]]:</span>
</span><span id="1-2609"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a *proxy* for this column.</span>
</span><span id="1-2610">
</span><span id="1-2611"><span class="sd">        This is a copy of this ``Column`` referenced by a different parent</span>
</span><span id="1-2612"><span class="sd">        (such as an alias or select statement).  The column should</span>
</span><span id="1-2613"><span class="sd">        be used only in select scenarios, as its full DDL/default</span>
</span><span id="1-2614"><span class="sd">        information is not transferred.</span>
</span><span id="1-2615">
</span><span id="1-2616"><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="1-2617">
</span><span id="1-2618">        <span class="n">fk</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="1-2619">            <span class="n">ForeignKey</span><span class="p">(</span>
</span><span id="1-2620">                <span class="n">col</span> <span class="k">if</span> <span class="n">col</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">f</span><span class="o">.</span><span class="n">_colspec</span><span class="p">,</span>
</span><span id="1-2621">                <span class="n">_unresolvable</span><span class="o">=</span><span class="n">col</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="1-2622">                <span class="n">_constraint</span><span class="o">=</span><span class="n">f</span><span class="o">.</span><span class="n">constraint</span><span class="p">,</span>
</span><span id="1-2623">            <span class="p">)</span>
</span><span id="1-2624">            <span class="k">for</span> <span class="n">f</span><span class="p">,</span> <span class="n">col</span> <span class="ow">in</span> <span class="p">[</span>
</span><span id="1-2625">                <span class="p">(</span><span class="n">fk</span><span class="p">,</span> <span class="n">fk</span><span class="o">.</span><span class="n">_resolve_column</span><span class="p">(</span><span class="n">raiseerr</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>
</span><span id="1-2626">                <span class="k">for</span> <span class="n">fk</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">foreign_keys</span>
</span><span id="1-2627">            <span class="p">]</span>
</span><span id="1-2628">        <span class="p">]</span>
</span><span id="1-2629">
</span><span id="1-2630">        <span class="k">if</span> <span class="n">name</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-2631">            <span class="k">raise</span> <span class="n">exc</span><span class="o">.</span><span class="n">InvalidRequestError</span><span class="p">(</span>
</span><span id="1-2632">                <span class="s2">&quot;Cannot initialize a sub-selectable&quot;</span>
</span><span id="1-2633">                <span class="s2">&quot; with this Column object until its &#39;name&#39; has &quot;</span>
</span><span id="1-2634">                <span class="s2">&quot;been assigned.&quot;</span>
</span><span id="1-2635">            <span class="p">)</span>
</span><span id="1-2636">        <span class="k">try</span><span class="p">:</span>
</span><span id="1-2637">            <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_constructor</span><span class="p">(</span>
</span><span id="1-2638">                <span class="n">coercions</span><span class="o">.</span><span class="n">expect</span><span class="p">(</span>
</span><span id="1-2639">                    <span class="n">roles</span><span class="o">.</span><span class="n">TruncatedLabelRole</span><span class="p">,</span> <span class="n">name</span> <span class="k">if</span> <span class="n">name</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>
</span><span id="1-2640">                <span class="p">)</span>
</span><span id="1-2641">                <span class="k">if</span> <span class="n">name_is_truncatable</span>
</span><span id="1-2642">                <span class="k">else</span> <span class="p">(</span><span class="n">name</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">),</span>
</span><span id="1-2643">                <span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="p">,</span>
</span><span id="1-2644">                <span class="c1"># this may actually be ._proxy_key when the key is incoming</span>
</span><span id="1-2645">                <span class="n">key</span><span class="o">=</span><span class="n">key</span> <span class="k">if</span> <span class="n">key</span> <span class="k">else</span> <span class="n">name</span> <span class="k">if</span> <span class="n">name</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">,</span>
</span><span id="1-2646">                <span class="n">primary_key</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">primary_key</span><span class="p">,</span>
</span><span id="1-2647">                <span class="n">nullable</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">nullable</span><span class="p">,</span>
</span><span id="1-2648">                <span class="n">_proxies</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">compound_select_cols</span><span class="p">)</span>
</span><span id="1-2649">                <span class="k">if</span> <span class="n">compound_select_cols</span>
</span><span id="1-2650">                <span class="k">else</span> <span class="p">[</span><span class="bp">self</span><span class="p">],</span>
</span><span id="1-2651">                <span class="o">*</span><span class="n">fk</span><span class="p">,</span>
</span><span id="1-2652">            <span class="p">)</span>
</span><span id="1-2653">        <span class="k">except</span> <span class="ne">TypeError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
</span><span id="1-2654">            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
</span><span id="1-2655">                <span class="s2">&quot;Could not create a copy of this </span><span class="si">%r</span><span class="s2"> object.  &quot;</span>
</span><span id="1-2656">                <span class="s2">&quot;Ensure the class includes a _constructor() &quot;</span>
</span><span id="1-2657">                <span class="s2">&quot;attribute or method which accepts the &quot;</span>
</span><span id="1-2658">                <span class="s2">&quot;standard Column constructor arguments, or &quot;</span>
</span><span id="1-2659">                <span class="s2">&quot;references the Column class itself.&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span>
</span><span id="1-2660">            <span class="p">)</span> <span class="kn">from</span> <span class="nn">err</span>
</span><span id="1-2661">
</span><span id="1-2662">        <span class="n">c</span><span class="o">.</span><span class="n">table</span> <span class="o">=</span> <span class="n">selectable</span>
</span><span id="1-2663">        <span class="n">c</span><span class="o">.</span><span class="n">_propagate_attrs</span> <span class="o">=</span> <span class="n">selectable</span><span class="o">.</span><span class="n">_propagate_attrs</span>
</span><span id="1-2664">        <span class="k">if</span> <span class="n">selectable</span><span class="o">.</span><span class="n">_is_clone_of</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-2665">            <span class="n">c</span><span class="o">.</span><span class="n">_is_clone_of</span> <span class="o">=</span> <span class="n">selectable</span><span class="o">.</span><span class="n">_is_clone_of</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">key</span><span class="p">)</span>
</span><span id="1-2666">        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">primary_key</span><span class="p">:</span>
</span><span id="1-2667">            <span class="n">selectable</span><span class="o">.</span><span class="n">primary_key</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>  <span class="c1"># type: ignore</span>
</span><span id="1-2668">        <span class="k">if</span> <span class="n">fk</span><span class="p">:</span>
</span><span id="1-2669">            <span class="n">selectable</span><span class="o">.</span><span class="n">foreign_keys</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">fk</span><span class="p">)</span>  <span class="c1"># type: ignore</span>
</span><span id="1-2670">        <span class="k">return</span> <span class="n">c</span><span class="o">.</span><span class="n">key</span><span class="p">,</span> <span class="n">c</span>
</span><span id="1-2671">
</span><span id="1-2672">
</span><span id="1-2673"><span class="k">def</span> <span class="nf">insert_sentinel</span><span class="p">(</span>
</span><span id="1-2674">    <span class="n">name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="1-2675">    <span class="n">type_</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">_TypeEngineArgument</span><span class="p">[</span><span class="n">_T</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="1-2676">    <span class="o">*</span><span class="p">,</span>
</span><span id="1-2677">    <span class="n">default</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="1-2678">    <span class="n">omit_from_statements</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="1-2679"><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Column</span><span class="p">[</span><span class="n">Any</span><span class="p">]:</span>
</span><span id="1-2680"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Provides a surrogate :class:`_schema.Column` that will act as a</span>
</span><span id="1-2681"><span class="sd">    dedicated insert :term:`sentinel` column, allowing efficient bulk</span>
</span><span id="1-2682"><span class="sd">    inserts with deterministic RETURNING sorting for tables that</span>
</span><span id="1-2683"><span class="sd">    don&#39;t otherwise have qualifying primary key configurations.</span>
</span><span id="1-2684">
</span><span id="1-2685"><span class="sd">    Adding this column to a :class:`.Table` object requires that a</span>
</span><span id="1-2686"><span class="sd">    corresponding database table actually has this column present, so if adding</span>
</span><span id="1-2687"><span class="sd">    it to an existing model, existing database tables would need to be migrated</span>
</span><span id="1-2688"><span class="sd">    (e.g. using ALTER TABLE or similar) to include this column.</span>
</span><span id="1-2689">
</span><span id="1-2690"><span class="sd">    For background on how this object is used, see the section</span>
</span><span id="1-2691"><span class="sd">    :ref:`engine_insertmanyvalues_sentinel_columns` as part of the</span>
</span><span id="1-2692"><span class="sd">    section :ref:`engine_insertmanyvalues`.</span>
</span><span id="1-2693">
</span><span id="1-2694"><span class="sd">    The :class:`_schema.Column` returned will be a nullable integer column by</span>
</span><span id="1-2695"><span class="sd">    default and make use of a sentinel-specific default generator used only in</span>
</span><span id="1-2696"><span class="sd">    &quot;insertmanyvalues&quot; operations.</span>
</span><span id="1-2697">
</span><span id="1-2698"><span class="sd">    .. seealso::</span>
</span><span id="1-2699">
</span><span id="1-2700"><span class="sd">        :func:`_orm.orm_insert_sentinel`</span>
</span><span id="1-2701">
</span><span id="1-2702"><span class="sd">        :paramref:`_schema.Column.insert_sentinel`</span>
</span><span id="1-2703">
</span><span id="1-2704"><span class="sd">        :ref:`engine_insertmanyvalues`</span>
</span><span id="1-2705">
</span><span id="1-2706"><span class="sd">        :ref:`engine_insertmanyvalues_sentinel_columns`</span>
</span><span id="1-2707">
</span><span id="1-2708">
</span><span id="1-2709"><span class="sd">    .. versionadded:: 2.0.10</span>
</span><span id="1-2710">
</span><span id="1-2711"><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="1-2712">    <span class="k">return</span> <span class="n">Column</span><span class="p">(</span>
</span><span id="1-2713">        <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
</span><span id="1-2714">        <span class="n">type_</span><span class="o">=</span><span class="n">type_api</span><span class="o">.</span><span class="n">INTEGERTYPE</span> <span class="k">if</span> <span class="n">type_</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">type_</span><span class="p">,</span>
</span><span id="1-2715">        <span class="n">default</span><span class="o">=</span><span class="n">default</span>
</span><span id="1-2716">        <span class="k">if</span> <span class="n">default</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span id="1-2717">        <span class="k">else</span> <span class="n">_InsertSentinelColumnDefault</span><span class="p">(),</span>
</span><span id="1-2718">        <span class="n">_omit_from_statements</span><span class="o">=</span><span class="n">omit_from_statements</span><span class="p">,</span>
</span><span id="1-2719">        <span class="n">insert_sentinel</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="1-2720">    <span class="p">)</span>
</span><span id="1-2721">
</span><span id="1-2722">
</span><span id="1-2723"><span class="k">class</span> <span class="nc">ForeignKey</span><span class="p">(</span><span class="n">DialectKWArgs</span><span class="p">,</span> <span class="n">SchemaItem</span><span class="p">):</span>
</span><span id="1-2724"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Defines a dependency between two columns.</span>
</span><span id="1-2725">
</span><span id="1-2726"><span class="sd">    ``ForeignKey`` is specified as an argument to a :class:`_schema.Column`</span>
</span><span id="1-2727"><span class="sd">    object,</span>
</span><span id="1-2728"><span class="sd">    e.g.::</span>
</span><span id="1-2729">
</span><span id="1-2730"><span class="sd">        t = Table(&quot;remote_table&quot;, metadata,</span>
</span><span id="1-2731"><span class="sd">            Column(&quot;remote_id&quot;, ForeignKey(&quot;main_table.id&quot;))</span>
</span><span id="1-2732"><span class="sd">        )</span>
</span><span id="1-2733">
</span><span id="1-2734"><span class="sd">    Note that ``ForeignKey`` is only a marker object that defines</span>
</span><span id="1-2735"><span class="sd">    a dependency between two columns.   The actual constraint</span>
</span><span id="1-2736"><span class="sd">    is in all cases represented by the :class:`_schema.ForeignKeyConstraint`</span>
</span><span id="1-2737"><span class="sd">    object.   This object will be generated automatically when</span>
</span><span id="1-2738"><span class="sd">    a ``ForeignKey`` is associated with a :class:`_schema.Column` which</span>
</span><span id="1-2739"><span class="sd">    in turn is associated with a :class:`_schema.Table`.   Conversely,</span>
</span><span id="1-2740"><span class="sd">    when :class:`_schema.ForeignKeyConstraint` is applied to a</span>
</span><span id="1-2741"><span class="sd">    :class:`_schema.Table`,</span>
</span><span id="1-2742"><span class="sd">    ``ForeignKey`` markers are automatically generated to be</span>
</span><span id="1-2743"><span class="sd">    present on each associated :class:`_schema.Column`, which are also</span>
</span><span id="1-2744"><span class="sd">    associated with the constraint object.</span>
</span><span id="1-2745">
</span><span id="1-2746"><span class="sd">    Note that you cannot define a &quot;composite&quot; foreign key constraint,</span>
</span><span id="1-2747"><span class="sd">    that is a constraint between a grouping of multiple parent/child</span>
</span><span id="1-2748"><span class="sd">    columns, using ``ForeignKey`` objects.   To define this grouping,</span>
</span><span id="1-2749"><span class="sd">    the :class:`_schema.ForeignKeyConstraint` object must be used, and applied</span>
</span><span id="1-2750"><span class="sd">    to the :class:`_schema.Table`.   The associated ``ForeignKey`` objects</span>
</span><span id="1-2751"><span class="sd">    are created automatically.</span>
</span><span id="1-2752">
</span><span id="1-2753"><span class="sd">    The ``ForeignKey`` objects associated with an individual</span>
</span><span id="1-2754"><span class="sd">    :class:`_schema.Column`</span>
</span><span id="1-2755"><span class="sd">    object are available in the `foreign_keys` collection</span>
</span><span id="1-2756"><span class="sd">    of that column.</span>
</span><span id="1-2757">
</span><span id="1-2758"><span class="sd">    Further examples of foreign key configuration are in</span>
</span><span id="1-2759"><span class="sd">    :ref:`metadata_foreignkeys`.</span>
</span><span id="1-2760">
</span><span id="1-2761"><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="1-2762">
</span><span id="1-2763">    <span class="n">__visit_name__</span> <span class="o">=</span> <span class="s2">&quot;foreign_key&quot;</span>
</span><span id="1-2764">
</span><span id="1-2765">    <span class="n">parent</span><span class="p">:</span> <span class="n">Column</span><span class="p">[</span><span class="n">Any</span><span class="p">]</span>
</span><span id="1-2766">
</span><span id="1-2767">    <span class="n">_table_column</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Column</span><span class="p">[</span><span class="n">Any</span><span class="p">]]</span>
</span><span id="1-2768">
</span><span id="1-2769">    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
</span><span id="1-2770">        <span class="bp">self</span><span class="p">,</span>
</span><span id="1-2771">        <span class="n">column</span><span class="p">:</span> <span class="n">_DDLColumnArgument</span><span class="p">,</span>
</span><span id="1-2772">        <span class="n">_constraint</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ForeignKeyConstraint</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="1-2773">        <span class="n">use_alter</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="1-2774">        <span class="n">name</span><span class="p">:</span> <span class="n">_ConstraintNameArgument</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="1-2775">        <span class="n">onupdate</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="1-2776">        <span class="n">ondelete</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="1-2777">        <span class="n">deferrable</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="1-2778">        <span class="n">initially</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="1-2779">        <span class="n">link_to_name</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="1-2780">        <span class="n">match</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="1-2781">        <span class="n">info</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">_InfoType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="1-2782">        <span class="n">comment</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="1-2783">        <span class="n">_unresolvable</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="1-2784">        <span class="o">**</span><span class="n">dialect_kw</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
</span><span id="1-2785">    <span class="p">):</span>
</span><span id="1-2786"><span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="1-2787"><span class="sd">        Construct a column-level FOREIGN KEY.</span>
</span><span id="1-2788">
</span><span id="1-2789"><span class="sd">        The :class:`_schema.ForeignKey` object when constructed generates a</span>
</span><span id="1-2790"><span class="sd">        :class:`_schema.ForeignKeyConstraint`</span>
</span><span id="1-2791"><span class="sd">        which is associated with the parent</span>
</span><span id="1-2792"><span class="sd">        :class:`_schema.Table` object&#39;s collection of constraints.</span>
</span><span id="1-2793">
</span><span id="1-2794"><span class="sd">        :param column: A single target column for the key relationship. A</span>
</span><span id="1-2795"><span class="sd">            :class:`_schema.Column` object or a column name as a string:</span>
</span><span id="1-2796"><span class="sd">            ``tablename.columnkey`` or ``schema.tablename.columnkey``.</span>
</span><span id="1-2797"><span class="sd">            ``columnkey`` is the ``key`` which has been assigned to the column</span>
</span><span id="1-2798"><span class="sd">            (defaults to the column name itself), unless ``link_to_name`` is</span>
</span><span id="1-2799"><span class="sd">            ``True`` in which case the rendered name of the column is used.</span>
</span><span id="1-2800">
</span><span id="1-2801"><span class="sd">        :param name: Optional string. An in-database name for the key if</span>
</span><span id="1-2802"><span class="sd">            `constraint` is not provided.</span>
</span><span id="1-2803">
</span><span id="1-2804"><span class="sd">        :param onupdate: Optional string. If set, emit ON UPDATE &lt;value&gt; when</span>
</span><span id="1-2805"><span class="sd">            issuing DDL for this constraint. Typical values include CASCADE,</span>
</span><span id="1-2806"><span class="sd">            DELETE and RESTRICT.</span>
</span><span id="1-2807">
</span><span id="1-2808"><span class="sd">        :param ondelete: Optional string. If set, emit ON DELETE &lt;value&gt; when</span>
</span><span id="1-2809"><span class="sd">            issuing DDL for this constraint. Typical values include CASCADE,</span>
</span><span id="1-2810"><span class="sd">            DELETE and RESTRICT.</span>
</span><span id="1-2811">
</span><span id="1-2812"><span class="sd">        :param deferrable: Optional bool. If set, emit DEFERRABLE or NOT</span>
</span><span id="1-2813"><span class="sd">            DEFERRABLE when issuing DDL for this constraint.</span>
</span><span id="1-2814">
</span><span id="1-2815"><span class="sd">        :param initially: Optional string. If set, emit INITIALLY &lt;value&gt; when</span>
</span><span id="1-2816"><span class="sd">            issuing DDL for this constraint.</span>
</span><span id="1-2817">
</span><span id="1-2818"><span class="sd">        :param link_to_name: if True, the string name given in ``column`` is</span>
</span><span id="1-2819"><span class="sd">            the rendered name of the referenced column, not its locally</span>
</span><span id="1-2820"><span class="sd">            assigned ``key``.</span>
</span><span id="1-2821">
</span><span id="1-2822"><span class="sd">        :param use_alter: passed to the underlying</span>
</span><span id="1-2823"><span class="sd">            :class:`_schema.ForeignKeyConstraint`</span>
</span><span id="1-2824"><span class="sd">            to indicate the constraint should</span>
</span><span id="1-2825"><span class="sd">            be generated/dropped externally from the CREATE TABLE/ DROP TABLE</span>
</span><span id="1-2826"><span class="sd">            statement.  See :paramref:`_schema.ForeignKeyConstraint.use_alter`</span>
</span><span id="1-2827"><span class="sd">            for further description.</span>
</span><span id="1-2828">
</span><span id="1-2829"><span class="sd">            .. seealso::</span>
</span><span id="1-2830">
</span><span id="1-2831"><span class="sd">                :paramref:`_schema.ForeignKeyConstraint.use_alter`</span>
</span><span id="1-2832">
</span><span id="1-2833"><span class="sd">                :ref:`use_alter`</span>
</span><span id="1-2834">
</span><span id="1-2835"><span class="sd">        :param match: Optional string. If set, emit MATCH &lt;value&gt; when issuing</span>
</span><span id="1-2836"><span class="sd">            DDL for this constraint. Typical values include SIMPLE, PARTIAL</span>
</span><span id="1-2837"><span class="sd">            and FULL.</span>
</span><span id="1-2838">
</span><span id="1-2839"><span class="sd">        :param info: Optional data dictionary which will be populated into the</span>
</span><span id="1-2840"><span class="sd">            :attr:`.SchemaItem.info` attribute of this object.</span>
</span><span id="1-2841">
</span><span id="1-2842"><span class="sd">        :param comment: Optional string that will render an SQL comment on</span>
</span><span id="1-2843"><span class="sd">          foreign key constraint creation.</span>
</span><span id="1-2844">
</span><span id="1-2845"><span class="sd">            .. versionadded:: 2.0</span>
</span><span id="1-2846">
</span><span id="1-2847"><span class="sd">        :param \**dialect_kw:  Additional keyword arguments are dialect</span>
</span><span id="1-2848"><span class="sd">            specific, and passed in the form ``&lt;dialectname&gt;_&lt;argname&gt;``.  The</span>
</span><span id="1-2849"><span class="sd">            arguments are ultimately handled by a corresponding</span>
</span><span id="1-2850"><span class="sd">            :class:`_schema.ForeignKeyConstraint`.</span>
</span><span id="1-2851"><span class="sd">            See the documentation regarding</span>
</span><span id="1-2852"><span class="sd">            an individual dialect at :ref:`dialect_toplevel` for detail on</span>
</span><span id="1-2853"><span class="sd">            documented arguments.</span>
</span><span id="1-2854">
</span><span id="1-2855"><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="1-2856">
</span><span id="1-2857">        <span class="bp">self</span><span class="o">.</span><span class="n">_colspec</span> <span class="o">=</span> <span class="n">coercions</span><span class="o">.</span><span class="n">expect</span><span class="p">(</span><span class="n">roles</span><span class="o">.</span><span class="n">DDLReferredColumnRole</span><span class="p">,</span> <span class="n">column</span><span class="p">)</span>
</span><span id="1-2858">        <span class="bp">self</span><span class="o">.</span><span class="n">_unresolvable</span> <span class="o">=</span> <span class="n">_unresolvable</span>
</span><span id="1-2859">
</span><span id="1-2860">        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_colspec</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="1-2861">            <span class="bp">self</span><span class="o">.</span><span class="n">_table_column</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="1-2862">        <span class="k">else</span><span class="p">:</span>
</span><span id="1-2863">            <span class="bp">self</span><span class="o">.</span><span class="n">_table_column</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_colspec</span>
</span><span id="1-2864">
</span><span id="1-2865">            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span>
</span><span id="1-2866">                <span class="bp">self</span><span class="o">.</span><span class="n">_table_column</span><span class="o">.</span><span class="n">table</span><span class="p">,</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="kc">None</span><span class="p">),</span> <span class="n">TableClause</span><span class="p">)</span>
</span><span id="1-2867">            <span class="p">):</span>
</span><span id="1-2868">                <span class="k">raise</span> <span class="n">exc</span><span class="o">.</span><span class="n">ArgumentError</span><span class="p">(</span>
</span><span id="1-2869">                    <span class="s2">&quot;ForeignKey received Column not bound &quot;</span>
</span><span id="1-2870">                    <span class="s2">&quot;to a Table, got: </span><span class="si">%r</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">_table_column</span><span class="o">.</span><span class="n">table</span>
</span><span id="1-2871">                <span class="p">)</span>
</span><span id="1-2872">
</span><span id="1-2873">        <span class="c1"># the linked ForeignKeyConstraint.</span>
</span><span id="1-2874">        <span class="c1"># ForeignKey will create this when parent Column</span>
</span><span id="1-2875">        <span class="c1"># is attached to a Table, *or* ForeignKeyConstraint</span>
</span><span id="1-2876">        <span class="c1"># object passes itself in when creating ForeignKey</span>
</span><span id="1-2877">        <span class="c1"># markers.</span>
</span><span id="1-2878">        <span class="bp">self</span><span class="o">.</span><span class="n">constraint</span> <span class="o">=</span> <span class="n">_constraint</span>
</span><span id="1-2879">
</span><span id="1-2880">        <span class="c1"># .parent is not Optional under normal use</span>
</span><span id="1-2881">        <span class="bp">self</span><span class="o">.</span><span class="n">parent</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># type: ignore</span>
</span><span id="1-2882">
</span><span id="1-2883">        <span class="bp">self</span><span class="o">.</span><span class="n">use_alter</span> <span class="o">=</span> <span class="n">use_alter</span>
</span><span id="1-2884">        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
</span><span id="1-2885">        <span class="bp">self</span><span class="o">.</span><span class="n">onupdate</span> <span class="o">=</span> <span class="n">onupdate</span>
</span><span id="1-2886">        <span class="bp">self</span><span class="o">.</span><span class="n">ondelete</span> <span class="o">=</span> <span class="n">ondelete</span>
</span><span id="1-2887">        <span class="bp">self</span><span class="o">.</span><span class="n">deferrable</span> <span class="o">=</span> <span class="n">deferrable</span>
</span><span id="1-2888">        <span class="bp">self</span><span class="o">.</span><span class="n">initially</span> <span class="o">=</span> <span class="n">initially</span>
</span><span id="1-2889">        <span class="bp">self</span><span class="o">.</span><span class="n">link_to_name</span> <span class="o">=</span> <span class="n">link_to_name</span>
</span><span id="1-2890">        <span class="bp">self</span><span class="o">.</span><span class="n">match</span> <span class="o">=</span> <span class="n">match</span>
</span><span id="1-2891">        <span class="bp">self</span><span class="o">.</span><span class="n">comment</span> <span class="o">=</span> <span class="n">comment</span>
</span><span id="1-2892">        <span class="k">if</span> <span class="n">info</span><span class="p">:</span>
</span><span id="1-2893">            <span class="bp">self</span><span class="o">.</span><span class="n">info</span> <span class="o">=</span> <span class="n">info</span>
</span><span id="1-2894">        <span class="bp">self</span><span class="o">.</span><span class="n">_unvalidated_dialect_kw</span> <span class="o">=</span> <span class="n">dialect_kw</span>
</span><span id="1-2895">
</span><span id="1-2896">    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="1-2897">        <span class="k">return</span> <span class="s2">&quot;ForeignKey(</span><span class="si">%r</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_colspec</span><span class="p">()</span>
</span><span id="1-2898">
</span><span id="1-2899">    <span class="nd">@util</span><span class="o">.</span><span class="n">deprecated</span><span class="p">(</span>
</span><span id="1-2900">        <span class="s2">&quot;1.4&quot;</span><span class="p">,</span>
</span><span id="1-2901">        <span class="s2">&quot;The :meth:`_schema.ForeignKey.copy` method is deprecated &quot;</span>
</span><span id="1-2902">        <span class="s2">&quot;and will be removed in a future release.&quot;</span><span class="p">,</span>
</span><span id="1-2903">    <span class="p">)</span>
</span><span id="1-2904">    <span class="k">def</span> <span class="nf">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">schema</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ForeignKey</span><span class="p">:</span>
</span><span id="1-2905">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_copy</span><span class="p">(</span><span class="n">schema</span><span class="o">=</span><span class="n">schema</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>
</span><span id="1-2906">
</span><span id="1-2907">    <span class="k">def</span> <span class="nf">_copy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">schema</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ForeignKey</span><span class="p">:</span>
</span><span id="1-2908"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Produce a copy of this :class:`_schema.ForeignKey` object.</span>
</span><span id="1-2909">
</span><span id="1-2910"><span class="sd">        The new :class:`_schema.ForeignKey` will not be bound</span>
</span><span id="1-2911"><span class="sd">        to any :class:`_schema.Column`.</span>
</span><span id="1-2912">
</span><span id="1-2913"><span class="sd">        This method is usually used by the internal</span>
</span><span id="1-2914"><span class="sd">        copy procedures of :class:`_schema.Column`, :class:`_schema.Table`,</span>
</span><span id="1-2915"><span class="sd">        and :class:`_schema.MetaData`.</span>
</span><span id="1-2916">
</span><span id="1-2917"><span class="sd">        :param schema: The returned :class:`_schema.ForeignKey` will</span>
</span><span id="1-2918"><span class="sd">          reference the original table and column name, qualified</span>
</span><span id="1-2919"><span class="sd">          by the given string schema name.</span>
</span><span id="1-2920">
</span><span id="1-2921"><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="1-2922">        <span class="n">fk</span> <span class="o">=</span> <span class="n">ForeignKey</span><span class="p">(</span>
</span><span id="1-2923">            <span class="bp">self</span><span class="o">.</span><span class="n">_get_colspec</span><span class="p">(</span><span class="n">schema</span><span class="o">=</span><span class="n">schema</span><span class="p">),</span>
</span><span id="1-2924">            <span class="n">use_alter</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">use_alter</span><span class="p">,</span>
</span><span id="1-2925">            <span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
</span><span id="1-2926">            <span class="n">onupdate</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">onupdate</span><span class="p">,</span>
</span><span id="1-2927">            <span class="n">ondelete</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ondelete</span><span class="p">,</span>
</span><span id="1-2928">            <span class="n">deferrable</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">deferrable</span><span class="p">,</span>
</span><span id="1-2929">            <span class="n">initially</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">initially</span><span class="p">,</span>
</span><span id="1-2930">            <span class="n">link_to_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">link_to_name</span><span class="p">,</span>
</span><span id="1-2931">            <span class="n">match</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">match</span><span class="p">,</span>
</span><span id="1-2932">            <span class="n">comment</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">comment</span><span class="p">,</span>
</span><span id="1-2933">            <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">_unvalidated_dialect_kw</span><span class="p">,</span>
</span><span id="1-2934">        <span class="p">)</span>
</span><span id="1-2935">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_schema_item_copy</span><span class="p">(</span><span class="n">fk</span><span class="p">)</span>
</span><span id="1-2936">
</span><span id="1-2937">    <span class="k">def</span> <span class="nf">_get_colspec</span><span class="p">(</span>
</span><span id="1-2938">        <span class="bp">self</span><span class="p">,</span>
</span><span id="1-2939">        <span class="n">schema</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span>
</span><span id="1-2940">            <span class="n">Union</span><span class="p">[</span>
</span><span id="1-2941">                <span class="nb">str</span><span class="p">,</span>
</span><span id="1-2942">                <span class="n">Literal</span><span class="p">[</span><span class="n">SchemaConst</span><span class="o">.</span><span class="n">RETAIN_SCHEMA</span><span class="p">,</span> <span class="n">SchemaConst</span><span class="o">.</span><span class="n">BLANK_SCHEMA</span><span class="p">],</span>
</span><span id="1-2943">            <span class="p">]</span>
</span><span id="1-2944">        <span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="1-2945">        <span class="n">table_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="1-2946">        <span class="n">_is_copy</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="1-2947">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="1-2948"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Return a string based &#39;column specification&#39; for this</span>
</span><span id="1-2949"><span class="sd">        :class:`_schema.ForeignKey`.</span>
</span><span id="1-2950">
</span><span id="1-2951"><span class="sd">        This is usually the equivalent of the string-based &quot;tablename.colname&quot;</span>
</span><span id="1-2952"><span class="sd">        argument first passed to the object&#39;s constructor.</span>
</span><span id="1-2953">
</span><span id="1-2954"><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="1-2955">        <span class="k">if</span> <span class="n">schema</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">RETAIN_SCHEMA</span><span class="p">):</span>
</span><span id="1-2956">            <span class="n">_schema</span><span class="p">,</span> <span class="n">tname</span><span class="p">,</span> <span class="n">colname</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_column_tokens</span>
</span><span id="1-2957">            <span class="k">if</span> <span class="n">table_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-2958">                <span class="n">tname</span> <span class="o">=</span> <span class="n">table_name</span>
</span><span id="1-2959">            <span class="k">if</span> <span class="n">schema</span> <span class="ow">is</span> <span class="n">BLANK_SCHEMA</span><span class="p">:</span>
</span><span id="1-2960">                <span class="k">return</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">.</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">tname</span><span class="p">,</span> <span class="n">colname</span><span class="p">)</span>
</span><span id="1-2961">            <span class="k">else</span><span class="p">:</span>
</span><span id="1-2962">                <span class="k">return</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">.</span><span class="si">%s</span><span class="s2">.</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">schema</span><span class="p">,</span> <span class="n">tname</span><span class="p">,</span> <span class="n">colname</span><span class="p">)</span>
</span><span id="1-2963">        <span class="k">elif</span> <span class="n">table_name</span><span class="p">:</span>
</span><span id="1-2964">            <span class="n">schema</span><span class="p">,</span> <span class="n">tname</span><span class="p">,</span> <span class="n">colname</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_column_tokens</span>
</span><span id="1-2965">            <span class="k">if</span> <span class="n">schema</span><span class="p">:</span>
</span><span id="1-2966">                <span class="k">return</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">.</span><span class="si">%s</span><span class="s2">.</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">schema</span><span class="p">,</span> <span class="n">table_name</span><span class="p">,</span> <span class="n">colname</span><span class="p">)</span>
</span><span id="1-2967">            <span class="k">else</span><span class="p">:</span>
</span><span id="1-2968">                <span class="k">return</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">.</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">table_name</span><span class="p">,</span> <span class="n">colname</span><span class="p">)</span>
</span><span id="1-2969">        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_table_column</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-2970">            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_table_column</span><span class="o">.</span><span class="n">table</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-2971">                <span class="k">if</span> <span class="n">_is_copy</span><span class="p">:</span>
</span><span id="1-2972">                    <span class="k">raise</span> <span class="n">exc</span><span class="o">.</span><span class="n">InvalidRequestError</span><span class="p">(</span>
</span><span id="1-2973">                        <span class="sa">f</span><span class="s2">&quot;Can&#39;t copy ForeignKey object which refers to &quot;</span>
</span><span id="1-2974">                        <span class="sa">f</span><span class="s2">&quot;non-table bound Column </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_table_column</span><span class="si">!r}</span><span class="s2">&quot;</span>
</span><span id="1-2975">                    <span class="p">)</span>
</span><span id="1-2976">                <span class="k">else</span><span class="p">:</span>
</span><span id="1-2977">                    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_table_column</span><span class="o">.</span><span class="n">key</span>
</span><span id="1-2978">            <span class="k">return</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">.</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span>
</span><span id="1-2979">                <span class="bp">self</span><span class="o">.</span><span class="n">_table_column</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">fullname</span><span class="p">,</span>
</span><span id="1-2980">                <span class="bp">self</span><span class="o">.</span><span class="n">_table_column</span><span class="o">.</span><span class="n">key</span><span class="p">,</span>
</span><span id="1-2981">            <span class="p">)</span>
</span><span id="1-2982">        <span class="k">else</span><span class="p">:</span>
</span><span id="1-2983">            <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_colspec</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span>
</span><span id="1-2984">            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_colspec</span>
</span><span id="1-2985">
</span><span id="1-2986">    <span class="nd">@property</span>
</span><span id="1-2987">    <span class="k">def</span> <span class="nf">_referred_schema</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
</span><span id="1-2988">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_column_tokens</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="1-2989">
</span><span id="1-2990">    <span class="k">def</span> <span class="nf">_table_key</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
</span><span id="1-2991">        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_table_column</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-2992">            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_table_column</span><span class="o">.</span><span class="n">table</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-2993">                <span class="k">return</span> <span class="kc">None</span>
</span><span id="1-2994">            <span class="k">else</span><span class="p">:</span>
</span><span id="1-2995">                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_table_column</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">key</span>
</span><span id="1-2996">        <span class="k">else</span><span class="p">:</span>
</span><span id="1-2997">            <span class="n">schema</span><span class="p">,</span> <span class="n">tname</span><span class="p">,</span> <span class="n">colname</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_column_tokens</span>
</span><span id="1-2998">            <span class="k">return</span> <span class="n">_get_table_key</span><span class="p">(</span><span class="n">tname</span><span class="p">,</span> <span class="n">schema</span><span class="p">)</span>
</span><span id="1-2999">
</span><span id="1-3000">    <span class="n">target_fullname</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">_get_colspec</span><span class="p">)</span>
</span><span id="1-3001">
</span><span id="1-3002">    <span class="k">def</span> <span class="nf">references</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">table</span><span class="p">:</span> <span class="n">Table</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="1-3003"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Return True if the given :class:`_schema.Table`</span>
</span><span id="1-3004"><span class="sd">        is referenced by this</span>
</span><span id="1-3005"><span class="sd">        :class:`_schema.ForeignKey`.&quot;&quot;&quot;</span>
</span><span id="1-3006">
</span><span id="1-3007">        <span class="k">return</span> <span class="n">table</span><span class="o">.</span><span class="n">corresponding_column</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">column</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span id="1-3008">
</span><span id="1-3009">    <span class="k">def</span> <span class="nf">get_referent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">table</span><span class="p">:</span> <span class="n">FromClause</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Column</span><span class="p">[</span><span class="n">Any</span><span class="p">]]:</span>
</span><span id="1-3010"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the :class:`_schema.Column` in the given</span>
</span><span id="1-3011"><span class="sd">        :class:`_schema.Table` (or any :class:`.FromClause`)</span>
</span><span id="1-3012"><span class="sd">        referenced by this :class:`_schema.ForeignKey`.</span>
</span><span id="1-3013">
</span><span id="1-3014"><span class="sd">        Returns None if this :class:`_schema.ForeignKey`</span>
</span><span id="1-3015"><span class="sd">        does not reference the given</span>
</span><span id="1-3016"><span class="sd">        :class:`_schema.Table`.</span>
</span><span id="1-3017">
</span><span id="1-3018"><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="1-3019">        <span class="c1"># our column is a Column, and any subquery etc. proxying us</span>
</span><span id="1-3020">        <span class="c1"># would be doing so via another Column, so that&#39;s what would</span>
</span><span id="1-3021">        <span class="c1"># be returned here</span>
</span><span id="1-3022">        <span class="k">return</span> <span class="n">table</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">corresponding_column</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">column</span><span class="p">)</span>  <span class="c1"># type: ignore</span>
</span><span id="1-3023">
</span><span id="1-3024">    <span class="nd">@util</span><span class="o">.</span><span class="n">memoized_property</span>
</span><span id="1-3025">    <span class="k">def</span> <span class="nf">_column_tokens</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="nb">str</span><span class="p">,</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]]:</span>
</span><span id="1-3026"><span class="w">        </span><span class="sd">&quot;&quot;&quot;parse a string-based _colspec into its component parts.&quot;&quot;&quot;</span>
</span><span id="1-3027">
</span><span id="1-3028">        <span class="n">m</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_colspec</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)</span>
</span><span id="1-3029">        <span class="k">if</span> <span class="n">m</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-3030">            <span class="k">raise</span> <span class="n">exc</span><span class="o">.</span><span class="n">ArgumentError</span><span class="p">(</span>
</span><span id="1-3031">                <span class="s2">&quot;Invalid foreign key column specification: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">_colspec</span>
</span><span id="1-3032">            <span class="p">)</span>
</span><span id="1-3033">        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">m</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="1-3034">            <span class="n">tname</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
</span><span id="1-3035">            <span class="n">colname</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="1-3036">        <span class="k">else</span><span class="p">:</span>
</span><span id="1-3037">            <span class="n">colname</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
</span><span id="1-3038">            <span class="n">tname</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
</span><span id="1-3039">
</span><span id="1-3040">        <span class="c1"># A FK between column &#39;bar&#39; and table &#39;foo&#39; can be</span>
</span><span id="1-3041">        <span class="c1"># specified as &#39;foo&#39;, &#39;foo.bar&#39;, &#39;dbo.foo.bar&#39;,</span>
</span><span id="1-3042">        <span class="c1"># &#39;otherdb.dbo.foo.bar&#39;. Once we have the column name and</span>
</span><span id="1-3043">        <span class="c1"># the table name, treat everything else as the schema</span>
</span><span id="1-3044">        <span class="c1"># name. Some databases (e.g. Sybase) support</span>
</span><span id="1-3045">        <span class="c1"># inter-database foreign keys. See tickets#1341 and --</span>
</span><span id="1-3046">        <span class="c1"># indirectly related -- Ticket #594. This assumes that &#39;.&#39;</span>
</span><span id="1-3047">        <span class="c1"># will never appear *within* any component of the FK.</span>
</span><span id="1-3048">
</span><span id="1-3049">        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">m</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="1-3050">            <span class="n">schema</span> <span class="o">=</span> <span class="s2">&quot;.&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
</span><span id="1-3051">        <span class="k">else</span><span class="p">:</span>
</span><span id="1-3052">            <span class="n">schema</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="1-3053">        <span class="k">return</span> <span class="n">schema</span><span class="p">,</span> <span class="n">tname</span><span class="p">,</span> <span class="n">colname</span>
</span><span id="1-3054">
</span><span id="1-3055">    <span class="k">def</span> <span class="nf">_resolve_col_tokens</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Table</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]]:</span>
</span><span id="1-3056">        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-3057">            <span class="k">raise</span> <span class="n">exc</span><span class="o">.</span><span class="n">InvalidRequestError</span><span class="p">(</span>
</span><span id="1-3058">                <span class="s2">&quot;this ForeignKey object does not yet have a &quot;</span>
</span><span id="1-3059">                <span class="s2">&quot;parent Column associated with it.&quot;</span>
</span><span id="1-3060">            <span class="p">)</span>
</span><span id="1-3061">
</span><span id="1-3062">        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">table</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-3063">            <span class="k">raise</span> <span class="n">exc</span><span class="o">.</span><span class="n">InvalidRequestError</span><span class="p">(</span>
</span><span id="1-3064">                <span class="s2">&quot;this ForeignKey&#39;s parent column is not yet associated &quot;</span>
</span><span id="1-3065">                <span class="s2">&quot;with a Table.&quot;</span>
</span><span id="1-3066">            <span class="p">)</span>
</span><span id="1-3067">
</span><span id="1-3068">        <span class="n">parenttable</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">table</span>
</span><span id="1-3069">
</span><span id="1-3070">        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_unresolvable</span><span class="p">:</span>
</span><span id="1-3071">            <span class="n">schema</span><span class="p">,</span> <span class="n">tname</span><span class="p">,</span> <span class="n">colname</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_column_tokens</span>
</span><span id="1-3072">            <span class="n">tablekey</span> <span class="o">=</span> <span class="n">_get_table_key</span><span class="p">(</span><span class="n">tname</span><span class="p">,</span> <span class="n">schema</span><span class="p">)</span>
</span><span id="1-3073">            <span class="k">return</span> <span class="n">parenttable</span><span class="p">,</span> <span class="n">tablekey</span><span class="p">,</span> <span class="n">colname</span>
</span><span id="1-3074">
</span><span id="1-3075">        <span class="c1"># assertion</span>
</span><span id="1-3076">        <span class="c1"># basically Column._make_proxy() sends the actual</span>
</span><span id="1-3077">        <span class="c1"># target Column to the ForeignKey object, so the</span>
</span><span id="1-3078">        <span class="c1"># string resolution here is never called.</span>
</span><span id="1-3079">        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">base_columns</span><span class="p">:</span>
</span><span id="1-3080">            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">Column</span><span class="p">):</span>
</span><span id="1-3081">                <span class="k">assert</span> <span class="n">c</span><span class="o">.</span><span class="n">table</span> <span class="ow">is</span> <span class="n">parenttable</span>
</span><span id="1-3082">                <span class="k">break</span>
</span><span id="1-3083">        <span class="k">else</span><span class="p">:</span>
</span><span id="1-3084">            <span class="k">assert</span> <span class="kc">False</span>
</span><span id="1-3085">        <span class="c1">######################</span>
</span><span id="1-3086">
</span><span id="1-3087">        <span class="n">schema</span><span class="p">,</span> <span class="n">tname</span><span class="p">,</span> <span class="n">colname</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_column_tokens</span>
</span><span id="1-3088">
</span><span id="1-3089">        <span class="k">if</span> <span class="n">schema</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">parenttable</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">schema</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-3090">            <span class="n">schema</span> <span class="o">=</span> <span class="n">parenttable</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">schema</span>
</span><span id="1-3091">
</span><span id="1-3092">        <span class="n">tablekey</span> <span class="o">=</span> <span class="n">_get_table_key</span><span class="p">(</span><span class="n">tname</span><span class="p">,</span> <span class="n">schema</span><span class="p">)</span>
</span><span id="1-3093">        <span class="k">return</span> <span class="n">parenttable</span><span class="p">,</span> <span class="n">tablekey</span><span class="p">,</span> <span class="n">colname</span>
</span><span id="1-3094">
</span><span id="1-3095">    <span class="k">def</span> <span class="nf">_link_to_col_by_colstring</span><span class="p">(</span>
</span><span id="1-3096">        <span class="bp">self</span><span class="p">,</span> <span class="n">parenttable</span><span class="p">:</span> <span class="n">Table</span><span class="p">,</span> <span class="n">table</span><span class="p">:</span> <span class="n">Table</span><span class="p">,</span> <span class="n">colname</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
</span><span id="1-3097">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Column</span><span class="p">[</span><span class="n">Any</span><span class="p">]:</span>
</span><span id="1-3098">        <span class="n">_column</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="1-3099">        <span class="k">if</span> <span class="n">colname</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-3100">            <span class="c1"># colname is None in the case that ForeignKey argument</span>
</span><span id="1-3101">            <span class="c1"># was specified as table name only, in which case we</span>
</span><span id="1-3102">            <span class="c1"># match the column name to the same column on the</span>
</span><span id="1-3103">            <span class="c1"># parent.</span>
</span><span id="1-3104">            <span class="c1"># this use case wasn&#39;t working in later 1.x series</span>
</span><span id="1-3105">            <span class="c1"># as it had no test coverage; fixed in 2.0</span>
</span><span id="1-3106">            <span class="n">parent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span>
</span><span id="1-3107">            <span class="k">assert</span> <span class="n">parent</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span id="1-3108">            <span class="n">key</span> <span class="o">=</span> <span class="n">parent</span><span class="o">.</span><span class="n">key</span>
</span><span id="1-3109">            <span class="n">_column</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="1-3110">        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">link_to_name</span><span class="p">:</span>
</span><span id="1-3111">            <span class="n">key</span> <span class="o">=</span> <span class="n">colname</span>
</span><span id="1-3112">            <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">table</span><span class="o">.</span><span class="n">c</span><span class="p">:</span>
</span><span id="1-3113">                <span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">colname</span><span class="p">:</span>
</span><span id="1-3114">                    <span class="n">_column</span> <span class="o">=</span> <span class="n">c</span>
</span><span id="1-3115">        <span class="k">else</span><span class="p">:</span>
</span><span id="1-3116">            <span class="n">key</span> <span class="o">=</span> <span class="n">colname</span>
</span><span id="1-3117">            <span class="n">_column</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">colname</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="1-3118">
</span><span id="1-3119">        <span class="k">if</span> <span class="n">_column</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-3120">            <span class="k">raise</span> <span class="n">exc</span><span class="o">.</span><span class="n">NoReferencedColumnError</span><span class="p">(</span>
</span><span id="1-3121">                <span class="s2">&quot;Could not initialize target column &quot;</span>
</span><span id="1-3122">                <span class="s2">&quot;for ForeignKey &#39;</span><span class="si">%s</span><span class="s2">&#39; on table &#39;</span><span class="si">%s</span><span class="s2">&#39;: &quot;</span>
</span><span id="1-3123">                <span class="s2">&quot;table &#39;</span><span class="si">%s</span><span class="s2">&#39; has no column named &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span>
</span><span id="1-3124">                <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_colspec</span><span class="p">,</span> <span class="n">parenttable</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">table</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">key</span><span class="p">),</span>
</span><span id="1-3125">                <span class="n">table</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
</span><span id="1-3126">                <span class="n">key</span><span class="p">,</span>
</span><span id="1-3127">            <span class="p">)</span>
</span><span id="1-3128">
</span><span id="1-3129">        <span class="k">return</span> <span class="n">_column</span>
</span><span id="1-3130">
</span><span id="1-3131">    <span class="k">def</span> <span class="nf">_set_target_column</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">column</span><span class="p">:</span> <span class="n">Column</span><span class="p">[</span><span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-3132">        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span id="1-3133">
</span><span id="1-3134">        <span class="c1"># propagate TypeEngine to parent if it didn&#39;t have one</span>
</span><span id="1-3135">        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">type</span><span class="o">.</span><span class="n">_isnull</span><span class="p">:</span>
</span><span id="1-3136">            <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="n">column</span><span class="o">.</span><span class="n">type</span>
</span><span id="1-3137">
</span><span id="1-3138">        <span class="c1"># super-edgy case, if other FKs point to our column,</span>
</span><span id="1-3139">        <span class="c1"># they&#39;d get the type propagated out also.</span>
</span><span id="1-3140">
</span><span id="1-3141">        <span class="k">def</span> <span class="nf">set_type</span><span class="p">(</span><span class="n">fk</span><span class="p">:</span> <span class="n">ForeignKey</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-3142">            <span class="k">if</span> <span class="n">fk</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">type</span><span class="o">.</span><span class="n">_isnull</span><span class="p">:</span>
</span><span id="1-3143">                <span class="n">fk</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="n">column</span><span class="o">.</span><span class="n">type</span>
</span><span id="1-3144">
</span><span id="1-3145">        <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">_setup_on_memoized_fks</span><span class="p">(</span><span class="n">set_type</span><span class="p">)</span>
</span><span id="1-3146">
</span><span id="1-3147">        <span class="bp">self</span><span class="o">.</span><span class="n">column</span> <span class="o">=</span> <span class="n">column</span>  <span class="c1"># type: ignore</span>
</span><span id="1-3148">
</span><span id="1-3149">    <span class="nd">@util</span><span class="o">.</span><span class="n">ro_memoized_property</span>
</span><span id="1-3150">    <span class="k">def</span> <span class="nf">column</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Column</span><span class="p">[</span><span class="n">Any</span><span class="p">]:</span>
</span><span id="1-3151"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the target :class:`_schema.Column` referenced by this</span>
</span><span id="1-3152"><span class="sd">        :class:`_schema.ForeignKey`.</span>
</span><span id="1-3153">
</span><span id="1-3154"><span class="sd">        If no target column has been established, an exception</span>
</span><span id="1-3155"><span class="sd">        is raised.</span>
</span><span id="1-3156">
</span><span id="1-3157"><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="1-3158">
</span><span id="1-3159">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_resolve_column</span><span class="p">()</span>
</span><span id="1-3160">
</span><span id="1-3161">    <span class="nd">@overload</span>
</span><span id="1-3162">    <span class="k">def</span> <span class="nf">_resolve_column</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">raiseerr</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="kc">True</span><span class="p">]</span> <span class="o">=</span> <span class="o">...</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Column</span><span class="p">[</span><span class="n">Any</span><span class="p">]:</span>
</span><span id="1-3163">        <span class="o">...</span>
</span><span id="1-3164">
</span><span id="1-3165">    <span class="nd">@overload</span>
</span><span id="1-3166">    <span class="k">def</span> <span class="nf">_resolve_column</span><span class="p">(</span>
</span><span id="1-3167">        <span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">raiseerr</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="o">...</span>
</span><span id="1-3168">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Column</span><span class="p">[</span><span class="n">Any</span><span class="p">]]:</span>
</span><span id="1-3169">        <span class="o">...</span>
</span><span id="1-3170">
</span><span id="1-3171">    <span class="k">def</span> <span class="nf">_resolve_column</span><span class="p">(</span>
</span><span id="1-3172">        <span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">raiseerr</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="1-3173">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Column</span><span class="p">[</span><span class="n">Any</span><span class="p">]]:</span>
</span><span id="1-3174">        <span class="n">_column</span><span class="p">:</span> <span class="n">Column</span><span class="p">[</span><span class="n">Any</span><span class="p">]</span>
</span><span id="1-3175">
</span><span id="1-3176">        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_colspec</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="1-3177">            <span class="n">parenttable</span><span class="p">,</span> <span class="n">tablekey</span><span class="p">,</span> <span class="n">colname</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_resolve_col_tokens</span><span class="p">()</span>
</span><span id="1-3178">
</span><span id="1-3179">            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_unresolvable</span> <span class="ow">or</span> <span class="n">tablekey</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">parenttable</span><span class="o">.</span><span class="n">metadata</span><span class="p">:</span>
</span><span id="1-3180">                <span class="k">if</span> <span class="ow">not</span> <span class="n">raiseerr</span><span class="p">:</span>
</span><span id="1-3181">                    <span class="k">return</span> <span class="kc">None</span>
</span><span id="1-3182">                <span class="k">raise</span> <span class="n">exc</span><span class="o">.</span><span class="n">NoReferencedTableError</span><span class="p">(</span>
</span><span id="1-3183">                    <span class="s2">&quot;Foreign key associated with column &#39;</span><span class="si">%s</span><span class="s2">&#39; could not find &quot;</span>
</span><span id="1-3184">                    <span class="s2">&quot;table &#39;</span><span class="si">%s</span><span class="s2">&#39; with which to generate a &quot;</span>
</span><span id="1-3185">                    <span class="s2">&quot;foreign key to target column &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span>
</span><span id="1-3186">                    <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="p">,</span> <span class="n">tablekey</span><span class="p">,</span> <span class="n">colname</span><span class="p">),</span>
</span><span id="1-3187">                    <span class="n">tablekey</span><span class="p">,</span>
</span><span id="1-3188">                <span class="p">)</span>
</span><span id="1-3189">            <span class="k">elif</span> <span class="n">parenttable</span><span class="o">.</span><span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">parenttable</span><span class="o">.</span><span class="n">metadata</span><span class="p">:</span>
</span><span id="1-3190">                <span class="k">if</span> <span class="ow">not</span> <span class="n">raiseerr</span><span class="p">:</span>
</span><span id="1-3191">                    <span class="k">return</span> <span class="kc">None</span>
</span><span id="1-3192">                <span class="k">raise</span> <span class="n">exc</span><span class="o">.</span><span class="n">InvalidRequestError</span><span class="p">(</span>
</span><span id="1-3193">                    <span class="s2">&quot;Table </span><span class="si">%s</span><span class="s2"> is no longer associated with its &quot;</span>
</span><span id="1-3194">                    <span class="s2">&quot;parent MetaData&quot;</span> <span class="o">%</span> <span class="n">parenttable</span>
</span><span id="1-3195">                <span class="p">)</span>
</span><span id="1-3196">            <span class="k">else</span><span class="p">:</span>
</span><span id="1-3197">                <span class="n">table</span> <span class="o">=</span> <span class="n">parenttable</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">tables</span><span class="p">[</span><span class="n">tablekey</span><span class="p">]</span>
</span><span id="1-3198">                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_link_to_col_by_colstring</span><span class="p">(</span>
</span><span id="1-3199">                    <span class="n">parenttable</span><span class="p">,</span> <span class="n">table</span><span class="p">,</span> <span class="n">colname</span>
</span><span id="1-3200">                <span class="p">)</span>
</span><span id="1-3201">
</span><span id="1-3202">        <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_colspec</span><span class="p">,</span> <span class="s2">&quot;__clause_element__&quot;</span><span class="p">):</span>
</span><span id="1-3203">            <span class="n">_column</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_colspec</span><span class="o">.</span><span class="n">__clause_element__</span><span class="p">()</span>
</span><span id="1-3204">            <span class="k">return</span> <span class="n">_column</span>
</span><span id="1-3205">        <span class="k">else</span><span class="p">:</span>
</span><span id="1-3206">            <span class="n">_column</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_colspec</span>
</span><span id="1-3207">            <span class="k">return</span> <span class="n">_column</span>
</span><span id="1-3208">
</span><span id="1-3209">    <span class="k">def</span> <span class="nf">_set_parent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">:</span> <span class="n">SchemaEventTarget</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-3210">        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">parent</span><span class="p">,</span> <span class="n">Column</span><span class="p">)</span>
</span><span id="1-3211">
</span><span id="1-3212">        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">parent</span><span class="p">:</span>
</span><span id="1-3213">            <span class="k">raise</span> <span class="n">exc</span><span class="o">.</span><span class="n">InvalidRequestError</span><span class="p">(</span>
</span><span id="1-3214">                <span class="s2">&quot;This ForeignKey already has a parent !&quot;</span>
</span><span id="1-3215">            <span class="p">)</span>
</span><span id="1-3216">        <span class="bp">self</span><span class="o">.</span><span class="n">parent</span> <span class="o">=</span> <span class="n">parent</span>
</span><span id="1-3217">        <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">foreign_keys</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span><span id="1-3218">        <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">_on_table_attach</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_set_table</span><span class="p">)</span>
</span><span id="1-3219">
</span><span id="1-3220">    <span class="k">def</span> <span class="nf">_set_remote_table</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">table</span><span class="p">:</span> <span class="n">Table</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-3221">        <span class="n">parenttable</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">colname</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_resolve_col_tokens</span><span class="p">()</span>
</span><span id="1-3222">        <span class="n">_column</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_link_to_col_by_colstring</span><span class="p">(</span><span class="n">parenttable</span><span class="p">,</span> <span class="n">table</span><span class="p">,</span> <span class="n">colname</span><span class="p">)</span>
</span><span id="1-3223">        <span class="bp">self</span><span class="o">.</span><span class="n">_set_target_column</span><span class="p">(</span><span class="n">_column</span><span class="p">)</span>
</span><span id="1-3224">        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">constraint</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span id="1-3225">        <span class="bp">self</span><span class="o">.</span><span class="n">constraint</span><span class="o">.</span><span class="n">_validate_dest_table</span><span class="p">(</span><span class="n">table</span><span class="p">)</span>
</span><span id="1-3226">
</span><span id="1-3227">    <span class="k">def</span> <span class="nf">_remove_from_metadata</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">metadata</span><span class="p">:</span> <span class="n">MetaData</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-3228">        <span class="n">parenttable</span><span class="p">,</span> <span class="n">table_key</span><span class="p">,</span> <span class="n">colname</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_resolve_col_tokens</span><span class="p">()</span>
</span><span id="1-3229">        <span class="n">fk_key</span> <span class="o">=</span> <span class="p">(</span><span class="n">table_key</span><span class="p">,</span> <span class="n">colname</span><span class="p">)</span>
</span><span id="1-3230">
</span><span id="1-3231">        <span class="k">if</span> <span class="bp">self</span> <span class="ow">in</span> <span class="n">metadata</span><span class="o">.</span><span class="n">_fk_memos</span><span class="p">[</span><span class="n">fk_key</span><span class="p">]:</span>
</span><span id="1-3232">            <span class="c1"># TODO: no test coverage for self not in memos</span>
</span><span id="1-3233">            <span class="n">metadata</span><span class="o">.</span><span class="n">_fk_memos</span><span class="p">[</span><span class="n">fk_key</span><span class="p">]</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span><span id="1-3234">
</span><span id="1-3235">    <span class="k">def</span> <span class="nf">_set_table</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">column</span><span class="p">:</span> <span class="n">Column</span><span class="p">[</span><span class="n">Any</span><span class="p">],</span> <span class="n">table</span><span class="p">:</span> <span class="n">Table</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-3236">        <span class="c1"># standalone ForeignKey - create ForeignKeyConstraint</span>
</span><span id="1-3237">        <span class="c1"># on the hosting Table when attached to the Table.</span>
</span><span id="1-3238">        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">table</span><span class="p">,</span> <span class="n">Table</span><span class="p">)</span>
</span><span id="1-3239">        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">constraint</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-3240">            <span class="bp">self</span><span class="o">.</span><span class="n">constraint</span> <span class="o">=</span> <span class="n">ForeignKeyConstraint</span><span class="p">(</span>
</span><span id="1-3241">                <span class="p">[],</span>
</span><span id="1-3242">                <span class="p">[],</span>
</span><span id="1-3243">                <span class="n">use_alter</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">use_alter</span><span class="p">,</span>
</span><span id="1-3244">                <span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
</span><span id="1-3245">                <span class="n">onupdate</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">onupdate</span><span class="p">,</span>
</span><span id="1-3246">                <span class="n">ondelete</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ondelete</span><span class="p">,</span>
</span><span id="1-3247">                <span class="n">deferrable</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">deferrable</span><span class="p">,</span>
</span><span id="1-3248">                <span class="n">initially</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">initially</span><span class="p">,</span>
</span><span id="1-3249">                <span class="n">match</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">match</span><span class="p">,</span>
</span><span id="1-3250">                <span class="n">comment</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">comment</span><span class="p">,</span>
</span><span id="1-3251">                <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">_unvalidated_dialect_kw</span><span class="p">,</span>
</span><span id="1-3252">            <span class="p">)</span>
</span><span id="1-3253">            <span class="bp">self</span><span class="o">.</span><span class="n">constraint</span><span class="o">.</span><span class="n">_append_element</span><span class="p">(</span><span class="n">column</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
</span><span id="1-3254">            <span class="bp">self</span><span class="o">.</span><span class="n">constraint</span><span class="o">.</span><span class="n">_set_parent_with_dispatch</span><span class="p">(</span><span class="n">table</span><span class="p">)</span>
</span><span id="1-3255">        <span class="n">table</span><span class="o">.</span><span class="n">foreign_keys</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span><span id="1-3256">        <span class="c1"># set up remote &quot;.column&quot; attribute, or a note to pick it</span>
</span><span id="1-3257">        <span class="c1"># up when the other Table/Column shows up</span>
</span><span id="1-3258">        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_colspec</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="1-3259">            <span class="n">parenttable</span><span class="p">,</span> <span class="n">table_key</span><span class="p">,</span> <span class="n">colname</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_resolve_col_tokens</span><span class="p">()</span>
</span><span id="1-3260">            <span class="n">fk_key</span> <span class="o">=</span> <span class="p">(</span><span class="n">table_key</span><span class="p">,</span> <span class="n">colname</span><span class="p">)</span>
</span><span id="1-3261">            <span class="k">if</span> <span class="n">table_key</span> <span class="ow">in</span> <span class="n">parenttable</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">tables</span><span class="p">:</span>
</span><span id="1-3262">                <span class="n">table</span> <span class="o">=</span> <span class="n">parenttable</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">tables</span><span class="p">[</span><span class="n">table_key</span><span class="p">]</span>
</span><span id="1-3263">                <span class="k">try</span><span class="p">:</span>
</span><span id="1-3264">                    <span class="n">_column</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_link_to_col_by_colstring</span><span class="p">(</span>
</span><span id="1-3265">                        <span class="n">parenttable</span><span class="p">,</span> <span class="n">table</span><span class="p">,</span> <span class="n">colname</span>
</span><span id="1-3266">                    <span class="p">)</span>
</span><span id="1-3267">                <span class="k">except</span> <span class="n">exc</span><span class="o">.</span><span class="n">NoReferencedColumnError</span><span class="p">:</span>
</span><span id="1-3268">                    <span class="c1"># this is OK, we&#39;ll try later</span>
</span><span id="1-3269">                    <span class="k">pass</span>
</span><span id="1-3270">                <span class="k">else</span><span class="p">:</span>
</span><span id="1-3271">                    <span class="bp">self</span><span class="o">.</span><span class="n">_set_target_column</span><span class="p">(</span><span class="n">_column</span><span class="p">)</span>
</span><span id="1-3272">
</span><span id="1-3273">            <span class="n">parenttable</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">_fk_memos</span><span class="p">[</span><span class="n">fk_key</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span><span id="1-3274">        <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_colspec</span><span class="p">,</span> <span class="s2">&quot;__clause_element__&quot;</span><span class="p">):</span>
</span><span id="1-3275">            <span class="n">_column</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_colspec</span><span class="o">.</span><span class="n">__clause_element__</span><span class="p">()</span>
</span><span id="1-3276">            <span class="bp">self</span><span class="o">.</span><span class="n">_set_target_column</span><span class="p">(</span><span class="n">_column</span><span class="p">)</span>
</span><span id="1-3277">        <span class="k">else</span><span class="p">:</span>
</span><span id="1-3278">            <span class="n">_column</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_colspec</span>
</span><span id="1-3279">            <span class="bp">self</span><span class="o">.</span><span class="n">_set_target_column</span><span class="p">(</span><span class="n">_column</span><span class="p">)</span>
</span><span id="1-3280">
</span><span id="1-3281">
</span><span id="1-3282"><span class="k">if</span> <span class="n">TYPE_CHECKING</span><span class="p">:</span>
</span><span id="1-3283">
</span><span id="1-3284">    <span class="k">def</span> <span class="nf">default_is_sequence</span><span class="p">(</span>
</span><span id="1-3285">        <span class="n">obj</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">DefaultGenerator</span><span class="p">],</span>
</span><span id="1-3286">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">TypeGuard</span><span class="p">[</span><span class="n">Sequence</span><span class="p">]:</span>
</span><span id="1-3287">        <span class="o">...</span>
</span><span id="1-3288">
</span><span id="1-3289">    <span class="k">def</span> <span class="nf">default_is_clause_element</span><span class="p">(</span>
</span><span id="1-3290">        <span class="n">obj</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">DefaultGenerator</span><span class="p">],</span>
</span><span id="1-3291">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">TypeGuard</span><span class="p">[</span><span class="n">ColumnElementColumnDefault</span><span class="p">]:</span>
</span><span id="1-3292">        <span class="o">...</span>
</span><span id="1-3293">
</span><span id="1-3294">    <span class="k">def</span> <span class="nf">default_is_scalar</span><span class="p">(</span>
</span><span id="1-3295">        <span class="n">obj</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">DefaultGenerator</span><span class="p">],</span>
</span><span id="1-3296">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">TypeGuard</span><span class="p">[</span><span class="n">ScalarElementColumnDefault</span><span class="p">]:</span>
</span><span id="1-3297">        <span class="o">...</span>
</span><span id="1-3298">
</span><span id="1-3299"><span class="k">else</span><span class="p">:</span>
</span><span id="1-3300">    <span class="n">default_is_sequence</span> <span class="o">=</span> <span class="n">operator</span><span class="o">.</span><span class="n">attrgetter</span><span class="p">(</span><span class="s2">&quot;is_sequence&quot;</span><span class="p">)</span>
</span><span id="1-3301">
</span><span id="1-3302">    <span class="n">default_is_clause_element</span> <span class="o">=</span> <span class="n">operator</span><span class="o">.</span><span class="n">attrgetter</span><span class="p">(</span><span class="s2">&quot;is_clause_element&quot;</span><span class="p">)</span>
</span><span id="1-3303">
</span><span id="1-3304">    <span class="n">default_is_scalar</span> <span class="o">=</span> <span class="n">operator</span><span class="o">.</span><span class="n">attrgetter</span><span class="p">(</span><span class="s2">&quot;is_scalar&quot;</span><span class="p">)</span>
</span><span id="1-3305">
</span><span id="1-3306">
</span><span id="1-3307"><span class="k">class</span> <span class="nc">DefaultGenerator</span><span class="p">(</span><span class="n">Executable</span><span class="p">,</span> <span class="n">SchemaItem</span><span class="p">):</span>
</span><span id="1-3308"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Base class for column *default* values.</span>
</span><span id="1-3309">
</span><span id="1-3310"><span class="sd">    This object is only present on column.default or column.onupdate.</span>
</span><span id="1-3311"><span class="sd">    It&#39;s not valid as a server default.</span>
</span><span id="1-3312">
</span><span id="1-3313"><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="1-3314">
</span><span id="1-3315">    <span class="n">__visit_name__</span> <span class="o">=</span> <span class="s2">&quot;default_generator&quot;</span>
</span><span id="1-3316">
</span><span id="1-3317">    <span class="n">_is_default_generator</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="1-3318">    <span class="n">is_sequence</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="1-3319">    <span class="n">is_identity</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="1-3320">    <span class="n">is_server_default</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="1-3321">    <span class="n">is_clause_element</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="1-3322">    <span class="n">is_callable</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="1-3323">    <span class="n">is_scalar</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="1-3324">    <span class="n">has_arg</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="1-3325">    <span class="n">is_sentinel</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="1-3326">    <span class="n">column</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Column</span><span class="p">[</span><span class="n">Any</span><span class="p">]]</span>
</span><span id="1-3327">
</span><span id="1-3328">    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">for_update</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-3329">        <span class="bp">self</span><span class="o">.</span><span class="n">for_update</span> <span class="o">=</span> <span class="n">for_update</span>
</span><span id="1-3330">
</span><span id="1-3331">    <span class="k">def</span> <span class="nf">_set_parent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">:</span> <span class="n">SchemaEventTarget</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-3332">        <span class="k">if</span> <span class="n">TYPE_CHECKING</span><span class="p">:</span>
</span><span id="1-3333">            <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">parent</span><span class="p">,</span> <span class="n">Column</span><span class="p">)</span>
</span><span id="1-3334">        <span class="bp">self</span><span class="o">.</span><span class="n">column</span> <span class="o">=</span> <span class="n">parent</span>
</span><span id="1-3335">        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">for_update</span><span class="p">:</span>
</span><span id="1-3336">            <span class="bp">self</span><span class="o">.</span><span class="n">column</span><span class="o">.</span><span class="n">onupdate</span> <span class="o">=</span> <span class="bp">self</span>
</span><span id="1-3337">        <span class="k">else</span><span class="p">:</span>
</span><span id="1-3338">            <span class="bp">self</span><span class="o">.</span><span class="n">column</span><span class="o">.</span><span class="n">default</span> <span class="o">=</span> <span class="bp">self</span>
</span><span id="1-3339">
</span><span id="1-3340">    <span class="k">def</span> <span class="nf">_copy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DefaultGenerator</span><span class="p">:</span>
</span><span id="1-3341">        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span>
</span><span id="1-3342">
</span><span id="1-3343">    <span class="k">def</span> <span class="nf">_execute_on_connection</span><span class="p">(</span>
</span><span id="1-3344">        <span class="bp">self</span><span class="p">,</span>
</span><span id="1-3345">        <span class="n">connection</span><span class="p">:</span> <span class="n">Connection</span><span class="p">,</span>
</span><span id="1-3346">        <span class="n">distilled_params</span><span class="p">:</span> <span class="n">_CoreMultiExecuteParams</span><span class="p">,</span>
</span><span id="1-3347">        <span class="n">execution_options</span><span class="p">:</span> <span class="n">CoreExecuteOptionsParameter</span><span class="p">,</span>
</span><span id="1-3348">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
</span><span id="1-3349">        <span class="n">util</span><span class="o">.</span><span class="n">warn_deprecated</span><span class="p">(</span>
</span><span id="1-3350">            <span class="s2">&quot;Using the .execute() method to invoke a &quot;</span>
</span><span id="1-3351">            <span class="s2">&quot;DefaultGenerator object is deprecated; please use &quot;</span>
</span><span id="1-3352">            <span class="s2">&quot;the .scalar() method.&quot;</span><span class="p">,</span>
</span><span id="1-3353">            <span class="s2">&quot;2.0&quot;</span><span class="p">,</span>
</span><span id="1-3354">        <span class="p">)</span>
</span><span id="1-3355">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_execute_on_scalar</span><span class="p">(</span>
</span><span id="1-3356">            <span class="n">connection</span><span class="p">,</span> <span class="n">distilled_params</span><span class="p">,</span> <span class="n">execution_options</span>
</span><span id="1-3357">        <span class="p">)</span>
</span><span id="1-3358">
</span><span id="1-3359">    <span class="k">def</span> <span class="nf">_execute_on_scalar</span><span class="p">(</span>
</span><span id="1-3360">        <span class="bp">self</span><span class="p">,</span>
</span><span id="1-3361">        <span class="n">connection</span><span class="p">:</span> <span class="n">Connection</span><span class="p">,</span>
</span><span id="1-3362">        <span class="n">distilled_params</span><span class="p">:</span> <span class="n">_CoreMultiExecuteParams</span><span class="p">,</span>
</span><span id="1-3363">        <span class="n">execution_options</span><span class="p">:</span> <span class="n">CoreExecuteOptionsParameter</span><span class="p">,</span>
</span><span id="1-3364">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
</span><span id="1-3365">        <span class="k">return</span> <span class="n">connection</span><span class="o">.</span><span class="n">_execute_default</span><span class="p">(</span>
</span><span id="1-3366">            <span class="bp">self</span><span class="p">,</span> <span class="n">distilled_params</span><span class="p">,</span> <span class="n">execution_options</span>
</span><span id="1-3367">        <span class="p">)</span>
</span><span id="1-3368">
</span><span id="1-3369">
</span><span id="1-3370"><span class="k">class</span> <span class="nc">ColumnDefault</span><span class="p">(</span><span class="n">DefaultGenerator</span><span class="p">,</span> <span class="n">ABC</span><span class="p">):</span>
</span><span id="1-3371"><span class="w">    </span><span class="sd">&quot;&quot;&quot;A plain default value on a column.</span>
</span><span id="1-3372">
</span><span id="1-3373"><span class="sd">    This could correspond to a constant, a callable function,</span>
</span><span id="1-3374"><span class="sd">    or a SQL clause.</span>
</span><span id="1-3375">
</span><span id="1-3376"><span class="sd">    :class:`.ColumnDefault` is generated automatically</span>
</span><span id="1-3377"><span class="sd">    whenever the ``default``, ``onupdate`` arguments of</span>
</span><span id="1-3378"><span class="sd">    :class:`_schema.Column` are used.  A :class:`.ColumnDefault`</span>
</span><span id="1-3379"><span class="sd">    can be passed positionally as well.</span>
</span><span id="1-3380">
</span><span id="1-3381"><span class="sd">    For example, the following::</span>
</span><span id="1-3382">
</span><span id="1-3383"><span class="sd">        Column(&#39;foo&#39;, Integer, default=50)</span>
</span><span id="1-3384">
</span><span id="1-3385"><span class="sd">    Is equivalent to::</span>
</span><span id="1-3386">
</span><span id="1-3387"><span class="sd">        Column(&#39;foo&#39;, Integer, ColumnDefault(50))</span>
</span><span id="1-3388">
</span><span id="1-3389">
</span><span id="1-3390"><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="1-3391">
</span><span id="1-3392">    <span class="n">arg</span><span class="p">:</span> <span class="n">Any</span>
</span><span id="1-3393">
</span><span id="1-3394">    <span class="nd">@overload</span>
</span><span id="1-3395">    <span class="k">def</span> <span class="fm">__new__</span><span class="p">(</span>
</span><span id="1-3396">        <span class="bp">cls</span><span class="p">,</span> <span class="n">arg</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="n">for_update</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="o">...</span>
</span><span id="1-3397">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CallableColumnDefault</span><span class="p">:</span>
</span><span id="1-3398">        <span class="o">...</span>
</span><span id="1-3399">
</span><span id="1-3400">    <span class="nd">@overload</span>
</span><span id="1-3401">    <span class="k">def</span> <span class="fm">__new__</span><span class="p">(</span>
</span><span id="1-3402">        <span class="bp">cls</span><span class="p">,</span> <span class="n">arg</span><span class="p">:</span> <span class="n">ColumnElement</span><span class="p">[</span><span class="n">Any</span><span class="p">],</span> <span class="n">for_update</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="o">...</span>
</span><span id="1-3403">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ColumnElementColumnDefault</span><span class="p">:</span>
</span><span id="1-3404">        <span class="o">...</span>
</span><span id="1-3405">
</span><span id="1-3406">    <span class="c1"># if I return ScalarElementColumnDefault here, which is what&#39;s actually</span>
</span><span id="1-3407">    <span class="c1"># returned, mypy complains that</span>
</span><span id="1-3408">    <span class="c1"># overloads overlap w/ incompatible return types.</span>
</span><span id="1-3409">    <span class="nd">@overload</span>
</span><span id="1-3410">    <span class="k">def</span> <span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">arg</span><span class="p">:</span> <span class="nb">object</span><span class="p">,</span> <span class="n">for_update</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="o">...</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ColumnDefault</span><span class="p">:</span>
</span><span id="1-3411">        <span class="o">...</span>
</span><span id="1-3412">
</span><span id="1-3413">    <span class="k">def</span> <span class="fm">__new__</span><span class="p">(</span>
</span><span id="1-3414">        <span class="bp">cls</span><span class="p">,</span> <span class="n">arg</span><span class="p">:</span> <span class="n">Any</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">for_update</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="1-3415">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ColumnDefault</span><span class="p">:</span>
</span><span id="1-3416"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Construct a new :class:`.ColumnDefault`.</span>
</span><span id="1-3417">
</span><span id="1-3418">
</span><span id="1-3419"><span class="sd">        :param arg: argument representing the default value.</span>
</span><span id="1-3420"><span class="sd">         May be one of the following:</span>
</span><span id="1-3421">
</span><span id="1-3422"><span class="sd">         * a plain non-callable Python value, such as a</span>
</span><span id="1-3423"><span class="sd">           string, integer, boolean, or other simple type.</span>
</span><span id="1-3424"><span class="sd">           The default value will be used as is each time.</span>
</span><span id="1-3425"><span class="sd">         * a SQL expression, that is one which derives from</span>
</span><span id="1-3426"><span class="sd">           :class:`_expression.ColumnElement`.  The SQL expression will</span>
</span><span id="1-3427"><span class="sd">           be rendered into the INSERT or UPDATE statement,</span>
</span><span id="1-3428"><span class="sd">           or in the case of a primary key column when</span>
</span><span id="1-3429"><span class="sd">           RETURNING is not used may be</span>
</span><span id="1-3430"><span class="sd">           pre-executed before an INSERT within a SELECT.</span>
</span><span id="1-3431"><span class="sd">         * A Python callable.  The function will be invoked for each</span>
</span><span id="1-3432"><span class="sd">           new row subject to an INSERT or UPDATE.</span>
</span><span id="1-3433"><span class="sd">           The callable must accept exactly</span>
</span><span id="1-3434"><span class="sd">           zero or one positional arguments.  The one-argument form</span>
</span><span id="1-3435"><span class="sd">           will receive an instance of the :class:`.ExecutionContext`,</span>
</span><span id="1-3436"><span class="sd">           which provides contextual information as to the current</span>
</span><span id="1-3437"><span class="sd">           :class:`_engine.Connection` in use as well as the current</span>
</span><span id="1-3438"><span class="sd">           statement and parameters.</span>
</span><span id="1-3439">
</span><span id="1-3440"><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="1-3441">
</span><span id="1-3442">        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">arg</span><span class="p">,</span> <span class="n">FetchedValue</span><span class="p">):</span>
</span><span id="1-3443">            <span class="k">raise</span> <span class="n">exc</span><span class="o">.</span><span class="n">ArgumentError</span><span class="p">(</span>
</span><span id="1-3444">                <span class="s2">&quot;ColumnDefault may not be a server-side default type.&quot;</span>
</span><span id="1-3445">            <span class="p">)</span>
</span><span id="1-3446">        <span class="k">elif</span> <span class="nb">callable</span><span class="p">(</span><span class="n">arg</span><span class="p">):</span>
</span><span id="1-3447">            <span class="bp">cls</span> <span class="o">=</span> <span class="n">CallableColumnDefault</span>
</span><span id="1-3448">        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">arg</span><span class="p">,</span> <span class="n">ClauseElement</span><span class="p">):</span>
</span><span id="1-3449">            <span class="bp">cls</span> <span class="o">=</span> <span class="n">ColumnElementColumnDefault</span>
</span><span id="1-3450">        <span class="k">elif</span> <span class="n">arg</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-3451">            <span class="bp">cls</span> <span class="o">=</span> <span class="n">ScalarElementColumnDefault</span>
</span><span id="1-3452">
</span><span id="1-3453">        <span class="k">return</span> <span class="nb">object</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span>
</span><span id="1-3454">
</span><span id="1-3455">    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="1-3456">        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">(</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">arg</span><span class="si">!r}</span><span class="s2">)&quot;</span>
</span><span id="1-3457">
</span><span id="1-3458">
</span><span id="1-3459"><span class="k">class</span> <span class="nc">ScalarElementColumnDefault</span><span class="p">(</span><span class="n">ColumnDefault</span><span class="p">):</span>
</span><span id="1-3460"><span class="w">    </span><span class="sd">&quot;&quot;&quot;default generator for a fixed scalar Python value</span>
</span><span id="1-3461">
</span><span id="1-3462"><span class="sd">    .. versionadded: 2.0</span>
</span><span id="1-3463">
</span><span id="1-3464"><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="1-3465">
</span><span id="1-3466">    <span class="n">is_scalar</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="1-3467">    <span class="n">has_arg</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="1-3468">
</span><span id="1-3469">    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arg</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">for_update</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-3470">        <span class="bp">self</span><span class="o">.</span><span class="n">for_update</span> <span class="o">=</span> <span class="n">for_update</span>
</span><span id="1-3471">        <span class="bp">self</span><span class="o">.</span><span class="n">arg</span> <span class="o">=</span> <span class="n">arg</span>
</span><span id="1-3472">
</span><span id="1-3473">    <span class="k">def</span> <span class="nf">_copy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ScalarElementColumnDefault</span><span class="p">:</span>
</span><span id="1-3474">        <span class="k">return</span> <span class="n">ScalarElementColumnDefault</span><span class="p">(</span>
</span><span id="1-3475">            <span class="n">arg</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">arg</span><span class="p">,</span> <span class="n">for_update</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">for_update</span>
</span><span id="1-3476">        <span class="p">)</span>
</span><span id="1-3477">
</span><span id="1-3478">
</span><span id="1-3479"><span class="k">class</span> <span class="nc">_InsertSentinelColumnDefault</span><span class="p">(</span><span class="n">ColumnDefault</span><span class="p">):</span>
</span><span id="1-3480"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Default generator that&#39;s specific to the use of a &quot;sentinel&quot; column</span>
</span><span id="1-3481"><span class="sd">    when using the insertmanyvalues feature.</span>
</span><span id="1-3482">
</span><span id="1-3483"><span class="sd">    This default is used as part of the :func:`_schema.insert_sentinel`</span>
</span><span id="1-3484"><span class="sd">    construct.</span>
</span><span id="1-3485">
</span><span id="1-3486"><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="1-3487">
</span><span id="1-3488">    <span class="n">is_sentinel</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="1-3489">    <span class="n">for_update</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="1-3490">    <span class="n">arg</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="1-3491">
</span><span id="1-3492">    <span class="k">def</span> <span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_InsertSentinelColumnDefault</span><span class="p">:</span>
</span><span id="1-3493">        <span class="k">return</span> <span class="nb">object</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span>
</span><span id="1-3494">
</span><span id="1-3495">    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-3496">        <span class="k">pass</span>
</span><span id="1-3497">
</span><span id="1-3498">    <span class="k">def</span> <span class="nf">_set_parent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">:</span> <span class="n">SchemaEventTarget</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-3499">        <span class="n">col</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="s2">&quot;Column[Any]&quot;</span><span class="p">,</span> <span class="n">parent</span><span class="p">)</span>
</span><span id="1-3500">        <span class="k">if</span> <span class="ow">not</span> <span class="n">col</span><span class="o">.</span><span class="n">_insert_sentinel</span><span class="p">:</span>
</span><span id="1-3501">            <span class="k">raise</span> <span class="n">exc</span><span class="o">.</span><span class="n">ArgumentError</span><span class="p">(</span>
</span><span id="1-3502">                <span class="s2">&quot;The _InsertSentinelColumnDefault may only be applied to a &quot;</span>
</span><span id="1-3503">                <span class="s2">&quot;Column marked as insert_sentinel=True&quot;</span>
</span><span id="1-3504">            <span class="p">)</span>
</span><span id="1-3505">        <span class="k">elif</span> <span class="ow">not</span> <span class="n">col</span><span class="o">.</span><span class="n">nullable</span><span class="p">:</span>
</span><span id="1-3506">            <span class="k">raise</span> <span class="n">exc</span><span class="o">.</span><span class="n">ArgumentError</span><span class="p">(</span>
</span><span id="1-3507">                <span class="s2">&quot;The _InsertSentinelColumnDefault may only be applied to a &quot;</span>
</span><span id="1-3508">                <span class="s2">&quot;Column that is nullable&quot;</span>
</span><span id="1-3509">            <span class="p">)</span>
</span><span id="1-3510">
</span><span id="1-3511">        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">_set_parent</span><span class="p">(</span><span class="n">parent</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>
</span><span id="1-3512">
</span><span id="1-3513">    <span class="k">def</span> <span class="nf">_copy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_InsertSentinelColumnDefault</span><span class="p">:</span>
</span><span id="1-3514">        <span class="k">return</span> <span class="n">_InsertSentinelColumnDefault</span><span class="p">()</span>
</span><span id="1-3515">
</span><span id="1-3516">
</span><span id="1-3517"><span class="n">_SQLExprDefault</span> <span class="o">=</span> <span class="n">Union</span><span class="p">[</span><span class="s2">&quot;ColumnElement[Any]&quot;</span><span class="p">,</span> <span class="s2">&quot;TextClause&quot;</span><span class="p">]</span>
</span><span id="1-3518">
</span><span id="1-3519">
</span><span id="1-3520"><span class="k">class</span> <span class="nc">ColumnElementColumnDefault</span><span class="p">(</span><span class="n">ColumnDefault</span><span class="p">):</span>
</span><span id="1-3521"><span class="w">    </span><span class="sd">&quot;&quot;&quot;default generator for a SQL expression</span>
</span><span id="1-3522">
</span><span id="1-3523"><span class="sd">    .. versionadded:: 2.0</span>
</span><span id="1-3524">
</span><span id="1-3525"><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="1-3526">
</span><span id="1-3527">    <span class="n">is_clause_element</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="1-3528">    <span class="n">has_arg</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="1-3529">    <span class="n">arg</span><span class="p">:</span> <span class="n">_SQLExprDefault</span>
</span><span id="1-3530">
</span><span id="1-3531">    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
</span><span id="1-3532">        <span class="bp">self</span><span class="p">,</span>
</span><span id="1-3533">        <span class="n">arg</span><span class="p">:</span> <span class="n">_SQLExprDefault</span><span class="p">,</span>
</span><span id="1-3534">        <span class="n">for_update</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="1-3535">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-3536">        <span class="bp">self</span><span class="o">.</span><span class="n">for_update</span> <span class="o">=</span> <span class="n">for_update</span>
</span><span id="1-3537">        <span class="bp">self</span><span class="o">.</span><span class="n">arg</span> <span class="o">=</span> <span class="n">arg</span>
</span><span id="1-3538">
</span><span id="1-3539">    <span class="k">def</span> <span class="nf">_copy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ColumnElementColumnDefault</span><span class="p">:</span>
</span><span id="1-3540">        <span class="k">return</span> <span class="n">ColumnElementColumnDefault</span><span class="p">(</span>
</span><span id="1-3541">            <span class="n">arg</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">arg</span><span class="p">,</span> <span class="n">for_update</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">for_update</span>
</span><span id="1-3542">        <span class="p">)</span>
</span><span id="1-3543">
</span><span id="1-3544">    <span class="nd">@util</span><span class="o">.</span><span class="n">memoized_property</span>
</span><span id="1-3545">    <span class="nd">@util</span><span class="o">.</span><span class="n">preload_module</span><span class="p">(</span><span class="s2">&quot;sqlalchemy.sql.sqltypes&quot;</span><span class="p">)</span>
</span><span id="1-3546">    <span class="k">def</span> <span class="nf">_arg_is_typed</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="1-3547">        <span class="n">sqltypes</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">preloaded</span><span class="o">.</span><span class="n">sql_sqltypes</span>
</span><span id="1-3548">
</span><span id="1-3549">        <span class="k">return</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">arg</span><span class="o">.</span><span class="n">type</span><span class="p">,</span> <span class="n">sqltypes</span><span class="o">.</span><span class="n">NullType</span><span class="p">)</span>
</span><span id="1-3550">
</span><span id="1-3551">
</span><span id="1-3552"><span class="k">class</span> <span class="nc">_CallableColumnDefaultProtocol</span><span class="p">(</span><span class="n">Protocol</span><span class="p">):</span>
</span><span id="1-3553">    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="n">ExecutionContext</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
</span><span id="1-3554">        <span class="o">...</span>
</span><span id="1-3555">
</span><span id="1-3556">
</span><span id="1-3557"><span class="k">class</span> <span class="nc">CallableColumnDefault</span><span class="p">(</span><span class="n">ColumnDefault</span><span class="p">):</span>
</span><span id="1-3558"><span class="w">    </span><span class="sd">&quot;&quot;&quot;default generator for a callable Python function</span>
</span><span id="1-3559">
</span><span id="1-3560"><span class="sd">    .. versionadded:: 2.0</span>
</span><span id="1-3561">
</span><span id="1-3562"><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="1-3563">
</span><span id="1-3564">    <span class="n">is_callable</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="1-3565">    <span class="n">arg</span><span class="p">:</span> <span class="n">_CallableColumnDefaultProtocol</span>
</span><span id="1-3566">    <span class="n">has_arg</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="1-3567">
</span><span id="1-3568">    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
</span><span id="1-3569">        <span class="bp">self</span><span class="p">,</span>
</span><span id="1-3570">        <span class="n">arg</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">_CallableColumnDefaultProtocol</span><span class="p">,</span> <span class="n">Callable</span><span class="p">[[],</span> <span class="n">Any</span><span class="p">]],</span>
</span><span id="1-3571">        <span class="n">for_update</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="1-3572">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-3573">        <span class="bp">self</span><span class="o">.</span><span class="n">for_update</span> <span class="o">=</span> <span class="n">for_update</span>
</span><span id="1-3574">        <span class="bp">self</span><span class="o">.</span><span class="n">arg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_maybe_wrap_callable</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span>
</span><span id="1-3575">
</span><span id="1-3576">    <span class="k">def</span> <span class="nf">_copy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CallableColumnDefault</span><span class="p">:</span>
</span><span id="1-3577">        <span class="k">return</span> <span class="n">CallableColumnDefault</span><span class="p">(</span><span class="n">arg</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">arg</span><span class="p">,</span> <span class="n">for_update</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">for_update</span><span class="p">)</span>
</span><span id="1-3578">
</span><span id="1-3579">    <span class="k">def</span> <span class="nf">_maybe_wrap_callable</span><span class="p">(</span>
</span><span id="1-3580">        <span class="bp">self</span><span class="p">,</span> <span class="n">fn</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">_CallableColumnDefaultProtocol</span><span class="p">,</span> <span class="n">Callable</span><span class="p">[[],</span> <span class="n">Any</span><span class="p">]]</span>
</span><span id="1-3581">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_CallableColumnDefaultProtocol</span><span class="p">:</span>
</span><span id="1-3582"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Wrap callables that don&#39;t accept a context.</span>
</span><span id="1-3583">
</span><span id="1-3584"><span class="sd">        This is to allow easy compatibility with default callables</span>
</span><span id="1-3585"><span class="sd">        that aren&#39;t specific to accepting of a context.</span>
</span><span id="1-3586">
</span><span id="1-3587"><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="1-3588">
</span><span id="1-3589">        <span class="k">try</span><span class="p">:</span>
</span><span id="1-3590">            <span class="n">argspec</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">get_callable_argspec</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span> <span class="n">no_self</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="1-3591">        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
</span><span id="1-3592">            <span class="k">return</span> <span class="n">util</span><span class="o">.</span><span class="n">wrap_callable</span><span class="p">(</span><span class="k">lambda</span> <span class="n">ctx</span><span class="p">:</span> <span class="n">fn</span><span class="p">(),</span> <span class="n">fn</span><span class="p">)</span>  <span class="c1"># type: ignore</span>
</span><span id="1-3593">
</span><span id="1-3594">        <span class="n">defaulted</span> <span class="o">=</span> <span class="n">argspec</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">argspec</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span> <span class="ow">or</span> <span class="mi">0</span>
</span><span id="1-3595">        <span class="n">positionals</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">argspec</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">-</span> <span class="n">defaulted</span>
</span><span id="1-3596">
</span><span id="1-3597">        <span class="k">if</span> <span class="n">positionals</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="1-3598">            <span class="k">return</span> <span class="n">util</span><span class="o">.</span><span class="n">wrap_callable</span><span class="p">(</span><span class="k">lambda</span> <span class="n">ctx</span><span class="p">:</span> <span class="n">fn</span><span class="p">(),</span> <span class="n">fn</span><span class="p">)</span>  <span class="c1"># type: ignore</span>
</span><span id="1-3599">
</span><span id="1-3600">        <span class="k">elif</span> <span class="n">positionals</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="1-3601">            <span class="k">return</span> <span class="n">fn</span>  <span class="c1"># type: ignore</span>
</span><span id="1-3602">        <span class="k">else</span><span class="p">:</span>
</span><span id="1-3603">            <span class="k">raise</span> <span class="n">exc</span><span class="o">.</span><span class="n">ArgumentError</span><span class="p">(</span>
</span><span id="1-3604">                <span class="s2">&quot;ColumnDefault Python function takes zero or one &quot;</span>
</span><span id="1-3605">                <span class="s2">&quot;positional arguments&quot;</span>
</span><span id="1-3606">            <span class="p">)</span>
</span><span id="1-3607">
</span><span id="1-3608">
</span><span id="1-3609"><span class="k">class</span> <span class="nc">IdentityOptions</span><span class="p">:</span>
</span><span id="1-3610"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Defines options for a named database sequence or an identity column.</span>
</span><span id="1-3611">
</span><span id="1-3612"><span class="sd">    .. versionadded:: 1.3.18</span>
</span><span id="1-3613">
</span><span id="1-3614"><span class="sd">    .. seealso::</span>
</span><span id="1-3615">
</span><span id="1-3616"><span class="sd">        :class:`.Sequence`</span>
</span><span id="1-3617">
</span><span id="1-3618"><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="1-3619">
</span><span id="1-3620">    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
</span><span id="1-3621">        <span class="bp">self</span><span class="p">,</span>
</span><span id="1-3622">        <span class="n">start</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="1-3623">        <span class="n">increment</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="1-3624">        <span class="n">minvalue</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="1-3625">        <span class="n">maxvalue</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="1-3626">        <span class="n">nominvalue</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="1-3627">        <span class="n">nomaxvalue</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="1-3628">        <span class="n">cycle</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="1-3629">        <span class="n">cache</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="1-3630">        <span class="n">order</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="1-3631">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-3632"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Construct a :class:`.IdentityOptions` object.</span>
</span><span id="1-3633">
</span><span id="1-3634"><span class="sd">        See the :class:`.Sequence` documentation for a complete description</span>
</span><span id="1-3635"><span class="sd">        of the parameters.</span>
</span><span id="1-3636">
</span><span id="1-3637"><span class="sd">        :param start: the starting index of the sequence.</span>
</span><span id="1-3638"><span class="sd">        :param increment: the increment value of the sequence.</span>
</span><span id="1-3639"><span class="sd">        :param minvalue: the minimum value of the sequence.</span>
</span><span id="1-3640"><span class="sd">        :param maxvalue: the maximum value of the sequence.</span>
</span><span id="1-3641"><span class="sd">        :param nominvalue: no minimum value of the sequence.</span>
</span><span id="1-3642"><span class="sd">        :param nomaxvalue: no maximum value of the sequence.</span>
</span><span id="1-3643"><span class="sd">        :param cycle: allows the sequence to wrap around when the maxvalue</span>
</span><span id="1-3644"><span class="sd">         or minvalue has been reached.</span>
</span><span id="1-3645"><span class="sd">        :param cache: optional integer value; number of future values in the</span>
</span><span id="1-3646"><span class="sd">         sequence which are calculated in advance.</span>
</span><span id="1-3647"><span class="sd">        :param order: optional boolean value; if ``True``, renders the</span>
</span><span id="1-3648"><span class="sd">         ORDER keyword.</span>
</span><span id="1-3649">
</span><span id="1-3650"><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="1-3651">        <span class="bp">self</span><span class="o">.</span><span class="n">start</span> <span class="o">=</span> <span class="n">start</span>
</span><span id="1-3652">        <span class="bp">self</span><span class="o">.</span><span class="n">increment</span> <span class="o">=</span> <span class="n">increment</span>
</span><span id="1-3653">        <span class="bp">self</span><span class="o">.</span><span class="n">minvalue</span> <span class="o">=</span> <span class="n">minvalue</span>
</span><span id="1-3654">        <span class="bp">self</span><span class="o">.</span><span class="n">maxvalue</span> <span class="o">=</span> <span class="n">maxvalue</span>
</span><span id="1-3655">        <span class="bp">self</span><span class="o">.</span><span class="n">nominvalue</span> <span class="o">=</span> <span class="n">nominvalue</span>
</span><span id="1-3656">        <span class="bp">self</span><span class="o">.</span><span class="n">nomaxvalue</span> <span class="o">=</span> <span class="n">nomaxvalue</span>
</span><span id="1-3657">        <span class="bp">self</span><span class="o">.</span><span class="n">cycle</span> <span class="o">=</span> <span class="n">cycle</span>
</span><span id="1-3658">        <span class="bp">self</span><span class="o">.</span><span class="n">cache</span> <span class="o">=</span> <span class="n">cache</span>
</span><span id="1-3659">        <span class="bp">self</span><span class="o">.</span><span class="n">order</span> <span class="o">=</span> <span class="n">order</span>
</span><span id="1-3660">
</span><span id="1-3661">    <span class="nd">@property</span>
</span><span id="1-3662">    <span class="k">def</span> <span class="nf">_increment_is_negative</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="1-3663">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">increment</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">increment</span> <span class="o">&lt;</span> <span class="mi">0</span>
</span><span id="1-3664">
</span><span id="1-3665">
</span><span id="1-3666"><span class="k">class</span> <span class="nc">Sequence</span><span class="p">(</span><span class="n">HasSchemaAttr</span><span class="p">,</span> <span class="n">IdentityOptions</span><span class="p">,</span> <span class="n">DefaultGenerator</span><span class="p">):</span>
</span><span id="1-3667"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Represents a named database sequence.</span>
</span><span id="1-3668">
</span><span id="1-3669"><span class="sd">    The :class:`.Sequence` object represents the name and configurational</span>
</span><span id="1-3670"><span class="sd">    parameters of a database sequence.   It also represents</span>
</span><span id="1-3671"><span class="sd">    a construct that can be &quot;executed&quot; by a SQLAlchemy :class:`_engine.Engine`</span>
</span><span id="1-3672"><span class="sd">    or :class:`_engine.Connection`,</span>
</span><span id="1-3673"><span class="sd">    rendering the appropriate &quot;next value&quot; function</span>
</span><span id="1-3674"><span class="sd">    for the target database and returning a result.</span>
</span><span id="1-3675">
</span><span id="1-3676"><span class="sd">    The :class:`.Sequence` is typically associated with a primary key column::</span>
</span><span id="1-3677">
</span><span id="1-3678"><span class="sd">        some_table = Table(</span>
</span><span id="1-3679"><span class="sd">            &#39;some_table&#39;, metadata,</span>
</span><span id="1-3680"><span class="sd">            Column(&#39;id&#39;, Integer, Sequence(&#39;some_table_seq&#39;, start=1),</span>
</span><span id="1-3681"><span class="sd">            primary_key=True)</span>
</span><span id="1-3682"><span class="sd">        )</span>
</span><span id="1-3683">
</span><span id="1-3684"><span class="sd">    When CREATE TABLE is emitted for the above :class:`_schema.Table`, if the</span>
</span><span id="1-3685"><span class="sd">    target platform supports sequences, a CREATE SEQUENCE statement will</span>
</span><span id="1-3686"><span class="sd">    be emitted as well.   For platforms that don&#39;t support sequences,</span>
</span><span id="1-3687"><span class="sd">    the :class:`.Sequence` construct is ignored.</span>
</span><span id="1-3688">
</span><span id="1-3689"><span class="sd">    .. seealso::</span>
</span><span id="1-3690">
</span><span id="1-3691"><span class="sd">        :ref:`defaults_sequences`</span>
</span><span id="1-3692">
</span><span id="1-3693"><span class="sd">        :class:`.CreateSequence`</span>
</span><span id="1-3694">
</span><span id="1-3695"><span class="sd">        :class:`.DropSequence`</span>
</span><span id="1-3696">
</span><span id="1-3697"><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="1-3698">
</span><span id="1-3699">    <span class="n">__visit_name__</span> <span class="o">=</span> <span class="s2">&quot;sequence&quot;</span>
</span><span id="1-3700">
</span><span id="1-3701">    <span class="n">is_sequence</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="1-3702">
</span><span id="1-3703">    <span class="n">column</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Column</span><span class="p">[</span><span class="n">Any</span><span class="p">]]</span>
</span><span id="1-3704">    <span class="n">data_type</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">TypeEngine</span><span class="p">[</span><span class="nb">int</span><span class="p">]]</span>
</span><span id="1-3705">
</span><span id="1-3706">    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
</span><span id="1-3707">        <span class="bp">self</span><span class="p">,</span>
</span><span id="1-3708">        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="1-3709">        <span class="n">start</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="1-3710">        <span class="n">increment</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="1-3711">        <span class="n">minvalue</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="1-3712">        <span class="n">maxvalue</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="1-3713">        <span class="n">nominvalue</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="1-3714">        <span class="n">nomaxvalue</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="1-3715">        <span class="n">cycle</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="1-3716">        <span class="n">schema</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Literal</span><span class="p">[</span><span class="n">SchemaConst</span><span class="o">.</span><span class="n">BLANK_SCHEMA</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="1-3717">        <span class="n">cache</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="1-3718">        <span class="n">order</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="1-3719">        <span class="n">data_type</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">_TypeEngineArgument</span><span class="p">[</span><span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="1-3720">        <span class="n">optional</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="1-3721">        <span class="n">quote</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="1-3722">        <span class="n">metadata</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">MetaData</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="1-3723">        <span class="n">quote_schema</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="1-3724">        <span class="n">for_update</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="1-3725">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-3726"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Construct a :class:`.Sequence` object.</span>
</span><span id="1-3727">
</span><span id="1-3728"><span class="sd">        :param name: the name of the sequence.</span>
</span><span id="1-3729">
</span><span id="1-3730"><span class="sd">        :param start: the starting index of the sequence.  This value is</span>
</span><span id="1-3731"><span class="sd">         used when the CREATE SEQUENCE command is emitted to the database</span>
</span><span id="1-3732"><span class="sd">         as the value of the &quot;START WITH&quot; clause. If ``None``, the</span>
</span><span id="1-3733"><span class="sd">         clause is omitted, which on most platforms indicates a starting</span>
</span><span id="1-3734"><span class="sd">         value of 1.</span>
</span><span id="1-3735">
</span><span id="1-3736"><span class="sd">         .. versionchanged:: 2.0 The :paramref:`.Sequence.start` parameter</span>
</span><span id="1-3737"><span class="sd">            is required in order to have DDL emit &quot;START WITH&quot;.  This is a</span>
</span><span id="1-3738"><span class="sd">            reversal of a change made in version 1.4 which would implicitly</span>
</span><span id="1-3739"><span class="sd">            render &quot;START WITH 1&quot; if the :paramref:`.Sequence.start` were</span>
</span><span id="1-3740"><span class="sd">            not included.  See :ref:`change_7211` for more detail.</span>
</span><span id="1-3741">
</span><span id="1-3742"><span class="sd">        :param increment: the increment value of the sequence.  This</span>
</span><span id="1-3743"><span class="sd">         value is used when the CREATE SEQUENCE command is emitted to</span>
</span><span id="1-3744"><span class="sd">         the database as the value of the &quot;INCREMENT BY&quot; clause.  If ``None``,</span>
</span><span id="1-3745"><span class="sd">         the clause is omitted, which on most platforms indicates an</span>
</span><span id="1-3746"><span class="sd">         increment of 1.</span>
</span><span id="1-3747"><span class="sd">        :param minvalue: the minimum value of the sequence.  This</span>
</span><span id="1-3748"><span class="sd">         value is used when the CREATE SEQUENCE command is emitted to</span>
</span><span id="1-3749"><span class="sd">         the database as the value of the &quot;MINVALUE&quot; clause.  If ``None``,</span>
</span><span id="1-3750"><span class="sd">         the clause is omitted, which on most platforms indicates a</span>
</span><span id="1-3751"><span class="sd">         minvalue of 1 and -2^63-1 for ascending and descending sequences,</span>
</span><span id="1-3752"><span class="sd">         respectively.</span>
</span><span id="1-3753">
</span><span id="1-3754"><span class="sd">        :param maxvalue: the maximum value of the sequence.  This</span>
</span><span id="1-3755"><span class="sd">         value is used when the CREATE SEQUENCE command is emitted to</span>
</span><span id="1-3756"><span class="sd">         the database as the value of the &quot;MAXVALUE&quot; clause.  If ``None``,</span>
</span><span id="1-3757"><span class="sd">         the clause is omitted, which on most platforms indicates a</span>
</span><span id="1-3758"><span class="sd">         maxvalue of 2^63-1 and -1 for ascending and descending sequences,</span>
</span><span id="1-3759"><span class="sd">         respectively.</span>
</span><span id="1-3760">
</span><span id="1-3761"><span class="sd">        :param nominvalue: no minimum value of the sequence.  This</span>
</span><span id="1-3762"><span class="sd">         value is used when the CREATE SEQUENCE command is emitted to</span>
</span><span id="1-3763"><span class="sd">         the database as the value of the &quot;NO MINVALUE&quot; clause.  If ``None``,</span>
</span><span id="1-3764"><span class="sd">         the clause is omitted, which on most platforms indicates a</span>
</span><span id="1-3765"><span class="sd">         minvalue of 1 and -2^63-1 for ascending and descending sequences,</span>
</span><span id="1-3766"><span class="sd">         respectively.</span>
</span><span id="1-3767">
</span><span id="1-3768"><span class="sd">        :param nomaxvalue: no maximum value of the sequence.  This</span>
</span><span id="1-3769"><span class="sd">         value is used when the CREATE SEQUENCE command is emitted to</span>
</span><span id="1-3770"><span class="sd">         the database as the value of the &quot;NO MAXVALUE&quot; clause.  If ``None``,</span>
</span><span id="1-3771"><span class="sd">         the clause is omitted, which on most platforms indicates a</span>
</span><span id="1-3772"><span class="sd">         maxvalue of 2^63-1 and -1 for ascending and descending sequences,</span>
</span><span id="1-3773"><span class="sd">         respectively.</span>
</span><span id="1-3774">
</span><span id="1-3775"><span class="sd">        :param cycle: allows the sequence to wrap around when the maxvalue</span>
</span><span id="1-3776"><span class="sd">         or minvalue has been reached by an ascending or descending sequence</span>
</span><span id="1-3777"><span class="sd">         respectively.  This value is used when the CREATE SEQUENCE command</span>
</span><span id="1-3778"><span class="sd">         is emitted to the database as the &quot;CYCLE&quot; clause.  If the limit is</span>
</span><span id="1-3779"><span class="sd">         reached, the next number generated will be the minvalue or maxvalue,</span>
</span><span id="1-3780"><span class="sd">         respectively.  If cycle=False (the default) any calls to nextval</span>
</span><span id="1-3781"><span class="sd">         after the sequence has reached its maximum value will return an</span>
</span><span id="1-3782"><span class="sd">         error.</span>
</span><span id="1-3783">
</span><span id="1-3784"><span class="sd">        :param schema: optional schema name for the sequence, if located</span>
</span><span id="1-3785"><span class="sd">         in a schema other than the default.  The rules for selecting the</span>
</span><span id="1-3786"><span class="sd">         schema name when a :class:`_schema.MetaData`</span>
</span><span id="1-3787"><span class="sd">         is also present are the same</span>
</span><span id="1-3788"><span class="sd">         as that of :paramref:`_schema.Table.schema`.</span>
</span><span id="1-3789">
</span><span id="1-3790"><span class="sd">        :param cache: optional integer value; number of future values in the</span>
</span><span id="1-3791"><span class="sd">         sequence which are calculated in advance.  Renders the CACHE keyword</span>
</span><span id="1-3792"><span class="sd">         understood by Oracle and PostgreSQL.</span>
</span><span id="1-3793">
</span><span id="1-3794"><span class="sd">        :param order: optional boolean value; if ``True``, renders the</span>
</span><span id="1-3795"><span class="sd">         ORDER keyword, understood by Oracle, indicating the sequence is</span>
</span><span id="1-3796"><span class="sd">         definitively ordered.   May be necessary to provide deterministic</span>
</span><span id="1-3797"><span class="sd">         ordering using Oracle RAC.</span>
</span><span id="1-3798">
</span><span id="1-3799"><span class="sd">        :param data_type: The type to be returned by the sequence, for</span>
</span><span id="1-3800"><span class="sd">         dialects that allow us to choose between INTEGER, BIGINT, etc.</span>
</span><span id="1-3801"><span class="sd">         (e.g., mssql).</span>
</span><span id="1-3802">
</span><span id="1-3803"><span class="sd">         .. versionadded:: 1.4.0</span>
</span><span id="1-3804">
</span><span id="1-3805"><span class="sd">        :param optional: boolean value, when ``True``, indicates that this</span>
</span><span id="1-3806"><span class="sd">         :class:`.Sequence` object only needs to be explicitly generated</span>
</span><span id="1-3807"><span class="sd">         on backends that don&#39;t provide another way to generate primary</span>
</span><span id="1-3808"><span class="sd">         key identifiers.  Currently, it essentially means, &quot;don&#39;t create</span>
</span><span id="1-3809"><span class="sd">         this sequence on the PostgreSQL backend, where the SERIAL keyword</span>
</span><span id="1-3810"><span class="sd">         creates a sequence for us automatically&quot;.</span>
</span><span id="1-3811"><span class="sd">        :param quote: boolean value, when ``True`` or ``False``, explicitly</span>
</span><span id="1-3812"><span class="sd">         forces quoting of the :paramref:`_schema.Sequence.name` on or off.</span>
</span><span id="1-3813"><span class="sd">         When left at its default of ``None``, normal quoting rules based</span>
</span><span id="1-3814"><span class="sd">         on casing and reserved words take place.</span>
</span><span id="1-3815"><span class="sd">        :param quote_schema: Set the quoting preferences for the ``schema``</span>
</span><span id="1-3816"><span class="sd">         name.</span>
</span><span id="1-3817">
</span><span id="1-3818"><span class="sd">        :param metadata: optional :class:`_schema.MetaData` object which this</span>
</span><span id="1-3819"><span class="sd">         :class:`.Sequence` will be associated with.  A :class:`.Sequence`</span>
</span><span id="1-3820"><span class="sd">         that is associated with a :class:`_schema.MetaData`</span>
</span><span id="1-3821"><span class="sd">         gains the following</span>
</span><span id="1-3822"><span class="sd">         capabilities:</span>
</span><span id="1-3823">
</span><span id="1-3824"><span class="sd">         * The :class:`.Sequence` will inherit the</span>
</span><span id="1-3825"><span class="sd">           :paramref:`_schema.MetaData.schema`</span>
</span><span id="1-3826"><span class="sd">           parameter specified to the target :class:`_schema.MetaData`, which</span>
</span><span id="1-3827"><span class="sd">           affects the production of CREATE / DROP DDL, if any.</span>
</span><span id="1-3828">
</span><span id="1-3829"><span class="sd">         * The :meth:`.Sequence.create` and :meth:`.Sequence.drop` methods</span>
</span><span id="1-3830"><span class="sd">           automatically use the engine bound to the :class:`_schema.MetaData`</span>
</span><span id="1-3831"><span class="sd">           object, if any.</span>
</span><span id="1-3832">
</span><span id="1-3833"><span class="sd">         * The :meth:`_schema.MetaData.create_all` and</span>
</span><span id="1-3834"><span class="sd">           :meth:`_schema.MetaData.drop_all`</span>
</span><span id="1-3835"><span class="sd">           methods will emit CREATE / DROP for this :class:`.Sequence`,</span>
</span><span id="1-3836"><span class="sd">           even if the :class:`.Sequence` is not associated with any</span>
</span><span id="1-3837"><span class="sd">           :class:`_schema.Table` / :class:`_schema.Column`</span>
</span><span id="1-3838"><span class="sd">           that&#39;s a member of this</span>
</span><span id="1-3839"><span class="sd">           :class:`_schema.MetaData`.</span>
</span><span id="1-3840">
</span><span id="1-3841"><span class="sd">         The above behaviors can only occur if the :class:`.Sequence` is</span>
</span><span id="1-3842"><span class="sd">         explicitly associated with the :class:`_schema.MetaData`</span>
</span><span id="1-3843"><span class="sd">         via this parameter.</span>
</span><span id="1-3844">
</span><span id="1-3845"><span class="sd">         .. seealso::</span>
</span><span id="1-3846">
</span><span id="1-3847"><span class="sd">            :ref:`sequence_metadata` - full discussion of the</span>
</span><span id="1-3848"><span class="sd">            :paramref:`.Sequence.metadata` parameter.</span>
</span><span id="1-3849">
</span><span id="1-3850"><span class="sd">        :param for_update: Indicates this :class:`.Sequence`, when associated</span>
</span><span id="1-3851"><span class="sd">         with a :class:`_schema.Column`,</span>
</span><span id="1-3852"><span class="sd">         should be invoked for UPDATE statements</span>
</span><span id="1-3853"><span class="sd">         on that column&#39;s table, rather than for INSERT statements, when</span>
</span><span id="1-3854"><span class="sd">         no value is otherwise present for that column in the statement.</span>
</span><span id="1-3855">
</span><span id="1-3856"><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="1-3857">        <span class="n">DefaultGenerator</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">for_update</span><span class="o">=</span><span class="n">for_update</span><span class="p">)</span>
</span><span id="1-3858">        <span class="n">IdentityOptions</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="1-3859">            <span class="bp">self</span><span class="p">,</span>
</span><span id="1-3860">            <span class="n">start</span><span class="o">=</span><span class="n">start</span><span class="p">,</span>
</span><span id="1-3861">            <span class="n">increment</span><span class="o">=</span><span class="n">increment</span><span class="p">,</span>
</span><span id="1-3862">            <span class="n">minvalue</span><span class="o">=</span><span class="n">minvalue</span><span class="p">,</span>
</span><span id="1-3863">            <span class="n">maxvalue</span><span class="o">=</span><span class="n">maxvalue</span><span class="p">,</span>
</span><span id="1-3864">            <span class="n">nominvalue</span><span class="o">=</span><span class="n">nominvalue</span><span class="p">,</span>
</span><span id="1-3865">            <span class="n">nomaxvalue</span><span class="o">=</span><span class="n">nomaxvalue</span><span class="p">,</span>
</span><span id="1-3866">            <span class="n">cycle</span><span class="o">=</span><span class="n">cycle</span><span class="p">,</span>
</span><span id="1-3867">            <span class="n">cache</span><span class="o">=</span><span class="n">cache</span><span class="p">,</span>
</span><span id="1-3868">            <span class="n">order</span><span class="o">=</span><span class="n">order</span><span class="p">,</span>
</span><span id="1-3869">        <span class="p">)</span>
</span><span id="1-3870">        <span class="bp">self</span><span class="o">.</span><span class="n">column</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="1-3871">        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">quoted_name</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">quote</span><span class="p">)</span>
</span><span id="1-3872">        <span class="bp">self</span><span class="o">.</span><span class="n">optional</span> <span class="o">=</span> <span class="n">optional</span>
</span><span id="1-3873">        <span class="k">if</span> <span class="n">schema</span> <span class="ow">is</span> <span class="n">BLANK_SCHEMA</span><span class="p">:</span>
</span><span id="1-3874">            <span class="bp">self</span><span class="o">.</span><span class="n">schema</span> <span class="o">=</span> <span class="n">schema</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="1-3875">        <span class="k">elif</span> <span class="n">metadata</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">schema</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">metadata</span><span class="o">.</span><span class="n">schema</span><span class="p">:</span>
</span><span id="1-3876">            <span class="bp">self</span><span class="o">.</span><span class="n">schema</span> <span class="o">=</span> <span class="n">schema</span> <span class="o">=</span> <span class="n">metadata</span><span class="o">.</span><span class="n">schema</span>
</span><span id="1-3877">        <span class="k">else</span><span class="p">:</span>
</span><span id="1-3878">            <span class="bp">self</span><span class="o">.</span><span class="n">schema</span> <span class="o">=</span> <span class="n">quoted_name</span><span class="o">.</span><span class="n">construct</span><span class="p">(</span><span class="n">schema</span><span class="p">,</span> <span class="n">quote_schema</span><span class="p">)</span>
</span><span id="1-3879">        <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span> <span class="o">=</span> <span class="n">metadata</span>
</span><span id="1-3880">        <span class="bp">self</span><span class="o">.</span><span class="n">_key</span> <span class="o">=</span> <span class="n">_get_table_key</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">schema</span><span class="p">)</span>
</span><span id="1-3881">        <span class="k">if</span> <span class="n">metadata</span><span class="p">:</span>
</span><span id="1-3882">            <span class="bp">self</span><span class="o">.</span><span class="n">_set_metadata</span><span class="p">(</span><span class="n">metadata</span><span class="p">)</span>
</span><span id="1-3883">        <span class="k">if</span> <span class="n">data_type</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-3884">            <span class="bp">self</span><span class="o">.</span><span class="n">data_type</span> <span class="o">=</span> <span class="n">to_instance</span><span class="p">(</span><span class="n">data_type</span><span class="p">)</span>
</span><span id="1-3885">        <span class="k">else</span><span class="p">:</span>
</span><span id="1-3886">            <span class="bp">self</span><span class="o">.</span><span class="n">data_type</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="1-3887">
</span><span id="1-3888">    <span class="nd">@util</span><span class="o">.</span><span class="n">preload_module</span><span class="p">(</span><span class="s2">&quot;sqlalchemy.sql.functions&quot;</span><span class="p">)</span>
</span><span id="1-3889">    <span class="k">def</span> <span class="nf">next_value</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Function</span><span class="p">[</span><span class="nb">int</span><span class="p">]:</span>
</span><span id="1-3890"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Return a :class:`.next_value` function element</span>
</span><span id="1-3891"><span class="sd">        which will render the appropriate increment function</span>
</span><span id="1-3892"><span class="sd">        for this :class:`.Sequence` within any SQL expression.</span>
</span><span id="1-3893">
</span><span id="1-3894"><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="1-3895">        <span class="k">return</span> <span class="n">util</span><span class="o">.</span><span class="n">preloaded</span><span class="o">.</span><span class="n">sql_functions</span><span class="o">.</span><span class="n">func</span><span class="o">.</span><span class="n">next_value</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span><span id="1-3896">
</span><span id="1-3897">    <span class="k">def</span> <span class="nf">_set_parent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">:</span> <span class="n">SchemaEventTarget</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-3898">        <span class="n">column</span> <span class="o">=</span> <span class="n">parent</span>
</span><span id="1-3899">        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">column</span><span class="p">,</span> <span class="n">Column</span><span class="p">)</span>
</span><span id="1-3900">        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">_set_parent</span><span class="p">(</span><span class="n">column</span><span class="p">)</span>
</span><span id="1-3901">        <span class="n">column</span><span class="o">.</span><span class="n">_on_table_attach</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_set_table</span><span class="p">)</span>
</span><span id="1-3902">
</span><span id="1-3903">    <span class="k">def</span> <span class="nf">_copy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Sequence</span><span class="p">:</span>
</span><span id="1-3904">        <span class="k">return</span> <span class="n">Sequence</span><span class="p">(</span>
</span><span id="1-3905">            <span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
</span><span id="1-3906">            <span class="n">start</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">,</span>
</span><span id="1-3907">            <span class="n">increment</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">increment</span><span class="p">,</span>
</span><span id="1-3908">            <span class="n">minvalue</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">minvalue</span><span class="p">,</span>
</span><span id="1-3909">            <span class="n">maxvalue</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">maxvalue</span><span class="p">,</span>
</span><span id="1-3910">            <span class="n">nominvalue</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">nominvalue</span><span class="p">,</span>
</span><span id="1-3911">            <span class="n">nomaxvalue</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">nomaxvalue</span><span class="p">,</span>
</span><span id="1-3912">            <span class="n">cycle</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cycle</span><span class="p">,</span>
</span><span id="1-3913">            <span class="n">schema</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">schema</span><span class="p">,</span>
</span><span id="1-3914">            <span class="n">cache</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cache</span><span class="p">,</span>
</span><span id="1-3915">            <span class="n">order</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">order</span><span class="p">,</span>
</span><span id="1-3916">            <span class="n">data_type</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">data_type</span><span class="p">,</span>
</span><span id="1-3917">            <span class="n">optional</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">optional</span><span class="p">,</span>
</span><span id="1-3918">            <span class="n">metadata</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">,</span>
</span><span id="1-3919">            <span class="n">for_update</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">for_update</span><span class="p">,</span>
</span><span id="1-3920">        <span class="p">)</span>
</span><span id="1-3921">
</span><span id="1-3922">    <span class="k">def</span> <span class="nf">_set_table</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">column</span><span class="p">:</span> <span class="n">Column</span><span class="p">[</span><span class="n">Any</span><span class="p">],</span> <span class="n">table</span><span class="p">:</span> <span class="n">Table</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-3923">        <span class="bp">self</span><span class="o">.</span><span class="n">_set_metadata</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">metadata</span><span class="p">)</span>
</span><span id="1-3924">
</span><span id="1-3925">    <span class="k">def</span> <span class="nf">_set_metadata</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">metadata</span><span class="p">:</span> <span class="n">MetaData</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-3926">        <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span> <span class="o">=</span> <span class="n">metadata</span>
</span><span id="1-3927">        <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">_sequences</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_key</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span>
</span><span id="1-3928">
</span><span id="1-3929">    <span class="k">def</span> <span class="nf">create</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bind</span><span class="p">:</span> <span class="n">_CreateDropBind</span><span class="p">,</span> <span class="n">checkfirst</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-3930"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Creates this sequence in the database.&quot;&quot;&quot;</span>
</span><span id="1-3931">
</span><span id="1-3932">        <span class="n">bind</span><span class="o">.</span><span class="n">_run_ddl_visitor</span><span class="p">(</span><span class="n">ddl</span><span class="o">.</span><span class="n">SchemaGenerator</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="n">checkfirst</span><span class="o">=</span><span class="n">checkfirst</span><span class="p">)</span>
</span><span id="1-3933">
</span><span id="1-3934">    <span class="k">def</span> <span class="nf">drop</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bind</span><span class="p">:</span> <span class="n">_CreateDropBind</span><span class="p">,</span> <span class="n">checkfirst</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-3935"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Drops this sequence from the database.&quot;&quot;&quot;</span>
</span><span id="1-3936">
</span><span id="1-3937">        <span class="n">bind</span><span class="o">.</span><span class="n">_run_ddl_visitor</span><span class="p">(</span><span class="n">ddl</span><span class="o">.</span><span class="n">SchemaDropper</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="n">checkfirst</span><span class="o">=</span><span class="n">checkfirst</span><span class="p">)</span>
</span><span id="1-3938">
</span><span id="1-3939">    <span class="k">def</span> <span class="nf">_not_a_column_expr</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">NoReturn</span><span class="p">:</span>
</span><span id="1-3940">        <span class="k">raise</span> <span class="n">exc</span><span class="o">.</span><span class="n">InvalidRequestError</span><span class="p">(</span>
</span><span id="1-3941">            <span class="s2">&quot;This </span><span class="si">%s</span><span class="s2"> cannot be used directly &quot;</span>
</span><span id="1-3942">            <span class="s2">&quot;as a column expression.  Use func.next_value(sequence) &quot;</span>
</span><span id="1-3943">            <span class="s2">&quot;to produce a &#39;next value&#39; function that&#39;s usable &quot;</span>
</span><span id="1-3944">            <span class="s2">&quot;as a column element.&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span>
</span><span id="1-3945">        <span class="p">)</span>
</span><span id="1-3946">
</span><span id="1-3947">
</span><span id="1-3948"><span class="nd">@inspection</span><span class="o">.</span><span class="n">_self_inspects</span>
</span><span id="1-3949"><span class="k">class</span> <span class="nc">FetchedValue</span><span class="p">(</span><span class="n">SchemaEventTarget</span><span class="p">):</span>
</span><span id="1-3950"><span class="w">    </span><span class="sd">&quot;&quot;&quot;A marker for a transparent database-side default.</span>
</span><span id="1-3951">
</span><span id="1-3952"><span class="sd">    Use :class:`.FetchedValue` when the database is configured</span>
</span><span id="1-3953"><span class="sd">    to provide some automatic default for a column.</span>
</span><span id="1-3954">
</span><span id="1-3955"><span class="sd">    E.g.::</span>
</span><span id="1-3956">
</span><span id="1-3957"><span class="sd">        Column(&#39;foo&#39;, Integer, FetchedValue())</span>
</span><span id="1-3958">
</span><span id="1-3959"><span class="sd">    Would indicate that some trigger or default generator</span>
</span><span id="1-3960"><span class="sd">    will create a new value for the ``foo`` column during an</span>
</span><span id="1-3961"><span class="sd">    INSERT.</span>
</span><span id="1-3962">
</span><span id="1-3963"><span class="sd">    .. seealso::</span>
</span><span id="1-3964">
</span><span id="1-3965"><span class="sd">        :ref:`triggered_columns`</span>
</span><span id="1-3966">
</span><span id="1-3967"><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="1-3968">
</span><span id="1-3969">    <span class="n">is_server_default</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="1-3970">    <span class="n">reflected</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="1-3971">    <span class="n">has_argument</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="1-3972">    <span class="n">is_clause_element</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="1-3973">    <span class="n">is_identity</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="1-3974">
</span><span id="1-3975">    <span class="n">column</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Column</span><span class="p">[</span><span class="n">Any</span><span class="p">]]</span>
</span><span id="1-3976">
</span><span id="1-3977">    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">for_update</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-3978">        <span class="bp">self</span><span class="o">.</span><span class="n">for_update</span> <span class="o">=</span> <span class="n">for_update</span>
</span><span id="1-3979">
</span><span id="1-3980">    <span class="k">def</span> <span class="nf">_as_for_update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">for_update</span><span class="p">:</span> <span class="nb">bool</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">FetchedValue</span><span class="p">:</span>
</span><span id="1-3981">        <span class="k">if</span> <span class="n">for_update</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">for_update</span><span class="p">:</span>
</span><span id="1-3982">            <span class="k">return</span> <span class="bp">self</span>
</span><span id="1-3983">        <span class="k">else</span><span class="p">:</span>
</span><span id="1-3984">            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_clone</span><span class="p">(</span><span class="n">for_update</span><span class="p">)</span>
</span><span id="1-3985">
</span><span id="1-3986">    <span class="k">def</span> <span class="nf">_copy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">FetchedValue</span><span class="p">:</span>
</span><span id="1-3987">        <span class="k">return</span> <span class="n">FetchedValue</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">for_update</span><span class="p">)</span>
</span><span id="1-3988">
</span><span id="1-3989">    <span class="k">def</span> <span class="nf">_clone</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">for_update</span><span class="p">:</span> <span class="nb">bool</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Self</span><span class="p">:</span>
</span><span id="1-3990">        <span class="n">n</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">)</span>
</span><span id="1-3991">        <span class="n">n</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">)</span>
</span><span id="1-3992">        <span class="n">n</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;column&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="1-3993">        <span class="n">n</span><span class="o">.</span><span class="n">for_update</span> <span class="o">=</span> <span class="n">for_update</span>
</span><span id="1-3994">        <span class="k">return</span> <span class="n">n</span>
</span><span id="1-3995">
</span><span id="1-3996">    <span class="k">def</span> <span class="nf">_set_parent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">:</span> <span class="n">SchemaEventTarget</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-3997">        <span class="n">column</span> <span class="o">=</span> <span class="n">parent</span>
</span><span id="1-3998">        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">column</span><span class="p">,</span> <span class="n">Column</span><span class="p">)</span>
</span><span id="1-3999">        <span class="bp">self</span><span class="o">.</span><span class="n">column</span> <span class="o">=</span> <span class="n">column</span>
</span><span id="1-4000">        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">for_update</span><span class="p">:</span>
</span><span id="1-4001">            <span class="bp">self</span><span class="o">.</span><span class="n">column</span><span class="o">.</span><span class="n">server_onupdate</span> <span class="o">=</span> <span class="bp">self</span>
</span><span id="1-4002">        <span class="k">else</span><span class="p">:</span>
</span><span id="1-4003">            <span class="bp">self</span><span class="o">.</span><span class="n">column</span><span class="o">.</span><span class="n">server_default</span> <span class="o">=</span> <span class="bp">self</span>
</span><span id="1-4004">
</span><span id="1-4005">    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="1-4006">        <span class="k">return</span> <span class="n">util</span><span class="o">.</span><span class="n">generic_repr</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span><span id="1-4007">
</span><span id="1-4008">
</span><span id="1-4009"><span class="k">class</span> <span class="nc">DefaultClause</span><span class="p">(</span><span class="n">FetchedValue</span><span class="p">):</span>
</span><span id="1-4010"><span class="w">    </span><span class="sd">&quot;&quot;&quot;A DDL-specified DEFAULT column value.</span>
</span><span id="1-4011">
</span><span id="1-4012"><span class="sd">    :class:`.DefaultClause` is a :class:`.FetchedValue`</span>
</span><span id="1-4013"><span class="sd">    that also generates a &quot;DEFAULT&quot; clause when</span>
</span><span id="1-4014"><span class="sd">    &quot;CREATE TABLE&quot; is emitted.</span>
</span><span id="1-4015">
</span><span id="1-4016"><span class="sd">    :class:`.DefaultClause` is generated automatically</span>
</span><span id="1-4017"><span class="sd">    whenever the ``server_default``, ``server_onupdate`` arguments of</span>
</span><span id="1-4018"><span class="sd">    :class:`_schema.Column` are used.  A :class:`.DefaultClause`</span>
</span><span id="1-4019"><span class="sd">    can be passed positionally as well.</span>
</span><span id="1-4020">
</span><span id="1-4021"><span class="sd">    For example, the following::</span>
</span><span id="1-4022">
</span><span id="1-4023"><span class="sd">        Column(&#39;foo&#39;, Integer, server_default=&quot;50&quot;)</span>
</span><span id="1-4024">
</span><span id="1-4025"><span class="sd">    Is equivalent to::</span>
</span><span id="1-4026">
</span><span id="1-4027"><span class="sd">        Column(&#39;foo&#39;, Integer, DefaultClause(&quot;50&quot;))</span>
</span><span id="1-4028">
</span><span id="1-4029"><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="1-4030">
</span><span id="1-4031">    <span class="n">has_argument</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="1-4032">
</span><span id="1-4033">    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
</span><span id="1-4034">        <span class="bp">self</span><span class="p">,</span>
</span><span id="1-4035">        <span class="n">arg</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">ClauseElement</span><span class="p">,</span> <span class="n">TextClause</span><span class="p">],</span>
</span><span id="1-4036">        <span class="n">for_update</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="1-4037">        <span class="n">_reflected</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="1-4038">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-4039">        <span class="n">util</span><span class="o">.</span><span class="n">assert_arg_type</span><span class="p">(</span><span class="n">arg</span><span class="p">,</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">ClauseElement</span><span class="p">,</span> <span class="n">TextClause</span><span class="p">),</span> <span class="s2">&quot;arg&quot;</span><span class="p">)</span>
</span><span id="1-4040">        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">for_update</span><span class="p">)</span>
</span><span id="1-4041">        <span class="bp">self</span><span class="o">.</span><span class="n">arg</span> <span class="o">=</span> <span class="n">arg</span>
</span><span id="1-4042">        <span class="bp">self</span><span class="o">.</span><span class="n">reflected</span> <span class="o">=</span> <span class="n">_reflected</span>
</span><span id="1-4043">
</span><span id="1-4044">    <span class="k">def</span> <span class="nf">_copy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DefaultClause</span><span class="p">:</span>
</span><span id="1-4045">        <span class="k">return</span> <span class="n">DefaultClause</span><span class="p">(</span>
</span><span id="1-4046">            <span class="n">arg</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">arg</span><span class="p">,</span> <span class="n">for_update</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">for_update</span><span class="p">,</span> <span class="n">_reflected</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">reflected</span>
</span><span id="1-4047">        <span class="p">)</span>
</span><span id="1-4048">
</span><span id="1-4049">    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="1-4050">        <span class="k">return</span> <span class="s2">&quot;DefaultClause(</span><span class="si">%r</span><span class="s2">, for_update=</span><span class="si">%r</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">arg</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">for_update</span><span class="p">)</span>
</span><span id="1-4051">
</span><span id="1-4052">
</span><span id="1-4053"><span class="k">class</span> <span class="nc">Constraint</span><span class="p">(</span><span class="n">DialectKWArgs</span><span class="p">,</span> <span class="n">HasConditionalDDL</span><span class="p">,</span> <span class="n">SchemaItem</span><span class="p">):</span>
</span><span id="1-4054"><span class="w">    </span><span class="sd">&quot;&quot;&quot;A table-level SQL constraint.</span>
</span><span id="1-4055">
</span><span id="1-4056"><span class="sd">    :class:`_schema.Constraint` serves as the base class for the series of</span>
</span><span id="1-4057"><span class="sd">    constraint objects that can be associated with :class:`_schema.Table`</span>
</span><span id="1-4058"><span class="sd">    objects, including :class:`_schema.PrimaryKeyConstraint`,</span>
</span><span id="1-4059"><span class="sd">    :class:`_schema.ForeignKeyConstraint`</span>
</span><span id="1-4060"><span class="sd">    :class:`_schema.UniqueConstraint`, and</span>
</span><span id="1-4061"><span class="sd">    :class:`_schema.CheckConstraint`.</span>
</span><span id="1-4062">
</span><span id="1-4063"><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="1-4064">
</span><span id="1-4065">    <span class="n">__visit_name__</span> <span class="o">=</span> <span class="s2">&quot;constraint&quot;</span>
</span><span id="1-4066">
</span><span id="1-4067">    <span class="n">_creation_order</span><span class="p">:</span> <span class="nb">int</span>
</span><span id="1-4068">    <span class="n">_column_flag</span><span class="p">:</span> <span class="nb">bool</span>
</span><span id="1-4069">
</span><span id="1-4070">    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
</span><span id="1-4071">        <span class="bp">self</span><span class="p">,</span>
</span><span id="1-4072">        <span class="n">name</span><span class="p">:</span> <span class="n">_ConstraintNameArgument</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="1-4073">        <span class="n">deferrable</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="1-4074">        <span class="n">initially</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="1-4075">        <span class="n">info</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">_InfoType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="1-4076">        <span class="n">comment</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="1-4077">        <span class="n">_create_rule</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="1-4078">        <span class="n">_type_bound</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="1-4079">        <span class="o">**</span><span class="n">dialect_kw</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
</span><span id="1-4080">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-4081"><span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Create a SQL constraint.</span>
</span><span id="1-4082">
</span><span id="1-4083"><span class="sd">        :param name:</span>
</span><span id="1-4084"><span class="sd">          Optional, the in-database name of this ``Constraint``.</span>
</span><span id="1-4085">
</span><span id="1-4086"><span class="sd">        :param deferrable:</span>
</span><span id="1-4087"><span class="sd">          Optional bool.  If set, emit DEFERRABLE or NOT DEFERRABLE when</span>
</span><span id="1-4088"><span class="sd">          issuing DDL for this constraint.</span>
</span><span id="1-4089">
</span><span id="1-4090"><span class="sd">        :param initially:</span>
</span><span id="1-4091"><span class="sd">          Optional string.  If set, emit INITIALLY &lt;value&gt; when issuing DDL</span>
</span><span id="1-4092"><span class="sd">          for this constraint.</span>
</span><span id="1-4093">
</span><span id="1-4094"><span class="sd">        :param info: Optional data dictionary which will be populated into the</span>
</span><span id="1-4095"><span class="sd">            :attr:`.SchemaItem.info` attribute of this object.</span>
</span><span id="1-4096">
</span><span id="1-4097"><span class="sd">        :param comment: Optional string that will render an SQL comment on</span>
</span><span id="1-4098"><span class="sd">          foreign key constraint creation.</span>
</span><span id="1-4099">
</span><span id="1-4100"><span class="sd">            .. versionadded:: 2.0</span>
</span><span id="1-4101">
</span><span id="1-4102"><span class="sd">        :param \**dialect_kw:  Additional keyword arguments are dialect</span>
</span><span id="1-4103"><span class="sd">            specific, and passed in the form ``&lt;dialectname&gt;_&lt;argname&gt;``.  See</span>
</span><span id="1-4104"><span class="sd">            the documentation regarding an individual dialect at</span>
</span><span id="1-4105"><span class="sd">            :ref:`dialect_toplevel` for detail on documented arguments.</span>
</span><span id="1-4106">
</span><span id="1-4107"><span class="sd">        :param _create_rule:</span>
</span><span id="1-4108"><span class="sd">          used internally by some datatypes that also create constraints.</span>
</span><span id="1-4109">
</span><span id="1-4110"><span class="sd">        :param _type_bound:</span>
</span><span id="1-4111"><span class="sd">          used internally to indicate that this constraint is associated with</span>
</span><span id="1-4112"><span class="sd">          a specific datatype.</span>
</span><span id="1-4113">
</span><span id="1-4114"><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="1-4115">
</span><span id="1-4116">        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
</span><span id="1-4117">        <span class="bp">self</span><span class="o">.</span><span class="n">deferrable</span> <span class="o">=</span> <span class="n">deferrable</span>
</span><span id="1-4118">        <span class="bp">self</span><span class="o">.</span><span class="n">initially</span> <span class="o">=</span> <span class="n">initially</span>
</span><span id="1-4119">        <span class="k">if</span> <span class="n">info</span><span class="p">:</span>
</span><span id="1-4120">            <span class="bp">self</span><span class="o">.</span><span class="n">info</span> <span class="o">=</span> <span class="n">info</span>
</span><span id="1-4121">        <span class="bp">self</span><span class="o">.</span><span class="n">_create_rule</span> <span class="o">=</span> <span class="n">_create_rule</span>
</span><span id="1-4122">        <span class="bp">self</span><span class="o">.</span><span class="n">_type_bound</span> <span class="o">=</span> <span class="n">_type_bound</span>
</span><span id="1-4123">        <span class="n">util</span><span class="o">.</span><span class="n">set_creation_order</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span><span id="1-4124">        <span class="bp">self</span><span class="o">.</span><span class="n">_validate_dialect_kwargs</span><span class="p">(</span><span class="n">dialect_kw</span><span class="p">)</span>
</span><span id="1-4125">        <span class="bp">self</span><span class="o">.</span><span class="n">comment</span> <span class="o">=</span> <span class="n">comment</span>
</span><span id="1-4126">
</span><span id="1-4127">    <span class="k">def</span> <span class="nf">_should_create_for_compiler</span><span class="p">(</span>
</span><span id="1-4128">        <span class="bp">self</span><span class="p">,</span> <span class="n">compiler</span><span class="p">:</span> <span class="n">DDLCompiler</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">:</span> <span class="n">Any</span>
</span><span id="1-4129">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="1-4130">        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_rule</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_rule</span><span class="p">(</span><span class="n">compiler</span><span class="p">):</span>
</span><span id="1-4131">            <span class="k">return</span> <span class="kc">False</span>
</span><span id="1-4132">        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ddl_if</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-4133">            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ddl_if</span><span class="o">.</span><span class="n">_should_execute</span><span class="p">(</span>
</span><span id="1-4134">                <span class="n">ddl</span><span class="o">.</span><span class="n">CreateConstraint</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span> <span class="bp">self</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">compiler</span><span class="o">=</span><span class="n">compiler</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span>
</span><span id="1-4135">            <span class="p">)</span>
</span><span id="1-4136">        <span class="k">else</span><span class="p">:</span>
</span><span id="1-4137">            <span class="k">return</span> <span class="kc">True</span>
</span><span id="1-4138">
</span><span id="1-4139">    <span class="nd">@property</span>
</span><span id="1-4140">    <span class="k">def</span> <span class="nf">table</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Table</span><span class="p">:</span>
</span><span id="1-4141">        <span class="k">try</span><span class="p">:</span>
</span><span id="1-4142">            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="p">,</span> <span class="n">Table</span><span class="p">):</span>
</span><span id="1-4143">                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span>
</span><span id="1-4144">        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
</span><span id="1-4145">            <span class="k">pass</span>
</span><span id="1-4146">        <span class="k">raise</span> <span class="n">exc</span><span class="o">.</span><span class="n">InvalidRequestError</span><span class="p">(</span>
</span><span id="1-4147">            <span class="s2">&quot;This constraint is not bound to a table.  Did you &quot;</span>
</span><span id="1-4148">            <span class="s2">&quot;mean to call table.append_constraint(constraint) ?&quot;</span>
</span><span id="1-4149">        <span class="p">)</span>
</span><span id="1-4150">
</span><span id="1-4151">    <span class="k">def</span> <span class="nf">_set_parent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">:</span> <span class="n">SchemaEventTarget</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-4152">        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">parent</span><span class="p">,</span> <span class="p">(</span><span class="n">Table</span><span class="p">,</span> <span class="n">Column</span><span class="p">))</span>
</span><span id="1-4153">        <span class="bp">self</span><span class="o">.</span><span class="n">parent</span> <span class="o">=</span> <span class="n">parent</span>
</span><span id="1-4154">        <span class="n">parent</span><span class="o">.</span><span class="n">constraints</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span><span id="1-4155">
</span><span id="1-4156">    <span class="nd">@util</span><span class="o">.</span><span class="n">deprecated</span><span class="p">(</span>
</span><span id="1-4157">        <span class="s2">&quot;1.4&quot;</span><span class="p">,</span>
</span><span id="1-4158">        <span class="s2">&quot;The :meth:`_schema.Constraint.copy` method is deprecated &quot;</span>
</span><span id="1-4159">        <span class="s2">&quot;and will be removed in a future release.&quot;</span><span class="p">,</span>
</span><span id="1-4160">    <span class="p">)</span>
</span><span id="1-4161">    <span class="k">def</span> <span class="nf">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Self</span><span class="p">:</span>
</span><span id="1-4162">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_copy</span><span class="p">(</span><span class="o">**</span><span class="n">kw</span><span class="p">)</span>
</span><span id="1-4163">
</span><span id="1-4164">    <span class="k">def</span> <span class="nf">_copy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Self</span><span class="p">:</span>
</span><span id="1-4165">        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span>
</span><span id="1-4166">
</span><span id="1-4167">
</span><span id="1-4168"><span class="k">class</span> <span class="nc">ColumnCollectionMixin</span><span class="p">:</span>
</span><span id="1-4169"><span class="w">    </span><span class="sd">&quot;&quot;&quot;A :class:`_expression.ColumnCollection` of :class:`_schema.Column`</span>
</span><span id="1-4170"><span class="sd">    objects.</span>
</span><span id="1-4171">
</span><span id="1-4172"><span class="sd">    This collection represents the columns which are referred to by</span>
</span><span id="1-4173"><span class="sd">    this object.</span>
</span><span id="1-4174">
</span><span id="1-4175"><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="1-4176">
</span><span id="1-4177">    <span class="n">_columns</span><span class="p">:</span> <span class="n">DedupeColumnCollection</span><span class="p">[</span><span class="n">Column</span><span class="p">[</span><span class="n">Any</span><span class="p">]]</span>
</span><span id="1-4178">
</span><span id="1-4179">    <span class="n">_allow_multiple_tables</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="1-4180">
</span><span id="1-4181">    <span class="n">_pending_colargs</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Column</span><span class="p">[</span><span class="n">Any</span><span class="p">]]]]</span>
</span><span id="1-4182">
</span><span id="1-4183">    <span class="k">if</span> <span class="n">TYPE_CHECKING</span><span class="p">:</span>
</span><span id="1-4184">
</span><span id="1-4185">        <span class="k">def</span> <span class="nf">_set_parent_with_dispatch</span><span class="p">(</span>
</span><span id="1-4186">            <span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">:</span> <span class="n">SchemaEventTarget</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">:</span> <span class="n">Any</span>
</span><span id="1-4187">        <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-4188">            <span class="o">...</span>
</span><span id="1-4189">
</span><span id="1-4190">    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
</span><span id="1-4191">        <span class="bp">self</span><span class="p">,</span>
</span><span id="1-4192">        <span class="o">*</span><span class="n">columns</span><span class="p">:</span> <span class="n">_DDLColumnArgument</span><span class="p">,</span>
</span><span id="1-4193">        <span class="n">_autoattach</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="1-4194">        <span class="n">_column_flag</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="1-4195">        <span class="n">_gather_expressions</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span>
</span><span id="1-4196">            <span class="n">List</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">ColumnElement</span><span class="p">[</span><span class="n">Any</span><span class="p">]]]</span>
</span><span id="1-4197">        <span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="1-4198">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-4199">        <span class="bp">self</span><span class="o">.</span><span class="n">_column_flag</span> <span class="o">=</span> <span class="n">_column_flag</span>
</span><span id="1-4200">        <span class="bp">self</span><span class="o">.</span><span class="n">_columns</span> <span class="o">=</span> <span class="n">DedupeColumnCollection</span><span class="p">()</span>
</span><span id="1-4201">
</span><span id="1-4202">        <span class="n">processed_expressions</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span>
</span><span id="1-4203">            <span class="n">List</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">ColumnElement</span><span class="p">[</span><span class="n">Any</span><span class="p">],</span> <span class="nb">str</span><span class="p">]]</span>
</span><span id="1-4204">        <span class="p">]</span> <span class="o">=</span> <span class="n">_gather_expressions</span>
</span><span id="1-4205">
</span><span id="1-4206">        <span class="k">if</span> <span class="n">processed_expressions</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-4207">            <span class="bp">self</span><span class="o">.</span><span class="n">_pending_colargs</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="1-4208">            <span class="k">for</span> <span class="p">(</span>
</span><span id="1-4209">                <span class="n">expr</span><span class="p">,</span>
</span><span id="1-4210">                <span class="n">_</span><span class="p">,</span>
</span><span id="1-4211">                <span class="n">_</span><span class="p">,</span>
</span><span id="1-4212">                <span class="n">add_element</span><span class="p">,</span>
</span><span id="1-4213">            <span class="p">)</span> <span class="ow">in</span> <span class="n">coercions</span><span class="o">.</span><span class="n">expect_col_expression_collection</span><span class="p">(</span>
</span><span id="1-4214">                <span class="n">roles</span><span class="o">.</span><span class="n">DDLConstraintColumnRole</span><span class="p">,</span> <span class="n">columns</span>
</span><span id="1-4215">            <span class="p">):</span>
</span><span id="1-4216">                <span class="bp">self</span><span class="o">.</span><span class="n">_pending_colargs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">add_element</span><span class="p">)</span>
</span><span id="1-4217">                <span class="n">processed_expressions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">expr</span><span class="p">)</span>
</span><span id="1-4218">        <span class="k">else</span><span class="p">:</span>
</span><span id="1-4219">            <span class="bp">self</span><span class="o">.</span><span class="n">_pending_colargs</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="1-4220">                <span class="n">coercions</span><span class="o">.</span><span class="n">expect</span><span class="p">(</span><span class="n">roles</span><span class="o">.</span><span class="n">DDLConstraintColumnRole</span><span class="p">,</span> <span class="n">column</span><span class="p">)</span>
</span><span id="1-4221">                <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="n">columns</span>
</span><span id="1-4222">            <span class="p">]</span>
</span><span id="1-4223">
</span><span id="1-4224">        <span class="k">if</span> <span class="n">_autoattach</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pending_colargs</span><span class="p">:</span>
</span><span id="1-4225">            <span class="bp">self</span><span class="o">.</span><span class="n">_check_attach</span><span class="p">()</span>
</span><span id="1-4226">
</span><span id="1-4227">    <span class="k">def</span> <span class="nf">_check_attach</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">evt</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-4228">        <span class="n">col_objs</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pending_colargs</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">Column</span><span class="p">)]</span>
</span><span id="1-4229">
</span><span id="1-4230">        <span class="n">cols_w_table</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">col_objs</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">table</span><span class="p">,</span> <span class="n">Table</span><span class="p">)]</span>
</span><span id="1-4231">
</span><span id="1-4232">        <span class="n">cols_wo_table</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">col_objs</span><span class="p">)</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="n">cols_w_table</span><span class="p">)</span>
</span><span id="1-4233">        <span class="k">if</span> <span class="n">cols_wo_table</span><span class="p">:</span>
</span><span id="1-4234">            <span class="c1"># feature #3341 - place event listeners for Column objects</span>
</span><span id="1-4235">            <span class="c1"># such that when all those cols are attached, we autoattach.</span>
</span><span id="1-4236">            <span class="k">assert</span> <span class="ow">not</span> <span class="n">evt</span><span class="p">,</span> <span class="s2">&quot;Should not reach here on event call&quot;</span>
</span><span id="1-4237">
</span><span id="1-4238">            <span class="c1"># issue #3411 - don&#39;t do the per-column auto-attach if some of the</span>
</span><span id="1-4239">            <span class="c1"># columns are specified as strings.</span>
</span><span id="1-4240">            <span class="n">has_string_cols</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="1-4241">                <span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pending_colargs</span> <span class="k">if</span> <span class="n">c</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span id="1-4242">            <span class="p">}</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="n">col_objs</span><span class="p">)</span>
</span><span id="1-4243">            <span class="k">if</span> <span class="ow">not</span> <span class="n">has_string_cols</span><span class="p">:</span>
</span><span id="1-4244">
</span><span id="1-4245">                <span class="k">def</span> <span class="nf">_col_attached</span><span class="p">(</span><span class="n">column</span><span class="p">:</span> <span class="n">Column</span><span class="p">[</span><span class="n">Any</span><span class="p">],</span> <span class="n">table</span><span class="p">:</span> <span class="n">Table</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-4246">                    <span class="c1"># this isinstance() corresponds with the</span>
</span><span id="1-4247">                    <span class="c1"># isinstance() above; only want to count Table-bound</span>
</span><span id="1-4248">                    <span class="c1"># columns</span>
</span><span id="1-4249">                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">table</span><span class="p">,</span> <span class="n">Table</span><span class="p">):</span>
</span><span id="1-4250">                        <span class="n">cols_wo_table</span><span class="o">.</span><span class="n">discard</span><span class="p">(</span><span class="n">column</span><span class="p">)</span>
</span><span id="1-4251">                        <span class="k">if</span> <span class="ow">not</span> <span class="n">cols_wo_table</span><span class="p">:</span>
</span><span id="1-4252">                            <span class="bp">self</span><span class="o">.</span><span class="n">_check_attach</span><span class="p">(</span><span class="n">evt</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="1-4253">
</span><span id="1-4254">                <span class="bp">self</span><span class="o">.</span><span class="n">_cols_wo_table</span> <span class="o">=</span> <span class="n">cols_wo_table</span>
</span><span id="1-4255">                <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">cols_wo_table</span><span class="p">:</span>
</span><span id="1-4256">                    <span class="n">col</span><span class="o">.</span><span class="n">_on_table_attach</span><span class="p">(</span><span class="n">_col_attached</span><span class="p">)</span>
</span><span id="1-4257">                <span class="k">return</span>
</span><span id="1-4258">
</span><span id="1-4259">        <span class="n">columns</span> <span class="o">=</span> <span class="n">cols_w_table</span>
</span><span id="1-4260">
</span><span id="1-4261">        <span class="n">tables</span> <span class="o">=</span> <span class="p">{</span><span class="n">c</span><span class="o">.</span><span class="n">table</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">columns</span><span class="p">}</span>
</span><span id="1-4262">        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">tables</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="1-4263">            <span class="bp">self</span><span class="o">.</span><span class="n">_set_parent_with_dispatch</span><span class="p">(</span><span class="n">tables</span><span class="o">.</span><span class="n">pop</span><span class="p">())</span>
</span><span id="1-4264">        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">tables</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_allow_multiple_tables</span><span class="p">:</span>
</span><span id="1-4265">            <span class="n">table</span> <span class="o">=</span> <span class="n">columns</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">table</span>
</span><span id="1-4266">            <span class="n">others</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">columns</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">table</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">table</span><span class="p">]</span>
</span><span id="1-4267">            <span class="k">if</span> <span class="n">others</span><span class="p">:</span>
</span><span id="1-4268">                <span class="k">raise</span> <span class="n">exc</span><span class="o">.</span><span class="n">ArgumentError</span><span class="p">(</span>
</span><span id="1-4269">                    <span class="s2">&quot;Column(s) </span><span class="si">%s</span><span class="s2"> are not part of table &#39;</span><span class="si">%s</span><span class="s2">&#39;.&quot;</span>
</span><span id="1-4270">                    <span class="o">%</span> <span class="p">(</span>
</span><span id="1-4271">                        <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s2">&quot;&#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span> <span class="o">%</span> <span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">others</span><span class="p">),</span>
</span><span id="1-4272">                        <span class="n">table</span><span class="o">.</span><span class="n">description</span><span class="p">,</span>
</span><span id="1-4273">                    <span class="p">)</span>
</span><span id="1-4274">                <span class="p">)</span>
</span><span id="1-4275">
</span><span id="1-4276">    <span class="nd">@util</span><span class="o">.</span><span class="n">ro_memoized_property</span>
</span><span id="1-4277">    <span class="k">def</span> <span class="nf">columns</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ReadOnlyColumnCollection</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Column</span><span class="p">[</span><span class="n">Any</span><span class="p">]]:</span>
</span><span id="1-4278">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_columns</span><span class="o">.</span><span class="n">as_readonly</span><span class="p">()</span>
</span><span id="1-4279">
</span><span id="1-4280">    <span class="nd">@util</span><span class="o">.</span><span class="n">ro_memoized_property</span>
</span><span id="1-4281">    <span class="k">def</span> <span class="nf">c</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ReadOnlyColumnCollection</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Column</span><span class="p">[</span><span class="n">Any</span><span class="p">]]:</span>
</span><span id="1-4282">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_columns</span><span class="o">.</span><span class="n">as_readonly</span><span class="p">()</span>
</span><span id="1-4283">
</span><span id="1-4284">    <span class="k">def</span> <span class="nf">_col_expressions</span><span class="p">(</span>
</span><span id="1-4285">        <span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Table</span><span class="p">,</span> <span class="n">Column</span><span class="p">[</span><span class="n">Any</span><span class="p">]]</span>
</span><span id="1-4286">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="n">Column</span><span class="p">[</span><span class="n">Any</span><span class="p">]]]:</span>
</span><span id="1-4287">        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">parent</span><span class="p">,</span> <span class="n">Column</span><span class="p">):</span>
</span><span id="1-4288">            <span class="n">result</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="n">Column</span><span class="p">[</span><span class="n">Any</span><span class="p">]]]</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="1-4289">                <span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pending_colargs</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">Column</span><span class="p">)</span>
</span><span id="1-4290">            <span class="p">]</span>
</span><span id="1-4291">            <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_pending_colargs</span><span class="p">)</span>
</span><span id="1-4292">            <span class="k">return</span> <span class="n">result</span>
</span><span id="1-4293">        <span class="k">else</span><span class="p">:</span>
</span><span id="1-4294">            <span class="k">try</span><span class="p">:</span>
</span><span id="1-4295">                <span class="k">return</span> <span class="p">[</span>
</span><span id="1-4296">                    <span class="n">parent</span><span class="o">.</span><span class="n">c</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">col</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">else</span> <span class="n">col</span>
</span><span id="1-4297">                    <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pending_colargs</span>
</span><span id="1-4298">                <span class="p">]</span>
</span><span id="1-4299">            <span class="k">except</span> <span class="ne">KeyError</span> <span class="k">as</span> <span class="n">ke</span><span class="p">:</span>
</span><span id="1-4300">                <span class="k">raise</span> <span class="n">exc</span><span class="o">.</span><span class="n">ConstraintColumnNotFoundError</span><span class="p">(</span>
</span><span id="1-4301">                    <span class="sa">f</span><span class="s2">&quot;Can&#39;t create </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2"> &quot;</span>
</span><span id="1-4302">                    <span class="sa">f</span><span class="s2">&quot;on table &#39;</span><span class="si">{</span><span class="n">parent</span><span class="o">.</span><span class="n">description</span><span class="si">}</span><span class="s2">&#39;: no column &quot;</span>
</span><span id="1-4303">                    <span class="sa">f</span><span class="s2">&quot;named &#39;</span><span class="si">{</span><span class="n">ke</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">&#39; is present.&quot;</span>
</span><span id="1-4304">                <span class="p">)</span> <span class="kn">from</span> <span class="nn">ke</span>
</span><span id="1-4305">
</span><span id="1-4306">    <span class="k">def</span> <span class="nf">_set_parent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">:</span> <span class="n">SchemaEventTarget</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-4307">        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">parent</span><span class="p">,</span> <span class="p">(</span><span class="n">Table</span><span class="p">,</span> <span class="n">Column</span><span class="p">))</span>
</span><span id="1-4308">
</span><span id="1-4309">        <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_col_expressions</span><span class="p">(</span><span class="n">parent</span><span class="p">):</span>
</span><span id="1-4310">            <span class="k">if</span> <span class="n">col</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-4311">                <span class="bp">self</span><span class="o">.</span><span class="n">_columns</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">col</span><span class="p">)</span>
</span><span id="1-4312">
</span><span id="1-4313">
</span><span id="1-4314"><span class="k">class</span> <span class="nc">ColumnCollectionConstraint</span><span class="p">(</span><span class="n">ColumnCollectionMixin</span><span class="p">,</span> <span class="n">Constraint</span><span class="p">):</span>
</span><span id="1-4315"><span class="w">    </span><span class="sd">&quot;&quot;&quot;A constraint that proxies a ColumnCollection.&quot;&quot;&quot;</span>
</span><span id="1-4316">
</span><span id="1-4317">    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
</span><span id="1-4318">        <span class="bp">self</span><span class="p">,</span>
</span><span id="1-4319">        <span class="o">*</span><span class="n">columns</span><span class="p">:</span> <span class="n">_DDLColumnArgument</span><span class="p">,</span>
</span><span id="1-4320">        <span class="n">name</span><span class="p">:</span> <span class="n">_ConstraintNameArgument</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="1-4321">        <span class="n">deferrable</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="1-4322">        <span class="n">initially</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="1-4323">        <span class="n">info</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">_InfoType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="1-4324">        <span class="n">_autoattach</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="1-4325">        <span class="n">_column_flag</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="1-4326">        <span class="n">_gather_expressions</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">_DDLColumnArgument</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="1-4327">        <span class="o">**</span><span class="n">dialect_kw</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
</span><span id="1-4328">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-4329"><span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="1-4330"><span class="sd">        :param \*columns:</span>
</span><span id="1-4331"><span class="sd">          A sequence of column names or Column objects.</span>
</span><span id="1-4332">
</span><span id="1-4333"><span class="sd">        :param name:</span>
</span><span id="1-4334"><span class="sd">          Optional, the in-database name of this constraint.</span>
</span><span id="1-4335">
</span><span id="1-4336"><span class="sd">        :param deferrable:</span>
</span><span id="1-4337"><span class="sd">          Optional bool.  If set, emit DEFERRABLE or NOT DEFERRABLE when</span>
</span><span id="1-4338"><span class="sd">          issuing DDL for this constraint.</span>
</span><span id="1-4339">
</span><span id="1-4340"><span class="sd">        :param initially:</span>
</span><span id="1-4341"><span class="sd">          Optional string.  If set, emit INITIALLY &lt;value&gt; when issuing DDL</span>
</span><span id="1-4342"><span class="sd">          for this constraint.</span>
</span><span id="1-4343">
</span><span id="1-4344"><span class="sd">        :param \**dialect_kw: other keyword arguments including</span>
</span><span id="1-4345"><span class="sd">          dialect-specific arguments are propagated to the :class:`.Constraint`</span>
</span><span id="1-4346"><span class="sd">          superclass.</span>
</span><span id="1-4347">
</span><span id="1-4348"><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="1-4349">        <span class="n">Constraint</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="1-4350">            <span class="bp">self</span><span class="p">,</span>
</span><span id="1-4351">            <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
</span><span id="1-4352">            <span class="n">deferrable</span><span class="o">=</span><span class="n">deferrable</span><span class="p">,</span>
</span><span id="1-4353">            <span class="n">initially</span><span class="o">=</span><span class="n">initially</span><span class="p">,</span>
</span><span id="1-4354">            <span class="n">info</span><span class="o">=</span><span class="n">info</span><span class="p">,</span>
</span><span id="1-4355">            <span class="o">**</span><span class="n">dialect_kw</span><span class="p">,</span>
</span><span id="1-4356">        <span class="p">)</span>
</span><span id="1-4357">        <span class="n">ColumnCollectionMixin</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="1-4358">            <span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">columns</span><span class="p">,</span> <span class="n">_autoattach</span><span class="o">=</span><span class="n">_autoattach</span><span class="p">,</span> <span class="n">_column_flag</span><span class="o">=</span><span class="n">_column_flag</span>
</span><span id="1-4359">        <span class="p">)</span>
</span><span id="1-4360">
</span><span id="1-4361">    <span class="n">columns</span><span class="p">:</span> <span class="n">ReadOnlyColumnCollection</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Column</span><span class="p">[</span><span class="n">Any</span><span class="p">]]</span>
</span><span id="1-4362"><span class="w">    </span><span class="sd">&quot;&quot;&quot;A :class:`_expression.ColumnCollection` representing the set of columns</span>
</span><span id="1-4363"><span class="sd">    for this constraint.</span>
</span><span id="1-4364">
</span><span id="1-4365"><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="1-4366">
</span><span id="1-4367">    <span class="k">def</span> <span class="nf">_set_parent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">:</span> <span class="n">SchemaEventTarget</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-4368">        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">parent</span><span class="p">,</span> <span class="p">(</span><span class="n">Column</span><span class="p">,</span> <span class="n">Table</span><span class="p">))</span>
</span><span id="1-4369">        <span class="n">Constraint</span><span class="o">.</span><span class="n">_set_parent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">)</span>
</span><span id="1-4370">        <span class="n">ColumnCollectionMixin</span><span class="o">.</span><span class="n">_set_parent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">)</span>
</span><span id="1-4371">
</span><span id="1-4372">    <span class="k">def</span> <span class="fm">__contains__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="1-4373">        <span class="k">return</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_columns</span>
</span><span id="1-4374">
</span><span id="1-4375">    <span class="nd">@util</span><span class="o">.</span><span class="n">deprecated</span><span class="p">(</span>
</span><span id="1-4376">        <span class="s2">&quot;1.4&quot;</span><span class="p">,</span>
</span><span id="1-4377">        <span class="s2">&quot;The :meth:`_schema.ColumnCollectionConstraint.copy` method &quot;</span>
</span><span id="1-4378">        <span class="s2">&quot;is deprecated and will be removed in a future release.&quot;</span><span class="p">,</span>
</span><span id="1-4379">    <span class="p">)</span>
</span><span id="1-4380">    <span class="k">def</span> <span class="nf">copy</span><span class="p">(</span>
</span><span id="1-4381">        <span class="bp">self</span><span class="p">,</span>
</span><span id="1-4382">        <span class="o">*</span><span class="p">,</span>
</span><span id="1-4383">        <span class="n">target_table</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Table</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="1-4384">        <span class="o">**</span><span class="n">kw</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
</span><span id="1-4385">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ColumnCollectionConstraint</span><span class="p">:</span>
</span><span id="1-4386">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_copy</span><span class="p">(</span><span class="n">target_table</span><span class="o">=</span><span class="n">target_table</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>
</span><span id="1-4387">
</span><span id="1-4388">    <span class="k">def</span> <span class="nf">_copy</span><span class="p">(</span>
</span><span id="1-4389">        <span class="bp">self</span><span class="p">,</span>
</span><span id="1-4390">        <span class="o">*</span><span class="p">,</span>
</span><span id="1-4391">        <span class="n">target_table</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Table</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="1-4392">        <span class="o">**</span><span class="n">kw</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
</span><span id="1-4393">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ColumnCollectionConstraint</span><span class="p">:</span>
</span><span id="1-4394">        <span class="c1"># ticket #5276</span>
</span><span id="1-4395">        <span class="n">constraint_kwargs</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="1-4396">        <span class="k">for</span> <span class="n">dialect_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dialect_options</span><span class="p">:</span>
</span><span id="1-4397">            <span class="n">dialect_options</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dialect_options</span><span class="p">[</span><span class="n">dialect_name</span><span class="p">]</span><span class="o">.</span><span class="n">_non_defaults</span>
</span><span id="1-4398">            <span class="k">for</span> <span class="p">(</span>
</span><span id="1-4399">                <span class="n">dialect_option_key</span><span class="p">,</span>
</span><span id="1-4400">                <span class="n">dialect_option_value</span><span class="p">,</span>
</span><span id="1-4401">            <span class="p">)</span> <span class="ow">in</span> <span class="n">dialect_options</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="1-4402">                <span class="n">constraint_kwargs</span><span class="p">[</span>
</span><span id="1-4403">                    <span class="n">dialect_name</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="n">dialect_option_key</span>
</span><span id="1-4404">                <span class="p">]</span> <span class="o">=</span> <span class="n">dialect_option_value</span>
</span><span id="1-4405">
</span><span id="1-4406">        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="p">,</span> <span class="n">Table</span><span class="p">)</span>
</span><span id="1-4407">        <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span>
</span><span id="1-4408">            <span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
</span><span id="1-4409">            <span class="n">deferrable</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">deferrable</span><span class="p">,</span>
</span><span id="1-4410">            <span class="n">initially</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">initially</span><span class="p">,</span>
</span><span id="1-4411">            <span class="o">*</span><span class="p">[</span>
</span><span id="1-4412">                <span class="n">_copy_expression</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="p">,</span> <span class="n">target_table</span><span class="p">)</span>
</span><span id="1-4413">                <span class="k">for</span> <span class="n">expr</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_columns</span>
</span><span id="1-4414">            <span class="p">],</span>
</span><span id="1-4415">            <span class="n">comment</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">comment</span><span class="p">,</span>
</span><span id="1-4416">            <span class="o">**</span><span class="n">constraint_kwargs</span><span class="p">,</span>
</span><span id="1-4417">        <span class="p">)</span>
</span><span id="1-4418">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_schema_item_copy</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
</span><span id="1-4419">
</span><span id="1-4420">    <span class="k">def</span> <span class="nf">contains_column</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">col</span><span class="p">:</span> <span class="n">Column</span><span class="p">[</span><span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="1-4421"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Return True if this constraint contains the given column.</span>
</span><span id="1-4422">
</span><span id="1-4423"><span class="sd">        Note that this object also contains an attribute ``.columns``</span>
</span><span id="1-4424"><span class="sd">        which is a :class:`_expression.ColumnCollection` of</span>
</span><span id="1-4425"><span class="sd">        :class:`_schema.Column` objects.</span>
</span><span id="1-4426">
</span><span id="1-4427"><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="1-4428">
</span><span id="1-4429">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_columns</span><span class="o">.</span><span class="n">contains_column</span><span class="p">(</span><span class="n">col</span><span class="p">)</span>
</span><span id="1-4430">
</span><span id="1-4431">    <span class="k">def</span> <span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="n">Column</span><span class="p">[</span><span class="n">Any</span><span class="p">]]:</span>
</span><span id="1-4432">        <span class="k">return</span> <span class="nb">iter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_columns</span><span class="p">)</span>
</span><span id="1-4433">
</span><span id="1-4434">    <span class="k">def</span> <span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="1-4435">        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_columns</span><span class="p">)</span>
</span><span id="1-4436">
</span><span id="1-4437">
</span><span id="1-4438"><span class="k">class</span> <span class="nc">CheckConstraint</span><span class="p">(</span><span class="n">ColumnCollectionConstraint</span><span class="p">):</span>
</span><span id="1-4439"><span class="w">    </span><span class="sd">&quot;&quot;&quot;A table- or column-level CHECK constraint.</span>
</span><span id="1-4440">
</span><span id="1-4441"><span class="sd">    Can be included in the definition of a Table or Column.</span>
</span><span id="1-4442"><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="1-4443">
</span><span id="1-4444">    <span class="n">_allow_multiple_tables</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="1-4445">
</span><span id="1-4446">    <span class="n">__visit_name__</span> <span class="o">=</span> <span class="s2">&quot;table_or_column_check_constraint&quot;</span>
</span><span id="1-4447">
</span><span id="1-4448">    <span class="nd">@_document_text_coercion</span><span class="p">(</span>
</span><span id="1-4449">        <span class="s2">&quot;sqltext&quot;</span><span class="p">,</span>
</span><span id="1-4450">        <span class="s2">&quot;:class:`.CheckConstraint`&quot;</span><span class="p">,</span>
</span><span id="1-4451">        <span class="s2">&quot;:paramref:`.CheckConstraint.sqltext`&quot;</span><span class="p">,</span>
</span><span id="1-4452">    <span class="p">)</span>
</span><span id="1-4453">    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
</span><span id="1-4454">        <span class="bp">self</span><span class="p">,</span>
</span><span id="1-4455">        <span class="n">sqltext</span><span class="p">:</span> <span class="n">_TextCoercedExpressionArgument</span><span class="p">[</span><span class="n">Any</span><span class="p">],</span>
</span><span id="1-4456">        <span class="n">name</span><span class="p">:</span> <span class="n">_ConstraintNameArgument</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="1-4457">        <span class="n">deferrable</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="1-4458">        <span class="n">initially</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="1-4459">        <span class="n">table</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Table</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="1-4460">        <span class="n">info</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">_InfoType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="1-4461">        <span class="n">_create_rule</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="1-4462">        <span class="n">_autoattach</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="1-4463">        <span class="n">_type_bound</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="1-4464">        <span class="o">**</span><span class="n">dialect_kw</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
</span><span id="1-4465">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-4466"><span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Construct a CHECK constraint.</span>
</span><span id="1-4467">
</span><span id="1-4468"><span class="sd">        :param sqltext:</span>
</span><span id="1-4469"><span class="sd">         A string containing the constraint definition, which will be used</span>
</span><span id="1-4470"><span class="sd">         verbatim, or a SQL expression construct.   If given as a string,</span>
</span><span id="1-4471"><span class="sd">         the object is converted to a :func:`_expression.text` object.</span>
</span><span id="1-4472"><span class="sd">         If the textual</span>
</span><span id="1-4473"><span class="sd">         string includes a colon character, escape this using a backslash::</span>
</span><span id="1-4474">
</span><span id="1-4475"><span class="sd">           CheckConstraint(r&quot;foo ~ E&#39;a(?\:b|c)d&quot;)</span>
</span><span id="1-4476">
</span><span id="1-4477"><span class="sd">        :param name:</span>
</span><span id="1-4478"><span class="sd">          Optional, the in-database name of the constraint.</span>
</span><span id="1-4479">
</span><span id="1-4480"><span class="sd">        :param deferrable:</span>
</span><span id="1-4481"><span class="sd">          Optional bool.  If set, emit DEFERRABLE or NOT DEFERRABLE when</span>
</span><span id="1-4482"><span class="sd">          issuing DDL for this constraint.</span>
</span><span id="1-4483">
</span><span id="1-4484"><span class="sd">        :param initially:</span>
</span><span id="1-4485"><span class="sd">          Optional string.  If set, emit INITIALLY &lt;value&gt; when issuing DDL</span>
</span><span id="1-4486"><span class="sd">          for this constraint.</span>
</span><span id="1-4487">
</span><span id="1-4488"><span class="sd">        :param info: Optional data dictionary which will be populated into the</span>
</span><span id="1-4489"><span class="sd">            :attr:`.SchemaItem.info` attribute of this object.</span>
</span><span id="1-4490">
</span><span id="1-4491"><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="1-4492">
</span><span id="1-4493">        <span class="bp">self</span><span class="o">.</span><span class="n">sqltext</span> <span class="o">=</span> <span class="n">coercions</span><span class="o">.</span><span class="n">expect</span><span class="p">(</span><span class="n">roles</span><span class="o">.</span><span class="n">DDLExpressionRole</span><span class="p">,</span> <span class="n">sqltext</span><span class="p">)</span>
</span><span id="1-4494">        <span class="n">columns</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Column</span><span class="p">[</span><span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="1-4495">        <span class="n">visitors</span><span class="o">.</span><span class="n">traverse</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sqltext</span><span class="p">,</span> <span class="p">{},</span> <span class="p">{</span><span class="s2">&quot;column&quot;</span><span class="p">:</span> <span class="n">columns</span><span class="o">.</span><span class="n">append</span><span class="p">})</span>
</span><span id="1-4496">
</span><span id="1-4497">        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="1-4498">            <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
</span><span id="1-4499">            <span class="n">deferrable</span><span class="o">=</span><span class="n">deferrable</span><span class="p">,</span>
</span><span id="1-4500">            <span class="n">initially</span><span class="o">=</span><span class="n">initially</span><span class="p">,</span>
</span><span id="1-4501">            <span class="n">_create_rule</span><span class="o">=</span><span class="n">_create_rule</span><span class="p">,</span>
</span><span id="1-4502">            <span class="n">info</span><span class="o">=</span><span class="n">info</span><span class="p">,</span>
</span><span id="1-4503">            <span class="n">_type_bound</span><span class="o">=</span><span class="n">_type_bound</span><span class="p">,</span>
</span><span id="1-4504">            <span class="n">_autoattach</span><span class="o">=</span><span class="n">_autoattach</span><span class="p">,</span>
</span><span id="1-4505">            <span class="o">*</span><span class="n">columns</span><span class="p">,</span>
</span><span id="1-4506">            <span class="o">**</span><span class="n">dialect_kw</span><span class="p">,</span>
</span><span id="1-4507">        <span class="p">)</span>
</span><span id="1-4508">        <span class="k">if</span> <span class="n">table</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-4509">            <span class="bp">self</span><span class="o">.</span><span class="n">_set_parent_with_dispatch</span><span class="p">(</span><span class="n">table</span><span class="p">)</span>
</span><span id="1-4510">
</span><span id="1-4511">    <span class="nd">@property</span>
</span><span id="1-4512">    <span class="k">def</span> <span class="nf">is_column_level</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="1-4513">        <span class="k">return</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="p">,</span> <span class="n">Table</span><span class="p">)</span>
</span><span id="1-4514">
</span><span id="1-4515">    <span class="nd">@util</span><span class="o">.</span><span class="n">deprecated</span><span class="p">(</span>
</span><span id="1-4516">        <span class="s2">&quot;1.4&quot;</span><span class="p">,</span>
</span><span id="1-4517">        <span class="s2">&quot;The :meth:`_schema.CheckConstraint.copy` method is deprecated &quot;</span>
</span><span id="1-4518">        <span class="s2">&quot;and will be removed in a future release.&quot;</span><span class="p">,</span>
</span><span id="1-4519">    <span class="p">)</span>
</span><span id="1-4520">    <span class="k">def</span> <span class="nf">copy</span><span class="p">(</span>
</span><span id="1-4521">        <span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">target_table</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Table</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">:</span> <span class="n">Any</span>
</span><span id="1-4522">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CheckConstraint</span><span class="p">:</span>
</span><span id="1-4523">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_copy</span><span class="p">(</span><span class="n">target_table</span><span class="o">=</span><span class="n">target_table</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>
</span><span id="1-4524">
</span><span id="1-4525">    <span class="k">def</span> <span class="nf">_copy</span><span class="p">(</span>
</span><span id="1-4526">        <span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">target_table</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Table</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">:</span> <span class="n">Any</span>
</span><span id="1-4527">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CheckConstraint</span><span class="p">:</span>
</span><span id="1-4528">        <span class="k">if</span> <span class="n">target_table</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-4529">            <span class="c1"># note that target_table is None for the copy process of</span>
</span><span id="1-4530">            <span class="c1"># a column-bound CheckConstraint, so this path is not reached</span>
</span><span id="1-4531">            <span class="c1"># in that case.</span>
</span><span id="1-4532">            <span class="n">sqltext</span> <span class="o">=</span> <span class="n">_copy_expression</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sqltext</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="p">,</span> <span class="n">target_table</span><span class="p">)</span>
</span><span id="1-4533">        <span class="k">else</span><span class="p">:</span>
</span><span id="1-4534">            <span class="n">sqltext</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sqltext</span>
</span><span id="1-4535">        <span class="n">c</span> <span class="o">=</span> <span class="n">CheckConstraint</span><span class="p">(</span>
</span><span id="1-4536">            <span class="n">sqltext</span><span class="p">,</span>
</span><span id="1-4537">            <span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
</span><span id="1-4538">            <span class="n">initially</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">initially</span><span class="p">,</span>
</span><span id="1-4539">            <span class="n">deferrable</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">deferrable</span><span class="p">,</span>
</span><span id="1-4540">            <span class="n">_create_rule</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_create_rule</span><span class="p">,</span>
</span><span id="1-4541">            <span class="n">table</span><span class="o">=</span><span class="n">target_table</span><span class="p">,</span>
</span><span id="1-4542">            <span class="n">comment</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">comment</span><span class="p">,</span>
</span><span id="1-4543">            <span class="n">_autoattach</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="1-4544">            <span class="n">_type_bound</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_type_bound</span><span class="p">,</span>
</span><span id="1-4545">        <span class="p">)</span>
</span><span id="1-4546">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_schema_item_copy</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
</span><span id="1-4547">
</span><span id="1-4548">
</span><span id="1-4549"><span class="k">class</span> <span class="nc">ForeignKeyConstraint</span><span class="p">(</span><span class="n">ColumnCollectionConstraint</span><span class="p">):</span>
</span><span id="1-4550"><span class="w">    </span><span class="sd">&quot;&quot;&quot;A table-level FOREIGN KEY constraint.</span>
</span><span id="1-4551">
</span><span id="1-4552"><span class="sd">    Defines a single column or composite FOREIGN KEY ... REFERENCES</span>
</span><span id="1-4553"><span class="sd">    constraint. For a no-frills, single column foreign key, adding a</span>
</span><span id="1-4554"><span class="sd">    :class:`_schema.ForeignKey` to the definition of a :class:`_schema.Column`</span>
</span><span id="1-4555"><span class="sd">    is a</span>
</span><span id="1-4556"><span class="sd">    shorthand equivalent for an unnamed, single column</span>
</span><span id="1-4557"><span class="sd">    :class:`_schema.ForeignKeyConstraint`.</span>
</span><span id="1-4558">
</span><span id="1-4559"><span class="sd">    Examples of foreign key configuration are in :ref:`metadata_foreignkeys`.</span>
</span><span id="1-4560">
</span><span id="1-4561"><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="1-4562">
</span><span id="1-4563">    <span class="n">__visit_name__</span> <span class="o">=</span> <span class="s2">&quot;foreign_key_constraint&quot;</span>
</span><span id="1-4564">
</span><span id="1-4565">    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
</span><span id="1-4566">        <span class="bp">self</span><span class="p">,</span>
</span><span id="1-4567">        <span class="n">columns</span><span class="p">:</span> <span class="n">_typing_Sequence</span><span class="p">[</span><span class="n">_DDLColumnArgument</span><span class="p">],</span>
</span><span id="1-4568">        <span class="n">refcolumns</span><span class="p">:</span> <span class="n">_typing_Sequence</span><span class="p">[</span><span class="n">_DDLColumnArgument</span><span class="p">],</span>
</span><span id="1-4569">        <span class="n">name</span><span class="p">:</span> <span class="n">_ConstraintNameArgument</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="1-4570">        <span class="n">onupdate</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="1-4571">        <span class="n">ondelete</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="1-4572">        <span class="n">deferrable</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="1-4573">        <span class="n">initially</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="1-4574">        <span class="n">use_alter</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="1-4575">        <span class="n">link_to_name</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="1-4576">        <span class="n">match</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="1-4577">        <span class="n">table</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Table</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="1-4578">        <span class="n">info</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">_InfoType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="1-4579">        <span class="n">comment</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="1-4580">        <span class="o">**</span><span class="n">dialect_kw</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
</span><span id="1-4581">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-4582"><span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Construct a composite-capable FOREIGN KEY.</span>
</span><span id="1-4583">
</span><span id="1-4584"><span class="sd">        :param columns: A sequence of local column names. The named columns</span>
</span><span id="1-4585"><span class="sd">          must be defined and present in the parent Table. The names should</span>
</span><span id="1-4586"><span class="sd">          match the ``key`` given to each column (defaults to the name) unless</span>
</span><span id="1-4587"><span class="sd">          ``link_to_name`` is True.</span>
</span><span id="1-4588">
</span><span id="1-4589"><span class="sd">        :param refcolumns: A sequence of foreign column names or Column</span>
</span><span id="1-4590"><span class="sd">          objects. The columns must all be located within the same Table.</span>
</span><span id="1-4591">
</span><span id="1-4592"><span class="sd">        :param name: Optional, the in-database name of the key.</span>
</span><span id="1-4593">
</span><span id="1-4594"><span class="sd">        :param onupdate: Optional string. If set, emit ON UPDATE &lt;value&gt; when</span>
</span><span id="1-4595"><span class="sd">          issuing DDL for this constraint. Typical values include CASCADE,</span>
</span><span id="1-4596"><span class="sd">          DELETE and RESTRICT.</span>
</span><span id="1-4597">
</span><span id="1-4598"><span class="sd">        :param ondelete: Optional string. If set, emit ON DELETE &lt;value&gt; when</span>
</span><span id="1-4599"><span class="sd">          issuing DDL for this constraint. Typical values include CASCADE,</span>
</span><span id="1-4600"><span class="sd">          DELETE and RESTRICT.</span>
</span><span id="1-4601">
</span><span id="1-4602"><span class="sd">        :param deferrable: Optional bool. If set, emit DEFERRABLE or NOT</span>
</span><span id="1-4603"><span class="sd">          DEFERRABLE when issuing DDL for this constraint.</span>
</span><span id="1-4604">
</span><span id="1-4605"><span class="sd">        :param initially: Optional string. If set, emit INITIALLY &lt;value&gt; when</span>
</span><span id="1-4606"><span class="sd">          issuing DDL for this constraint.</span>
</span><span id="1-4607">
</span><span id="1-4608"><span class="sd">        :param link_to_name: if True, the string name given in ``column`` is</span>
</span><span id="1-4609"><span class="sd">          the rendered name of the referenced column, not its locally assigned</span>
</span><span id="1-4610"><span class="sd">          ``key``.</span>
</span><span id="1-4611">
</span><span id="1-4612"><span class="sd">        :param use_alter: If True, do not emit the DDL for this constraint as</span>
</span><span id="1-4613"><span class="sd">          part of the CREATE TABLE definition. Instead, generate it via an</span>
</span><span id="1-4614"><span class="sd">          ALTER TABLE statement issued after the full collection of tables</span>
</span><span id="1-4615"><span class="sd">          have been created, and drop it via an ALTER TABLE statement before</span>
</span><span id="1-4616"><span class="sd">          the full collection of tables are dropped.</span>
</span><span id="1-4617">
</span><span id="1-4618"><span class="sd">          The use of :paramref:`_schema.ForeignKeyConstraint.use_alter` is</span>
</span><span id="1-4619"><span class="sd">          particularly geared towards the case where two or more tables</span>
</span><span id="1-4620"><span class="sd">          are established within a mutually-dependent foreign key constraint</span>
</span><span id="1-4621"><span class="sd">          relationship; however, the :meth:`_schema.MetaData.create_all` and</span>
</span><span id="1-4622"><span class="sd">          :meth:`_schema.MetaData.drop_all`</span>
</span><span id="1-4623"><span class="sd">          methods will perform this resolution</span>
</span><span id="1-4624"><span class="sd">          automatically, so the flag is normally not needed.</span>
</span><span id="1-4625">
</span><span id="1-4626"><span class="sd">          .. seealso::</span>
</span><span id="1-4627">
</span><span id="1-4628"><span class="sd">                :ref:`use_alter`</span>
</span><span id="1-4629">
</span><span id="1-4630"><span class="sd">        :param match: Optional string. If set, emit MATCH &lt;value&gt; when issuing</span>
</span><span id="1-4631"><span class="sd">          DDL for this constraint. Typical values include SIMPLE, PARTIAL</span>
</span><span id="1-4632"><span class="sd">          and FULL.</span>
</span><span id="1-4633">
</span><span id="1-4634"><span class="sd">        :param info: Optional data dictionary which will be populated into the</span>
</span><span id="1-4635"><span class="sd">            :attr:`.SchemaItem.info` attribute of this object.</span>
</span><span id="1-4636">
</span><span id="1-4637"><span class="sd">        :param comment: Optional string that will render an SQL comment on</span>
</span><span id="1-4638"><span class="sd">          foreign key constraint creation.</span>
</span><span id="1-4639">
</span><span id="1-4640"><span class="sd">            .. versionadded:: 2.0</span>
</span><span id="1-4641">
</span><span id="1-4642"><span class="sd">        :param \**dialect_kw:  Additional keyword arguments are dialect</span>
</span><span id="1-4643"><span class="sd">          specific, and passed in the form ``&lt;dialectname&gt;_&lt;argname&gt;``.  See</span>
</span><span id="1-4644"><span class="sd">          the documentation regarding an individual dialect at</span>
</span><span id="1-4645"><span class="sd">          :ref:`dialect_toplevel` for detail on documented arguments.</span>
</span><span id="1-4646">
</span><span id="1-4647"><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="1-4648">
</span><span id="1-4649">        <span class="n">Constraint</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="1-4650">            <span class="bp">self</span><span class="p">,</span>
</span><span id="1-4651">            <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
</span><span id="1-4652">            <span class="n">deferrable</span><span class="o">=</span><span class="n">deferrable</span><span class="p">,</span>
</span><span id="1-4653">            <span class="n">initially</span><span class="o">=</span><span class="n">initially</span><span class="p">,</span>
</span><span id="1-4654">            <span class="n">info</span><span class="o">=</span><span class="n">info</span><span class="p">,</span>
</span><span id="1-4655">            <span class="n">comment</span><span class="o">=</span><span class="n">comment</span><span class="p">,</span>
</span><span id="1-4656">            <span class="o">**</span><span class="n">dialect_kw</span><span class="p">,</span>
</span><span id="1-4657">        <span class="p">)</span>
</span><span id="1-4658">        <span class="bp">self</span><span class="o">.</span><span class="n">onupdate</span> <span class="o">=</span> <span class="n">onupdate</span>
</span><span id="1-4659">        <span class="bp">self</span><span class="o">.</span><span class="n">ondelete</span> <span class="o">=</span> <span class="n">ondelete</span>
</span><span id="1-4660">        <span class="bp">self</span><span class="o">.</span><span class="n">link_to_name</span> <span class="o">=</span> <span class="n">link_to_name</span>
</span><span id="1-4661">        <span class="bp">self</span><span class="o">.</span><span class="n">use_alter</span> <span class="o">=</span> <span class="n">use_alter</span>
</span><span id="1-4662">        <span class="bp">self</span><span class="o">.</span><span class="n">match</span> <span class="o">=</span> <span class="n">match</span>
</span><span id="1-4663">
</span><span id="1-4664">        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">columns</span><span class="p">))</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">refcolumns</span><span class="p">):</span>
</span><span id="1-4665">            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">columns</span><span class="p">))</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">columns</span><span class="p">):</span>
</span><span id="1-4666">                <span class="c1"># e.g. FOREIGN KEY (a, a) REFERENCES r (b, c)</span>
</span><span id="1-4667">                <span class="k">raise</span> <span class="n">exc</span><span class="o">.</span><span class="n">ArgumentError</span><span class="p">(</span>
</span><span id="1-4668">                    <span class="s2">&quot;ForeignKeyConstraint with duplicate source column &quot;</span>
</span><span id="1-4669">                    <span class="s2">&quot;references are not supported.&quot;</span>
</span><span id="1-4670">                <span class="p">)</span>
</span><span id="1-4671">            <span class="k">else</span><span class="p">:</span>
</span><span id="1-4672">                <span class="c1"># e.g. FOREIGN KEY (a) REFERENCES r (b, c)</span>
</span><span id="1-4673">                <span class="c1"># paraphrasing</span>
</span><span id="1-4674">                <span class="c1"># https://www.postgresql.org/docs/current/static/ddl-constraints.html</span>
</span><span id="1-4675">                <span class="k">raise</span> <span class="n">exc</span><span class="o">.</span><span class="n">ArgumentError</span><span class="p">(</span>
</span><span id="1-4676">                    <span class="s2">&quot;ForeignKeyConstraint number &quot;</span>
</span><span id="1-4677">                    <span class="s2">&quot;of constrained columns must match the number of &quot;</span>
</span><span id="1-4678">                    <span class="s2">&quot;referenced columns.&quot;</span>
</span><span id="1-4679">                <span class="p">)</span>
</span><span id="1-4680">
</span><span id="1-4681">        <span class="c1"># standalone ForeignKeyConstraint - create</span>
</span><span id="1-4682">        <span class="c1"># associated ForeignKey objects which will be applied to hosted</span>
</span><span id="1-4683">        <span class="c1"># Column objects (in col.foreign_keys), either now or when attached</span>
</span><span id="1-4684">        <span class="c1"># to the Table for string-specified names</span>
</span><span id="1-4685">        <span class="bp">self</span><span class="o">.</span><span class="n">elements</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="1-4686">            <span class="n">ForeignKey</span><span class="p">(</span>
</span><span id="1-4687">                <span class="n">refcol</span><span class="p">,</span>
</span><span id="1-4688">                <span class="n">_constraint</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span>
</span><span id="1-4689">                <span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
</span><span id="1-4690">                <span class="n">onupdate</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">onupdate</span><span class="p">,</span>
</span><span id="1-4691">                <span class="n">ondelete</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ondelete</span><span class="p">,</span>
</span><span id="1-4692">                <span class="n">use_alter</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">use_alter</span><span class="p">,</span>
</span><span id="1-4693">                <span class="n">link_to_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">link_to_name</span><span class="p">,</span>
</span><span id="1-4694">                <span class="n">match</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">match</span><span class="p">,</span>
</span><span id="1-4695">                <span class="n">deferrable</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">deferrable</span><span class="p">,</span>
</span><span id="1-4696">                <span class="n">initially</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">initially</span><span class="p">,</span>
</span><span id="1-4697">                <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">dialect_kwargs</span><span class="p">,</span>
</span><span id="1-4698">            <span class="p">)</span>
</span><span id="1-4699">            <span class="k">for</span> <span class="n">refcol</span> <span class="ow">in</span> <span class="n">refcolumns</span>
</span><span id="1-4700">        <span class="p">]</span>
</span><span id="1-4701">
</span><span id="1-4702">        <span class="n">ColumnCollectionMixin</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">columns</span><span class="p">)</span>
</span><span id="1-4703">        <span class="k">if</span> <span class="n">table</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-4704">            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;parent&quot;</span><span class="p">):</span>
</span><span id="1-4705">                <span class="k">assert</span> <span class="n">table</span> <span class="ow">is</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span>
</span><span id="1-4706">            <span class="bp">self</span><span class="o">.</span><span class="n">_set_parent_with_dispatch</span><span class="p">(</span><span class="n">table</span><span class="p">)</span>
</span><span id="1-4707">
</span><span id="1-4708">    <span class="k">def</span> <span class="nf">_append_element</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">column</span><span class="p">:</span> <span class="n">Column</span><span class="p">[</span><span class="n">Any</span><span class="p">],</span> <span class="n">fk</span><span class="p">:</span> <span class="n">ForeignKey</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-4709">        <span class="bp">self</span><span class="o">.</span><span class="n">_columns</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">column</span><span class="p">)</span>
</span><span id="1-4710">        <span class="bp">self</span><span class="o">.</span><span class="n">elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fk</span><span class="p">)</span>
</span><span id="1-4711">
</span><span id="1-4712">    <span class="n">columns</span><span class="p">:</span> <span class="n">ReadOnlyColumnCollection</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Column</span><span class="p">[</span><span class="n">Any</span><span class="p">]]</span>
</span><span id="1-4713"><span class="w">    </span><span class="sd">&quot;&quot;&quot;A :class:`_expression.ColumnCollection` representing the set of columns</span>
</span><span id="1-4714"><span class="sd">    for this constraint.</span>
</span><span id="1-4715">
</span><span id="1-4716"><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="1-4717">
</span><span id="1-4718">    <span class="n">elements</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">ForeignKey</span><span class="p">]</span>
</span><span id="1-4719"><span class="w">    </span><span class="sd">&quot;&quot;&quot;A sequence of :class:`_schema.ForeignKey` objects.</span>
</span><span id="1-4720">
</span><span id="1-4721"><span class="sd">    Each :class:`_schema.ForeignKey`</span>
</span><span id="1-4722"><span class="sd">    represents a single referring column/referred</span>
</span><span id="1-4723"><span class="sd">    column pair.</span>
</span><span id="1-4724">
</span><span id="1-4725"><span class="sd">    This collection is intended to be read-only.</span>
</span><span id="1-4726">
</span><span id="1-4727"><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="1-4728">
</span><span id="1-4729">    <span class="nd">@property</span>
</span><span id="1-4730">    <span class="k">def</span> <span class="nf">_elements</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">util</span><span class="o">.</span><span class="n">OrderedDict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">ForeignKey</span><span class="p">]:</span>
</span><span id="1-4731">        <span class="c1"># legacy - provide a dictionary view of (column_key, fk)</span>
</span><span id="1-4732">        <span class="k">return</span> <span class="n">util</span><span class="o">.</span><span class="n">OrderedDict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">column_keys</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">elements</span><span class="p">))</span>
</span><span id="1-4733">
</span><span id="1-4734">    <span class="nd">@property</span>
</span><span id="1-4735">    <span class="k">def</span> <span class="nf">_referred_schema</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
</span><span id="1-4736">        <span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">elements</span><span class="p">:</span>
</span><span id="1-4737">            <span class="k">return</span> <span class="n">elem</span><span class="o">.</span><span class="n">_referred_schema</span>
</span><span id="1-4738">        <span class="k">else</span><span class="p">:</span>
</span><span id="1-4739">            <span class="k">return</span> <span class="kc">None</span>
</span><span id="1-4740">
</span><span id="1-4741">    <span class="nd">@property</span>
</span><span id="1-4742">    <span class="k">def</span> <span class="nf">referred_table</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Table</span><span class="p">:</span>
</span><span id="1-4743"><span class="w">        </span><span class="sd">&quot;&quot;&quot;The :class:`_schema.Table` object to which this</span>
</span><span id="1-4744"><span class="sd">        :class:`_schema.ForeignKeyConstraint` references.</span>
</span><span id="1-4745">
</span><span id="1-4746"><span class="sd">        This is a dynamically calculated attribute which may not be available</span>
</span><span id="1-4747"><span class="sd">        if the constraint and/or parent table is not yet associated with</span>
</span><span id="1-4748"><span class="sd">        a metadata collection that contains the referred table.</span>
</span><span id="1-4749">
</span><span id="1-4750"><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="1-4751">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">elements</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">column</span><span class="o">.</span><span class="n">table</span>
</span><span id="1-4752">
</span><span id="1-4753">    <span class="k">def</span> <span class="nf">_validate_dest_table</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">table</span><span class="p">:</span> <span class="n">Table</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-4754">        <span class="n">table_keys</span> <span class="o">=</span> <span class="p">{</span><span class="n">elem</span><span class="o">.</span><span class="n">_table_key</span><span class="p">()</span> <span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">elements</span><span class="p">}</span>
</span><span id="1-4755">        <span class="k">if</span> <span class="kc">None</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">table_keys</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">table_keys</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="1-4756">            <span class="n">elem0</span><span class="p">,</span> <span class="n">elem1</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">table_keys</span><span class="p">)[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span>
</span><span id="1-4757">            <span class="k">raise</span> <span class="n">exc</span><span class="o">.</span><span class="n">ArgumentError</span><span class="p">(</span>
</span><span id="1-4758">                <span class="s2">&quot;ForeignKeyConstraint on </span><span class="si">%s</span><span class="s2">(</span><span class="si">%s</span><span class="s2">) refers to &quot;</span>
</span><span id="1-4759">                <span class="s2">&quot;multiple remote tables: </span><span class="si">%s</span><span class="s2"> and </span><span class="si">%s</span><span class="s2">&quot;</span>
</span><span id="1-4760">                <span class="o">%</span> <span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">fullname</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_col_description</span><span class="p">,</span> <span class="n">elem0</span><span class="p">,</span> <span class="n">elem1</span><span class="p">)</span>
</span><span id="1-4761">            <span class="p">)</span>
</span><span id="1-4762">
</span><span id="1-4763">    <span class="nd">@property</span>
</span><span id="1-4764">    <span class="k">def</span> <span class="nf">column_keys</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_typing_Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
</span><span id="1-4765"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Return a list of string keys representing the local</span>
</span><span id="1-4766"><span class="sd">        columns in this :class:`_schema.ForeignKeyConstraint`.</span>
</span><span id="1-4767">
</span><span id="1-4768"><span class="sd">        This list is either the original string arguments sent</span>
</span><span id="1-4769"><span class="sd">        to the constructor of the :class:`_schema.ForeignKeyConstraint`,</span>
</span><span id="1-4770"><span class="sd">        or if the constraint has been initialized with :class:`_schema.Column`</span>
</span><span id="1-4771"><span class="sd">        objects, is the string ``.key`` of each element.</span>
</span><span id="1-4772">
</span><span id="1-4773"><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="1-4774">        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;parent&quot;</span><span class="p">):</span>
</span><span id="1-4775">            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_columns</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
</span><span id="1-4776">        <span class="k">else</span><span class="p">:</span>
</span><span id="1-4777">            <span class="k">return</span> <span class="p">[</span>
</span><span id="1-4778">                <span class="n">col</span><span class="o">.</span><span class="n">key</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">col</span><span class="p">,</span> <span class="n">ColumnElement</span><span class="p">)</span> <span class="k">else</span> <span class="nb">str</span><span class="p">(</span><span class="n">col</span><span class="p">)</span>
</span><span id="1-4779">                <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pending_colargs</span>
</span><span id="1-4780">            <span class="p">]</span>
</span><span id="1-4781">
</span><span id="1-4782">    <span class="nd">@property</span>
</span><span id="1-4783">    <span class="k">def</span> <span class="nf">_col_description</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="1-4784">        <span class="k">return</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">column_keys</span><span class="p">)</span>
</span><span id="1-4785">
</span><span id="1-4786">    <span class="k">def</span> <span class="nf">_set_parent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">:</span> <span class="n">SchemaEventTarget</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-4787">        <span class="n">table</span> <span class="o">=</span> <span class="n">parent</span>
</span><span id="1-4788">        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">table</span><span class="p">,</span> <span class="n">Table</span><span class="p">)</span>
</span><span id="1-4789">        <span class="n">Constraint</span><span class="o">.</span><span class="n">_set_parent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">table</span><span class="p">)</span>
</span><span id="1-4790">
</span><span id="1-4791">        <span class="n">ColumnCollectionConstraint</span><span class="o">.</span><span class="n">_set_parent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">table</span><span class="p">)</span>
</span><span id="1-4792">
</span><span id="1-4793">        <span class="k">for</span> <span class="n">col</span><span class="p">,</span> <span class="n">fk</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_columns</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">elements</span><span class="p">):</span>
</span><span id="1-4794">            <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">fk</span><span class="p">,</span> <span class="s2">&quot;parent&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">fk</span><span class="o">.</span><span class="n">parent</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">col</span><span class="p">:</span>
</span><span id="1-4795">                <span class="n">fk</span><span class="o">.</span><span class="n">_set_parent_with_dispatch</span><span class="p">(</span><span class="n">col</span><span class="p">)</span>
</span><span id="1-4796">
</span><span id="1-4797">        <span class="bp">self</span><span class="o">.</span><span class="n">_validate_dest_table</span><span class="p">(</span><span class="n">table</span><span class="p">)</span>
</span><span id="1-4798">
</span><span id="1-4799">    <span class="nd">@util</span><span class="o">.</span><span class="n">deprecated</span><span class="p">(</span>
</span><span id="1-4800">        <span class="s2">&quot;1.4&quot;</span><span class="p">,</span>
</span><span id="1-4801">        <span class="s2">&quot;The :meth:`_schema.ForeignKeyConstraint.copy` method is deprecated &quot;</span>
</span><span id="1-4802">        <span class="s2">&quot;and will be removed in a future release.&quot;</span><span class="p">,</span>
</span><span id="1-4803">    <span class="p">)</span>
</span><span id="1-4804">    <span class="k">def</span> <span class="nf">copy</span><span class="p">(</span>
</span><span id="1-4805">        <span class="bp">self</span><span class="p">,</span>
</span><span id="1-4806">        <span class="o">*</span><span class="p">,</span>
</span><span id="1-4807">        <span class="n">schema</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="1-4808">        <span class="n">target_table</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Table</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="1-4809">        <span class="o">**</span><span class="n">kw</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
</span><span id="1-4810">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ForeignKeyConstraint</span><span class="p">:</span>
</span><span id="1-4811">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_copy</span><span class="p">(</span><span class="n">schema</span><span class="o">=</span><span class="n">schema</span><span class="p">,</span> <span class="n">target_table</span><span class="o">=</span><span class="n">target_table</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>
</span><span id="1-4812">
</span><span id="1-4813">    <span class="k">def</span> <span class="nf">_copy</span><span class="p">(</span>
</span><span id="1-4814">        <span class="bp">self</span><span class="p">,</span>
</span><span id="1-4815">        <span class="o">*</span><span class="p">,</span>
</span><span id="1-4816">        <span class="n">schema</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="1-4817">        <span class="n">target_table</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Table</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="1-4818">        <span class="o">**</span><span class="n">kw</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
</span><span id="1-4819">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ForeignKeyConstraint</span><span class="p">:</span>
</span><span id="1-4820">        <span class="n">fkc</span> <span class="o">=</span> <span class="n">ForeignKeyConstraint</span><span class="p">(</span>
</span><span id="1-4821">            <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">key</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">elements</span><span class="p">],</span>
</span><span id="1-4822">            <span class="p">[</span>
</span><span id="1-4823">                <span class="n">x</span><span class="o">.</span><span class="n">_get_colspec</span><span class="p">(</span>
</span><span id="1-4824">                    <span class="n">schema</span><span class="o">=</span><span class="n">schema</span><span class="p">,</span>
</span><span id="1-4825">                    <span class="n">table_name</span><span class="o">=</span><span class="n">target_table</span><span class="o">.</span><span class="n">name</span>
</span><span id="1-4826">                    <span class="k">if</span> <span class="n">target_table</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span id="1-4827">                    <span class="ow">and</span> <span class="n">x</span><span class="o">.</span><span class="n">_table_key</span><span class="p">()</span> <span class="o">==</span> <span class="n">x</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">key</span>
</span><span id="1-4828">                    <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="1-4829">                    <span class="n">_is_copy</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="1-4830">                <span class="p">)</span>
</span><span id="1-4831">                <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">elements</span>
</span><span id="1-4832">            <span class="p">],</span>
</span><span id="1-4833">            <span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
</span><span id="1-4834">            <span class="n">onupdate</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">onupdate</span><span class="p">,</span>
</span><span id="1-4835">            <span class="n">ondelete</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ondelete</span><span class="p">,</span>
</span><span id="1-4836">            <span class="n">use_alter</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">use_alter</span><span class="p">,</span>
</span><span id="1-4837">            <span class="n">deferrable</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">deferrable</span><span class="p">,</span>
</span><span id="1-4838">            <span class="n">initially</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">initially</span><span class="p">,</span>
</span><span id="1-4839">            <span class="n">link_to_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">link_to_name</span><span class="p">,</span>
</span><span id="1-4840">            <span class="n">match</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">match</span><span class="p">,</span>
</span><span id="1-4841">            <span class="n">comment</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">comment</span><span class="p">,</span>
</span><span id="1-4842">        <span class="p">)</span>
</span><span id="1-4843">        <span class="k">for</span> <span class="n">self_fk</span><span class="p">,</span> <span class="n">other_fk</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">elements</span><span class="p">,</span> <span class="n">fkc</span><span class="o">.</span><span class="n">elements</span><span class="p">):</span>
</span><span id="1-4844">            <span class="n">self_fk</span><span class="o">.</span><span class="n">_schema_item_copy</span><span class="p">(</span><span class="n">other_fk</span><span class="p">)</span>
</span><span id="1-4845">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_schema_item_copy</span><span class="p">(</span><span class="n">fkc</span><span class="p">)</span>
</span><span id="1-4846">
</span><span id="1-4847">
</span><span id="1-4848"><span class="k">class</span> <span class="nc">PrimaryKeyConstraint</span><span class="p">(</span><span class="n">ColumnCollectionConstraint</span><span class="p">):</span>
</span><span id="1-4849"><span class="w">    </span><span class="sd">&quot;&quot;&quot;A table-level PRIMARY KEY constraint.</span>
</span><span id="1-4850">
</span><span id="1-4851"><span class="sd">    The :class:`.PrimaryKeyConstraint` object is present automatically</span>
</span><span id="1-4852"><span class="sd">    on any :class:`_schema.Table` object; it is assigned a set of</span>
</span><span id="1-4853"><span class="sd">    :class:`_schema.Column` objects corresponding to those marked with</span>
</span><span id="1-4854"><span class="sd">    the :paramref:`_schema.Column.primary_key` flag::</span>
</span><span id="1-4855">
</span><span id="1-4856"><span class="sd">        &gt;&gt;&gt; my_table = Table(&#39;mytable&#39;, metadata,</span>
</span><span id="1-4857"><span class="sd">        ...                 Column(&#39;id&#39;, Integer, primary_key=True),</span>
</span><span id="1-4858"><span class="sd">        ...                 Column(&#39;version_id&#39;, Integer, primary_key=True),</span>
</span><span id="1-4859"><span class="sd">        ...                 Column(&#39;data&#39;, String(50))</span>
</span><span id="1-4860"><span class="sd">        ...     )</span>
</span><span id="1-4861"><span class="sd">        &gt;&gt;&gt; my_table.primary_key</span>
</span><span id="1-4862"><span class="sd">        PrimaryKeyConstraint(</span>
</span><span id="1-4863"><span class="sd">            Column(&#39;id&#39;, Integer(), table=&lt;mytable&gt;,</span>
</span><span id="1-4864"><span class="sd">                   primary_key=True, nullable=False),</span>
</span><span id="1-4865"><span class="sd">            Column(&#39;version_id&#39;, Integer(), table=&lt;mytable&gt;,</span>
</span><span id="1-4866"><span class="sd">                   primary_key=True, nullable=False)</span>
</span><span id="1-4867"><span class="sd">        )</span>
</span><span id="1-4868">
</span><span id="1-4869"><span class="sd">    The primary key of a :class:`_schema.Table` can also be specified by using</span>
</span><span id="1-4870"><span class="sd">    a :class:`.PrimaryKeyConstraint` object explicitly; in this mode of usage,</span>
</span><span id="1-4871"><span class="sd">    the &quot;name&quot; of the constraint can also be specified, as well as other</span>
</span><span id="1-4872"><span class="sd">    options which may be recognized by dialects::</span>
</span><span id="1-4873">
</span><span id="1-4874"><span class="sd">        my_table = Table(&#39;mytable&#39;, metadata,</span>
</span><span id="1-4875"><span class="sd">                    Column(&#39;id&#39;, Integer),</span>
</span><span id="1-4876"><span class="sd">                    Column(&#39;version_id&#39;, Integer),</span>
</span><span id="1-4877"><span class="sd">                    Column(&#39;data&#39;, String(50)),</span>
</span><span id="1-4878"><span class="sd">                    PrimaryKeyConstraint(&#39;id&#39;, &#39;version_id&#39;,</span>
</span><span id="1-4879"><span class="sd">                                         name=&#39;mytable_pk&#39;)</span>
</span><span id="1-4880"><span class="sd">                )</span>
</span><span id="1-4881">
</span><span id="1-4882"><span class="sd">    The two styles of column-specification should generally not be mixed.</span>
</span><span id="1-4883"><span class="sd">    An warning is emitted if the columns present in the</span>
</span><span id="1-4884"><span class="sd">    :class:`.PrimaryKeyConstraint`</span>
</span><span id="1-4885"><span class="sd">    don&#39;t match the columns that were marked as ``primary_key=True``, if both</span>
</span><span id="1-4886"><span class="sd">    are present; in this case, the columns are taken strictly from the</span>
</span><span id="1-4887"><span class="sd">    :class:`.PrimaryKeyConstraint` declaration, and those columns otherwise</span>
</span><span id="1-4888"><span class="sd">    marked as ``primary_key=True`` are ignored.  This behavior is intended to</span>
</span><span id="1-4889"><span class="sd">    be backwards compatible with previous behavior.</span>
</span><span id="1-4890">
</span><span id="1-4891"><span class="sd">    For the use case where specific options are to be specified on the</span>
</span><span id="1-4892"><span class="sd">    :class:`.PrimaryKeyConstraint`, but the usual style of using</span>
</span><span id="1-4893"><span class="sd">    ``primary_key=True`` flags is still desirable, an empty</span>
</span><span id="1-4894"><span class="sd">    :class:`.PrimaryKeyConstraint` may be specified, which will take on the</span>
</span><span id="1-4895"><span class="sd">    primary key column collection from the :class:`_schema.Table` based on the</span>
</span><span id="1-4896"><span class="sd">    flags::</span>
</span><span id="1-4897">
</span><span id="1-4898"><span class="sd">        my_table = Table(&#39;mytable&#39;, metadata,</span>
</span><span id="1-4899"><span class="sd">                    Column(&#39;id&#39;, Integer, primary_key=True),</span>
</span><span id="1-4900"><span class="sd">                    Column(&#39;version_id&#39;, Integer, primary_key=True),</span>
</span><span id="1-4901"><span class="sd">                    Column(&#39;data&#39;, String(50)),</span>
</span><span id="1-4902"><span class="sd">                    PrimaryKeyConstraint(name=&#39;mytable_pk&#39;,</span>
</span><span id="1-4903"><span class="sd">                                         mssql_clustered=True)</span>
</span><span id="1-4904"><span class="sd">                )</span>
</span><span id="1-4905">
</span><span id="1-4906"><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="1-4907">
</span><span id="1-4908">    <span class="n">__visit_name__</span> <span class="o">=</span> <span class="s2">&quot;primary_key_constraint&quot;</span>
</span><span id="1-4909">
</span><span id="1-4910">    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
</span><span id="1-4911">        <span class="bp">self</span><span class="p">,</span>
</span><span id="1-4912">        <span class="o">*</span><span class="n">columns</span><span class="p">:</span> <span class="n">_DDLColumnArgument</span><span class="p">,</span>
</span><span id="1-4913">        <span class="n">name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="1-4914">        <span class="n">deferrable</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="1-4915">        <span class="n">initially</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="1-4916">        <span class="n">info</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">_InfoType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="1-4917">        <span class="n">_implicit_generated</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="1-4918">        <span class="o">**</span><span class="n">dialect_kw</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
</span><span id="1-4919">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-4920">        <span class="bp">self</span><span class="o">.</span><span class="n">_implicit_generated</span> <span class="o">=</span> <span class="n">_implicit_generated</span>
</span><span id="1-4921">        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="1-4922">            <span class="o">*</span><span class="n">columns</span><span class="p">,</span>
</span><span id="1-4923">            <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
</span><span id="1-4924">            <span class="n">deferrable</span><span class="o">=</span><span class="n">deferrable</span><span class="p">,</span>
</span><span id="1-4925">            <span class="n">initially</span><span class="o">=</span><span class="n">initially</span><span class="p">,</span>
</span><span id="1-4926">            <span class="n">info</span><span class="o">=</span><span class="n">info</span><span class="p">,</span>
</span><span id="1-4927">            <span class="o">**</span><span class="n">dialect_kw</span><span class="p">,</span>
</span><span id="1-4928">        <span class="p">)</span>
</span><span id="1-4929">
</span><span id="1-4930">    <span class="k">def</span> <span class="nf">_set_parent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">:</span> <span class="n">SchemaEventTarget</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-4931">        <span class="n">table</span> <span class="o">=</span> <span class="n">parent</span>
</span><span id="1-4932">        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">table</span><span class="p">,</span> <span class="n">Table</span><span class="p">)</span>
</span><span id="1-4933">        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">_set_parent</span><span class="p">(</span><span class="n">table</span><span class="p">)</span>
</span><span id="1-4934">
</span><span id="1-4935">        <span class="k">if</span> <span class="n">table</span><span class="o">.</span><span class="n">primary_key</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">self</span><span class="p">:</span>
</span><span id="1-4936">            <span class="n">table</span><span class="o">.</span><span class="n">constraints</span><span class="o">.</span><span class="n">discard</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">primary_key</span><span class="p">)</span>
</span><span id="1-4937">            <span class="n">table</span><span class="o">.</span><span class="n">primary_key</span> <span class="o">=</span> <span class="bp">self</span>  <span class="c1"># type: ignore</span>
</span><span id="1-4938">            <span class="n">table</span><span class="o">.</span><span class="n">constraints</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span><span id="1-4939">
</span><span id="1-4940">        <span class="n">table_pks</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">table</span><span class="o">.</span><span class="n">c</span> <span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">primary_key</span><span class="p">]</span>
</span><span id="1-4941">        <span class="k">if</span> <span class="p">(</span>
</span><span id="1-4942">            <span class="bp">self</span><span class="o">.</span><span class="n">_columns</span>
</span><span id="1-4943">            <span class="ow">and</span> <span class="n">table_pks</span>
</span><span id="1-4944">            <span class="ow">and</span> <span class="nb">set</span><span class="p">(</span><span class="n">table_pks</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_columns</span><span class="p">)</span>
</span><span id="1-4945">        <span class="p">):</span>
</span><span id="1-4946">            <span class="n">util</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
</span><span id="1-4947">                <span class="s2">&quot;Table &#39;</span><span class="si">%s</span><span class="s2">&#39; specifies columns </span><span class="si">%s</span><span class="s2"> as primary_key=True, &quot;</span>
</span><span id="1-4948">                <span class="s2">&quot;not matching locally specified columns </span><span class="si">%s</span><span class="s2">; setting the &quot;</span>
</span><span id="1-4949">                <span class="s2">&quot;current primary key columns to </span><span class="si">%s</span><span class="s2">. This warning &quot;</span>
</span><span id="1-4950">                <span class="s2">&quot;may become an exception in a future release&quot;</span>
</span><span id="1-4951">                <span class="o">%</span> <span class="p">(</span>
</span><span id="1-4952">                    <span class="n">table</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
</span><span id="1-4953">                    <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s2">&quot;&#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span> <span class="o">%</span> <span class="n">c</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">table_pks</span><span class="p">),</span>
</span><span id="1-4954">                    <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s2">&quot;&#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span> <span class="o">%</span> <span class="n">c</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_columns</span><span class="p">),</span>
</span><span id="1-4955">                    <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s2">&quot;&#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span> <span class="o">%</span> <span class="n">c</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_columns</span><span class="p">),</span>
</span><span id="1-4956">                <span class="p">)</span>
</span><span id="1-4957">            <span class="p">)</span>
</span><span id="1-4958">            <span class="n">table_pks</span><span class="p">[:]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="1-4959">
</span><span id="1-4960">        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_columns</span><span class="p">:</span>
</span><span id="1-4961">            <span class="n">c</span><span class="o">.</span><span class="n">primary_key</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="1-4962">            <span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">_user_defined_nullable</span> <span class="ow">is</span> <span class="n">NULL_UNSPECIFIED</span><span class="p">:</span>
</span><span id="1-4963">                <span class="n">c</span><span class="o">.</span><span class="n">nullable</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="1-4964">        <span class="k">if</span> <span class="n">table_pks</span><span class="p">:</span>
</span><span id="1-4965">            <span class="bp">self</span><span class="o">.</span><span class="n">_columns</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">table_pks</span><span class="p">)</span>
</span><span id="1-4966">
</span><span id="1-4967">    <span class="k">def</span> <span class="nf">_reload</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">columns</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">Column</span><span class="p">[</span><span class="n">Any</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-4968"><span class="w">        </span><span class="sd">&quot;&quot;&quot;repopulate this :class:`.PrimaryKeyConstraint` given</span>
</span><span id="1-4969"><span class="sd">        a set of columns.</span>
</span><span id="1-4970">
</span><span id="1-4971"><span class="sd">        Existing columns in the table that are marked as primary_key=True</span>
</span><span id="1-4972"><span class="sd">        are maintained.</span>
</span><span id="1-4973">
</span><span id="1-4974"><span class="sd">        Also fires a new event.</span>
</span><span id="1-4975">
</span><span id="1-4976"><span class="sd">        This is basically like putting a whole new</span>
</span><span id="1-4977"><span class="sd">        :class:`.PrimaryKeyConstraint` object on the parent</span>
</span><span id="1-4978"><span class="sd">        :class:`_schema.Table` object without actually replacing the object.</span>
</span><span id="1-4979">
</span><span id="1-4980"><span class="sd">        The ordering of the given list of columns is also maintained; these</span>
</span><span id="1-4981"><span class="sd">        columns will be appended to the list of columns after any which</span>
</span><span id="1-4982"><span class="sd">        are already present.</span>
</span><span id="1-4983">
</span><span id="1-4984"><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="1-4985">        <span class="c1"># set the primary key flag on new columns.</span>
</span><span id="1-4986">        <span class="c1"># note any existing PK cols on the table also have their</span>
</span><span id="1-4987">        <span class="c1"># flag still set.</span>
</span><span id="1-4988">        <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">columns</span><span class="p">:</span>
</span><span id="1-4989">            <span class="n">col</span><span class="o">.</span><span class="n">primary_key</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="1-4990">
</span><span id="1-4991">        <span class="bp">self</span><span class="o">.</span><span class="n">_columns</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">columns</span><span class="p">)</span>
</span><span id="1-4992">
</span><span id="1-4993">        <span class="n">PrimaryKeyConstraint</span><span class="o">.</span><span class="n">_autoincrement_column</span><span class="o">.</span><span class="n">_reset</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>  <span class="c1"># type: ignore</span>
</span><span id="1-4994">        <span class="bp">self</span><span class="o">.</span><span class="n">_set_parent_with_dispatch</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="p">)</span>
</span><span id="1-4995">
</span><span id="1-4996">    <span class="k">def</span> <span class="nf">_replace</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">col</span><span class="p">:</span> <span class="n">Column</span><span class="p">[</span><span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-4997">        <span class="n">PrimaryKeyConstraint</span><span class="o">.</span><span class="n">_autoincrement_column</span><span class="o">.</span><span class="n">_reset</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>  <span class="c1"># type: ignore</span>
</span><span id="1-4998">        <span class="bp">self</span><span class="o">.</span><span class="n">_columns</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">col</span><span class="p">)</span>
</span><span id="1-4999">
</span><span id="1-5000">        <span class="bp">self</span><span class="o">.</span><span class="n">dispatch</span><span class="o">.</span><span class="n">_sa_event_column_added_to_pk_constraint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">col</span><span class="p">)</span>
</span><span id="1-5001">
</span><span id="1-5002">    <span class="nd">@property</span>
</span><span id="1-5003">    <span class="k">def</span> <span class="nf">columns_autoinc_first</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Column</span><span class="p">[</span><span class="n">Any</span><span class="p">]]:</span>
</span><span id="1-5004">        <span class="n">autoinc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_autoincrement_column</span>
</span><span id="1-5005">
</span><span id="1-5006">        <span class="k">if</span> <span class="n">autoinc</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-5007">            <span class="k">return</span> <span class="p">[</span><span class="n">autoinc</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_columns</span> <span class="k">if</span> <span class="n">c</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">autoinc</span><span class="p">]</span>
</span><span id="1-5008">        <span class="k">else</span><span class="p">:</span>
</span><span id="1-5009">            <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_columns</span><span class="p">)</span>
</span><span id="1-5010">
</span><span id="1-5011">    <span class="nd">@util</span><span class="o">.</span><span class="n">ro_memoized_property</span>
</span><span id="1-5012">    <span class="k">def</span> <span class="nf">_autoincrement_column</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Column</span><span class="p">[</span><span class="nb">int</span><span class="p">]]:</span>
</span><span id="1-5013">        <span class="k">def</span> <span class="nf">_validate_autoinc</span><span class="p">(</span><span class="n">col</span><span class="p">:</span> <span class="n">Column</span><span class="p">[</span><span class="n">Any</span><span class="p">],</span> <span class="n">autoinc_true</span><span class="p">:</span> <span class="nb">bool</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="1-5014">            <span class="k">if</span> <span class="n">col</span><span class="o">.</span><span class="n">type</span><span class="o">.</span><span class="n">_type_affinity</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">issubclass</span><span class="p">(</span>
</span><span id="1-5015">                <span class="n">col</span><span class="o">.</span><span class="n">type</span><span class="o">.</span><span class="n">_type_affinity</span><span class="p">,</span>
</span><span id="1-5016">                <span class="p">(</span>
</span><span id="1-5017">                    <span class="n">type_api</span><span class="o">.</span><span class="n">INTEGERTYPE</span><span class="o">.</span><span class="n">_type_affinity</span><span class="p">,</span>
</span><span id="1-5018">                    <span class="n">type_api</span><span class="o">.</span><span class="n">NUMERICTYPE</span><span class="o">.</span><span class="n">_type_affinity</span><span class="p">,</span>
</span><span id="1-5019">                <span class="p">),</span>
</span><span id="1-5020">            <span class="p">):</span>
</span><span id="1-5021">                <span class="k">if</span> <span class="n">autoinc_true</span><span class="p">:</span>
</span><span id="1-5022">                    <span class="k">raise</span> <span class="n">exc</span><span class="o">.</span><span class="n">ArgumentError</span><span class="p">(</span>
</span><span id="1-5023">                        <span class="s2">&quot;Column type </span><span class="si">%s</span><span class="s2"> on column &#39;</span><span class="si">%s</span><span class="s2">&#39; is not &quot;</span>
</span><span id="1-5024">                        <span class="s2">&quot;compatible with autoincrement=True&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">col</span><span class="o">.</span><span class="n">type</span><span class="p">,</span> <span class="n">col</span><span class="p">)</span>
</span><span id="1-5025">                    <span class="p">)</span>
</span><span id="1-5026">                <span class="k">else</span><span class="p">:</span>
</span><span id="1-5027">                    <span class="k">return</span> <span class="kc">False</span>
</span><span id="1-5028">            <span class="k">elif</span> <span class="p">(</span>
</span><span id="1-5029">                <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">col</span><span class="o">.</span><span class="n">default</span><span class="p">,</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="kc">None</span><span class="p">),</span> <span class="n">Sequence</span><span class="p">))</span>
</span><span id="1-5030">                <span class="ow">and</span> <span class="ow">not</span> <span class="n">autoinc_true</span>
</span><span id="1-5031">            <span class="p">):</span>
</span><span id="1-5032">                <span class="k">return</span> <span class="kc">False</span>
</span><span id="1-5033">            <span class="k">elif</span> <span class="p">(</span>
</span><span id="1-5034">                <span class="n">col</span><span class="o">.</span><span class="n">server_default</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span id="1-5035">                <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">col</span><span class="o">.</span><span class="n">server_default</span><span class="p">,</span> <span class="n">Identity</span><span class="p">)</span>
</span><span id="1-5036">                <span class="ow">and</span> <span class="ow">not</span> <span class="n">autoinc_true</span>
</span><span id="1-5037">            <span class="p">):</span>
</span><span id="1-5038">                <span class="k">return</span> <span class="kc">False</span>
</span><span id="1-5039">            <span class="k">elif</span> <span class="n">col</span><span class="o">.</span><span class="n">foreign_keys</span> <span class="ow">and</span> <span class="n">col</span><span class="o">.</span><span class="n">autoincrement</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span>
</span><span id="1-5040">                <span class="kc">True</span><span class="p">,</span>
</span><span id="1-5041">                <span class="s2">&quot;ignore_fk&quot;</span><span class="p">,</span>
</span><span id="1-5042">            <span class="p">):</span>
</span><span id="1-5043">                <span class="k">return</span> <span class="kc">False</span>
</span><span id="1-5044">            <span class="k">return</span> <span class="kc">True</span>
</span><span id="1-5045">
</span><span id="1-5046">        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_columns</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="1-5047">            <span class="n">col</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_columns</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="1-5048">
</span><span id="1-5049">            <span class="k">if</span> <span class="n">col</span><span class="o">.</span><span class="n">autoincrement</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
</span><span id="1-5050">                <span class="n">_validate_autoinc</span><span class="p">(</span><span class="n">col</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
</span><span id="1-5051">                <span class="k">return</span> <span class="n">col</span>
</span><span id="1-5052">            <span class="k">elif</span> <span class="n">col</span><span class="o">.</span><span class="n">autoincrement</span> <span class="ow">in</span> <span class="p">(</span>
</span><span id="1-5053">                <span class="s2">&quot;auto&quot;</span><span class="p">,</span>
</span><span id="1-5054">                <span class="s2">&quot;ignore_fk&quot;</span><span class="p">,</span>
</span><span id="1-5055">            <span class="p">)</span> <span class="ow">and</span> <span class="n">_validate_autoinc</span><span class="p">(</span><span class="n">col</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
</span><span id="1-5056">                <span class="k">return</span> <span class="n">col</span>
</span><span id="1-5057">            <span class="k">else</span><span class="p">:</span>
</span><span id="1-5058">                <span class="k">return</span> <span class="kc">None</span>
</span><span id="1-5059">
</span><span id="1-5060">        <span class="k">else</span><span class="p">:</span>
</span><span id="1-5061">            <span class="n">autoinc</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="1-5062">            <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_columns</span><span class="p">:</span>
</span><span id="1-5063">                <span class="k">if</span> <span class="n">col</span><span class="o">.</span><span class="n">autoincrement</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
</span><span id="1-5064">                    <span class="n">_validate_autoinc</span><span class="p">(</span><span class="n">col</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
</span><span id="1-5065">                    <span class="k">if</span> <span class="n">autoinc</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-5066">                        <span class="k">raise</span> <span class="n">exc</span><span class="o">.</span><span class="n">ArgumentError</span><span class="p">(</span>
</span><span id="1-5067">                            <span class="s2">&quot;Only one Column may be marked &quot;</span>
</span><span id="1-5068">                            <span class="s2">&quot;autoincrement=True, found both </span><span class="si">%s</span><span class="s2"> and </span><span class="si">%s</span><span class="s2">.&quot;</span>
</span><span id="1-5069">                            <span class="o">%</span> <span class="p">(</span><span class="n">col</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">autoinc</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</span><span id="1-5070">                        <span class="p">)</span>
</span><span id="1-5071">                    <span class="k">else</span><span class="p">:</span>
</span><span id="1-5072">                        <span class="n">autoinc</span> <span class="o">=</span> <span class="n">col</span>
</span><span id="1-5073">
</span><span id="1-5074">            <span class="k">return</span> <span class="n">autoinc</span>
</span><span id="1-5075">
</span><span id="1-5076">
</span><span id="1-5077"><span class="k">class</span> <span class="nc">UniqueConstraint</span><span class="p">(</span><span class="n">ColumnCollectionConstraint</span><span class="p">):</span>
</span><span id="1-5078"><span class="w">    </span><span class="sd">&quot;&quot;&quot;A table-level UNIQUE constraint.</span>
</span><span id="1-5079">
</span><span id="1-5080"><span class="sd">    Defines a single column or composite UNIQUE constraint. For a no-frills,</span>
</span><span id="1-5081"><span class="sd">    single column constraint, adding ``unique=True`` to the ``Column``</span>
</span><span id="1-5082"><span class="sd">    definition is a shorthand equivalent for an unnamed, single column</span>
</span><span id="1-5083"><span class="sd">    UniqueConstraint.</span>
</span><span id="1-5084"><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="1-5085">
</span><span id="1-5086">    <span class="n">__visit_name__</span> <span class="o">=</span> <span class="s2">&quot;unique_constraint&quot;</span>
</span><span id="1-5087">
</span><span id="1-5088">
</span><span id="1-5089"><span class="k">class</span> <span class="nc">Index</span><span class="p">(</span>
</span><span id="1-5090">    <span class="n">DialectKWArgs</span><span class="p">,</span> <span class="n">ColumnCollectionMixin</span><span class="p">,</span> <span class="n">HasConditionalDDL</span><span class="p">,</span> <span class="n">SchemaItem</span>
</span><span id="1-5091"><span class="p">):</span>
</span><span id="1-5092"><span class="w">    </span><span class="sd">&quot;&quot;&quot;A table-level INDEX.</span>
</span><span id="1-5093">
</span><span id="1-5094"><span class="sd">    Defines a composite (one or more column) INDEX.</span>
</span><span id="1-5095">
</span><span id="1-5096"><span class="sd">    E.g.::</span>
</span><span id="1-5097">
</span><span id="1-5098"><span class="sd">        sometable = Table(&quot;sometable&quot;, metadata,</span>
</span><span id="1-5099"><span class="sd">                        Column(&quot;name&quot;, String(50)),</span>
</span><span id="1-5100"><span class="sd">                        Column(&quot;address&quot;, String(100))</span>
</span><span id="1-5101"><span class="sd">                    )</span>
</span><span id="1-5102">
</span><span id="1-5103"><span class="sd">        Index(&quot;some_index&quot;, sometable.c.name)</span>
</span><span id="1-5104">
</span><span id="1-5105"><span class="sd">    For a no-frills, single column index, adding</span>
</span><span id="1-5106"><span class="sd">    :class:`_schema.Column` also supports ``index=True``::</span>
</span><span id="1-5107">
</span><span id="1-5108"><span class="sd">        sometable = Table(&quot;sometable&quot;, metadata,</span>
</span><span id="1-5109"><span class="sd">                        Column(&quot;name&quot;, String(50), index=True)</span>
</span><span id="1-5110"><span class="sd">                    )</span>
</span><span id="1-5111">
</span><span id="1-5112"><span class="sd">    For a composite index, multiple columns can be specified::</span>
</span><span id="1-5113">
</span><span id="1-5114"><span class="sd">        Index(&quot;some_index&quot;, sometable.c.name, sometable.c.address)</span>
</span><span id="1-5115">
</span><span id="1-5116"><span class="sd">    Functional indexes are supported as well, typically by using the</span>
</span><span id="1-5117"><span class="sd">    :data:`.func` construct in conjunction with table-bound</span>
</span><span id="1-5118"><span class="sd">    :class:`_schema.Column` objects::</span>
</span><span id="1-5119">
</span><span id="1-5120"><span class="sd">        Index(&quot;some_index&quot;, func.lower(sometable.c.name))</span>
</span><span id="1-5121">
</span><span id="1-5122"><span class="sd">    An :class:`.Index` can also be manually associated with a</span>
</span><span id="1-5123"><span class="sd">    :class:`_schema.Table`,</span>
</span><span id="1-5124"><span class="sd">    either through inline declaration or using</span>
</span><span id="1-5125"><span class="sd">    :meth:`_schema.Table.append_constraint`.  When this approach is used,</span>
</span><span id="1-5126"><span class="sd">    the names</span>
</span><span id="1-5127"><span class="sd">    of the indexed columns can be specified as strings::</span>
</span><span id="1-5128">
</span><span id="1-5129"><span class="sd">        Table(&quot;sometable&quot;, metadata,</span>
</span><span id="1-5130"><span class="sd">                        Column(&quot;name&quot;, String(50)),</span>
</span><span id="1-5131"><span class="sd">                        Column(&quot;address&quot;, String(100)),</span>
</span><span id="1-5132"><span class="sd">                        Index(&quot;some_index&quot;, &quot;name&quot;, &quot;address&quot;)</span>
</span><span id="1-5133"><span class="sd">                )</span>
</span><span id="1-5134">
</span><span id="1-5135"><span class="sd">    To support functional or expression-based indexes in this form, the</span>
</span><span id="1-5136"><span class="sd">    :func:`_expression.text` construct may be used::</span>
</span><span id="1-5137">
</span><span id="1-5138"><span class="sd">        from sqlalchemy import text</span>
</span><span id="1-5139">
</span><span id="1-5140"><span class="sd">        Table(&quot;sometable&quot;, metadata,</span>
</span><span id="1-5141"><span class="sd">                        Column(&quot;name&quot;, String(50)),</span>
</span><span id="1-5142"><span class="sd">                        Column(&quot;address&quot;, String(100)),</span>
</span><span id="1-5143"><span class="sd">                        Index(&quot;some_index&quot;, text(&quot;lower(name)&quot;))</span>
</span><span id="1-5144"><span class="sd">                )</span>
</span><span id="1-5145">
</span><span id="1-5146"><span class="sd">    .. seealso::</span>
</span><span id="1-5147">
</span><span id="1-5148"><span class="sd">        :ref:`schema_indexes` - General information on :class:`.Index`.</span>
</span><span id="1-5149">
</span><span id="1-5150"><span class="sd">        :ref:`postgresql_indexes` - PostgreSQL-specific options available for</span>
</span><span id="1-5151"><span class="sd">        the :class:`.Index` construct.</span>
</span><span id="1-5152">
</span><span id="1-5153"><span class="sd">        :ref:`mysql_indexes` - MySQL-specific options available for the</span>
</span><span id="1-5154"><span class="sd">        :class:`.Index` construct.</span>
</span><span id="1-5155">
</span><span id="1-5156"><span class="sd">        :ref:`mssql_indexes` - MSSQL-specific options available for the</span>
</span><span id="1-5157"><span class="sd">        :class:`.Index` construct.</span>
</span><span id="1-5158">
</span><span id="1-5159"><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="1-5160">
</span><span id="1-5161">    <span class="n">__visit_name__</span> <span class="o">=</span> <span class="s2">&quot;index&quot;</span>
</span><span id="1-5162">
</span><span id="1-5163">    <span class="n">table</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Table</span><span class="p">]</span>
</span><span id="1-5164">    <span class="n">expressions</span><span class="p">:</span> <span class="n">_typing_Sequence</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">ColumnElement</span><span class="p">[</span><span class="n">Any</span><span class="p">]]]</span>
</span><span id="1-5165">    <span class="n">_table_bound_expressions</span><span class="p">:</span> <span class="n">_typing_Sequence</span><span class="p">[</span><span class="n">ColumnElement</span><span class="p">[</span><span class="n">Any</span><span class="p">]]</span>
</span><span id="1-5166">
</span><span id="1-5167">    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
</span><span id="1-5168">        <span class="bp">self</span><span class="p">,</span>
</span><span id="1-5169">        <span class="n">name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
</span><span id="1-5170">        <span class="o">*</span><span class="n">expressions</span><span class="p">:</span> <span class="n">_DDLColumnArgument</span><span class="p">,</span>
</span><span id="1-5171">        <span class="n">unique</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="1-5172">        <span class="n">quote</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="1-5173">        <span class="n">info</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">_InfoType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="1-5174">        <span class="n">_table</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Table</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="1-5175">        <span class="n">_column_flag</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="1-5176">        <span class="o">**</span><span class="n">dialect_kw</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
</span><span id="1-5177">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-5178"><span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Construct an index object.</span>
</span><span id="1-5179">
</span><span id="1-5180"><span class="sd">        :param name:</span>
</span><span id="1-5181"><span class="sd">          The name of the index</span>
</span><span id="1-5182">
</span><span id="1-5183"><span class="sd">        :param \*expressions:</span>
</span><span id="1-5184"><span class="sd">          Column expressions to include in the index.   The expressions</span>
</span><span id="1-5185"><span class="sd">          are normally instances of :class:`_schema.Column`, but may also</span>
</span><span id="1-5186"><span class="sd">          be arbitrary SQL expressions which ultimately refer to a</span>
</span><span id="1-5187"><span class="sd">          :class:`_schema.Column`.</span>
</span><span id="1-5188">
</span><span id="1-5189"><span class="sd">        :param unique=False:</span>
</span><span id="1-5190"><span class="sd">            Keyword only argument; if True, create a unique index.</span>
</span><span id="1-5191">
</span><span id="1-5192"><span class="sd">        :param quote=None:</span>
</span><span id="1-5193"><span class="sd">            Keyword only argument; whether to apply quoting to the name of</span>
</span><span id="1-5194"><span class="sd">            the index.  Works in the same manner as that of</span>
</span><span id="1-5195"><span class="sd">            :paramref:`_schema.Column.quote`.</span>
</span><span id="1-5196">
</span><span id="1-5197"><span class="sd">        :param info=None: Optional data dictionary which will be populated</span>
</span><span id="1-5198"><span class="sd">            into the :attr:`.SchemaItem.info` attribute of this object.</span>
</span><span id="1-5199">
</span><span id="1-5200"><span class="sd">        :param \**dialect_kw: Additional keyword arguments not mentioned above</span>
</span><span id="1-5201"><span class="sd">            are dialect specific, and passed in the form</span>
</span><span id="1-5202"><span class="sd">            ``&lt;dialectname&gt;_&lt;argname&gt;``. See the documentation regarding an</span>
</span><span id="1-5203"><span class="sd">            individual dialect at :ref:`dialect_toplevel` for detail on</span>
</span><span id="1-5204"><span class="sd">            documented arguments.</span>
</span><span id="1-5205">
</span><span id="1-5206"><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="1-5207">        <span class="bp">self</span><span class="o">.</span><span class="n">table</span> <span class="o">=</span> <span class="n">table</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="1-5208">
</span><span id="1-5209">        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">quoted_name</span><span class="o">.</span><span class="n">construct</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">quote</span><span class="p">)</span>
</span><span id="1-5210">        <span class="bp">self</span><span class="o">.</span><span class="n">unique</span> <span class="o">=</span> <span class="n">unique</span>
</span><span id="1-5211">        <span class="k">if</span> <span class="n">info</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-5212">            <span class="bp">self</span><span class="o">.</span><span class="n">info</span> <span class="o">=</span> <span class="n">info</span>
</span><span id="1-5213">
</span><span id="1-5214">        <span class="c1"># TODO: consider &quot;table&quot; argument being public, but for</span>
</span><span id="1-5215">        <span class="c1"># the purpose of the fix here, it starts as private.</span>
</span><span id="1-5216">        <span class="k">if</span> <span class="n">_table</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-5217">            <span class="n">table</span> <span class="o">=</span> <span class="n">_table</span>
</span><span id="1-5218">
</span><span id="1-5219">        <span class="bp">self</span><span class="o">.</span><span class="n">_validate_dialect_kwargs</span><span class="p">(</span><span class="n">dialect_kw</span><span class="p">)</span>
</span><span id="1-5220">
</span><span id="1-5221">        <span class="bp">self</span><span class="o">.</span><span class="n">expressions</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="1-5222">        <span class="c1"># will call _set_parent() if table-bound column</span>
</span><span id="1-5223">        <span class="c1"># objects are present</span>
</span><span id="1-5224">        <span class="n">ColumnCollectionMixin</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="1-5225">            <span class="bp">self</span><span class="p">,</span>
</span><span id="1-5226">            <span class="o">*</span><span class="n">expressions</span><span class="p">,</span>
</span><span id="1-5227">            <span class="n">_column_flag</span><span class="o">=</span><span class="n">_column_flag</span><span class="p">,</span>
</span><span id="1-5228">            <span class="n">_gather_expressions</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">expressions</span><span class="p">,</span>
</span><span id="1-5229">        <span class="p">)</span>
</span><span id="1-5230">        <span class="k">if</span> <span class="n">table</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-5231">            <span class="bp">self</span><span class="o">.</span><span class="n">_set_parent</span><span class="p">(</span><span class="n">table</span><span class="p">)</span>
</span><span id="1-5232">
</span><span id="1-5233">    <span class="k">def</span> <span class="nf">_set_parent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">:</span> <span class="n">SchemaEventTarget</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-5234">        <span class="n">table</span> <span class="o">=</span> <span class="n">parent</span>
</span><span id="1-5235">        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">table</span><span class="p">,</span> <span class="n">Table</span><span class="p">)</span>
</span><span id="1-5236">        <span class="n">ColumnCollectionMixin</span><span class="o">.</span><span class="n">_set_parent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">table</span><span class="p">)</span>
</span><span id="1-5237">
</span><span id="1-5238">        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">table</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">table</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="p">:</span>
</span><span id="1-5239">            <span class="k">raise</span> <span class="n">exc</span><span class="o">.</span><span class="n">ArgumentError</span><span class="p">(</span>
</span><span id="1-5240">                <span class="s2">&quot;Index &#39;</span><span class="si">%s</span><span class="s2">&#39; is against table &#39;</span><span class="si">%s</span><span class="s2">&#39;, and &quot;</span>
</span><span id="1-5241">                <span class="s2">&quot;cannot be associated with table &#39;</span><span class="si">%s</span><span class="s2">&#39;.&quot;</span>
</span><span id="1-5242">                <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">description</span><span class="p">,</span> <span class="n">table</span><span class="o">.</span><span class="n">description</span><span class="p">)</span>
</span><span id="1-5243">            <span class="p">)</span>
</span><span id="1-5244">        <span class="bp">self</span><span class="o">.</span><span class="n">table</span> <span class="o">=</span> <span class="n">table</span>
</span><span id="1-5245">        <span class="n">table</span><span class="o">.</span><span class="n">indexes</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span><span id="1-5246">
</span><span id="1-5247">        <span class="n">expressions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">expressions</span>
</span><span id="1-5248">        <span class="n">col_expressions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_col_expressions</span><span class="p">(</span><span class="n">table</span><span class="p">)</span>
</span><span id="1-5249">        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">expressions</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">col_expressions</span><span class="p">)</span>
</span><span id="1-5250">
</span><span id="1-5251">        <span class="n">exprs</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="1-5252">        <span class="k">for</span> <span class="n">expr</span><span class="p">,</span> <span class="n">colexpr</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">expressions</span><span class="p">,</span> <span class="n">col_expressions</span><span class="p">):</span>
</span><span id="1-5253">            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span> <span class="n">ClauseElement</span><span class="p">):</span>
</span><span id="1-5254">                <span class="n">exprs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">expr</span><span class="p">)</span>
</span><span id="1-5255">            <span class="k">elif</span> <span class="n">colexpr</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-5256">                <span class="n">exprs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">colexpr</span><span class="p">)</span>
</span><span id="1-5257">            <span class="k">else</span><span class="p">:</span>
</span><span id="1-5258">                <span class="k">assert</span> <span class="kc">False</span>
</span><span id="1-5259">        <span class="bp">self</span><span class="o">.</span><span class="n">expressions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_table_bound_expressions</span> <span class="o">=</span> <span class="n">exprs</span>
</span><span id="1-5260">
</span><span id="1-5261">    <span class="k">def</span> <span class="nf">create</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bind</span><span class="p">:</span> <span class="n">_CreateDropBind</span><span class="p">,</span> <span class="n">checkfirst</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-5262"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Issue a ``CREATE`` statement for this</span>
</span><span id="1-5263"><span class="sd">        :class:`.Index`, using the given</span>
</span><span id="1-5264"><span class="sd">        :class:`.Connection` or :class:`.Engine`` for connectivity.</span>
</span><span id="1-5265">
</span><span id="1-5266"><span class="sd">        .. seealso::</span>
</span><span id="1-5267">
</span><span id="1-5268"><span class="sd">            :meth:`_schema.MetaData.create_all`.</span>
</span><span id="1-5269">
</span><span id="1-5270"><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="1-5271">        <span class="n">bind</span><span class="o">.</span><span class="n">_run_ddl_visitor</span><span class="p">(</span><span class="n">ddl</span><span class="o">.</span><span class="n">SchemaGenerator</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="n">checkfirst</span><span class="o">=</span><span class="n">checkfirst</span><span class="p">)</span>
</span><span id="1-5272">
</span><span id="1-5273">    <span class="k">def</span> <span class="nf">drop</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bind</span><span class="p">:</span> <span class="n">_CreateDropBind</span><span class="p">,</span> <span class="n">checkfirst</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-5274"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Issue a ``DROP`` statement for this</span>
</span><span id="1-5275"><span class="sd">        :class:`.Index`, using the given</span>
</span><span id="1-5276"><span class="sd">        :class:`.Connection` or :class:`.Engine` for connectivity.</span>
</span><span id="1-5277">
</span><span id="1-5278"><span class="sd">        .. seealso::</span>
</span><span id="1-5279">
</span><span id="1-5280"><span class="sd">            :meth:`_schema.MetaData.drop_all`.</span>
</span><span id="1-5281">
</span><span id="1-5282"><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="1-5283">        <span class="n">bind</span><span class="o">.</span><span class="n">_run_ddl_visitor</span><span class="p">(</span><span class="n">ddl</span><span class="o">.</span><span class="n">SchemaDropper</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="n">checkfirst</span><span class="o">=</span><span class="n">checkfirst</span><span class="p">)</span>
</span><span id="1-5284">
</span><span id="1-5285">    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="1-5286">        <span class="n">exprs</span><span class="p">:</span> <span class="n">_typing_Sequence</span><span class="p">[</span><span class="n">Any</span><span class="p">]</span>  <span class="c1"># noqa: F842</span>
</span><span id="1-5287">
</span><span id="1-5288">        <span class="k">return</span> <span class="s2">&quot;Index(</span><span class="si">%s</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span>
</span><span id="1-5289">            <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="1-5290">                <span class="p">[</span><span class="nb">repr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)]</span>
</span><span id="1-5291">                <span class="o">+</span> <span class="p">[</span><span class="nb">repr</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">expressions</span><span class="p">]</span>
</span><span id="1-5292">                <span class="o">+</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">unique</span> <span class="ow">and</span> <span class="p">[</span><span class="s2">&quot;unique=True&quot;</span><span class="p">]</span> <span class="ow">or</span> <span class="p">[])</span>
</span><span id="1-5293">            <span class="p">)</span>
</span><span id="1-5294">        <span class="p">)</span>
</span><span id="1-5295">
</span><span id="1-5296">
</span><span id="1-5297"><span class="n">_NamingSchemaCallable</span> <span class="o">=</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">Constraint</span><span class="p">,</span> <span class="n">Table</span><span class="p">],</span> <span class="nb">str</span><span class="p">]</span>
</span><span id="1-5298"><span class="n">_NamingSchemaDirective</span> <span class="o">=</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">_NamingSchemaCallable</span><span class="p">]</span>
</span><span id="1-5299">
</span><span id="1-5300">
</span><span id="1-5301"><span class="k">class</span> <span class="nc">_NamingSchemaTD</span><span class="p">(</span><span class="n">TypedDict</span><span class="p">,</span> <span class="n">total</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="1-5302">    <span class="n">fk</span><span class="p">:</span> <span class="n">_NamingSchemaDirective</span>
</span><span id="1-5303">    <span class="n">pk</span><span class="p">:</span> <span class="n">_NamingSchemaDirective</span>
</span><span id="1-5304">    <span class="n">ix</span><span class="p">:</span> <span class="n">_NamingSchemaDirective</span>
</span><span id="1-5305">    <span class="n">ck</span><span class="p">:</span> <span class="n">_NamingSchemaDirective</span>
</span><span id="1-5306">    <span class="n">uq</span><span class="p">:</span> <span class="n">_NamingSchemaDirective</span>
</span><span id="1-5307">
</span><span id="1-5308">
</span><span id="1-5309"><span class="n">_NamingSchemaParameter</span> <span class="o">=</span> <span class="n">Union</span><span class="p">[</span>
</span><span id="1-5310">    <span class="c1"># it seems like the TypedDict here is useful for pylance typeahead,</span>
</span><span id="1-5311">    <span class="c1"># and not much else</span>
</span><span id="1-5312">    <span class="n">_NamingSchemaTD</span><span class="p">,</span>
</span><span id="1-5313">    <span class="c1"># there is no form that allows Union[Type[Any], str] to work in all</span>
</span><span id="1-5314">    <span class="c1"># cases, including breaking out Mapping[] entries for each combination</span>
</span><span id="1-5315">    <span class="c1"># even, therefore keys must be `Any` (see #10264)</span>
</span><span id="1-5316">    <span class="n">Mapping</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="n">_NamingSchemaDirective</span><span class="p">],</span>
</span><span id="1-5317"><span class="p">]</span>
</span><span id="1-5318">
</span><span id="1-5319">
</span><span id="1-5320"><span class="n">DEFAULT_NAMING_CONVENTION</span><span class="p">:</span> <span class="n">_NamingSchemaParameter</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">immutabledict</span><span class="p">(</span>
</span><span id="1-5321">    <span class="p">{</span><span class="s2">&quot;ix&quot;</span><span class="p">:</span> <span class="s2">&quot;ix_</span><span class="si">%(column_0_label)s</span><span class="s2">&quot;</span><span class="p">}</span>
</span><span id="1-5322"><span class="p">)</span>
</span><span id="1-5323">
</span><span id="1-5324">
</span><span id="1-5325"><span class="k">class</span> <span class="nc">MetaData</span><span class="p">(</span><span class="n">HasSchemaAttr</span><span class="p">):</span>
</span><span id="1-5326"><span class="w">    </span><span class="sd">&quot;&quot;&quot;A collection of :class:`_schema.Table`</span>
</span><span id="1-5327"><span class="sd">    objects and their associated schema</span>
</span><span id="1-5328"><span class="sd">    constructs.</span>
</span><span id="1-5329">
</span><span id="1-5330"><span class="sd">    Holds a collection of :class:`_schema.Table` objects as well as</span>
</span><span id="1-5331"><span class="sd">    an optional binding to an :class:`_engine.Engine` or</span>
</span><span id="1-5332"><span class="sd">    :class:`_engine.Connection`.  If bound, the :class:`_schema.Table` objects</span>
</span><span id="1-5333"><span class="sd">    in the collection and their columns may participate in implicit SQL</span>
</span><span id="1-5334"><span class="sd">    execution.</span>
</span><span id="1-5335">
</span><span id="1-5336"><span class="sd">    The :class:`_schema.Table` objects themselves are stored in the</span>
</span><span id="1-5337"><span class="sd">    :attr:`_schema.MetaData.tables` dictionary.</span>
</span><span id="1-5338">
</span><span id="1-5339"><span class="sd">    :class:`_schema.MetaData` is a thread-safe object for read operations.</span>
</span><span id="1-5340"><span class="sd">    Construction of new tables within a single :class:`_schema.MetaData`</span>
</span><span id="1-5341"><span class="sd">    object,</span>
</span><span id="1-5342"><span class="sd">    either explicitly or via reflection, may not be completely thread-safe.</span>
</span><span id="1-5343">
</span><span id="1-5344"><span class="sd">    .. seealso::</span>
</span><span id="1-5345">
</span><span id="1-5346"><span class="sd">        :ref:`metadata_describing` - Introduction to database metadata</span>
</span><span id="1-5347">
</span><span id="1-5348"><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="1-5349">
</span><span id="1-5350">    <span class="n">__visit_name__</span> <span class="o">=</span> <span class="s2">&quot;metadata&quot;</span>
</span><span id="1-5351">
</span><span id="1-5352">    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
</span><span id="1-5353">        <span class="bp">self</span><span class="p">,</span>
</span><span id="1-5354">        <span class="n">schema</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="1-5355">        <span class="n">quote_schema</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="1-5356">        <span class="n">naming_convention</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">_NamingSchemaParameter</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="1-5357">        <span class="n">info</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">_InfoType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="1-5358">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-5359"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a new MetaData object.</span>
</span><span id="1-5360">
</span><span id="1-5361"><span class="sd">        :param schema:</span>
</span><span id="1-5362"><span class="sd">           The default schema to use for the :class:`_schema.Table`,</span>
</span><span id="1-5363"><span class="sd">           :class:`.Sequence`, and potentially other objects associated with</span>
</span><span id="1-5364"><span class="sd">           this :class:`_schema.MetaData`. Defaults to ``None``.</span>
</span><span id="1-5365">
</span><span id="1-5366"><span class="sd">           .. seealso::</span>
</span><span id="1-5367">
</span><span id="1-5368"><span class="sd">                :ref:`schema_metadata_schema_name` - details on how the</span>
</span><span id="1-5369"><span class="sd">                :paramref:`_schema.MetaData.schema` parameter is used.</span>
</span><span id="1-5370">
</span><span id="1-5371"><span class="sd">                :paramref:`_schema.Table.schema`</span>
</span><span id="1-5372">
</span><span id="1-5373"><span class="sd">                :paramref:`.Sequence.schema`</span>
</span><span id="1-5374">
</span><span id="1-5375"><span class="sd">        :param quote_schema:</span>
</span><span id="1-5376"><span class="sd">            Sets the ``quote_schema`` flag for those :class:`_schema.Table`,</span>
</span><span id="1-5377"><span class="sd">            :class:`.Sequence`, and other objects which make usage of the</span>
</span><span id="1-5378"><span class="sd">            local ``schema`` name.</span>
</span><span id="1-5379">
</span><span id="1-5380"><span class="sd">        :param info: Optional data dictionary which will be populated into the</span>
</span><span id="1-5381"><span class="sd">            :attr:`.SchemaItem.info` attribute of this object.</span>
</span><span id="1-5382">
</span><span id="1-5383"><span class="sd">        :param naming_convention: a dictionary referring to values which</span>
</span><span id="1-5384"><span class="sd">          will establish default naming conventions for :class:`.Constraint`</span>
</span><span id="1-5385"><span class="sd">          and :class:`.Index` objects, for those objects which are not given</span>
</span><span id="1-5386"><span class="sd">          a name explicitly.</span>
</span><span id="1-5387">
</span><span id="1-5388"><span class="sd">          The keys of this dictionary may be:</span>
</span><span id="1-5389">
</span><span id="1-5390"><span class="sd">          * a constraint or Index class, e.g. the :class:`.UniqueConstraint`,</span>
</span><span id="1-5391"><span class="sd">            :class:`_schema.ForeignKeyConstraint` class, the :class:`.Index`</span>
</span><span id="1-5392"><span class="sd">            class</span>
</span><span id="1-5393">
</span><span id="1-5394"><span class="sd">          * a string mnemonic for one of the known constraint classes;</span>
</span><span id="1-5395"><span class="sd">            ``&quot;fk&quot;``, ``&quot;pk&quot;``, ``&quot;ix&quot;``, ``&quot;ck&quot;``, ``&quot;uq&quot;`` for foreign key,</span>
</span><span id="1-5396"><span class="sd">            primary key, index, check, and unique constraint, respectively.</span>
</span><span id="1-5397">
</span><span id="1-5398"><span class="sd">          * the string name of a user-defined &quot;token&quot; that can be used</span>
</span><span id="1-5399"><span class="sd">            to define new naming tokens.</span>
</span><span id="1-5400">
</span><span id="1-5401"><span class="sd">          The values associated with each &quot;constraint class&quot; or &quot;constraint</span>
</span><span id="1-5402"><span class="sd">          mnemonic&quot; key are string naming templates, such as</span>
</span><span id="1-5403"><span class="sd">          ``&quot;uq_%(table_name)s_%(column_0_name)s&quot;``,</span>
</span><span id="1-5404"><span class="sd">          which describe how the name should be composed.  The values</span>
</span><span id="1-5405"><span class="sd">          associated with user-defined &quot;token&quot; keys should be callables of the</span>
</span><span id="1-5406"><span class="sd">          form ``fn(constraint, table)``, which accepts the constraint/index</span>
</span><span id="1-5407"><span class="sd">          object and :class:`_schema.Table` as arguments, returning a string</span>
</span><span id="1-5408"><span class="sd">          result.</span>
</span><span id="1-5409">
</span><span id="1-5410"><span class="sd">          The built-in names are as follows, some of which may only be</span>
</span><span id="1-5411"><span class="sd">          available for certain types of constraint:</span>
</span><span id="1-5412">
</span><span id="1-5413"><span class="sd">            * ``%(table_name)s`` - the name of the :class:`_schema.Table`</span>
</span><span id="1-5414"><span class="sd">              object</span>
</span><span id="1-5415"><span class="sd">              associated with the constraint.</span>
</span><span id="1-5416">
</span><span id="1-5417"><span class="sd">            * ``%(referred_table_name)s`` - the name of the</span>
</span><span id="1-5418"><span class="sd">              :class:`_schema.Table`</span>
</span><span id="1-5419"><span class="sd">              object associated with the referencing target of a</span>
</span><span id="1-5420"><span class="sd">              :class:`_schema.ForeignKeyConstraint`.</span>
</span><span id="1-5421">
</span><span id="1-5422"><span class="sd">            * ``%(column_0_name)s`` - the name of the :class:`_schema.Column`</span>
</span><span id="1-5423"><span class="sd">              at</span>
</span><span id="1-5424"><span class="sd">              index position &quot;0&quot; within the constraint.</span>
</span><span id="1-5425">
</span><span id="1-5426"><span class="sd">            * ``%(column_0N_name)s`` - the name of all :class:`_schema.Column`</span>
</span><span id="1-5427"><span class="sd">              objects in order within the constraint, joined without a</span>
</span><span id="1-5428"><span class="sd">              separator.</span>
</span><span id="1-5429">
</span><span id="1-5430"><span class="sd">            * ``%(column_0_N_name)s`` - the name of all</span>
</span><span id="1-5431"><span class="sd">              :class:`_schema.Column`</span>
</span><span id="1-5432"><span class="sd">              objects in order within the constraint, joined with an</span>
</span><span id="1-5433"><span class="sd">              underscore as a separator.</span>
</span><span id="1-5434">
</span><span id="1-5435"><span class="sd">            * ``%(column_0_label)s``, ``%(column_0N_label)s``,</span>
</span><span id="1-5436"><span class="sd">              ``%(column_0_N_label)s`` - the label of either the zeroth</span>
</span><span id="1-5437"><span class="sd">              :class:`_schema.Column` or all :class:`.Columns`, separated with</span>
</span><span id="1-5438"><span class="sd">              or without an underscore</span>
</span><span id="1-5439">
</span><span id="1-5440"><span class="sd">            * ``%(column_0_key)s``, ``%(column_0N_key)s``,</span>
</span><span id="1-5441"><span class="sd">              ``%(column_0_N_key)s`` - the key of either the zeroth</span>
</span><span id="1-5442"><span class="sd">              :class:`_schema.Column` or all :class:`.Columns`, separated with</span>
</span><span id="1-5443"><span class="sd">              or without an underscore</span>
</span><span id="1-5444">
</span><span id="1-5445"><span class="sd">            * ``%(referred_column_0_name)s``, ``%(referred_column_0N_name)s``</span>
</span><span id="1-5446"><span class="sd">              ``%(referred_column_0_N_name)s``,  ``%(referred_column_0_key)s``,</span>
</span><span id="1-5447"><span class="sd">              ``%(referred_column_0N_key)s``, ...  column tokens which</span>
</span><span id="1-5448"><span class="sd">              render the names/keys/labels of columns that are referenced</span>
</span><span id="1-5449"><span class="sd">              by a  :class:`_schema.ForeignKeyConstraint`.</span>
</span><span id="1-5450">
</span><span id="1-5451"><span class="sd">            * ``%(constraint_name)s`` - a special key that refers to the</span>
</span><span id="1-5452"><span class="sd">              existing name given to the constraint.  When this key is</span>
</span><span id="1-5453"><span class="sd">              present, the :class:`.Constraint` object&#39;s existing name will be</span>
</span><span id="1-5454"><span class="sd">              replaced with one that is composed from template string that</span>
</span><span id="1-5455"><span class="sd">              uses this token. When this token is present, it is required that</span>
</span><span id="1-5456"><span class="sd">              the :class:`.Constraint` is given an explicit name ahead of time.</span>
</span><span id="1-5457">
</span><span id="1-5458"><span class="sd">            * user-defined: any additional token may be implemented by passing</span>
</span><span id="1-5459"><span class="sd">              it along with a ``fn(constraint, table)`` callable to the</span>
</span><span id="1-5460"><span class="sd">              naming_convention dictionary.</span>
</span><span id="1-5461">
</span><span id="1-5462"><span class="sd">          .. versionadded:: 1.3.0 - added new ``%(column_0N_name)s``,</span>
</span><span id="1-5463"><span class="sd">             ``%(column_0_N_name)s``, and related tokens that produce</span>
</span><span id="1-5464"><span class="sd">             concatenations of names, keys, or labels for all columns referred</span>
</span><span id="1-5465"><span class="sd">             to by a given constraint.</span>
</span><span id="1-5466">
</span><span id="1-5467"><span class="sd">          .. seealso::</span>
</span><span id="1-5468">
</span><span id="1-5469"><span class="sd">                :ref:`constraint_naming_conventions` - for detailed usage</span>
</span><span id="1-5470"><span class="sd">                examples.</span>
</span><span id="1-5471">
</span><span id="1-5472"><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="1-5473">        <span class="k">if</span> <span class="n">schema</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">schema</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="1-5474">            <span class="k">raise</span> <span class="n">exc</span><span class="o">.</span><span class="n">ArgumentError</span><span class="p">(</span>
</span><span id="1-5475">                <span class="s2">&quot;expected schema argument to be a string, &quot;</span>
</span><span id="1-5476">                <span class="sa">f</span><span class="s2">&quot;got </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">schema</span><span class="p">)</span><span class="si">}</span><span class="s2">.&quot;</span>
</span><span id="1-5477">            <span class="p">)</span>
</span><span id="1-5478">        <span class="bp">self</span><span class="o">.</span><span class="n">tables</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">FacadeDict</span><span class="p">()</span>
</span><span id="1-5479">        <span class="bp">self</span><span class="o">.</span><span class="n">schema</span> <span class="o">=</span> <span class="n">quoted_name</span><span class="o">.</span><span class="n">construct</span><span class="p">(</span><span class="n">schema</span><span class="p">,</span> <span class="n">quote_schema</span><span class="p">)</span>
</span><span id="1-5480">        <span class="bp">self</span><span class="o">.</span><span class="n">naming_convention</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="1-5481">            <span class="n">naming_convention</span>
</span><span id="1-5482">            <span class="k">if</span> <span class="n">naming_convention</span>
</span><span id="1-5483">            <span class="k">else</span> <span class="n">DEFAULT_NAMING_CONVENTION</span>
</span><span id="1-5484">        <span class="p">)</span>
</span><span id="1-5485">        <span class="k">if</span> <span class="n">info</span><span class="p">:</span>
</span><span id="1-5486">            <span class="bp">self</span><span class="o">.</span><span class="n">info</span> <span class="o">=</span> <span class="n">info</span>
</span><span id="1-5487">        <span class="bp">self</span><span class="o">.</span><span class="n">_schemas</span><span class="p">:</span> <span class="n">Set</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
</span><span id="1-5488">        <span class="bp">self</span><span class="o">.</span><span class="n">_sequences</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Sequence</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="1-5489">        <span class="bp">self</span><span class="o">.</span><span class="n">_fk_memos</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span>
</span><span id="1-5490">            <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]],</span> <span class="n">List</span><span class="p">[</span><span class="n">ForeignKey</span><span class="p">]</span>
</span><span id="1-5491">        <span class="p">]</span> <span class="o">=</span> <span class="n">collections</span><span class="o">.</span><span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
</span><span id="1-5492">
</span><span id="1-5493">    <span class="n">tables</span><span class="p">:</span> <span class="n">util</span><span class="o">.</span><span class="n">FacadeDict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Table</span><span class="p">]</span>
</span><span id="1-5494"><span class="w">    </span><span class="sd">&quot;&quot;&quot;A dictionary of :class:`_schema.Table`</span>
</span><span id="1-5495"><span class="sd">    objects keyed to their name or &quot;table key&quot;.</span>
</span><span id="1-5496">
</span><span id="1-5497"><span class="sd">    The exact key is that determined by the :attr:`_schema.Table.key`</span>
</span><span id="1-5498"><span class="sd">    attribute;</span>
</span><span id="1-5499"><span class="sd">    for a table with no :attr:`_schema.Table.schema` attribute,</span>
</span><span id="1-5500"><span class="sd">    this is the same</span>
</span><span id="1-5501"><span class="sd">    as :attr:`_schema.Table.name`.  For a table with a schema,</span>
</span><span id="1-5502"><span class="sd">    it is typically of the</span>
</span><span id="1-5503"><span class="sd">    form ``schemaname.tablename``.</span>
</span><span id="1-5504">
</span><span id="1-5505"><span class="sd">    .. seealso::</span>
</span><span id="1-5506">
</span><span id="1-5507"><span class="sd">        :attr:`_schema.MetaData.sorted_tables`</span>
</span><span id="1-5508">
</span><span id="1-5509"><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="1-5510">
</span><span id="1-5511">    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="1-5512">        <span class="k">return</span> <span class="s2">&quot;MetaData()&quot;</span>
</span><span id="1-5513">
</span><span id="1-5514">    <span class="k">def</span> <span class="fm">__contains__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">table_or_key</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Table</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="1-5515">        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">table_or_key</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="1-5516">            <span class="n">table_or_key</span> <span class="o">=</span> <span class="n">table_or_key</span><span class="o">.</span><span class="n">key</span>
</span><span id="1-5517">        <span class="k">return</span> <span class="n">table_or_key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tables</span>
</span><span id="1-5518">
</span><span id="1-5519">    <span class="k">def</span> <span class="nf">_add_table</span><span class="p">(</span>
</span><span id="1-5520">        <span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">schema</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">table</span><span class="p">:</span> <span class="n">Table</span>
</span><span id="1-5521">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-5522">        <span class="n">key</span> <span class="o">=</span> <span class="n">_get_table_key</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">schema</span><span class="p">)</span>
</span><span id="1-5523">        <span class="bp">self</span><span class="o">.</span><span class="n">tables</span><span class="o">.</span><span class="n">_insert_item</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">table</span><span class="p">)</span>
</span><span id="1-5524">        <span class="k">if</span> <span class="n">schema</span><span class="p">:</span>
</span><span id="1-5525">            <span class="bp">self</span><span class="o">.</span><span class="n">_schemas</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">schema</span><span class="p">)</span>
</span><span id="1-5526">
</span><span id="1-5527">    <span class="k">def</span> <span class="nf">_remove_table</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">schema</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-5528">        <span class="n">key</span> <span class="o">=</span> <span class="n">_get_table_key</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">schema</span><span class="p">)</span>
</span><span id="1-5529">        <span class="n">removed</span> <span class="o">=</span> <span class="nb">dict</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tables</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="1-5530">        <span class="k">if</span> <span class="n">removed</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-5531">            <span class="k">for</span> <span class="n">fk</span> <span class="ow">in</span> <span class="n">removed</span><span class="o">.</span><span class="n">foreign_keys</span><span class="p">:</span>
</span><span id="1-5532">                <span class="n">fk</span><span class="o">.</span><span class="n">_remove_from_metadata</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span><span id="1-5533">        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_schemas</span><span class="p">:</span>
</span><span id="1-5534">            <span class="bp">self</span><span class="o">.</span><span class="n">_schemas</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="1-5535">                <span class="n">t</span><span class="o">.</span><span class="n">schema</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tables</span><span class="o">.</span><span class="n">values</span><span class="p">()</span> <span class="k">if</span> <span class="n">t</span><span class="o">.</span><span class="n">schema</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span id="1-5536">            <span class="p">}</span>
</span><span id="1-5537">
</span><span id="1-5538">    <span class="k">def</span> <span class="nf">__getstate__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span id="1-5539">        <span class="k">return</span> <span class="p">{</span>
</span><span id="1-5540">            <span class="s2">&quot;tables&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">tables</span><span class="p">,</span>
</span><span id="1-5541">            <span class="s2">&quot;schema&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">schema</span><span class="p">,</span>
</span><span id="1-5542">            <span class="s2">&quot;schemas&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_schemas</span><span class="p">,</span>
</span><span id="1-5543">            <span class="s2">&quot;sequences&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sequences</span><span class="p">,</span>
</span><span id="1-5544">            <span class="s2">&quot;fk_memos&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fk_memos</span><span class="p">,</span>
</span><span id="1-5545">            <span class="s2">&quot;naming_convention&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">naming_convention</span><span class="p">,</span>
</span><span id="1-5546">        <span class="p">}</span>
</span><span id="1-5547">
</span><span id="1-5548">    <span class="k">def</span> <span class="nf">__setstate__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-5549">        <span class="bp">self</span><span class="o">.</span><span class="n">tables</span> <span class="o">=</span> <span class="n">state</span><span class="p">[</span><span class="s2">&quot;tables&quot;</span><span class="p">]</span>
</span><span id="1-5550">        <span class="bp">self</span><span class="o">.</span><span class="n">schema</span> <span class="o">=</span> <span class="n">state</span><span class="p">[</span><span class="s2">&quot;schema&quot;</span><span class="p">]</span>
</span><span id="1-5551">        <span class="bp">self</span><span class="o">.</span><span class="n">naming_convention</span> <span class="o">=</span> <span class="n">state</span><span class="p">[</span><span class="s2">&quot;naming_convention&quot;</span><span class="p">]</span>
</span><span id="1-5552">        <span class="bp">self</span><span class="o">.</span><span class="n">_sequences</span> <span class="o">=</span> <span class="n">state</span><span class="p">[</span><span class="s2">&quot;sequences&quot;</span><span class="p">]</span>
</span><span id="1-5553">        <span class="bp">self</span><span class="o">.</span><span class="n">_schemas</span> <span class="o">=</span> <span class="n">state</span><span class="p">[</span><span class="s2">&quot;schemas&quot;</span><span class="p">]</span>
</span><span id="1-5554">        <span class="bp">self</span><span class="o">.</span><span class="n">_fk_memos</span> <span class="o">=</span> <span class="n">state</span><span class="p">[</span><span class="s2">&quot;fk_memos&quot;</span><span class="p">]</span>
</span><span id="1-5555">
</span><span id="1-5556">    <span class="k">def</span> <span class="nf">clear</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-5557"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Clear all Table objects from this MetaData.&quot;&quot;&quot;</span>
</span><span id="1-5558">
</span><span id="1-5559">        <span class="nb">dict</span><span class="o">.</span><span class="n">clear</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tables</span><span class="p">)</span>  <span class="c1"># type: ignore</span>
</span><span id="1-5560">        <span class="bp">self</span><span class="o">.</span><span class="n">_schemas</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
</span><span id="1-5561">        <span class="bp">self</span><span class="o">.</span><span class="n">_fk_memos</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
</span><span id="1-5562">
</span><span id="1-5563">    <span class="k">def</span> <span class="nf">remove</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">table</span><span class="p">:</span> <span class="n">Table</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-5564"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Remove the given Table object from this MetaData.&quot;&quot;&quot;</span>
</span><span id="1-5565">
</span><span id="1-5566">        <span class="bp">self</span><span class="o">.</span><span class="n">_remove_table</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">table</span><span class="o">.</span><span class="n">schema</span><span class="p">)</span>
</span><span id="1-5567">
</span><span id="1-5568">    <span class="nd">@property</span>
</span><span id="1-5569">    <span class="k">def</span> <span class="nf">sorted_tables</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Table</span><span class="p">]:</span>
</span><span id="1-5570"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns a list of :class:`_schema.Table` objects sorted in order of</span>
</span><span id="1-5571"><span class="sd">        foreign key dependency.</span>
</span><span id="1-5572">
</span><span id="1-5573"><span class="sd">        The sorting will place :class:`_schema.Table`</span>
</span><span id="1-5574"><span class="sd">        objects that have dependencies</span>
</span><span id="1-5575"><span class="sd">        first, before the dependencies themselves, representing the</span>
</span><span id="1-5576"><span class="sd">        order in which they can be created.   To get the order in which</span>
</span><span id="1-5577"><span class="sd">        the tables would be dropped, use the ``reversed()`` Python built-in.</span>
</span><span id="1-5578">
</span><span id="1-5579"><span class="sd">        .. warning::</span>
</span><span id="1-5580">
</span><span id="1-5581"><span class="sd">            The :attr:`.MetaData.sorted_tables` attribute cannot by itself</span>
</span><span id="1-5582"><span class="sd">            accommodate automatic resolution of dependency cycles between</span>
</span><span id="1-5583"><span class="sd">            tables, which are usually caused by mutually dependent foreign key</span>
</span><span id="1-5584"><span class="sd">            constraints. When these cycles are detected, the foreign keys</span>
</span><span id="1-5585"><span class="sd">            of these tables are omitted from consideration in the sort.</span>
</span><span id="1-5586"><span class="sd">            A warning is emitted when this condition occurs, which will be an</span>
</span><span id="1-5587"><span class="sd">            exception raise in a future release.   Tables which are not part</span>
</span><span id="1-5588"><span class="sd">            of the cycle will still be returned in dependency order.</span>
</span><span id="1-5589">
</span><span id="1-5590"><span class="sd">            To resolve these cycles, the</span>
</span><span id="1-5591"><span class="sd">            :paramref:`_schema.ForeignKeyConstraint.use_alter` parameter may be</span>
</span><span id="1-5592"><span class="sd">            applied to those constraints which create a cycle.  Alternatively,</span>
</span><span id="1-5593"><span class="sd">            the :func:`_schema.sort_tables_and_constraints` function will</span>
</span><span id="1-5594"><span class="sd">            automatically return foreign key constraints in a separate</span>
</span><span id="1-5595"><span class="sd">            collection when cycles are detected so that they may be applied</span>
</span><span id="1-5596"><span class="sd">            to a schema separately.</span>
</span><span id="1-5597">
</span><span id="1-5598"><span class="sd">            .. versionchanged:: 1.3.17 - a warning is emitted when</span>
</span><span id="1-5599"><span class="sd">               :attr:`.MetaData.sorted_tables` cannot perform a proper sort</span>
</span><span id="1-5600"><span class="sd">               due to cyclical dependencies.  This will be an exception in a</span>
</span><span id="1-5601"><span class="sd">               future release.  Additionally, the sort will continue to return</span>
</span><span id="1-5602"><span class="sd">               other tables not involved in the cycle in dependency order which</span>
</span><span id="1-5603"><span class="sd">               was not the case previously.</span>
</span><span id="1-5604">
</span><span id="1-5605"><span class="sd">        .. seealso::</span>
</span><span id="1-5606">
</span><span id="1-5607"><span class="sd">            :func:`_schema.sort_tables`</span>
</span><span id="1-5608">
</span><span id="1-5609"><span class="sd">            :func:`_schema.sort_tables_and_constraints`</span>
</span><span id="1-5610">
</span><span id="1-5611"><span class="sd">            :attr:`_schema.MetaData.tables`</span>
</span><span id="1-5612">
</span><span id="1-5613"><span class="sd">            :meth:`_reflection.Inspector.get_table_names`</span>
</span><span id="1-5614">
</span><span id="1-5615"><span class="sd">            :meth:`_reflection.Inspector.get_sorted_table_and_fkc_names`</span>
</span><span id="1-5616">
</span><span id="1-5617">
</span><span id="1-5618"><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="1-5619">        <span class="k">return</span> <span class="n">ddl</span><span class="o">.</span><span class="n">sort_tables</span><span class="p">(</span>
</span><span id="1-5620">            <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tables</span><span class="o">.</span><span class="n">values</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">t</span><span class="p">:</span> <span class="n">t</span><span class="o">.</span><span class="n">key</span><span class="p">)</span>  <span class="c1"># type: ignore</span>
</span><span id="1-5621">        <span class="p">)</span>
</span><span id="1-5622">
</span><span id="1-5623">    <span class="nd">@util</span><span class="o">.</span><span class="n">preload_module</span><span class="p">(</span><span class="s2">&quot;sqlalchemy.engine.reflection&quot;</span><span class="p">)</span>
</span><span id="1-5624">    <span class="k">def</span> <span class="nf">reflect</span><span class="p">(</span>
</span><span id="1-5625">        <span class="bp">self</span><span class="p">,</span>
</span><span id="1-5626">        <span class="n">bind</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Engine</span><span class="p">,</span> <span class="n">Connection</span><span class="p">],</span>
</span><span id="1-5627">        <span class="n">schema</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="1-5628">        <span class="n">views</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="1-5629">        <span class="n">only</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span>
</span><span id="1-5630">            <span class="n">_typing_Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">Callable</span><span class="p">[[</span><span class="nb">str</span><span class="p">,</span> <span class="n">MetaData</span><span class="p">],</span> <span class="nb">bool</span><span class="p">],</span> <span class="kc">None</span>
</span><span id="1-5631">        <span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="1-5632">        <span class="n">extend_existing</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="1-5633">        <span class="n">autoload_replace</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="1-5634">        <span class="n">resolve_fks</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="1-5635">        <span class="o">**</span><span class="n">dialect_kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
</span><span id="1-5636">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-5637"><span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Load all available table definitions from the database.</span>
</span><span id="1-5638">
</span><span id="1-5639"><span class="sd">        Automatically creates ``Table`` entries in this ``MetaData`` for any</span>
</span><span id="1-5640"><span class="sd">        table available in the database but not yet present in the</span>
</span><span id="1-5641"><span class="sd">        ``MetaData``.  May be called multiple times to pick up tables recently</span>
</span><span id="1-5642"><span class="sd">        added to the database, however no special action is taken if a table</span>
</span><span id="1-5643"><span class="sd">        in this ``MetaData`` no longer exists in the database.</span>
</span><span id="1-5644">
</span><span id="1-5645"><span class="sd">        :param bind:</span>
</span><span id="1-5646"><span class="sd">          A :class:`.Connection` or :class:`.Engine` used to access the</span>
</span><span id="1-5647"><span class="sd">          database.</span>
</span><span id="1-5648">
</span><span id="1-5649"><span class="sd">        :param schema:</span>
</span><span id="1-5650"><span class="sd">          Optional, query and reflect tables from an alternate schema.</span>
</span><span id="1-5651"><span class="sd">          If None, the schema associated with this :class:`_schema.MetaData`</span>
</span><span id="1-5652"><span class="sd">          is used, if any.</span>
</span><span id="1-5653">
</span><span id="1-5654"><span class="sd">        :param views:</span>
</span><span id="1-5655"><span class="sd">          If True, also reflect views (materialized and plain).</span>
</span><span id="1-5656">
</span><span id="1-5657"><span class="sd">        :param only:</span>
</span><span id="1-5658"><span class="sd">          Optional.  Load only a sub-set of available named tables.  May be</span>
</span><span id="1-5659"><span class="sd">          specified as a sequence of names or a callable.</span>
</span><span id="1-5660">
</span><span id="1-5661"><span class="sd">          If a sequence of names is provided, only those tables will be</span>
</span><span id="1-5662"><span class="sd">          reflected.  An error is raised if a table is requested but not</span>
</span><span id="1-5663"><span class="sd">          available.  Named tables already present in this ``MetaData`` are</span>
</span><span id="1-5664"><span class="sd">          ignored.</span>
</span><span id="1-5665">
</span><span id="1-5666"><span class="sd">          If a callable is provided, it will be used as a boolean predicate to</span>
</span><span id="1-5667"><span class="sd">          filter the list of potential table names.  The callable is called</span>
</span><span id="1-5668"><span class="sd">          with a table name and this ``MetaData`` instance as positional</span>
</span><span id="1-5669"><span class="sd">          arguments and should return a true value for any table to reflect.</span>
</span><span id="1-5670">
</span><span id="1-5671"><span class="sd">        :param extend_existing: Passed along to each :class:`_schema.Table` as</span>
</span><span id="1-5672"><span class="sd">          :paramref:`_schema.Table.extend_existing`.</span>
</span><span id="1-5673">
</span><span id="1-5674"><span class="sd">        :param autoload_replace: Passed along to each :class:`_schema.Table`</span>
</span><span id="1-5675"><span class="sd">          as</span>
</span><span id="1-5676"><span class="sd">          :paramref:`_schema.Table.autoload_replace`.</span>
</span><span id="1-5677">
</span><span id="1-5678"><span class="sd">        :param resolve_fks: if True, reflect :class:`_schema.Table`</span>
</span><span id="1-5679"><span class="sd">         objects linked</span>
</span><span id="1-5680"><span class="sd">         to :class:`_schema.ForeignKey` objects located in each</span>
</span><span id="1-5681"><span class="sd">         :class:`_schema.Table`.</span>
</span><span id="1-5682"><span class="sd">         For :meth:`_schema.MetaData.reflect`,</span>
</span><span id="1-5683"><span class="sd">         this has the effect of reflecting</span>
</span><span id="1-5684"><span class="sd">         related tables that might otherwise not be in the list of tables</span>
</span><span id="1-5685"><span class="sd">         being reflected, for example if the referenced table is in a</span>
</span><span id="1-5686"><span class="sd">         different schema or is omitted via the</span>
</span><span id="1-5687"><span class="sd">         :paramref:`.MetaData.reflect.only` parameter.  When False,</span>
</span><span id="1-5688"><span class="sd">         :class:`_schema.ForeignKey` objects are not followed to the</span>
</span><span id="1-5689"><span class="sd">         :class:`_schema.Table`</span>
</span><span id="1-5690"><span class="sd">         in which they link, however if the related table is also part of the</span>
</span><span id="1-5691"><span class="sd">         list of tables that would be reflected in any case, the</span>
</span><span id="1-5692"><span class="sd">         :class:`_schema.ForeignKey` object will still resolve to its related</span>
</span><span id="1-5693"><span class="sd">         :class:`_schema.Table` after the :meth:`_schema.MetaData.reflect`</span>
</span><span id="1-5694"><span class="sd">         operation is</span>
</span><span id="1-5695"><span class="sd">         complete.   Defaults to True.</span>
</span><span id="1-5696">
</span><span id="1-5697"><span class="sd">         .. versionadded:: 1.3.0</span>
</span><span id="1-5698">
</span><span id="1-5699"><span class="sd">         .. seealso::</span>
</span><span id="1-5700">
</span><span id="1-5701"><span class="sd">            :paramref:`_schema.Table.resolve_fks`</span>
</span><span id="1-5702">
</span><span id="1-5703"><span class="sd">        :param \**dialect_kwargs: Additional keyword arguments not mentioned</span>
</span><span id="1-5704"><span class="sd">         above are dialect specific, and passed in the form</span>
</span><span id="1-5705"><span class="sd">         ``&lt;dialectname&gt;_&lt;argname&gt;``.  See the documentation regarding an</span>
</span><span id="1-5706"><span class="sd">         individual dialect at :ref:`dialect_toplevel` for detail on</span>
</span><span id="1-5707"><span class="sd">         documented arguments.</span>
</span><span id="1-5708">
</span><span id="1-5709"><span class="sd">        .. seealso::</span>
</span><span id="1-5710">
</span><span id="1-5711"><span class="sd">            :ref:`metadata_reflection_toplevel`</span>
</span><span id="1-5712">
</span><span id="1-5713"><span class="sd">            :meth:`_events.DDLEvents.column_reflect` - Event used to customize</span>
</span><span id="1-5714"><span class="sd">            the reflected columns. Usually used to generalize the types using</span>
</span><span id="1-5715"><span class="sd">            :meth:`_types.TypeEngine.as_generic`</span>
</span><span id="1-5716">
</span><span id="1-5717"><span class="sd">            :ref:`metadata_reflection_dbagnostic_types` - describes how to</span>
</span><span id="1-5718"><span class="sd">            reflect tables using general types.</span>
</span><span id="1-5719">
</span><span id="1-5720"><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="1-5721">
</span><span id="1-5722">        <span class="k">with</span> <span class="n">inspection</span><span class="o">.</span><span class="n">inspect</span><span class="p">(</span><span class="n">bind</span><span class="p">)</span><span class="o">.</span><span class="n">_inspection_context</span><span class="p">()</span> <span class="k">as</span> <span class="n">insp</span><span class="p">:</span>
</span><span id="1-5723">            <span class="n">reflect_opts</span><span class="p">:</span> <span class="n">Any</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="1-5724">                <span class="s2">&quot;autoload_with&quot;</span><span class="p">:</span> <span class="n">insp</span><span class="p">,</span>
</span><span id="1-5725">                <span class="s2">&quot;extend_existing&quot;</span><span class="p">:</span> <span class="n">extend_existing</span><span class="p">,</span>
</span><span id="1-5726">                <span class="s2">&quot;autoload_replace&quot;</span><span class="p">:</span> <span class="n">autoload_replace</span><span class="p">,</span>
</span><span id="1-5727">                <span class="s2">&quot;resolve_fks&quot;</span><span class="p">:</span> <span class="n">resolve_fks</span><span class="p">,</span>
</span><span id="1-5728">                <span class="s2">&quot;_extend_on&quot;</span><span class="p">:</span> <span class="nb">set</span><span class="p">(),</span>
</span><span id="1-5729">            <span class="p">}</span>
</span><span id="1-5730">
</span><span id="1-5731">            <span class="n">reflect_opts</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">dialect_kwargs</span><span class="p">)</span>
</span><span id="1-5732">
</span><span id="1-5733">            <span class="k">if</span> <span class="n">schema</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-5734">                <span class="n">schema</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">schema</span>
</span><span id="1-5735">
</span><span id="1-5736">            <span class="k">if</span> <span class="n">schema</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-5737">                <span class="n">reflect_opts</span><span class="p">[</span><span class="s2">&quot;schema&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">schema</span>
</span><span id="1-5738">
</span><span id="1-5739">            <span class="n">kind</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">preloaded</span><span class="o">.</span><span class="n">engine_reflection</span><span class="o">.</span><span class="n">ObjectKind</span><span class="o">.</span><span class="n">TABLE</span>
</span><span id="1-5740">            <span class="n">available</span><span class="p">:</span> <span class="n">util</span><span class="o">.</span><span class="n">OrderedSet</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">OrderedSet</span><span class="p">(</span>
</span><span id="1-5741">                <span class="n">insp</span><span class="o">.</span><span class="n">get_table_names</span><span class="p">(</span><span class="n">schema</span><span class="p">)</span>
</span><span id="1-5742">            <span class="p">)</span>
</span><span id="1-5743">            <span class="k">if</span> <span class="n">views</span><span class="p">:</span>
</span><span id="1-5744">                <span class="n">kind</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">preloaded</span><span class="o">.</span><span class="n">engine_reflection</span><span class="o">.</span><span class="n">ObjectKind</span><span class="o">.</span><span class="n">ANY</span>
</span><span id="1-5745">                <span class="n">available</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">insp</span><span class="o">.</span><span class="n">get_view_names</span><span class="p">(</span><span class="n">schema</span><span class="p">))</span>
</span><span id="1-5746">                <span class="k">try</span><span class="p">:</span>
</span><span id="1-5747">                    <span class="n">available</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">insp</span><span class="o">.</span><span class="n">get_materialized_view_names</span><span class="p">(</span><span class="n">schema</span><span class="p">))</span>
</span><span id="1-5748">                <span class="k">except</span> <span class="ne">NotImplementedError</span><span class="p">:</span>
</span><span id="1-5749">                    <span class="k">pass</span>
</span><span id="1-5750">
</span><span id="1-5751">            <span class="k">if</span> <span class="n">schema</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-5752">                <span class="n">available_w_schema</span><span class="p">:</span> <span class="n">util</span><span class="o">.</span><span class="n">OrderedSet</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">OrderedSet</span><span class="p">(</span>
</span><span id="1-5753">                    <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">schema</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">available</span><span class="p">]</span>
</span><span id="1-5754">                <span class="p">)</span>
</span><span id="1-5755">            <span class="k">else</span><span class="p">:</span>
</span><span id="1-5756">                <span class="n">available_w_schema</span> <span class="o">=</span> <span class="n">available</span>
</span><span id="1-5757">
</span><span id="1-5758">            <span class="n">current</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tables</span><span class="p">)</span>
</span><span id="1-5759">
</span><span id="1-5760">            <span class="k">if</span> <span class="n">only</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-5761">                <span class="n">load</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="1-5762">                    <span class="n">name</span>
</span><span id="1-5763">                    <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">schname</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">available</span><span class="p">,</span> <span class="n">available_w_schema</span><span class="p">)</span>
</span><span id="1-5764">                    <span class="k">if</span> <span class="n">extend_existing</span> <span class="ow">or</span> <span class="n">schname</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">current</span>
</span><span id="1-5765">                <span class="p">]</span>
</span><span id="1-5766">            <span class="k">elif</span> <span class="nb">callable</span><span class="p">(</span><span class="n">only</span><span class="p">):</span>
</span><span id="1-5767">                <span class="n">load</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="1-5768">                    <span class="n">name</span>
</span><span id="1-5769">                    <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">schname</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">available</span><span class="p">,</span> <span class="n">available_w_schema</span><span class="p">)</span>
</span><span id="1-5770">                    <span class="k">if</span> <span class="p">(</span><span class="n">extend_existing</span> <span class="ow">or</span> <span class="n">schname</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">current</span><span class="p">)</span>
</span><span id="1-5771">                    <span class="ow">and</span> <span class="n">only</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
</span><span id="1-5772">                <span class="p">]</span>
</span><span id="1-5773">            <span class="k">else</span><span class="p">:</span>
</span><span id="1-5774">                <span class="n">missing</span> <span class="o">=</span> <span class="p">[</span><span class="n">name</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">only</span> <span class="k">if</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">available</span><span class="p">]</span>
</span><span id="1-5775">                <span class="k">if</span> <span class="n">missing</span><span class="p">:</span>
</span><span id="1-5776">                    <span class="n">s</span> <span class="o">=</span> <span class="n">schema</span> <span class="ow">and</span> <span class="p">(</span><span class="s2">&quot; schema &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span> <span class="o">%</span> <span class="n">schema</span><span class="p">)</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span>
</span><span id="1-5777">                    <span class="k">raise</span> <span class="n">exc</span><span class="o">.</span><span class="n">InvalidRequestError</span><span class="p">(</span>
</span><span id="1-5778">                        <span class="s2">&quot;Could not reflect: requested table(s) not available &quot;</span>
</span><span id="1-5779">                        <span class="s2">&quot;in </span><span class="si">%r%s</span><span class="s2">: (</span><span class="si">%s</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">bind</span><span class="o">.</span><span class="n">engine</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">missing</span><span class="p">))</span>
</span><span id="1-5780">                    <span class="p">)</span>
</span><span id="1-5781">                <span class="n">load</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="1-5782">                    <span class="n">name</span>
</span><span id="1-5783">                    <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">only</span>
</span><span id="1-5784">                    <span class="k">if</span> <span class="n">extend_existing</span> <span class="ow">or</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">current</span>
</span><span id="1-5785">                <span class="p">]</span>
</span><span id="1-5786">            <span class="c1"># pass the available tables so the inspector can</span>
</span><span id="1-5787">            <span class="c1"># choose to ignore the filter_names</span>
</span><span id="1-5788">            <span class="n">_reflect_info</span> <span class="o">=</span> <span class="n">insp</span><span class="o">.</span><span class="n">_get_reflection_info</span><span class="p">(</span>
</span><span id="1-5789">                <span class="n">schema</span><span class="o">=</span><span class="n">schema</span><span class="p">,</span>
</span><span id="1-5790">                <span class="n">filter_names</span><span class="o">=</span><span class="n">load</span><span class="p">,</span>
</span><span id="1-5791">                <span class="n">available</span><span class="o">=</span><span class="n">available</span><span class="p">,</span>
</span><span id="1-5792">                <span class="n">kind</span><span class="o">=</span><span class="n">kind</span><span class="p">,</span>
</span><span id="1-5793">                <span class="n">scope</span><span class="o">=</span><span class="n">util</span><span class="o">.</span><span class="n">preloaded</span><span class="o">.</span><span class="n">engine_reflection</span><span class="o">.</span><span class="n">ObjectScope</span><span class="o">.</span><span class="n">ANY</span><span class="p">,</span>
</span><span id="1-5794">                <span class="o">**</span><span class="n">dialect_kwargs</span><span class="p">,</span>
</span><span id="1-5795">            <span class="p">)</span>
</span><span id="1-5796">            <span class="n">reflect_opts</span><span class="p">[</span><span class="s2">&quot;_reflect_info&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_reflect_info</span>
</span><span id="1-5797">
</span><span id="1-5798">            <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">load</span><span class="p">:</span>
</span><span id="1-5799">                <span class="k">try</span><span class="p">:</span>
</span><span id="1-5800">                    <span class="n">Table</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">reflect_opts</span><span class="p">)</span>
</span><span id="1-5801">                <span class="k">except</span> <span class="n">exc</span><span class="o">.</span><span class="n">UnreflectableTableError</span> <span class="k">as</span> <span class="n">uerr</span><span class="p">:</span>
</span><span id="1-5802">                    <span class="n">util</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;Skipping table </span><span class="si">%s</span><span class="s2">: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">uerr</span><span class="p">))</span>
</span><span id="1-5803">
</span><span id="1-5804">    <span class="k">def</span> <span class="nf">create_all</span><span class="p">(</span>
</span><span id="1-5805">        <span class="bp">self</span><span class="p">,</span>
</span><span id="1-5806">        <span class="n">bind</span><span class="p">:</span> <span class="n">_CreateDropBind</span><span class="p">,</span>
</span><span id="1-5807">        <span class="n">tables</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">_typing_Sequence</span><span class="p">[</span><span class="n">Table</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="1-5808">        <span class="n">checkfirst</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="1-5809">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-5810"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Create all tables stored in this metadata.</span>
</span><span id="1-5811">
</span><span id="1-5812"><span class="sd">        Conditional by default, will not attempt to recreate tables already</span>
</span><span id="1-5813"><span class="sd">        present in the target database.</span>
</span><span id="1-5814">
</span><span id="1-5815"><span class="sd">        :param bind:</span>
</span><span id="1-5816"><span class="sd">          A :class:`.Connection` or :class:`.Engine` used to access the</span>
</span><span id="1-5817"><span class="sd">          database.</span>
</span><span id="1-5818">
</span><span id="1-5819"><span class="sd">        :param tables:</span>
</span><span id="1-5820"><span class="sd">          Optional list of ``Table`` objects, which is a subset of the total</span>
</span><span id="1-5821"><span class="sd">          tables in the ``MetaData`` (others are ignored).</span>
</span><span id="1-5822">
</span><span id="1-5823"><span class="sd">        :param checkfirst:</span>
</span><span id="1-5824"><span class="sd">          Defaults to True, don&#39;t issue CREATEs for tables already present</span>
</span><span id="1-5825"><span class="sd">          in the target database.</span>
</span><span id="1-5826">
</span><span id="1-5827"><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="1-5828">        <span class="n">bind</span><span class="o">.</span><span class="n">_run_ddl_visitor</span><span class="p">(</span>
</span><span id="1-5829">            <span class="n">ddl</span><span class="o">.</span><span class="n">SchemaGenerator</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="n">checkfirst</span><span class="o">=</span><span class="n">checkfirst</span><span class="p">,</span> <span class="n">tables</span><span class="o">=</span><span class="n">tables</span>
</span><span id="1-5830">        <span class="p">)</span>
</span><span id="1-5831">
</span><span id="1-5832">    <span class="k">def</span> <span class="nf">drop_all</span><span class="p">(</span>
</span><span id="1-5833">        <span class="bp">self</span><span class="p">,</span>
</span><span id="1-5834">        <span class="n">bind</span><span class="p">:</span> <span class="n">_CreateDropBind</span><span class="p">,</span>
</span><span id="1-5835">        <span class="n">tables</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">_typing_Sequence</span><span class="p">[</span><span class="n">Table</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="1-5836">        <span class="n">checkfirst</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="1-5837">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-5838"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Drop all tables stored in this metadata.</span>
</span><span id="1-5839">
</span><span id="1-5840"><span class="sd">        Conditional by default, will not attempt to drop tables not present in</span>
</span><span id="1-5841"><span class="sd">        the target database.</span>
</span><span id="1-5842">
</span><span id="1-5843"><span class="sd">        :param bind:</span>
</span><span id="1-5844"><span class="sd">          A :class:`.Connection` or :class:`.Engine` used to access the</span>
</span><span id="1-5845"><span class="sd">          database.</span>
</span><span id="1-5846">
</span><span id="1-5847"><span class="sd">        :param tables:</span>
</span><span id="1-5848"><span class="sd">          Optional list of ``Table`` objects, which is a subset of the</span>
</span><span id="1-5849"><span class="sd">          total tables in the ``MetaData`` (others are ignored).</span>
</span><span id="1-5850">
</span><span id="1-5851"><span class="sd">        :param checkfirst:</span>
</span><span id="1-5852"><span class="sd">          Defaults to True, only issue DROPs for tables confirmed to be</span>
</span><span id="1-5853"><span class="sd">          present in the target database.</span>
</span><span id="1-5854">
</span><span id="1-5855"><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="1-5856">        <span class="n">bind</span><span class="o">.</span><span class="n">_run_ddl_visitor</span><span class="p">(</span>
</span><span id="1-5857">            <span class="n">ddl</span><span class="o">.</span><span class="n">SchemaDropper</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="n">checkfirst</span><span class="o">=</span><span class="n">checkfirst</span><span class="p">,</span> <span class="n">tables</span><span class="o">=</span><span class="n">tables</span>
</span><span id="1-5858">        <span class="p">)</span>
</span><span id="1-5859">
</span><span id="1-5860">
</span><span id="1-5861"><span class="k">class</span> <span class="nc">Computed</span><span class="p">(</span><span class="n">FetchedValue</span><span class="p">,</span> <span class="n">SchemaItem</span><span class="p">):</span>
</span><span id="1-5862"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Defines a generated column, i.e. &quot;GENERATED ALWAYS AS&quot; syntax.</span>
</span><span id="1-5863">
</span><span id="1-5864"><span class="sd">    The :class:`.Computed` construct is an inline construct added to the</span>
</span><span id="1-5865"><span class="sd">    argument list of a :class:`_schema.Column` object::</span>
</span><span id="1-5866">
</span><span id="1-5867"><span class="sd">        from sqlalchemy import Computed</span>
</span><span id="1-5868">
</span><span id="1-5869"><span class="sd">        Table(&#39;square&#39;, metadata_obj,</span>
</span><span id="1-5870"><span class="sd">            Column(&#39;side&#39;, Float, nullable=False),</span>
</span><span id="1-5871"><span class="sd">            Column(&#39;area&#39;, Float, Computed(&#39;side * side&#39;))</span>
</span><span id="1-5872"><span class="sd">        )</span>
</span><span id="1-5873">
</span><span id="1-5874"><span class="sd">    See the linked documentation below for complete details.</span>
</span><span id="1-5875">
</span><span id="1-5876"><span class="sd">    .. versionadded:: 1.3.11</span>
</span><span id="1-5877">
</span><span id="1-5878"><span class="sd">    .. seealso::</span>
</span><span id="1-5879">
</span><span id="1-5880"><span class="sd">        :ref:`computed_ddl`</span>
</span><span id="1-5881">
</span><span id="1-5882"><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="1-5883">
</span><span id="1-5884">    <span class="n">__visit_name__</span> <span class="o">=</span> <span class="s2">&quot;computed_column&quot;</span>
</span><span id="1-5885">
</span><span id="1-5886">    <span class="n">column</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Column</span><span class="p">[</span><span class="n">Any</span><span class="p">]]</span>
</span><span id="1-5887">
</span><span id="1-5888">    <span class="nd">@_document_text_coercion</span><span class="p">(</span>
</span><span id="1-5889">        <span class="s2">&quot;sqltext&quot;</span><span class="p">,</span> <span class="s2">&quot;:class:`.Computed`&quot;</span><span class="p">,</span> <span class="s2">&quot;:paramref:`.Computed.sqltext`&quot;</span>
</span><span id="1-5890">    <span class="p">)</span>
</span><span id="1-5891">    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
</span><span id="1-5892">        <span class="bp">self</span><span class="p">,</span> <span class="n">sqltext</span><span class="p">:</span> <span class="n">_DDLColumnArgument</span><span class="p">,</span> <span class="n">persisted</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="1-5893">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-5894"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Construct a GENERATED ALWAYS AS DDL construct to accompany a</span>
</span><span id="1-5895"><span class="sd">        :class:`_schema.Column`.</span>
</span><span id="1-5896">
</span><span id="1-5897"><span class="sd">        :param sqltext:</span>
</span><span id="1-5898"><span class="sd">          A string containing the column generation expression, which will be</span>
</span><span id="1-5899"><span class="sd">          used verbatim, or a SQL expression construct, such as a</span>
</span><span id="1-5900"><span class="sd">          :func:`_expression.text`</span>
</span><span id="1-5901"><span class="sd">          object.   If given as a string, the object is converted to a</span>
</span><span id="1-5902"><span class="sd">          :func:`_expression.text` object.</span>
</span><span id="1-5903">
</span><span id="1-5904"><span class="sd">        :param persisted:</span>
</span><span id="1-5905"><span class="sd">          Optional, controls how this column should be persisted by the</span>
</span><span id="1-5906"><span class="sd">          database.   Possible values are:</span>
</span><span id="1-5907">
</span><span id="1-5908"><span class="sd">          * ``None``, the default, it will use the default persistence</span>
</span><span id="1-5909"><span class="sd">            defined by the database.</span>
</span><span id="1-5910"><span class="sd">          * ``True``, will render ``GENERATED ALWAYS AS ... STORED``, or the</span>
</span><span id="1-5911"><span class="sd">            equivalent for the target database if supported.</span>
</span><span id="1-5912"><span class="sd">          * ``False``, will render ``GENERATED ALWAYS AS ... VIRTUAL``, or</span>
</span><span id="1-5913"><span class="sd">            the equivalent for the target database if supported.</span>
</span><span id="1-5914">
</span><span id="1-5915"><span class="sd">          Specifying ``True`` or ``False`` may raise an error when the DDL</span>
</span><span id="1-5916"><span class="sd">          is emitted to the target database if the database does not support</span>
</span><span id="1-5917"><span class="sd">          that persistence option.   Leaving this parameter at its default</span>
</span><span id="1-5918"><span class="sd">          of ``None`` is guaranteed to succeed for all databases that support</span>
</span><span id="1-5919"><span class="sd">          ``GENERATED ALWAYS AS``.</span>
</span><span id="1-5920">
</span><span id="1-5921"><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="1-5922">        <span class="bp">self</span><span class="o">.</span><span class="n">sqltext</span> <span class="o">=</span> <span class="n">coercions</span><span class="o">.</span><span class="n">expect</span><span class="p">(</span><span class="n">roles</span><span class="o">.</span><span class="n">DDLExpressionRole</span><span class="p">,</span> <span class="n">sqltext</span><span class="p">)</span>
</span><span id="1-5923">        <span class="bp">self</span><span class="o">.</span><span class="n">persisted</span> <span class="o">=</span> <span class="n">persisted</span>
</span><span id="1-5924">        <span class="bp">self</span><span class="o">.</span><span class="n">column</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="1-5925">
</span><span id="1-5926">    <span class="k">def</span> <span class="nf">_set_parent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">:</span> <span class="n">SchemaEventTarget</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-5927">        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">parent</span><span class="p">,</span> <span class="n">Column</span><span class="p">)</span>
</span><span id="1-5928">
</span><span id="1-5929">        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span>
</span><span id="1-5930">            <span class="n">parent</span><span class="o">.</span><span class="n">server_default</span><span class="p">,</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="kc">None</span><span class="p">),</span> <span class="n">Computed</span><span class="p">)</span>
</span><span id="1-5931">        <span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">parent</span><span class="o">.</span><span class="n">server_onupdate</span><span class="p">,</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="kc">None</span><span class="p">),</span> <span class="n">Computed</span><span class="p">)):</span>
</span><span id="1-5932">            <span class="k">raise</span> <span class="n">exc</span><span class="o">.</span><span class="n">ArgumentError</span><span class="p">(</span>
</span><span id="1-5933">                <span class="s2">&quot;A generated column cannot specify a server_default or a &quot;</span>
</span><span id="1-5934">                <span class="s2">&quot;server_onupdate argument&quot;</span>
</span><span id="1-5935">            <span class="p">)</span>
</span><span id="1-5936">        <span class="bp">self</span><span class="o">.</span><span class="n">column</span> <span class="o">=</span> <span class="n">parent</span>
</span><span id="1-5937">        <span class="n">parent</span><span class="o">.</span><span class="n">computed</span> <span class="o">=</span> <span class="bp">self</span>
</span><span id="1-5938">        <span class="bp">self</span><span class="o">.</span><span class="n">column</span><span class="o">.</span><span class="n">server_onupdate</span> <span class="o">=</span> <span class="bp">self</span>
</span><span id="1-5939">        <span class="bp">self</span><span class="o">.</span><span class="n">column</span><span class="o">.</span><span class="n">server_default</span> <span class="o">=</span> <span class="bp">self</span>
</span><span id="1-5940">
</span><span id="1-5941">    <span class="k">def</span> <span class="nf">_as_for_update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">for_update</span><span class="p">:</span> <span class="nb">bool</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">FetchedValue</span><span class="p">:</span>
</span><span id="1-5942">        <span class="k">return</span> <span class="bp">self</span>
</span><span id="1-5943">
</span><span id="1-5944">    <span class="nd">@util</span><span class="o">.</span><span class="n">deprecated</span><span class="p">(</span>
</span><span id="1-5945">        <span class="s2">&quot;1.4&quot;</span><span class="p">,</span>
</span><span id="1-5946">        <span class="s2">&quot;The :meth:`_schema.Computed.copy` method is deprecated &quot;</span>
</span><span id="1-5947">        <span class="s2">&quot;and will be removed in a future release.&quot;</span><span class="p">,</span>
</span><span id="1-5948">    <span class="p">)</span>
</span><span id="1-5949">    <span class="k">def</span> <span class="nf">copy</span><span class="p">(</span>
</span><span id="1-5950">        <span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">target_table</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Table</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">:</span> <span class="n">Any</span>
</span><span id="1-5951">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Computed</span><span class="p">:</span>
</span><span id="1-5952">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_copy</span><span class="p">(</span><span class="n">target_table</span><span class="o">=</span><span class="n">target_table</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>
</span><span id="1-5953">
</span><span id="1-5954">    <span class="k">def</span> <span class="nf">_copy</span><span class="p">(</span>
</span><span id="1-5955">        <span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">target_table</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Table</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">:</span> <span class="n">Any</span>
</span><span id="1-5956">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Computed</span><span class="p">:</span>
</span><span id="1-5957">        <span class="n">sqltext</span> <span class="o">=</span> <span class="n">_copy_expression</span><span class="p">(</span>
</span><span id="1-5958">            <span class="bp">self</span><span class="o">.</span><span class="n">sqltext</span><span class="p">,</span>
</span><span id="1-5959">            <span class="bp">self</span><span class="o">.</span><span class="n">column</span><span class="o">.</span><span class="n">table</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">column</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="1-5960">            <span class="n">target_table</span><span class="p">,</span>
</span><span id="1-5961">        <span class="p">)</span>
</span><span id="1-5962">        <span class="n">g</span> <span class="o">=</span> <span class="n">Computed</span><span class="p">(</span><span class="n">sqltext</span><span class="p">,</span> <span class="n">persisted</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">persisted</span><span class="p">)</span>
</span><span id="1-5963">
</span><span id="1-5964">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_schema_item_copy</span><span class="p">(</span><span class="n">g</span><span class="p">)</span>
</span><span id="1-5965">
</span><span id="1-5966">
</span><span id="1-5967"><span class="k">class</span> <span class="nc">Identity</span><span class="p">(</span><span class="n">IdentityOptions</span><span class="p">,</span> <span class="n">FetchedValue</span><span class="p">,</span> <span class="n">SchemaItem</span><span class="p">):</span>
</span><span id="1-5968"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Defines an identity column, i.e. &quot;GENERATED { ALWAYS | BY DEFAULT }</span>
</span><span id="1-5969"><span class="sd">    AS IDENTITY&quot; syntax.</span>
</span><span id="1-5970">
</span><span id="1-5971"><span class="sd">    The :class:`.Identity` construct is an inline construct added to the</span>
</span><span id="1-5972"><span class="sd">    argument list of a :class:`_schema.Column` object::</span>
</span><span id="1-5973">
</span><span id="1-5974"><span class="sd">        from sqlalchemy import Identity</span>
</span><span id="1-5975">
</span><span id="1-5976"><span class="sd">        Table(&#39;foo&#39;, metadata_obj,</span>
</span><span id="1-5977"><span class="sd">            Column(&#39;id&#39;, Integer, Identity())</span>
</span><span id="1-5978"><span class="sd">            Column(&#39;description&#39;, Text),</span>
</span><span id="1-5979"><span class="sd">        )</span>
</span><span id="1-5980">
</span><span id="1-5981"><span class="sd">    See the linked documentation below for complete details.</span>
</span><span id="1-5982">
</span><span id="1-5983"><span class="sd">    .. versionadded:: 1.4</span>
</span><span id="1-5984">
</span><span id="1-5985"><span class="sd">    .. seealso::</span>
</span><span id="1-5986">
</span><span id="1-5987"><span class="sd">        :ref:`identity_ddl`</span>
</span><span id="1-5988">
</span><span id="1-5989"><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="1-5990">
</span><span id="1-5991">    <span class="n">__visit_name__</span> <span class="o">=</span> <span class="s2">&quot;identity_column&quot;</span>
</span><span id="1-5992">
</span><span id="1-5993">    <span class="n">is_identity</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="1-5994">
</span><span id="1-5995">    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
</span><span id="1-5996">        <span class="bp">self</span><span class="p">,</span>
</span><span id="1-5997">        <span class="n">always</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="1-5998">        <span class="n">on_null</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="1-5999">        <span class="n">start</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="1-6000">        <span class="n">increment</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="1-6001">        <span class="n">minvalue</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="1-6002">        <span class="n">maxvalue</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="1-6003">        <span class="n">nominvalue</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="1-6004">        <span class="n">nomaxvalue</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="1-6005">        <span class="n">cycle</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="1-6006">        <span class="n">cache</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="1-6007">        <span class="n">order</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="1-6008">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-6009"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Construct a GENERATED { ALWAYS | BY DEFAULT } AS IDENTITY DDL</span>
</span><span id="1-6010"><span class="sd">        construct to accompany a :class:`_schema.Column`.</span>
</span><span id="1-6011">
</span><span id="1-6012"><span class="sd">        See the :class:`.Sequence` documentation for a complete description</span>
</span><span id="1-6013"><span class="sd">        of most parameters.</span>
</span><span id="1-6014">
</span><span id="1-6015"><span class="sd">        .. note::</span>
</span><span id="1-6016"><span class="sd">            MSSQL supports this construct as the preferred alternative to</span>
</span><span id="1-6017"><span class="sd">            generate an IDENTITY on a column, but it uses non standard</span>
</span><span id="1-6018"><span class="sd">            syntax that only support :paramref:`_schema.Identity.start`</span>
</span><span id="1-6019"><span class="sd">            and :paramref:`_schema.Identity.increment`.</span>
</span><span id="1-6020"><span class="sd">            All other parameters are ignored.</span>
</span><span id="1-6021">
</span><span id="1-6022"><span class="sd">        :param always:</span>
</span><span id="1-6023"><span class="sd">          A boolean, that indicates the type of identity column.</span>
</span><span id="1-6024"><span class="sd">          If ``False`` is specified, the default, then the user-specified</span>
</span><span id="1-6025"><span class="sd">          value takes precedence.</span>
</span><span id="1-6026"><span class="sd">          If ``True`` is specified, a user-specified value is not accepted (</span>
</span><span id="1-6027"><span class="sd">          on some backends, like PostgreSQL, OVERRIDING SYSTEM VALUE, or</span>
</span><span id="1-6028"><span class="sd">          similar, may be specified in an INSERT to override the sequence</span>
</span><span id="1-6029"><span class="sd">          value).</span>
</span><span id="1-6030"><span class="sd">          Some backends also have a default value for this parameter,</span>
</span><span id="1-6031"><span class="sd">          ``None`` can be used to omit rendering this part in the DDL. It</span>
</span><span id="1-6032"><span class="sd">          will be treated as ``False`` if a backend does not have a default</span>
</span><span id="1-6033"><span class="sd">          value.</span>
</span><span id="1-6034">
</span><span id="1-6035"><span class="sd">        :param on_null:</span>
</span><span id="1-6036"><span class="sd">          Set to ``True`` to specify ON NULL in conjunction with a</span>
</span><span id="1-6037"><span class="sd">          ``always=False`` identity column. This option is only supported on</span>
</span><span id="1-6038"><span class="sd">          some backends, like Oracle.</span>
</span><span id="1-6039">
</span><span id="1-6040"><span class="sd">        :param start: the starting index of the sequence.</span>
</span><span id="1-6041"><span class="sd">        :param increment: the increment value of the sequence.</span>
</span><span id="1-6042"><span class="sd">        :param minvalue: the minimum value of the sequence.</span>
</span><span id="1-6043"><span class="sd">        :param maxvalue: the maximum value of the sequence.</span>
</span><span id="1-6044"><span class="sd">        :param nominvalue: no minimum value of the sequence.</span>
</span><span id="1-6045"><span class="sd">        :param nomaxvalue: no maximum value of the sequence.</span>
</span><span id="1-6046"><span class="sd">        :param cycle: allows the sequence to wrap around when the maxvalue</span>
</span><span id="1-6047"><span class="sd">         or minvalue has been reached.</span>
</span><span id="1-6048"><span class="sd">        :param cache: optional integer value; number of future values in the</span>
</span><span id="1-6049"><span class="sd">         sequence which are calculated in advance.</span>
</span><span id="1-6050"><span class="sd">        :param order: optional boolean value; if true, renders the</span>
</span><span id="1-6051"><span class="sd">         ORDER keyword.</span>
</span><span id="1-6052">
</span><span id="1-6053"><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="1-6054">        <span class="n">IdentityOptions</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="1-6055">            <span class="bp">self</span><span class="p">,</span>
</span><span id="1-6056">            <span class="n">start</span><span class="o">=</span><span class="n">start</span><span class="p">,</span>
</span><span id="1-6057">            <span class="n">increment</span><span class="o">=</span><span class="n">increment</span><span class="p">,</span>
</span><span id="1-6058">            <span class="n">minvalue</span><span class="o">=</span><span class="n">minvalue</span><span class="p">,</span>
</span><span id="1-6059">            <span class="n">maxvalue</span><span class="o">=</span><span class="n">maxvalue</span><span class="p">,</span>
</span><span id="1-6060">            <span class="n">nominvalue</span><span class="o">=</span><span class="n">nominvalue</span><span class="p">,</span>
</span><span id="1-6061">            <span class="n">nomaxvalue</span><span class="o">=</span><span class="n">nomaxvalue</span><span class="p">,</span>
</span><span id="1-6062">            <span class="n">cycle</span><span class="o">=</span><span class="n">cycle</span><span class="p">,</span>
</span><span id="1-6063">            <span class="n">cache</span><span class="o">=</span><span class="n">cache</span><span class="p">,</span>
</span><span id="1-6064">            <span class="n">order</span><span class="o">=</span><span class="n">order</span><span class="p">,</span>
</span><span id="1-6065">        <span class="p">)</span>
</span><span id="1-6066">        <span class="bp">self</span><span class="o">.</span><span class="n">always</span> <span class="o">=</span> <span class="n">always</span>
</span><span id="1-6067">        <span class="bp">self</span><span class="o">.</span><span class="n">on_null</span> <span class="o">=</span> <span class="n">on_null</span>
</span><span id="1-6068">        <span class="bp">self</span><span class="o">.</span><span class="n">column</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="1-6069">
</span><span id="1-6070">    <span class="k">def</span> <span class="nf">_set_parent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">:</span> <span class="n">SchemaEventTarget</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-6071">        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">parent</span><span class="p">,</span> <span class="n">Column</span><span class="p">)</span>
</span><span id="1-6072">        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span>
</span><span id="1-6073">            <span class="n">parent</span><span class="o">.</span><span class="n">server_default</span><span class="p">,</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="kc">None</span><span class="p">),</span> <span class="n">Identity</span><span class="p">)</span>
</span><span id="1-6074">        <span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">parent</span><span class="o">.</span><span class="n">server_onupdate</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="kc">None</span><span class="p">)):</span>
</span><span id="1-6075">            <span class="k">raise</span> <span class="n">exc</span><span class="o">.</span><span class="n">ArgumentError</span><span class="p">(</span>
</span><span id="1-6076">                <span class="s2">&quot;A column with an Identity object cannot specify a &quot;</span>
</span><span id="1-6077">                <span class="s2">&quot;server_default or a server_onupdate argument&quot;</span>
</span><span id="1-6078">            <span class="p">)</span>
</span><span id="1-6079">        <span class="k">if</span> <span class="n">parent</span><span class="o">.</span><span class="n">autoincrement</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
</span><span id="1-6080">            <span class="k">raise</span> <span class="n">exc</span><span class="o">.</span><span class="n">ArgumentError</span><span class="p">(</span>
</span><span id="1-6081">                <span class="s2">&quot;A column with an Identity object cannot specify &quot;</span>
</span><span id="1-6082">                <span class="s2">&quot;autoincrement=False&quot;</span>
</span><span id="1-6083">            <span class="p">)</span>
</span><span id="1-6084">        <span class="bp">self</span><span class="o">.</span><span class="n">column</span> <span class="o">=</span> <span class="n">parent</span>
</span><span id="1-6085">
</span><span id="1-6086">        <span class="n">parent</span><span class="o">.</span><span class="n">identity</span> <span class="o">=</span> <span class="bp">self</span>
</span><span id="1-6087">        <span class="k">if</span> <span class="n">parent</span><span class="o">.</span><span class="n">_user_defined_nullable</span> <span class="ow">is</span> <span class="n">NULL_UNSPECIFIED</span><span class="p">:</span>
</span><span id="1-6088">            <span class="n">parent</span><span class="o">.</span><span class="n">nullable</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="1-6089">
</span><span id="1-6090">        <span class="n">parent</span><span class="o">.</span><span class="n">server_default</span> <span class="o">=</span> <span class="bp">self</span>
</span><span id="1-6091">
</span><span id="1-6092">    <span class="k">def</span> <span class="nf">_as_for_update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">for_update</span><span class="p">:</span> <span class="nb">bool</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">FetchedValue</span><span class="p">:</span>
</span><span id="1-6093">        <span class="k">return</span> <span class="bp">self</span>
</span><span id="1-6094">
</span><span id="1-6095">    <span class="nd">@util</span><span class="o">.</span><span class="n">deprecated</span><span class="p">(</span>
</span><span id="1-6096">        <span class="s2">&quot;1.4&quot;</span><span class="p">,</span>
</span><span id="1-6097">        <span class="s2">&quot;The :meth:`_schema.Identity.copy` method is deprecated &quot;</span>
</span><span id="1-6098">        <span class="s2">&quot;and will be removed in a future release.&quot;</span><span class="p">,</span>
</span><span id="1-6099">    <span class="p">)</span>
</span><span id="1-6100">    <span class="k">def</span> <span class="nf">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Identity</span><span class="p">:</span>
</span><span id="1-6101">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_copy</span><span class="p">(</span><span class="o">**</span><span class="n">kw</span><span class="p">)</span>
</span><span id="1-6102">
</span><span id="1-6103">    <span class="k">def</span> <span class="nf">_copy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Identity</span><span class="p">:</span>
</span><span id="1-6104">        <span class="n">i</span> <span class="o">=</span> <span class="n">Identity</span><span class="p">(</span>
</span><span id="1-6105">            <span class="n">always</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">always</span><span class="p">,</span>
</span><span id="1-6106">            <span class="n">on_null</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">on_null</span><span class="p">,</span>
</span><span id="1-6107">            <span class="n">start</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">,</span>
</span><span id="1-6108">            <span class="n">increment</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">increment</span><span class="p">,</span>
</span><span id="1-6109">            <span class="n">minvalue</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">minvalue</span><span class="p">,</span>
</span><span id="1-6110">            <span class="n">maxvalue</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">maxvalue</span><span class="p">,</span>
</span><span id="1-6111">            <span class="n">nominvalue</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">nominvalue</span><span class="p">,</span>
</span><span id="1-6112">            <span class="n">nomaxvalue</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">nomaxvalue</span><span class="p">,</span>
</span><span id="1-6113">            <span class="n">cycle</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cycle</span><span class="p">,</span>
</span><span id="1-6114">            <span class="n">cache</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cache</span><span class="p">,</span>
</span><span id="1-6115">            <span class="n">order</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">order</span><span class="p">,</span>
</span><span id="1-6116">        <span class="p">)</span>
</span><span id="1-6117">
</span><span id="1-6118">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_schema_item_copy</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
</span></pre></div>
        </article>
        
        <div class="navigation flex print:hidden">
  
  
</div>
        
      </div>
    </div>
  </main>
</div>
<footer class="sy-foot">
  <div class="sy-foot-inner sy-container mx-auto">
    
    <div class="sy-foot-reserved md:flex justify-between items-center">
      <div class="sy-foot-copyright"><p>2023, Jolt Org</p>
        
        <p>
          Made with
          
          <a href="https://www.sphinx-doc.org/">Sphinx</a> and
          
          <a href="https://shibuya.lepture.com">Shibuya theme</a>.
        </p>
      </div>
      <div class="sy-foot-socials">
          <a href="https://github.com/jolt-org/advanced-alchemy" aria-label="GitHub"><i class="i-icon github"></i></a>
      </div>
    </div>
  </div>
</footer></div>
      <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js?v=e43216b9"></script>
      <script src="../../../_static/doctools.js?v=888ff710"></script>
      <script src="../../../_static/sphinx_highlight.js?v=4825356b"></script>
      <script src="../../../_static/clipboard.min.js?v=a7894cd8"></script>
      <script src="../../../_static/copybutton.js?v=f281be69"></script>
      <script src="../../../_static/design-tabs.js?v=36754332"></script>
      <script src="../../../_static/shibuya.js?v=3e5c8598"></script>
    
</body>
</html>